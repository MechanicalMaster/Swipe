This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.github/
  workflows/
    build-apk.yml
android/
  app/
    src/
      androidTest/
        java/
          com/
            getcapacitor/
              myapp/
                ExampleInstrumentedTest.java
      main/
        java/
          com/
            swipe/
              app/
                MainActivity.java
        res/
          drawable/
            ic_launcher_background.xml
            splash.png
          drawable-land-hdpi/
            splash.png
          drawable-land-ldpi/
            splash.png
          drawable-land-mdpi/
            splash.png
          drawable-land-night-hdpi/
            splash.png
          drawable-land-night-ldpi/
            splash.png
          drawable-land-night-mdpi/
            splash.png
          drawable-land-night-xhdpi/
            splash.png
          drawable-land-night-xxhdpi/
            splash.png
          drawable-land-night-xxxhdpi/
            splash.png
          drawable-land-xhdpi/
            splash.png
          drawable-land-xxhdpi/
            splash.png
          drawable-land-xxxhdpi/
            splash.png
          drawable-night/
            splash.png
          drawable-port-hdpi/
            splash.png
          drawable-port-ldpi/
            splash.png
          drawable-port-mdpi/
            splash.png
          drawable-port-night-hdpi/
            splash.png
          drawable-port-night-ldpi/
            splash.png
          drawable-port-night-mdpi/
            splash.png
          drawable-port-night-xhdpi/
            splash.png
          drawable-port-night-xxhdpi/
            splash.png
          drawable-port-night-xxxhdpi/
            splash.png
          drawable-port-xhdpi/
            splash.png
          drawable-port-xxhdpi/
            splash.png
          drawable-port-xxxhdpi/
            splash.png
          drawable-v24/
            ic_launcher_foreground.xml
          layout/
            activity_main.xml
          mipmap-anydpi-v26/
            ic_launcher_round.xml
            ic_launcher.xml
          mipmap-hdpi/
            ic_launcher_background.png
            ic_launcher_foreground.png
            ic_launcher_round.png
            ic_launcher.png
          mipmap-ldpi/
            ic_launcher_background.png
            ic_launcher_foreground.png
            ic_launcher_round.png
            ic_launcher.png
          mipmap-mdpi/
            ic_launcher_background.png
            ic_launcher_foreground.png
            ic_launcher_round.png
            ic_launcher.png
          mipmap-xhdpi/
            ic_launcher_background.png
            ic_launcher_foreground.png
            ic_launcher_round.png
            ic_launcher.png
          mipmap-xxhdpi/
            ic_launcher_background.png
            ic_launcher_foreground.png
            ic_launcher_round.png
            ic_launcher.png
          mipmap-xxxhdpi/
            ic_launcher_background.png
            ic_launcher_foreground.png
            ic_launcher_round.png
            ic_launcher.png
          values/
            ic_launcher_background.xml
            strings.xml
            styles.xml
          xml/
            file_paths.xml
        AndroidManifest.xml
      test/
        java/
          com/
            getcapacitor/
              myapp/
                ExampleUnitTest.java
    .gitignore
    build.gradle
    capacitor.build.gradle
    proguard-rules.pro
  gradle/
    wrapper/
      gradle-wrapper.jar
      gradle-wrapper.properties
  .gitignore
  build.gradle
  capacitor.settings.gradle
  gradle.properties
  gradlew
  gradlew.bat
  settings.gradle
  variables.gradle
cypress/
  e2e/
    sanity.cy.js
  support/
    e2e.js
docs/
  ICON_DESIGN_GUIDE.md
public/
  images/
    templates/
      detailed_front.png
      minimal_front.png
      weight_front.png
  templates/
    classic-preview.svg
    classic.svg
    elegant.svg
    modern-preview.svg
    modern.svg
  bg-pattern.png
  file.svg
  globe.svg
  hero-dashboard.png
  landing-bg.jpg
  manifest.json
  next.svg
  vercel.svg
  window.svg
resources/
  icon.png
  splash.png
src/
  app/
    attendance/
      history/
        page.js
      page.js
      page.module.css
    bills/
      purchase/
        create/
          page.js
      page.js
      page.module.css
    coming-soon/
      page.js
    invoice/
      create/
        select-customer/
          page.js
        select-product/
          page.js
        page.js
      edit/
        page.js
      view/
        page.js
    more/
      bills/
        expenses/
          create/
            page.js
            page.module.css
          page.js
          page.module.css
      company/
        page.js
        page.module.css
      label-templates/
        page.js
        page.module.css
      masters/
        products/
          page.js
          page.module.css
        page.js
      profile/
        page.js
        page.module.css
      templates/
        lending/
          page.js
        page.js
      page.js
      page.module.css
    parties/
      customer/
        add/
          page.js
        edit/
          page.js
          page.module.css
        view/
          page.js
      payment/
        create/
          page.js
          page.module.css
      vendor/
        add/
          page.js
        edit/
          page.js
          page.module.css
        view/
          page.js
      form.module.css
      page.js
      page.module.css
    products/
      add/
        page.js
      bulk-upload/
        page.js
        page.module.css
      components/
        __tests__/
          ProductCard.test.js
        FilterBar.js
        FilterBar.module.css
        Pagination.js
        Pagination.module.css
        ProductCard.js
        ProductCard.module.css
      edit/
        page.js
      page.js
      page.module.css
    purchase/
      create/
        select-vendor/
          page.js
        page.js
    reports/
      page.js
      page.module.css
    favicon.ico
    globals.css
    layout.js
    page.js
    page.module.css
    template.js
  components/
    __tests__/
      BottomNav.test.js
    Auth/
      AuthWrapper.js
      LoginFlow.js
      LoginFlow.module.css
    Expenses/
      AddCategoryModal.js
      CategoryModal.js
    icons/
      index.js
    InvoiceTemplates/
      index.js
      Template1.js
      Template2.js
      Template3.js
    LandingPage/
      LandingPage.js
      LandingPage.module.css
    AddressBottomSheet.js
    AnimatedButton.js
    BackButtonHandler.js
    BarcodeScanner.js
    BarcodeScanner.module.css
    BottomNav.js
    BottomNav.module.css
    BottomSheet.js
    BottomSheet.module.css
    CancelInvoiceModal.js
    ComingSoon.js
    ComingSoon.module.css
    ImagePicker.js
    InvoiceBottomSheet.js
    InvoiceForm.js
    InvoiceForm.module.css
    InvoiceTemplate.js
    PartyListItem.js
    PurchaseForm.js
    PurchaseForm.module.css
    ScanResultModal.js
    ScanResultModal.module.css
    Toast.js
    TransactionCard.js
  lib/
    data/
      tagTemplates.js
    db/
      index.js
    hooks/
      useBackButton.js
    services/
      bulkUploadService.js
    store/
      __tests__/
        invoiceStore.test.js
        productStore.test.js
      authStore.js
      expenseStore.js
      invoiceStore.js
      masterStore.js
      partyStore.js
      paymentStore.js
      productStore.js
      purchaseStore.js
      settingsStore.js
    utils/
      __tests__/
        exportUtils.test.js
        numberToWords.test.js
        tax.test.js
      exportUtils.js
      invoiceActions.js
      numberToWords.js
      pdf.js
      tax.js
    animations.js
.gitignore
capacitor.config.json
cypress.config.js
jest.config.js
jest.setup.js
jsconfig.json
Landingpage.jpg
next.config.mjs
package.json
README.md
schema.md
style_guide.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="schema.md">
# IndexedDB Database Schema

**Database Name:** `SwipeInvoiceDB`  
**Current Version:** `11`  
**Database Type:** Dexie.js (IndexedDB wrapper)

---

## Tables Overview

This document describes all tables in the Swipe Invoice application's IndexedDB database, including their indexed columns and data types.

---

## 1. invoices

**Purpose:** Stores invoice and billing records (including regular invoices, proforma invoices, and lending bills)

**Indexes:** `++id, invoiceNumber, date, customerId, status, balanceDue, type`

| Column Name | Type | Description |
|------------|------|-------------|
| `id` | Number (Auto-increment) | Primary key, auto-generated |
| `invoiceNumber` | String | Unique invoice identifier (e.g., "INV-1234") |
| `date` | String (ISO Date) | Invoice date |
| `dueDate` | String (ISO Date) | Payment due date |
| `placeOfSupply` | String | Location where goods/services are supplied |
| `invoiceCopyType` | String | Type of copy (e.g., "Original for Recipient") |
| `customerId` | Number | Foreign key to customers table |
| `customer` | Object | Embedded customer snapshot {name, id, phone} |
| `items` | Array | Array of line items with product details |
| `details` | Object | {reference, notes, terms, extraDiscount, shippingCharges, packagingCharges} |
| `weightSummary` | Object | {grossWeight, netWeight} for jewelry items |
| `toggles` | Object | {tds, tcs, rcm} - tax toggles |
| `totals` | Object | Calculated totals {subtotal, totalTax, total, roundOffAmount, cgst, sgst, igst} |
| `status` | String | Payment status: "Paid", "Partial", "Unpaid", "Pending" |
| `balanceDue` | Number | Outstanding amount |
| `type` | String | Invoice type: "INVOICE", "PROFORMA", or "LENDING" |
| `cgstAmount` | Number | CGST calculated amount |
| `sgstAmount` | Number | SGST calculated amount |
| `totalBeforeTax` | Number | Subtotal before taxes |
| `totalAfterTax` | Number | Final total amount |
| `createdAt` | String (ISO DateTime) | Record creation timestamp |
| `updatedAt` | String (ISO DateTime) | Last update timestamp |

---

## 2. purchases

**Purpose:** Stores purchase orders and vendor invoices

**Indexes:** `++id, purchaseNumber, date, vendorId, status, balanceDue`

| Column Name | Type | Description |
|------------|------|-------------|
| `id` | Number (Auto-increment) | Primary key, auto-generated |
| `purchaseNumber` | String | Unique purchase identifier (e.g., "PUR-1234") |
| `date` | String (ISO Date) | Purchase date |
| `dueDate` | String (ISO Date) | Payment due date |
| `vendorId` | Number | Foreign key to vendors table |
| `vendor` | Object | Embedded vendor snapshot {name, id, phone} |
| `items` | Array | Array of purchased items |
| `details` | Object | {reference, notes, terms, extraDiscount, shippingCharges, packagingCharges} |
| `weightSummary` | Object | {grossWeight, netWeight} |
| `gstEnabled` | Boolean | Whether GST is enabled for this purchase |
| `totals` | Object | Calculated totals {subtotal, totalTax, total, roundOffAmount, cgst, sgst, igst} |
| `status` | String | Payment status: "Paid", "Partial", "Unpaid" |
| `balanceDue` | Number | Outstanding amount |
| `cgstAmount` | Number | CGST calculated amount |
| `sgstAmount` | Number | SGST calculated amount |
| `totalBeforeTax` | Number | Subtotal before taxes |
| `totalAfterTax` | Number | Final total amount |
| `createdAt` | String (ISO DateTime) | Record creation timestamp |
| `updatedAt` | String (ISO DateTime) | Last update timestamp |

---

## 3. customers

**Purpose:** Stores customer/party information

**Indexes:** `++id, name, gstin, phone, email, isDeleted`

| Column Name | Type | Description |
|------------|------|-------------|
| `id` | Number (Auto-increment) | Primary key, auto-generated |
| `name` | String | Customer name |
| `gstin` | String | GST identification number |
| `phone` | String | Contact phone number |
| `email` | String | Email address |
| `balance` | Number | Current account balance (receivable) |
| `isDeleted` | Boolean | Soft delete flag |
| `address` | Object (Optional) | Address details |
| `createdAt` | String (ISO DateTime) | Record creation timestamp |

---

## 4. vendors

**Purpose:** Stores vendor/supplier information

**Indexes:** `++id, name, gstin, phone, email, isDeleted`

| Column Name | Type | Description |
|------------|------|-------------|
| `id` | Number (Auto-increment) | Primary key, auto-generated |
| `name` | String | Vendor name |
| `gstin` | String | GST identification number |
| `phone` | String | Contact phone number |
| `email` | String | Email address |
| `balance` | Number | Current account balance (payable) |
| `isDeleted` | Boolean | Soft delete flag |
| `address` | Object (Optional) | Address details |
| `createdAt` | String (ISO DateTime) | Record creation timestamp |

---

## 5. products

**Purpose:** Stores product catalog (primarily jewelry items)

**Indexes:** `++id, name, type, sku, hsn, category, sellingPrice, purchasePrice, taxRate, unit, barcode`

| Column Name | Type | Description |
|------------|------|-------------|
| `id` | Number (Auto-increment) | Primary key, auto-generated |
| `type` | String | "product" or "service" |
| `name` | String | Product name/title |
| `sku` | String | Stock Keeping Unit code (format: CAT-SUB-000001) |
| `barcode` | String | Barcode identifier |
| `hsn` | String | HSN/SAC code for taxation |
| `category` | String | Product category name |
| `subCategory` | String | Product sub-category name |
| `description` | String | Product description |
| `sellingPrice` | Number | Selling price |
| `purchasePrice` | Number | Purchase/cost price |
| `taxRate` | Number | Applicable tax rate percentage |
| `unit` | String | Unit of measurement (e.g., "gms") |
| **Metal Attributes** | | |
| `metalType` | String | "Gold", "Silver", "Platinum" |
| `metalColor` | String | "Yellow", "White", "Rose", "Two-tone" |
| `purity` | String | "24K", "22K", "18K", "14K" |
| `grossWeight` | Number | Gross weight in grams |
| `netWeight` | Number | Net metal weight in grams |
| `wastagePercentage` | Number | Wastage percentage |
| `wastageWeight` | Number | Wastage weight |
| `makingCharges` | Number | Making charges amount |
| `makingChargesType` | String | "per_gram" or "fixed" |
| `metalRateRef` | String | Reference to metal rate |
| **Gemstone Attributes** | | |
| `hasStones` | Boolean | Whether product has gemstones |
| `stoneType` | String | Type of stone (e.g., "Diamond", "Ruby") |
| `stoneCount` | Number | Number of stones |
| `stoneWeight` | Number | Weight in carats |
| `stoneShape` | String | Shape of stone |
| `stoneClarity` | String | Clarity grade (SI, VS, VVS) |
| `stoneColor` | String | Color grade |
| `stoneCut` | String | Cut quality |
| `stoneCertification` | String | Certification body (GIA, IGI) |
| `stonePrice` | Number | Stone charges/price |
| `stoneSetting` | String | Setting type |
| **Design & Dimensions** | | |
| `size` | String | Product size |
| `pattern` | String | Design pattern details |
| `customizable` | Boolean | Can be customized |
| `engravingText` | String | Engraving details |
| **Other** | | |
| `vendorRef` | String | Vendor reference |
| `procurementDate` | String (ISO Date) | Date of procurement |
| `hallmarkCert` | String | BIS Hallmark certification number |
| `launchDate` | String (ISO Date) | Product launch date |
| `images` | Array | Product images array |
| `showOnline` | Boolean | Show in online store |
| `notForSale` | Boolean | Not available for sale |
| `createdAt` | Date | Record creation timestamp |

---

## 6. payments

**Purpose:** Stores payment transactions

**Indexes:** `++id, transactionNumber, date, type, partyType, partyId`

| Column Name | Type | Description |
|------------|------|-------------|
| `id` | Number (Auto-increment) | Primary key, auto-generated |
| `transactionNumber` | String | Unique transaction identifier |
| `date` | String (ISO Date) | Payment date |
| `type` | String | "IN" (received) or "OUT" (paid) |
| `partyType` | String | "CUSTOMER" or "VENDOR" |
| `partyId` | Number | Foreign key to customer/vendor |
| `amount` | Number | Payment amount |
| `mode` | String | Payment mode: "Cash", "UPI", "CASH", etc. |
| `notes` | String | Payment notes |
| `createdAt` | String (ISO DateTime) | Record creation timestamp |

---

## 7. payment_allocations

**Purpose:** Links payments to specific invoices

**Indexes:** `++id, paymentId, invoiceId`

| Column Name | Type | Description |
|------------|------|-------------|
| `id` | Number (Auto-increment) | Primary key, auto-generated |
| `paymentId` | Number | Foreign key to payments table |
| `invoiceId` | Number | Foreign key to invoices table |
| `amount` | Number | Allocated amount |

---

## 8. audit_logs

**Purpose:** Tracks audit trail for important actions

**Indexes:** `++id, entityType, entityId, action, timestamp`

| Column Name | Type | Description |
|------------|------|-------------|
| `id` | Number (Auto-increment) | Primary key, auto-generated |
| `entityType` | String | Type of entity (e.g., "product") |
| `entityId` | Number | ID of the affected entity |
| `action` | String | Action performed (e.g., "MANUAL_SKU_OVERRIDE") |
| `details` | String | Detailed description of action |
| `timestamp` | Date | When the action occurred |

---

## 9. attendance_log

**Purpose:** Tracks user login/logout sessions

**Indexes:** `++id, userId, loginDate, loginTimestamp, logoutTimestamp, created_at`

| Column Name | Type | Description |
|------------|------|-------------|
| `id` | Number (Auto-increment) | Primary key, auto-generated |
| `userId` | Number/String | User identifier |
| `loginDate` | String (ISO Date) | Login date |
| `loginTimestamp` | String (ISO DateTime) | Login timestamp |
| `logoutTimestamp` | String (ISO DateTime) | Logout timestamp |
| `created_at` | String (ISO DateTime) | Record creation timestamp |

---

## 10. bulk_upload_logs

**Purpose:** Tracks bulk data upload operations

**Indexes:** `++id, userId, fileName, totalRecords, successCount, failureCount, timestamp`

| Column Name | Type | Description |
|------------|------|-------------|
| `id` | Number (Auto-increment) | Primary key, auto-generated |
| `userId` | Number/String | User who performed the upload |
| `fileName` | String | Name of uploaded file |
| `totalRecords` | Number | Total records in upload |
| `successCount` | Number | Successfully imported records |
| `failureCount` | Number | Failed records |
| `timestamp` | String (ISO DateTime) | Upload timestamp |

---

## 11. categories

**Purpose:** Stores product categories

**Indexes:** `++id, name, type`

| Column Name | Type | Description |
|------------|------|-------------|
| `id` | Number (Auto-increment) | Primary key, auto-generated |
| `name` | String | Category name |
| `type` | String | Category type (e.g., "product_category") |

---

## 12. subCategories

**Purpose:** Stores product sub-categories

**Indexes:** `++id, name, categoryId`

| Column Name | Type | Description |
|------------|------|-------------|
| `id` | Number (Auto-increment) | Primary key, auto-generated |
| `name` | String | Sub-category name |
| `categoryId` | Number | Foreign key to categories table |

---

## 13. sequences

**Purpose:** Stores auto-increment sequences for various entities

**Indexes:** `key` (Primary key)

| Column Name | Type | Description |
|------------|------|-------------|
| `key` | String | Sequence identifier (e.g., "product_sku") |
| `value` | Number | Current sequence value |

---

## 14. settings

**Purpose:** Stores application settings and configuration

**Indexes:** `key` (Primary key)

| Column Name | Type | Description |
|------------|------|-------------|
| `key` | String | Setting identifier |
| `value` | Any | Setting value (can be object, string, etc.) |

**Common Settings:**
- `companyDetails`: Company information object
- `userProfile`: User profile object
- `templateId`: Invoice template ID (default: "modern")
- `lendingBillTemplateId`: Lending bill template ID (default: "modern")

---

## 15. tag_templates

**Purpose:** Stores barcode tag/label templates for products

**Indexes:** `template_id, name, version`

| Column Name | Type | Description |
|------------|------|-------------|
| `template_id` | String | Primary key, template identifier |
| `name` | String | Template name |
| `version` | String | Template version |
| `frontFields` | Array (Optional) | Fields to show on front of tag |
| `backFields` | Array (Optional) | Fields to show on back of tag |
| `previewImage` | String (Optional) | Preview image path |

---

## 16. product_tag_config

**Purpose:** Links products to their selected tag templates

**Indexes:** `++id, product_id, template_id`

| Column Name | Type | Description |
|------------|------|-------------|
| `id` | Number (Auto-increment) | Primary key, auto-generated |
| `product_id` | Number | Foreign key to products table |
| `template_id` | String | Foreign key to tag_templates table |

---

## Database Schema Diagram

```
┌─────────────┐         ┌──────────────┐
│  customers  │◄───────┤   invoices   │
└─────────────┘         └──────────────┘
                               │
                               ▼
                        ┌──────────────────────┐
                        │ payment_allocations  │
                        └──────────────────────┘
                               ▲
                               │
┌─────────────┐         ┌──────────────┐
│   vendors   │◄───────┤  purchases   │
└─────────────┘         └──────────────┘
       ▲                       
       │                       
       │                ┌──────────────┐
       └───────────────┤   payments   │
                        └──────────────┘

┌──────────────┐        ┌──────────────────┐        ┌──────────────────────┐
│  categories  │◄──────┤  subCategories   │◄──────┤     products         │
└──────────────┘        └──────────────────┘        └──────────────────────┘
                                                              │
                                                              ▼
                                                     ┌──────────────────────┐
                                                     │ product_tag_config   │
                                                     └──────────────────────┘
                                                              │
                                                              ▼
                                                     ┌──────────────────────┐
                                                     │   tag_templates      │
                                                     └──────────────────────┘
```

---

## Notes

1. **Auto-increment IDs**: All tables use `++id` for auto-incrementing primary keys except `sequences` and `settings` which use `key` as primary key
2. **Soft Deletes**: `customers` and `vendors` use `isDeleted` flag for soft deletion
3. **Embedded Data**: Invoice and purchase records embed customer/vendor snapshots for historical accuracy
4. **Timestamps**: Most tables include `createdAt` and `updatedAt` timestamps in ISO DateTime format
5. **Balance Tracking**: Customer and vendor balances are updated atomically within transactions
6. **Jewelry-Specific**: The schema is optimized for jewelry business with metal, gemstone, and weight-related fields
</file>

<file path="android/app/src/androidTest/java/com/getcapacitor/myapp/ExampleInstrumentedTest.java">
package com.getcapacitor.myapp;

import static org.junit.Assert.*;

import android.content.Context;
import androidx.test.ext.junit.runners.AndroidJUnit4;
import androidx.test.platform.app.InstrumentationRegistry;
import org.junit.Test;
import org.junit.runner.RunWith;

/**
 * Instrumented test, which will execute on an Android device.
 *
 * @see <a href="http://d.android.com/tools/testing">Testing documentation</a>
 */
@RunWith(AndroidJUnit4.class)
public class ExampleInstrumentedTest {

    @Test
    public void useAppContext() throws Exception {
        // Context of the app under test.
        Context appContext = InstrumentationRegistry.getInstrumentation().getTargetContext();

        assertEquals("com.getcapacitor.app", appContext.getPackageName());
    }
}
</file>

<file path="android/app/src/main/java/com/swipe/app/MainActivity.java">
package com.swipe.app;

import com.getcapacitor.BridgeActivity;

public class MainActivity extends BridgeActivity {}
</file>

<file path="android/app/src/main/res/drawable/ic_launcher_background.xml">
<?xml version="1.0" encoding="utf-8"?>
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="108dp"
    android:height="108dp"
    android:viewportHeight="108"
    android:viewportWidth="108">
    <path
        android:fillColor="#26A69A"
        android:pathData="M0,0h108v108h-108z" />
    <path
        android:fillColor="#00000000"
        android:pathData="M9,0L9,108"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,0L19,108"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M29,0L29,108"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M39,0L39,108"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M49,0L49,108"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M59,0L59,108"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M69,0L69,108"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M79,0L79,108"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M89,0L89,108"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M99,0L99,108"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,9L108,9"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,19L108,19"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,29L108,29"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,39L108,39"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,49L108,49"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,59L108,59"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,69L108,69"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,79L108,79"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,89L108,89"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,99L108,99"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,29L89,29"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,39L89,39"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,49L89,49"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,59L89,59"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,69L89,69"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,79L89,79"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M29,19L29,89"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M39,19L39,89"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M49,19L49,89"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M59,19L59,89"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M69,19L69,89"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
    <path
        android:fillColor="#00000000"
        android:pathData="M79,19L79,89"
        android:strokeColor="#33FFFFFF"
        android:strokeWidth="0.8" />
</vector>
</file>

<file path="android/app/src/main/res/drawable-v24/ic_launcher_foreground.xml">
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:aapt="http://schemas.android.com/aapt"
    android:width="108dp"
    android:height="108dp"
    android:viewportHeight="108"
    android:viewportWidth="108">
    <path
        android:fillType="evenOdd"
        android:pathData="M32,64C32,64 38.39,52.99 44.13,50.95C51.37,48.37 70.14,49.57 70.14,49.57L108.26,87.69L108,109.01L75.97,107.97L32,64Z"
        android:strokeColor="#00000000"
        android:strokeWidth="1">
        <aapt:attr name="android:fillColor">
            <gradient
                android:endX="78.5885"
                android:endY="90.9159"
                android:startX="48.7653"
                android:startY="61.0927"
                android:type="linear">
                <item
                    android:color="#44000000"
                    android:offset="0.0" />
                <item
                    android:color="#00000000"
                    android:offset="1.0" />
            </gradient>
        </aapt:attr>
    </path>
    <path
        android:fillColor="#FFFFFF"
        android:fillType="nonZero"
        android:pathData="M66.94,46.02L66.94,46.02C72.44,50.07 76,56.61 76,64L32,64C32,56.61 35.56,50.11 40.98,46.06L36.18,41.19C35.45,40.45 35.45,39.3 36.18,38.56C36.91,37.81 38.05,37.81 38.78,38.56L44.25,44.05C47.18,42.57 50.48,41.71 54,41.71C57.48,41.71 60.78,42.57 63.68,44.05L69.11,38.56C69.84,37.81 70.98,37.81 71.71,38.56C72.44,39.3 72.44,40.45 71.71,41.19L66.94,46.02ZM62.94,56.92C64.08,56.92 65,56.01 65,54.88C65,53.76 64.08,52.85 62.94,52.85C61.8,52.85 60.88,53.76 60.88,54.88C60.88,56.01 61.8,56.92 62.94,56.92ZM45.06,56.92C46.2,56.92 47.13,56.01 47.13,54.88C47.13,53.76 46.2,52.85 45.06,52.85C43.92,52.85 43,53.76 43,54.88C43,56.01 43.92,56.92 45.06,56.92Z"
        android:strokeColor="#00000000"
        android:strokeWidth="1" />
</vector>
</file>

<file path="android/app/src/main/res/layout/activity_main.xml">
<?xml version="1.0" encoding="utf-8"?>
<androidx.coordinatorlayout.widget.CoordinatorLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".MainActivity">

    <WebView
        android:layout_width="match_parent"
        android:layout_height="match_parent" />
</androidx.coordinatorlayout.widget.CoordinatorLayout>
</file>

<file path="android/app/src/main/res/values/ic_launcher_background.xml">
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <color name="ic_launcher_background">#FFFFFF</color>
</resources>
</file>

<file path="android/app/src/main/res/values/strings.xml">
<?xml version='1.0' encoding='utf-8'?>
<resources>
    <string name="app_name">Swipe</string>
    <string name="title_activity_main">Swipe</string>
    <string name="package_name">com.swipe.app</string>
    <string name="custom_url_scheme">com.swipe.app</string>
</resources>
</file>

<file path="android/app/src/main/res/values/styles.xml">
<?xml version="1.0" encoding="utf-8"?>
<resources>

    <!-- Base application theme. -->
    <style name="AppTheme" parent="Theme.AppCompat.Light.DarkActionBar">
        <!-- Customize your theme here. -->
        <item name="colorPrimary">@color/colorPrimary</item>
        <item name="colorPrimaryDark">@color/colorPrimaryDark</item>
        <item name="colorAccent">@color/colorAccent</item>
    </style>

    <style name="AppTheme.NoActionBar" parent="Theme.AppCompat.DayNight.NoActionBar">
        <item name="windowActionBar">false</item>
        <item name="windowNoTitle">true</item>
        <item name="android:background">@null</item>
    </style>


    <style name="AppTheme.NoActionBarLaunch" parent="Theme.SplashScreen">
        <item name="android:background">@drawable/splash</item>
    </style>
</resources>
</file>

<file path="android/app/src/test/java/com/getcapacitor/myapp/ExampleUnitTest.java">
package com.getcapacitor.myapp;

import static org.junit.Assert.*;

import org.junit.Test;

/**
 * Example local unit test, which will execute on the development machine (host).
 *
 * @see <a href="http://d.android.com/tools/testing">Testing documentation</a>
 */
public class ExampleUnitTest {

    @Test
    public void addition_isCorrect() throws Exception {
        assertEquals(4, 2 + 2);
    }
}
</file>

<file path="android/app/.gitignore">
/build/*
!/build/.npmkeep
</file>

<file path="android/app/build.gradle">
apply plugin: 'com.android.application'

android {
    namespace "com.swipe.app"
    compileSdk rootProject.ext.compileSdkVersion
    defaultConfig {
        applicationId "com.swipe.app"
        minSdkVersion rootProject.ext.minSdkVersion
        targetSdkVersion rootProject.ext.targetSdkVersion
        versionCode 1
        versionName "1.0"
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
        aaptOptions {
             // Files and dirs to omit from the packaged assets dir, modified to accommodate modern web apps.
             // Default: https://android.googlesource.com/platform/frameworks/base/+/282e181b58cf72b6ca770dc7ca5f91f135444502/tools/aapt/AaptAssets.cpp#61
            ignoreAssetsPattern '!.svn:!.git:!.ds_store:!*.scc:.*:!CVS:!thumbs.db:!picasa.ini:!*~'
        }
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
}

repositories {
    flatDir{
        dirs '../capacitor-cordova-android-plugins/src/main/libs', 'libs'
    }
}

dependencies {
    implementation fileTree(include: ['*.jar'], dir: 'libs')
    implementation "androidx.appcompat:appcompat:$androidxAppCompatVersion"
    implementation "androidx.coordinatorlayout:coordinatorlayout:$androidxCoordinatorLayoutVersion"
    implementation "androidx.core:core-splashscreen:$coreSplashScreenVersion"
    implementation project(':capacitor-android')
    testImplementation "junit:junit:$junitVersion"
    androidTestImplementation "androidx.test.ext:junit:$androidxJunitVersion"
    androidTestImplementation "androidx.test.espresso:espresso-core:$androidxEspressoCoreVersion"
    implementation project(':capacitor-cordova-android-plugins')
}

apply from: 'capacitor.build.gradle'

try {
    def servicesJSON = file('google-services.json')
    if (servicesJSON.text) {
        apply plugin: 'com.google.gms.google-services'
    }
} catch(Exception e) {
    logger.info("google-services.json not found, google-services plugin not applied. Push Notifications won't work")
}
</file>

<file path="android/app/capacitor.build.gradle">
// DO NOT EDIT THIS FILE! IT IS GENERATED EACH TIME "capacitor update" IS RUN

android {
  compileOptions {
      sourceCompatibility JavaVersion.VERSION_21
      targetCompatibility JavaVersion.VERSION_21
  }
}

apply from: "../capacitor-cordova-android-plugins/cordova.variables.gradle"
dependencies {


}


if (hasProperty('postBuildExtras')) {
  postBuildExtras()
}
</file>

<file path="android/app/proguard-rules.pro">
# Add project specific ProGuard rules here.
# You can control the set of applied configuration files using the
# proguardFiles setting in build.gradle.
#
# For more details, see
#   http://developer.android.com/guide/developing/tools/proguard.html

# If your project uses WebView with JS, uncomment the following
# and specify the fully qualified class name to the JavaScript interface
# class:
#-keepclassmembers class fqcn.of.javascript.interface.for.webview {
#   public *;
#}

# Uncomment this to preserve the line number information for
# debugging stack traces.
#-keepattributes SourceFile,LineNumberTable

# If you keep the line number information, uncomment this to
# hide the original source file name.
#-renamesourcefileattribute SourceFile
</file>

<file path="android/gradle/wrapper/gradle-wrapper.properties">
distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-8.11.1-all.zip
networkTimeout=10000
validateDistributionUrl=true
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists
</file>

<file path="android/.gitignore">
# Using Android gitignore template: https://github.com/github/gitignore/blob/HEAD/Android.gitignore

# Built application files
*.apk
*.aar
*.ap_
*.aab

# Files for the ART/Dalvik VM
*.dex

# Java class files
*.class

# Generated files
bin/
gen/
out/
#  Uncomment the following line in case you need and you don't have the release build type files in your app
# release/

# Gradle files
.gradle/
build/

# Local configuration file (sdk path, etc)
local.properties

# Proguard folder generated by Eclipse
proguard/

# Log Files
*.log

# Android Studio Navigation editor temp files
.navigation/

# Android Studio captures folder
captures/

# IntelliJ
*.iml
.idea/workspace.xml
.idea/tasks.xml
.idea/gradle.xml
.idea/assetWizardSettings.xml
.idea/dictionaries
.idea/libraries
# Android Studio 3 in .gitignore file.
.idea/caches
.idea/modules.xml
# Comment next line if keeping position of elements in Navigation Editor is relevant for you
.idea/navEditor.xml

# Keystore files
# Uncomment the following lines if you do not want to check your keystore files in.
#*.jks
#*.keystore

# External native build folder generated in Android Studio 2.2 and later
.externalNativeBuild
.cxx/

# Google Services (e.g. APIs or Firebase)
# google-services.json

# Freeline
freeline.py
freeline/
freeline_project_description.json

# fastlane
fastlane/report.xml
fastlane/Preview.html
fastlane/screenshots
fastlane/test_output
fastlane/readme.md

# Version control
vcs.xml

# lint
lint/intermediates/
lint/generated/
lint/outputs/
lint/tmp/
# lint/reports/

# Android Profiling
*.hprof

# Cordova plugins for Capacitor
capacitor-cordova-android-plugins

# Copied web assets
app/src/main/assets/public

# Generated Config files
app/src/main/assets/capacitor.config.json
app/src/main/assets/capacitor.plugins.json
app/src/main/res/xml/config.xml
</file>

<file path="android/build.gradle">
// Top-level build file where you can add configuration options common to all sub-projects/modules.

buildscript {
    
    repositories {
        google()
        mavenCentral()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:8.7.2'
        classpath 'com.google.gms:google-services:4.4.2'

        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
    }
}

apply from: "variables.gradle"

allprojects {
    repositories {
        google()
        mavenCentral()
    }
}

task clean(type: Delete) {
    delete rootProject.buildDir
}
</file>

<file path="android/capacitor.settings.gradle">
// DO NOT EDIT THIS FILE! IT IS GENERATED EACH TIME "capacitor update" IS RUN
include ':capacitor-android'
project(':capacitor-android').projectDir = new File('../node_modules/@capacitor/android/capacitor')
</file>

<file path="android/gradle.properties">
# Project-wide Gradle settings.

# IDE (e.g. Android Studio) users:
# Gradle settings configured through the IDE *will override*
# any settings specified in this file.

# For more details on how to configure your build environment visit
# http://www.gradle.org/docs/current/userguide/build_environment.html

# Specifies the JVM arguments used for the daemon process.
# The setting is particularly useful for tweaking memory settings.
org.gradle.jvmargs=-Xmx1536m

# When configured, Gradle will run in incubating parallel mode.
# This option should only be used with decoupled projects. More details, visit
# http://www.gradle.org/docs/current/userguide/multi_project_builds.html#sec:decoupled_projects
# org.gradle.parallel=true

# AndroidX package structure to make it clearer which packages are bundled with the
# Android operating system, and which are packaged with your app's APK
# https://developer.android.com/topic/libraries/support-library/androidx-rn
android.useAndroidX=true
</file>

<file path="android/gradlew">
#!/bin/sh

#
# Copyright © 2015-2021 the original authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# SPDX-License-Identifier: Apache-2.0
#

##############################################################################
#
#   Gradle start up script for POSIX generated by Gradle.
#
#   Important for running:
#
#   (1) You need a POSIX-compliant shell to run this script. If your /bin/sh is
#       noncompliant, but you have some other compliant shell such as ksh or
#       bash, then to run this script, type that shell name before the whole
#       command line, like:
#
#           ksh Gradle
#
#       Busybox and similar reduced shells will NOT work, because this script
#       requires all of these POSIX shell features:
#         * functions;
#         * expansions «$var», «${var}», «${var:-default}», «${var+SET}»,
#           «${var#prefix}», «${var%suffix}», and «$( cmd )»;
#         * compound commands having a testable exit status, especially «case»;
#         * various built-in commands including «command», «set», and «ulimit».
#
#   Important for patching:
#
#   (2) This script targets any POSIX shell, so it avoids extensions provided
#       by Bash, Ksh, etc; in particular arrays are avoided.
#
#       The "traditional" practice of packing multiple parameters into a
#       space-separated string is a well documented source of bugs and security
#       problems, so this is (mostly) avoided, by progressively accumulating
#       options in "$@", and eventually passing that to Java.
#
#       Where the inherited environment variables (DEFAULT_JVM_OPTS, JAVA_OPTS,
#       and GRADLE_OPTS) rely on word-splitting, this is performed explicitly;
#       see the in-line comments for details.
#
#       There are tweaks for specific operating systems such as AIX, CygWin,
#       Darwin, MinGW, and NonStop.
#
#   (3) This script is generated from the Groovy template
#       https://github.com/gradle/gradle/blob/HEAD/platforms/jvm/plugins-application/src/main/resources/org/gradle/api/internal/plugins/unixStartScript.txt
#       within the Gradle project.
#
#       You can find Gradle at https://github.com/gradle/gradle/.
#
##############################################################################

# Attempt to set APP_HOME

# Resolve links: $0 may be a link
app_path=$0

# Need this for daisy-chained symlinks.
while
    APP_HOME=${app_path%"${app_path##*/}"}  # leaves a trailing /; empty if no leading path
    [ -h "$app_path" ]
do
    ls=$( ls -ld "$app_path" )
    link=${ls#*' -> '}
    case $link in             #(
      /*)   app_path=$link ;; #(
      *)    app_path=$APP_HOME$link ;;
    esac
done

# This is normally unused
# shellcheck disable=SC2034
APP_BASE_NAME=${0##*/}
# Discard cd standard output in case $CDPATH is set (https://github.com/gradle/gradle/issues/25036)
APP_HOME=$( cd -P "${APP_HOME:-./}" > /dev/null && printf '%s
' "$PWD" ) || exit

# Use the maximum available, or set MAX_FD != -1 to use that value.
MAX_FD=maximum

warn () {
    echo "$*"
} >&2

die () {
    echo
    echo "$*"
    echo
    exit 1
} >&2

# OS specific support (must be 'true' or 'false').
cygwin=false
msys=false
darwin=false
nonstop=false
case "$( uname )" in                #(
  CYGWIN* )         cygwin=true  ;; #(
  Darwin* )         darwin=true  ;; #(
  MSYS* | MINGW* )  msys=true    ;; #(
  NONSTOP* )        nonstop=true ;;
esac

CLASSPATH=$APP_HOME/gradle/wrapper/gradle-wrapper.jar


# Determine the Java command to use to start the JVM.
if [ -n "$JAVA_HOME" ] ; then
    if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
        # IBM's JDK on AIX uses strange locations for the executables
        JAVACMD=$JAVA_HOME/jre/sh/java
    else
        JAVACMD=$JAVA_HOME/bin/java
    fi
    if [ ! -x "$JAVACMD" ] ; then
        die "ERROR: JAVA_HOME is set to an invalid directory: $JAVA_HOME

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
else
    JAVACMD=java
    if ! command -v java >/dev/null 2>&1
    then
        die "ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
fi

# Increase the maximum file descriptors if we can.
if ! "$cygwin" && ! "$darwin" && ! "$nonstop" ; then
    case $MAX_FD in #(
      max*)
        # In POSIX sh, ulimit -H is undefined. That's why the result is checked to see if it worked.
        # shellcheck disable=SC2039,SC3045
        MAX_FD=$( ulimit -H -n ) ||
            warn "Could not query maximum file descriptor limit"
    esac
    case $MAX_FD in  #(
      '' | soft) :;; #(
      *)
        # In POSIX sh, ulimit -n is undefined. That's why the result is checked to see if it worked.
        # shellcheck disable=SC2039,SC3045
        ulimit -n "$MAX_FD" ||
            warn "Could not set maximum file descriptor limit to $MAX_FD"
    esac
fi

# Collect all arguments for the java command, stacking in reverse order:
#   * args from the command line
#   * the main class name
#   * -classpath
#   * -D...appname settings
#   * --module-path (only if needed)
#   * DEFAULT_JVM_OPTS, JAVA_OPTS, and GRADLE_OPTS environment variables.

# For Cygwin or MSYS, switch paths to Windows format before running java
if "$cygwin" || "$msys" ; then
    APP_HOME=$( cygpath --path --mixed "$APP_HOME" )
    CLASSPATH=$( cygpath --path --mixed "$CLASSPATH" )

    JAVACMD=$( cygpath --unix "$JAVACMD" )

    # Now convert the arguments - kludge to limit ourselves to /bin/sh
    for arg do
        if
            case $arg in                                #(
              -*)   false ;;                            # don't mess with options #(
              /?*)  t=${arg#/} t=/${t%%/*}              # looks like a POSIX filepath
                    [ -e "$t" ] ;;                      #(
              *)    false ;;
            esac
        then
            arg=$( cygpath --path --ignore --mixed "$arg" )
        fi
        # Roll the args list around exactly as many times as the number of
        # args, so each arg winds up back in the position where it started, but
        # possibly modified.
        #
        # NB: a `for` loop captures its iteration list before it begins, so
        # changing the positional parameters here affects neither the number of
        # iterations, nor the values presented in `arg`.
        shift                   # remove old arg
        set -- "$@" "$arg"      # push replacement arg
    done
fi


# Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
DEFAULT_JVM_OPTS='"-Xmx64m" "-Xms64m"'

# Collect all arguments for the java command:
#   * DEFAULT_JVM_OPTS, JAVA_OPTS, JAVA_OPTS, and optsEnvironmentVar are not allowed to contain shell fragments,
#     and any embedded shellness will be escaped.
#   * For example: A user cannot expect ${Hostname} to be expanded, as it is an environment variable and will be
#     treated as '${Hostname}' itself on the command line.

set -- \
        "-Dorg.gradle.appname=$APP_BASE_NAME" \
        -classpath "$CLASSPATH" \
        org.gradle.wrapper.GradleWrapperMain \
        "$@"

# Stop when "xargs" is not available.
if ! command -v xargs >/dev/null 2>&1
then
    die "xargs is not available"
fi

# Use "xargs" to parse quoted args.
#
# With -n1 it outputs one arg per line, with the quotes and backslashes removed.
#
# In Bash we could simply go:
#
#   readarray ARGS < <( xargs -n1 <<<"$var" ) &&
#   set -- "${ARGS[@]}" "$@"
#
# but POSIX shell has neither arrays nor command substitution, so instead we
# post-process each arg (as a line of input to sed) to backslash-escape any
# character that might be a shell metacharacter, then use eval to reverse
# that process (while maintaining the separation between arguments), and wrap
# the whole thing up as a single "set" statement.
#
# This will of course break if any of these variables contains a newline or
# an unmatched quote.
#

eval "set -- $(
        printf '%s\n' "$DEFAULT_JVM_OPTS $JAVA_OPTS $GRADLE_OPTS" |
        xargs -n1 |
        sed ' s~[^-[:alnum:]+,./:=@_]~\\&~g; ' |
        tr '\n' ' '
    )" '"$@"'

exec "$JAVACMD" "$@"
</file>

<file path="android/gradlew.bat">
@rem
@rem Copyright 2015 the original author or authors.
@rem
@rem Licensed under the Apache License, Version 2.0 (the "License");
@rem you may not use this file except in compliance with the License.
@rem You may obtain a copy of the License at
@rem
@rem      https://www.apache.org/licenses/LICENSE-2.0
@rem
@rem Unless required by applicable law or agreed to in writing, software
@rem distributed under the License is distributed on an "AS IS" BASIS,
@rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
@rem See the License for the specific language governing permissions and
@rem limitations under the License.
@rem
@rem SPDX-License-Identifier: Apache-2.0
@rem

@if "%DEBUG%"=="" @echo off
@rem ##########################################################################
@rem
@rem  Gradle startup script for Windows
@rem
@rem ##########################################################################

@rem Set local scope for the variables with windows NT shell
if "%OS%"=="Windows_NT" setlocal

set DIRNAME=%~dp0
if "%DIRNAME%"=="" set DIRNAME=.
@rem This is normally unused
set APP_BASE_NAME=%~n0
set APP_HOME=%DIRNAME%

@rem Resolve any "." and ".." in APP_HOME to make it shorter.
for %%i in ("%APP_HOME%") do set APP_HOME=%%~fi

@rem Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
set DEFAULT_JVM_OPTS="-Xmx64m" "-Xms64m"

@rem Find java.exe
if defined JAVA_HOME goto findJavaFromJavaHome

set JAVA_EXE=java.exe
%JAVA_EXE% -version >NUL 2>&1
if %ERRORLEVEL% equ 0 goto execute

echo. 1>&2
echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH. 1>&2
echo. 1>&2
echo Please set the JAVA_HOME variable in your environment to match the 1>&2
echo location of your Java installation. 1>&2

goto fail

:findJavaFromJavaHome
set JAVA_HOME=%JAVA_HOME:"=%
set JAVA_EXE=%JAVA_HOME%/bin/java.exe

if exist "%JAVA_EXE%" goto execute

echo. 1>&2
echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME% 1>&2
echo. 1>&2
echo Please set the JAVA_HOME variable in your environment to match the 1>&2
echo location of your Java installation. 1>&2

goto fail

:execute
@rem Setup the command line

set CLASSPATH=%APP_HOME%\gradle\wrapper\gradle-wrapper.jar


@rem Execute Gradle
"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %GRADLE_OPTS% "-Dorg.gradle.appname=%APP_BASE_NAME%" -classpath "%CLASSPATH%" org.gradle.wrapper.GradleWrapperMain %*

:end
@rem End local scope for the variables with windows NT shell
if %ERRORLEVEL% equ 0 goto mainEnd

:fail
rem Set variable GRADLE_EXIT_CONSOLE if you need the _script_ return code instead of
rem the _cmd.exe /c_ return code!
set EXIT_CODE=%ERRORLEVEL%
if %EXIT_CODE% equ 0 set EXIT_CODE=1
if not ""=="%GRADLE_EXIT_CONSOLE%" exit %EXIT_CODE%
exit /b %EXIT_CODE%

:mainEnd
if "%OS%"=="Windows_NT" endlocal

:omega
</file>

<file path="android/settings.gradle">
include ':app'
include ':capacitor-cordova-android-plugins'
project(':capacitor-cordova-android-plugins').projectDir = new File('./capacitor-cordova-android-plugins/')

apply from: 'capacitor.settings.gradle'
</file>

<file path="android/variables.gradle">
ext {
    minSdkVersion = 23
    compileSdkVersion = 35
    targetSdkVersion = 35
    androidxActivityVersion = '1.9.2'
    androidxAppCompatVersion = '1.7.0'
    androidxCoordinatorLayoutVersion = '1.2.0'
    androidxCoreVersion = '1.15.0'
    androidxFragmentVersion = '1.8.4'
    coreSplashScreenVersion = '1.0.1'
    androidxWebkitVersion = '1.12.1'
    junitVersion = '4.13.2'
    androidxJunitVersion = '1.2.1'
    androidxEspressoCoreVersion = '3.6.1'
    cordovaAndroidVersion = '10.1.1'
}
</file>

<file path="cypress/e2e/sanity.cy.js">
/// <reference types="cypress" />

describe('Swipe App Sanity Tests', () => {
    beforeEach(() => {
        // Visit the home page before each test
        cy.visit('/');
    });

    describe('Home Page', () => {
        it('should load the home page successfully', () => {
            // Verify the page loads without errors
            cy.url().should('include', '/');
        });

        it('should display the bottom navigation', () => {
            // Check for all navigation items
            cy.contains('Home').should('be.visible');
            cy.contains('Bills').should('be.visible');
            cy.contains('Products').should('be.visible');
            cy.contains('Parties').should('be.visible');
            cy.contains('More').should('be.visible');
        });
    });

    describe('Navigation', () => {
        it('should navigate to Products page', () => {
            cy.contains('Products').click();
            cy.url().should('include', '/products');
        });

        it('should navigate to Bills page', () => {
            cy.contains('Bills').click();
            cy.url().should('include', '/bills');
        });

        it('should navigate to Parties page', () => {
            cy.contains('Parties').click();
            cy.url().should('include', '/parties');
        });

        it('should navigate to More page', () => {
            cy.contains('More').click();
            cy.url().should('include', '/more');
        });

        it('should navigate back to Home from Products', () => {
            // Navigate away from home
            cy.contains('Products').click();
            cy.url().should('include', '/products');

            // Navigate back to home
            cy.contains('Home').click();
            cy.url().should('eq', Cypress.config().baseUrl + '/');
        });
    });

    describe('Products Page', () => {
        beforeEach(() => {
            cy.visit('/products');
        });

        it('should load the products page', () => {
            cy.url().should('include', '/products');
        });

        it('should have a way to add new products', () => {
            // Look for add/create button or link
            cy.get('body').then(($body) => {
                // Check if there's a visible add button or the page loads properly
                expect($body.length).to.be.greaterThan(0);
            });
        });
    });

    describe('Responsive Design', () => {
        it('should display correctly on mobile viewport', () => {
            // Default viewport is already mobile (390x844)
            cy.viewport(390, 844);
            cy.visit('/');

            // Bottom nav should be visible
            cy.contains('Home').should('be.visible');
        });

        it('should display correctly on tablet viewport', () => {
            cy.viewport(768, 1024);
            cy.visit('/');

            // Page should still work
            cy.contains('Home').should('be.visible');
        });
    });
});
</file>

<file path="cypress/support/e2e.js">
// Cypress E2E support file
// This file runs before every single spec file

// Import commands
// import './commands';

// Prevent Cypress from failing tests on uncaught exceptions from the app
Cypress.on('uncaught:exception', (err, runnable) => {
    // Return false to prevent the error from failing the test
    // This is useful for third-party script errors
    return false;
});

// Global before hook - runs once before all tests
before(() => {
    // Clear local storage and session storage
    cy.clearLocalStorage();
    cy.clearAllSessionStorage();
});

// Before each test
beforeEach(() => {
    // Log the current test name for debugging
    cy.log(`Running: ${Cypress.currentTest.title}`);
});

// After each test
afterEach(() => {
    // Add any cleanup logic here
});
</file>

<file path="docs/ICON_DESIGN_GUIDE.md">
# Icon Design Guide

## Overview
Custom SVG icons for the Swipe application featuring a modern, minimal line style with subtle gold accents.

## Color Palette

| Color | Hex | Usage |
|-------|-----|-------|
| Primary Gray | `#666666` | Main strokes, outlines, borders |
| Gold Accent | `#D4AF37` | Key details, checkmarks, highlights |
| Gold Light | `#E5C76B` | Optional lighter gold variant |

## Grid & Sizing

- **Canvas**: 30×30 px
- **Padding**: 2.5 px on all sides
- **Drawable area**: ~25×25 px centered
- No strokes should touch the outer padding

## Stroke Specifications

```
stroke-width: 2.25
stroke-linecap: round
stroke-linejoin: round
fill: none (except small accent fills)
```

## Color Rules

1. **Primary strokes**: `#666666` at 100% opacity
2. **Accent strokes/fills**: `#D4AF37` at 100% opacity
3. **Accent usage**: 10–20% of icon area only
4. Use gold for: checkmarks, pointers, trend lines, key highlights
5. Keep main shapes and borders in gray

## Shape Language

- Use simple geometric primitives
- Circles, rounded rectangles, straight lines, simple curves
- No drop shadows, gradients, or 3D effects
- Maintain consistent visual weight across all icons

## React Component Template

```jsx
export const IconName = ({ size = 24, className }) => (
  <svg 
    width={size} 
    height={size} 
    viewBox="0 0 24 24" 
    fill="none"
    strokeWidth="1.75"
    strokeLinecap="round"
    strokeLinejoin="round"
    className={className}
  >
    {/* Gray elements */}
    <path stroke="#666666" d="..." />
    
    {/* Gold accent */}
    <path stroke="#D4AF37" d="..." />
  </svg>
);
```

## Icon Set Reference

| Icon | Gray Elements | Gold Accent |
|------|---------------|-------------|
| Invoice | Document + lines | Top header line |
| Purchase | Cart body + wheels | Plus sign |
| Quotation | Clipboard + lines | Header bar |
| DailyLogin | Calendar + grid | Checkmark |
| LendingBill | Archive box | Arrow accent |
| Expenses | Wallet outline | Coin symbol |
| ProFormaInvoice | Calculator | Display accent |
| PaymentsTimeline | Document/card | Checkmark |
| Reports | Clock + ticks | Clock hands |
| Insights | X/Y axis | Trend line |
| InvoiceTemplates | Document + lines | Title line |
| DocumentSettings | Gear shape | Center hub |

## Adding New Icons

1. Follow the 24×24 canvas with 2 px padding
2. Use 1.75 px stroke with rounded caps/joins
3. Keep most strokes gray (`#666666`)
4. Reserve gold (`#D4AF37`) for 1–2 key details only
5. Match visual weight of existing icons
6. Export with `fill="none"` at root level
</file>

<file path="public/templates/classic-preview.svg">
<svg width="600" height="850" viewBox="0 0 600 850" xmlns="http://www.w3.org/2000/svg">
  <rect width="600" height="850" fill="white"/>
  
  <!-- Header -->
  <text x="40" y="60" font-family="serif" font-size="24" font-weight="bold" fill="#990099">Godrej</text>
  <text x="40" y="80" font-family="sans-serif" font-size="9">GSTIN: 27ABCCS2942R1ZR</text>
  <text x="40" y="95" font-family="sans-serif" font-size="9">Hyderabad, Telangana</text>
  
  <text x="560" y="60" font-family="sans-serif" font-size="12" fill="#2563eb" text-anchor="end">TAX INVOICE</text>
  <text x="560" y="75" font-family="sans-serif" font-size="8" fill="#666" text-anchor="end">ORIGINAL FOR RECIPIENT</text>

  <!-- Bill To -->
  <text x="40" y="140" font-family="sans-serif" font-size="10" font-weight="bold">Bill To:</text>
  <text x="40" y="155" font-family="sans-serif" font-size="10">Vishal Sharma</text>
  <text x="40" y="170" font-family="sans-serif" font-size="9">GSTIN: 27ABCCS2942R1ZR</text>
  <text x="40" y="185" font-family="sans-serif" font-size="9">Gachibowli, Hyderabad</text>
  
  <text x="450" y="140" font-family="sans-serif" font-size="9" text-anchor="end">Invoice #:</text>
  <text x="560" y="140" font-family="sans-serif" font-size="9" font-weight="bold" text-anchor="end">INV-1</text>
  <text x="450" y="155" font-family="sans-serif" font-size="9" text-anchor="end">Invoice Date:</text>
  <text x="560" y="155" font-family="sans-serif" font-size="9" text-anchor="end">16 Jun 2023</text>

  <!-- Table Header -->
  <rect x="40" y="220" width="520" height="20" fill="#2563eb"/>
  <text x="50" y="234" font-family="sans-serif" font-size="9" fill="white" font-weight="bold">Item</text>
  <text x="300" y="234" font-family="sans-serif" font-size="9" fill="white" font-weight="bold">HSN/SAC</text>
  <text x="400" y="234" font-family="sans-serif" font-size="9" fill="white" font-weight="bold" text-anchor="end">Rate/Item</text>
  <text x="460" y="234" font-family="sans-serif" font-size="9" fill="white" font-weight="bold" text-anchor="end">Qty</text>
  <text x="550" y="234" font-family="sans-serif" font-size="9" fill="white" font-weight="bold" text-anchor="end">Amount</text>

  <!-- Table Row 1 -->
  <text x="50" y="260" font-family="sans-serif" font-size="10" font-weight="bold">Full Back Lounge Chair</text>
  <text x="50" y="275" font-family="sans-serif" font-size="9" fill="#666">Adjustable armrest, Carbon blue</text>
  
  <!-- Product Images Placeholder -->
  <rect x="50" y="290" width="40" height="40" fill="#eee"/>
  <rect x="100" y="290" width="40" height="40" fill="#eee"/>
  <rect x="150" y="290" width="40" height="40" fill="#eee"/>
  
  <text x="300" y="260" font-family="sans-serif" font-size="9">112233</text>
  <text x="400" y="260" font-family="sans-serif" font-size="9" text-anchor="end">11,999.00</text>
  <text x="460" y="260" font-family="sans-serif" font-size="9" text-anchor="end">1</text>
  <text x="550" y="260" font-family="sans-serif" font-size="9" text-anchor="end">11,999.00</text>
  
  <line x1="40" y1="340" x2="560" y2="340" stroke="#eee" stroke-width="1"/>

  <!-- Table Row 2 -->
  <text x="50" y="360" font-family="sans-serif" font-size="10">Table Decors</text>
  <text x="300" y="360" font-family="sans-serif" font-size="9">212232</text>
  <text x="400" y="360" font-family="sans-serif" font-size="9" text-anchor="end">499.00</text>
  <text x="460" y="360" font-family="sans-serif" font-size="9" text-anchor="end">1</text>
  <text x="550" y="360" font-family="sans-serif" font-size="9" text-anchor="end">499.00</text>
  
  <line x1="40" y1="380" x2="560" y2="380" stroke="#2563eb" stroke-width="1"/>

  <!-- Totals -->
  <text x="450" y="400" font-family="sans-serif" font-size="9" text-anchor="end">Taxable Amount</text>
  <text x="550" y="400" font-family="sans-serif" font-size="9" text-anchor="end">12,498.00</text>
  
  <text x="450" y="415" font-family="sans-serif" font-size="9" text-anchor="end">CGST 9.0%</text>
  <text x="550" y="415" font-family="sans-serif" font-size="9" text-anchor="end">1,124.82</text>
  
  <text x="450" y="430" font-family="sans-serif" font-size="9" text-anchor="end">SGST 9.0%</text>
  <text x="550" y="430" font-family="sans-serif" font-size="9" text-anchor="end">1,124.82</text>
  
  <text x="450" y="450" font-family="sans-serif" font-size="12" font-weight="bold" text-anchor="end">Total</text>
  <text x="550" y="450" font-family="sans-serif" font-size="12" font-weight="bold" text-anchor="end">₹14,748.00</text>
  
  <line x1="40" y1="460" x2="560" y2="460" stroke="#2563eb" stroke-width="1"/>
  
  <!-- Footer -->
  <text x="40" y="480" font-family="sans-serif" font-size="10" font-weight="bold">Pay using UPI:</text>
  <rect x="40" y="490" width="60" height="60" fill="white" stroke="#000"/>
  <rect x="45" y="495" width="50" height="50" fill="#000"/>
  
  <text x="120" y="490" font-family="sans-serif" font-size="9" font-weight="bold">Bank Details:</text>
  <text x="120" y="505" font-family="sans-serif" font-size="9">Bank: YES BANK</text>
  
  <circle cx="520" cy="510" r="15" stroke="#2563eb" stroke-width="1" fill="none"/>
  <text x="520" y="513" font-family="sans-serif" font-size="6" fill="#2563eb" text-anchor="middle">SIGNATURE</text>
</svg>
</file>

<file path="public/templates/classic.svg">
<svg width="200" height="280" viewBox="0 0 200 280" xmlns="http://www.w3.org/2000/svg">
  <rect width="200" height="280" fill="white"/>
  <rect x="20" y="20" width="160" height="260" fill="none" stroke="black" stroke-width="1"/>
  <text x="100" y="50" font-family="serif" font-size="16" text-anchor="middle">INVOICE</text>
  <line x1="20" y1="60" x2="180" y2="60" stroke="black" stroke-width="0.5"/>
  <rect x="30" y="80" width="140" height="100" fill="none" stroke="black" stroke-width="0.5"/>
  <line x1="30" y1="100" x2="170" y2="100" stroke="black" stroke-width="0.5"/>
  <rect x="100" y="200" width="70" height="40" fill="none" stroke="black" stroke-width="0.5"/>
</svg>
</file>

<file path="public/templates/elegant.svg">
<svg width="200" height="280" viewBox="0 0 200 280" xmlns="http://www.w3.org/2000/svg">
  <rect width="200" height="280" fill="white"/>
  <rect x="0" y="0" width="200" height="60" fill="#1e293b"/>
  <text x="20" y="40" font-family="serif" font-size="14" fill="white">INVOICE</text>
  <rect x="20" y="80" width="80" height="30" fill="#f1f5f9"/>
  <rect x="20" y="130" width="160" height="1" fill="#e2e8f0"/>
  <rect x="20" y="150" width="160" height="1" fill="#e2e8f0"/>
  <rect x="20" y="170" width="160" height="1" fill="#e2e8f0"/>
  <rect x="120" y="200" width="60" height="40" fill="#f8fafc"/>
</svg>
</file>

<file path="public/templates/modern-preview.svg">
<svg width="600" height="850" viewBox="0 0 600 850" xmlns="http://www.w3.org/2000/svg">
  <rect width="600" height="850" fill="white"/>
  
  <!-- Header -->
  <text x="40" y="50" font-family="sans-serif" font-size="12" font-weight="bold" fill="#2563eb">TAX INVOICE</text>
  <text x="40" y="70" font-family="sans-serif" font-size="18" font-weight="bold">Amazon</text>
  <text x="40" y="90" font-family="sans-serif" font-size="10" fill="#666">GSTIN: 29ABCDE1234F1Z5</text>
  <text x="40" y="105" font-family="sans-serif" font-size="10" fill="#666">Hyderabad, Telangana, 500032</text>
  
  <text x="450" y="70" font-family="sans-serif" font-size="24" font-weight="bold" text-anchor="end">amazon</text>
  <path d="M400 80 Q 425 90 450 80" stroke="#ff9900" stroke-width="2" fill="none"/>

  <!-- Invoice Details -->
  <line x1="40" y1="130" x2="560" y2="130" stroke="#eee" stroke-width="1"/>
  
  <text x="40" y="150" font-family="sans-serif" font-size="10" font-weight="bold">Invoice #: INV-1</text>
  <text x="40" y="165" font-family="sans-serif" font-size="10">Invoice Date: 16 Jun 2023</text>
  
  <text x="300" y="150" font-family="sans-serif" font-size="10" font-weight="bold">Bill To:</text>
  <text x="300" y="165" font-family="sans-serif" font-size="10">Amit Agarwal</text>
  <text x="300" y="180" font-family="sans-serif" font-size="10" fill="#666">Hitech City, Hyderabad</text>

  <!-- Table Header -->
  <rect x="40" y="210" width="520" height="25" fill="#f3f4f6"/>
  <text x="50" y="227" font-family="sans-serif" font-size="10" font-weight="bold">Item</text>
  <text x="350" y="227" font-family="sans-serif" font-size="10" font-weight="bold" text-anchor="end">Rate</text>
  <text x="420" y="227" font-family="sans-serif" font-size="10" font-weight="bold" text-anchor="end">Qty</text>
  <text x="550" y="227" font-family="sans-serif" font-size="10" font-weight="bold" text-anchor="end">Amount</text>

  <!-- Table Row 1 -->
  <text x="50" y="255" font-family="sans-serif" font-size="10" font-weight="bold">Samsung Galaxy F23</text>
  <text x="50" y="270" font-family="sans-serif" font-size="9" fill="#666">HSN: 8517</text>
  <text x="50" y="285" font-family="sans-serif" font-size="9" fill="#666">Color: Aqua Green</text>
  <text x="350" y="255" font-family="sans-serif" font-size="10" text-anchor="end">14,406.93</text>
  <text x="420" y="255" font-family="sans-serif" font-size="10" text-anchor="end">1</text>
  <text x="550" y="255" font-family="sans-serif" font-size="10" text-anchor="end">16,999.00</text>
  <line x1="40" y1="300" x2="560" y2="300" stroke="#eee" stroke-width="1"/>

  <!-- Table Row 2 -->
  <text x="50" y="320" font-family="sans-serif" font-size="10" font-weight="bold">Samsung 45W Travel Adapter</text>
  <text x="50" y="335" font-family="sans-serif" font-size="9" fill="#666">HSN: 8504</text>
  <text x="350" y="320" font-family="sans-serif" font-size="10" text-anchor="end">2,117.80</text>
  <text x="420" y="320" font-family="sans-serif" font-size="10" text-anchor="end">1</text>
  <text x="550" y="320" font-family="sans-serif" font-size="10" text-anchor="end">2,499.00</text>
  <line x1="40" y1="350" x2="560" y2="350" stroke="#eee" stroke-width="1"/>

  <!-- Totals -->
  <text x="450" y="380" font-family="sans-serif" font-size="10" text-anchor="end">Taxable Amount</text>
  <text x="550" y="380" font-family="sans-serif" font-size="10" text-anchor="end">16,523.73</text>
  
  <text x="450" y="400" font-family="sans-serif" font-size="10" text-anchor="end">IGST 18.0%</text>
  <text x="550" y="400" font-family="sans-serif" font-size="10" text-anchor="end">2,974.27</text>
  
  <line x1="400" y1="410" x2="560" y2="410" stroke="#000" stroke-width="1"/>
  <text x="450" y="430" font-family="sans-serif" font-size="12" font-weight="bold" text-anchor="end">Total</text>
  <text x="550" y="430" font-family="sans-serif" font-size="12" font-weight="bold" text-anchor="end">₹19,498.00</text>
  
  <!-- Footer -->
  <rect x="40" y="460" width="80" height="80" fill="white" stroke="#000"/>
  <rect x="45" y="465" width="70" height="70" fill="#000"/> <!-- QR Code Placeholder -->
  
  <text x="140" y="470" font-family="sans-serif" font-size="10" font-weight="bold">Bank Details:</text>
  <text x="140" y="485" font-family="sans-serif" font-size="9">Bank: YES BANK</text>
  <text x="140" y="500" font-family="sans-serif" font-size="9">Account #: 85789999222445</text>
  
  <circle cx="500" cy="480" r="20" stroke="#2563eb" stroke-width="2" fill="none"/>
  <text x="500" y="485" font-family="sans-serif" font-size="8" fill="#2563eb" text-anchor="middle">SIGNATURE</text>
</svg>
</file>

<file path="public/templates/modern.svg">
<svg width="200" height="280" viewBox="0 0 200 280" xmlns="http://www.w3.org/2000/svg">
  <rect width="200" height="280" fill="white"/>
  <rect x="0" y="20" width="200" height="4" fill="#2563eb"/>
  <rect x="20" y="40" width="60" height="10" fill="#2563eb"/>
  <rect x="20" y="60" width="40" height="4" fill="#9ca3af"/>
  <rect x="120" y="40" width="60" height="20" fill="#f3f4f6"/>
  <rect x="20" y="90" width="160" height="20" fill="#f3f4f6"/>
  <rect x="20" y="120" width="160" height="4" fill="#e5e7eb"/>
  <rect x="20" y="130" width="160" height="4" fill="#e5e7eb"/>
  <rect x="20" y="140" width="160" height="4" fill="#e5e7eb"/>
  <rect x="100" y="160" width="80" height="40" fill="#f9fafb"/>
</svg>
</file>

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/manifest.json">
{
  "name": "Swipe Invoice App",
  "short_name": "Swipe",
  "description": "Offline-first Invoice App for MSMEs",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#000000",
  "icons": [
    {
      "src": "/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="src/app/attendance/history/page.js">
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { db } from '@/lib/db';
import { FiArrowLeft, FiCalendar } from 'react-icons/fi';
import styles from '../page.module.css'; // Reusing styles

export default function AttendanceHistoryPage() {
    const router = useRouter();
    const [history, setHistory] = useState([]);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        const loadHistory = async () => {
            try {
                const logs = await db.attendance_log
                    .orderBy('loginTimestamp')
                    .reverse()
                    .toArray();
                setHistory(logs);
            } catch (error) {
                console.error('Error loading history:', error);
            } finally {
                setLoading(false);
            }
        };
        loadHistory();
    }, []);

    const formatFullDate = (dateStr) => {
        return new Date(dateStr).toLocaleDateString('en-IN', {
            weekday: 'short', day: 'numeric', month: 'short', year: 'numeric'
        });
    };

    const formatTime = (isoString) => {
        return new Date(isoString).toLocaleTimeString('en-IN', {
            hour: '2-digit', minute: '2-digit', hour12: true
        });
    };

    return (
        <div className={styles.container}>
            <div className={styles.header}>
                <button className={styles.backButton} onClick={() => router.back()}>
                    <FiArrowLeft />
                </button>
                <div>
                    <div className={styles.title}>Attendance History</div>
                    <div className={styles.subtext}>All your login records</div>
                </div>
            </div>

            <div className={styles.content}>
                <div className={styles.historySection}>
                    <div className={styles.historyList}>
                        {loading ? (
                            <div className={styles.emptyState}>Loading...</div>
                        ) : history.length === 0 ? (
                            <div className={styles.emptyState}>No history available</div>
                        ) : (
                            history.map(log => (
                                <div key={log.id} className={styles.historyItem}>
                                    <div>
                                        <div className={styles.historyDate}>
                                            {formatFullDate(log.loginDate)}
                                        </div>
                                        <div className={styles.historyTime}>
                                            Login at {formatTime(log.loginTimestamp)}
                                        </div>
                                    </div>
                                    <div className={styles.statusTag}>Present</div>
                                </div>
                            ))
                        )}
                    </div>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="src/app/attendance/page.js">
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { db } from '@/lib/db';
import { FiArrowLeft, FiCheckCircle, FiClock, FiCalendar } from 'react-icons/fi';
import styles from './page.module.css';
import Link from 'next/link';

export default function AttendancePage() {
    const router = useRouter();
    const [todayLogin, setTodayLogin] = useState(null);
    const [history, setHistory] = useState([]);
    const [loading, setLoading] = useState(true);

    const checkLoginStatus = async () => {
        try {
            // Get today's date string YYYY-MM-DD
            const now = new Date();
            const todayStr = now.toISOString().split('T')[0];

            // Check if record exists for today
            // Assuming simple single user for now as per app structure, or userId=1
            const record = await db.attendance_log
                .where('loginDate')
                .equals(todayStr)
                .first();

            setTodayLogin(record || null);

            // Load last 5 history items
            const recentLogs = await db.attendance_log
                .orderBy('loginTimestamp')
                .reverse()
                .limit(5)
                .toArray();

            setHistory(recentLogs);
        } catch (error) {
            console.error('Error checking attendance:', error);
        } finally {
            setLoading(false);
        }
    };

    useEffect(() => {
        checkLoginStatus();
    }, []);

    const handleLogin = async () => {
        try {
            const now = new Date();
            const todayStr = now.toISOString().split('T')[0];

            // Double check
            const exists = await db.attendance_log
                .where('loginDate')
                .equals(todayStr)
                .first();

            if (exists) {
                alert('Already logged in for today!');
                setTodayLogin(exists);
                return;
            }

            const newRecord = {
                userId: 1, // Default user
                loginDate: todayStr,
                loginTimestamp: now.toISOString(),
                created_at: now.toISOString()
            };

            await db.attendance_log.add(newRecord);
            await checkLoginStatus(); // Refresh

        } catch (error) {
            console.error('Login failed:', error);
            alert('Failed to record login. Please try again.');
        }
    };

    const formatDate = (dateStr) => {
        return new Date(dateStr).toLocaleDateString('en-IN', {
            weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
        });
    };

    const formatTime = (isoString) => {
        return new Date(isoString).toLocaleTimeString('en-IN', {
            hour: '2-digit', minute: '2-digit', hour12: true
        });
    };

    if (loading) return <div className={styles.container}><div className={styles.content}>Loading...</div></div>;

    return (
        <div className={styles.container}>
            <div className={styles.header}>
                <button className={styles.backButton} onClick={() => router.back()}>
                    <FiArrowLeft />
                </button>
                <div>
                    <div className={styles.title}>Daily Attendance</div>
                    <div className={styles.subtext}>Record your login for today</div>
                </div>
            </div>

            <div className={styles.content}>

                {/* Status Card */}
                <div className={styles.statusCard}>
                    <div className={styles.dateDisplay}>
                        {formatDate(new Date())}
                    </div>

                    {todayLogin ? (
                        <div className={styles.successBadge}>
                            <FiCheckCircle className={styles.successIcon} />
                            <div className={styles.timeDisplay}>
                                {formatTime(todayLogin.loginTimestamp)}
                            </div>
                            <div className={styles.statusLabel}>
                                Present Today
                            </div>
                        </div>
                    ) : (
                        <button className={styles.loginButton} onClick={handleLogin}>
                            <FiClock /> Log In Now
                        </button>
                    )}
                </div>

                {/* History Preview */}
                <div className={styles.historySection}>
                    <div className={styles.sectionHeader}>
                        <div className={styles.sectionTitle}>Recent Activity</div>
                        <Link href="/attendance/history" className={styles.viewAllLink}>
                            View Full History
                        </Link>
                    </div>

                    <div className={styles.historyList}>
                        {history.length === 0 ? (
                            <div className={styles.emptyState}>No attendance records found</div>
                        ) : (
                            history.map(log => (
                                <div key={log.id} className={styles.historyItem}>
                                    <div>
                                        <div className={styles.historyDate}>
                                            {new Date(log.loginDate).toLocaleDateString('en-IN', { day: 'numeric', month: 'short' })}
                                        </div>
                                        <div className={styles.historyTime}>
                                            {formatTime(log.loginTimestamp)}
                                        </div>
                                    </div>
                                    <div className={styles.statusTag}>Present</div>
                                </div>
                            ))
                        )}
                    </div>
                </div>

            </div>
        </div>
    );
}
</file>

<file path="src/app/attendance/page.module.css">
.container {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    background-color: #f8f9fa;
}

.header {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background-color: #fff;
    border-bottom: 1px solid #eee;
}

.backButton {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #333;
}

.title {
    font-size: 18px;
    font-weight: 600;
    color: #000;
}

.subtext {
    font-size: 12px;
    color: #666;
    margin-top: 2px;
}

.content {
    padding: 16px;
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

/* Status Card */
.statusCard {
    background: #fff;
    border-radius: 12px;
    padding: 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    border: 1px solid #eee;
    min-height: 200px;
}

.dateDisplay {
    font-size: 16px;
    color: #666;
    margin-bottom: 8px;
    font-weight: 500;
}

.loginButton {
    background: #2563eb;
    color: #fff;
    border: none;
    padding: 16px 32px;
    border-radius: 32px;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: transform 0.1s;
}

.loginButton:active {
    transform: scale(0.98);
}

.disabledButton {
    background: #dcfce7;
    color: #166534;
    border: 1px solid #bbf7d0;
    cursor: default;
}

.successBadge {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

.successIcon {
    font-size: 48px;
    color: #166534;
}

.timeDisplay {
    font-size: 32px;
    font-weight: 700;
    color: #111;
    font-variant-numeric: tabular-nums;
}

.statusLabel {
    font-size: 14px;
    color: #166534;
    font-weight: 600;
    background: #dcfce7;
    padding: 4px 12px;
    border-radius: 12px;
}

/* History Section */
.historySection {
    background: #fff;
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid #eee;
}

.sectionHeader {
    padding: 16px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.sectionTitle {
    font-size: 16px;
    font-weight: 600;
    color: #333;
}

.viewAllLink {
    font-size: 14px;
    color: #2563eb;
    text-decoration: none;
    font-weight: 500;
}

.historyList {
    display: flex;
    flex-direction: column;
}

.historyItem {
    padding: 16px;
    border-bottom: 1px solid #f3f4f6;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.historyItem:last-child {
    border-bottom: none;
}

.historyDate {
    font-weight: 500;
    color: #333;
}

.historyTime {
    font-size: 14px;
    color: #666;
}

.statusTag {
    font-size: 12px;
    padding: 2px 8px;
    border-radius: 4px;
    background: #dcfce7;
    color: #166534;
    font-weight: 500;
}

.emptyState {
    padding: 32px;
    text-align: center;
    color: #9ca3af;
    font-size: 14px;
}
</file>

<file path="src/app/bills/purchase/create/page.js">
'use client';

import PurchaseForm from '@/components/PurchaseForm';

export default function CreatePurchasePage() {
    return <PurchaseForm />;
}
</file>

<file path="src/app/bills/page.module.css">
.container {
    padding: 16px;
    padding-bottom: 80px;
    background: var(--background);
    min-height: 100vh;
}

.tabs {
    display: flex;
    background: var(--card-bg);
    padding: 0 16px;
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    z-index: 10;
    overflow-x: auto;
}

.tab {
    padding: 16px;
    font-weight: 600;
    color: var(--text-secondary);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    white-space: nowrap;
    font-size: 14px;
}

.activeTab {
    color: var(--primary);
    border-bottom-color: var(--primary);
}

.summaryCard {
    background: var(--card-bg);
    padding: 20px;
    border-radius: 16px;
    /* Card Radius */
    margin: 16px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

.summaryLabel {
    font-size: 12px;
    color: var(--text-secondary);
    font-weight: 500;
    /* Medium */
    margin-bottom: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.summaryAmount {
    font-size: 18px;
    font-weight: 700;
    /* Bold */
    color: var(--foreground);
}

.pending {
    color: #EF4444;
    /* Red for pending */
}

.filterRow {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
    overflow-x: auto;
    padding-bottom: 4px;
}

.filterChip {
    padding: 8px 16px;
    background: white;
    border: 1px solid var(--border);
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    color: var(--text-secondary);
    white-space: nowrap;
}

.activeFilter {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

.emptyState {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
    text-align: center;
    background: var(--primary-light);
    border-radius: 16px;
    min-height: 200px;
    border: 1px dashed var(--primary);
}

.emptyText {
    color: var(--primary);
    font-weight: 700;
    margin-bottom: 8px;
    font-size: 16px;
}

.emptySub {
    font-size: 12px;
    color: var(--text-secondary);
    margin-bottom: 16px;
    max-width: 250px;
    line-height: 1.4;
}

.link {
    color: var(--primary);
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
}

.fab {
    position: fixed;
    bottom: 80px;
    right: 16px;
    background: var(--primary);
    color: white;
    padding: 12px 24px;
    border-radius: 24px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    z-index: 20;
}

.listItem {
    background: var(--card-bg);
    padding: 16px;
    border-radius: 16px;
    /* Card Radius */
    margin-bottom: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

.itemMain {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.itemTitle {
    font-weight: 600;
    color: var(--foreground);
    font-size: 14px;
    display: flex;
    align-items: center;
}

.itemSub {
    font-size: 12px;
    color: var(--text-secondary);
    font-weight: 500;
}

.itemAmount {
    font-weight: 700;
    color: var(--foreground);
    font-size: 16px;
}

.status {
    font-size: 10px;
    padding: 2px 8px;
    border-radius: 12px;
    background: #FEE2E2;
    color: #991B1B;
    margin-left: 8px;
    font-weight: 600;
}
</file>

<file path="src/app/coming-soon/page.js">
'use client';

import ComingSoon from '@/components/ComingSoon';

export default function ComingSoonPage() {
    return <ComingSoon />;
}
</file>

<file path="src/app/invoice/edit/page.js">
'use client';

import { useEffect, Suspense } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { useInvoiceStore } from '@/lib/store/invoiceStore';
import { db } from '@/lib/db';
import InvoiceForm from '@/components/InvoiceForm';
import { FiArrowLeft } from 'react-icons/fi';

function InvoiceEditContent() {
    const router = useRouter();
    const searchParams = useSearchParams();
    const id = searchParams.get('id');
    const { setInvoice, resetInvoice } = useInvoiceStore();

    useEffect(() => {
        const loadInvoice = async () => {
            if (id) {
                const inv = await db.invoices.get(Number(id));
                if (inv) {
                    setInvoice(inv);
                } else {
                    alert('Invoice not found');
                    router.push('/');
                }
            }
        };
        loadInvoice();

        // Cleanup on unmount is tricky because we might want to keep state if navigating to select-product
        // But if we navigate away to home, we should reset.
        // For now, we rely on explicit reset in handleSave or component mount of create page if we were to add one.
        // Actually, Create page should probably reset on mount.

        return () => {
            // Optional: reset if leaving the edit flow completely? 
            // Let's not reset here to allow navigation to sub-pages (select-customer/product)
        };
    }, [id, setInvoice, router]);

    return (
        <div>
            <div style={{ padding: '16px', background: 'white', borderBottom: '1px solid #e5e7eb', display: 'flex', alignItems: 'center', gap: 12 }}>
                <FiArrowLeft size={24} onClick={() => router.back()} style={{ cursor: 'pointer' }} />
                <h1 style={{ fontSize: 18, fontWeight: 600 }}>Update Invoice</h1>
            </div>
            <InvoiceForm isEditMode={true} />
        </div>
    );
}

export default function InvoiceEditPage() {
    return (
        <Suspense fallback={<div>Loading...</div>}>
            <InvoiceEditContent />
        </Suspense>
    );
}
</file>

<file path="src/app/more/bills/expenses/create/page.js">
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { FiChevronLeft, FiCalendar, FiChevronDown, FiCamera, FiUpload, FiCheck } from 'react-icons/fi';
import { FaPlayCircle } from 'react-icons/fa';
import { useExpenseStore } from '@/lib/store/expenseStore';
import CategoryModal from '@/components/Expenses/CategoryModal';
import AddCategoryModal from '@/components/Expenses/AddCategoryModal';
import styles from './page.module.css';

export default function CreateExpensePage() {
    const router = useRouter();
    const { addExpense } = useExpenseStore();

    const [amount, setAmount] = useState('');
    const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
    const [category, setCategory] = useState('');
    const [isPaid, setIsPaid] = useState(true);
    const [paymentType, setPaymentType] = useState('Cash');
    const [paymentDate, setPaymentDate] = useState(new Date().toISOString().split('T')[0]);
    const [description, setDescription] = useState('');

    const [showCategoryModal, setShowCategoryModal] = useState(false);
    const [showAddCategoryModal, setShowAddCategoryModal] = useState(false);
    const [categoryToEdit, setCategoryToEdit] = useState(null);

    const handleCreate = () => {
        if (!amount || !category) {
            alert('Please enter amount and select a category');
            return;
        }

        addExpense({
            amount,
            date,
            category,
            isPaid,
            paymentType: isPaid ? paymentType : null,
            paymentDate: isPaid ? paymentDate : null,
            description,
        });

        router.back();
    };

    const handleEditCategory = (cat) => {
        setCategoryToEdit(cat);
        setShowCategoryModal(false);
        setShowAddCategoryModal(true);
    };

    return (
        <div className={styles.container}>
            <header className={styles.header}>
                <div className={styles.headerLeft}>
                    <button onClick={() => router.back()} className={styles.backButton}>
                        <FiChevronLeft />
                    </button>
                    <h1 className={styles.title}>Create Expense</h1>
                </div>
                <FaPlayCircle className={styles.playButton} />
            </header>

            <div className={styles.content}>
                <div className={styles.formGroup}>
                    <label className={styles.label}>Enter Expense Amount</label>
                    <input
                        type="number"
                        value={amount}
                        onChange={(e) => setAmount(e.target.value)}
                        className={styles.input}
                        placeholder="0.00"
                    />
                </div>

                <div className={styles.formGroup}>
                    <label className={styles.label}>Expense Date</label>
                    <div className={styles.dateInputContainer}>
                        <input
                            type="date"
                            value={date}
                            onChange={(e) => setDate(e.target.value)}
                            className={styles.input}
                        />
                        <FiCalendar className={styles.calendarIcon} />
                    </div>
                </div>

                <div className={styles.formGroup}>
                    <button
                        className={`${styles.selectButton} ${category ? styles.selected : ''}`}
                        onClick={() => setShowCategoryModal(true)}
                    >
                        {category || 'Select Category'}
                        <FiChevronDown />
                    </button>
                </div>

                <div className={styles.toggleContainer}>
                    <label className={styles.toggleLabel}>Mark as Paid</label>
                    <label className={styles.toggleSwitch}>
                        <input
                            type="checkbox"
                            checked={isPaid}
                            onChange={(e) => setIsPaid(e.target.checked)}
                        />
                        <span className={styles.slider}></span>
                    </label>
                </div>

                {isPaid && (
                    <>
                        <div className={styles.formGroup}>
                            <label className={styles.label}>Select Type <span style={{ color: 'red' }}>*</span></label>
                            <div className={styles.paymentTypes}>
                                {['UPI', 'Cash', 'Card', 'Net Banking', 'Cheque', 'EMI'].map((type) => (
                                    <button
                                        key={type}
                                        className={`${styles.paymentType} ${paymentType === type ? styles.active : ''}`}
                                        onClick={() => setPaymentType(type)}
                                    >
                                        {paymentType === type && <div className={styles.checkIcon}><FiCheck /></div>}
                                        {type}
                                    </button>
                                ))}
                            </div>
                        </div>

                        <div className={styles.formGroup}>
                            <label className={styles.label}>Payment date</label>
                            <div className={styles.dateInputContainer}>
                                <input
                                    type="date"
                                    value={paymentDate}
                                    onChange={(e) => setPaymentDate(e.target.value)}
                                    className={styles.input}
                                />
                                <FiCalendar className={styles.calendarIcon} />
                            </div>
                        </div>
                    </>
                )}

                <div className={styles.formGroup}>
                    <label className={styles.label}>Description</label>
                    <textarea
                        value={description}
                        onChange={(e) => setDescription(e.target.value)}
                        className={styles.textArea}
                        placeholder="Expense Description"
                    />
                </div>

                <div className={styles.formGroup}>
                    <label className={styles.label}>Attachments</label>
                    <div className={styles.attachmentButtons}>
                        <button className={styles.attachButton}>
                            <FiCamera /> Camera
                        </button>
                        <button className={styles.attachButton}>
                            <FiUpload /> Upload File
                        </button>
                    </div>
                </div>
            </div>

            <div className={styles.footer}>
                <button onClick={handleCreate} className={styles.createButton}>
                    Create <FiChevronLeft style={{ transform: 'rotate(180deg)' }} />
                </button>
            </div>

            {showCategoryModal && (
                <CategoryModal
                    onClose={() => setShowCategoryModal(false)}
                    onSelect={(cat) => {
                        setCategory(cat);
                        setShowCategoryModal(false);
                    }}
                    onEdit={handleEditCategory}
                />
            )}

            {showAddCategoryModal && (
                <AddCategoryModal
                    onClose={() => setShowAddCategoryModal(false)}
                    categoryToEdit={categoryToEdit}
                />
            )}
        </div>
    );
}
</file>

<file path="src/app/more/bills/expenses/create/page.module.css">
.container {
    display: flex;
    flex-direction: column;
    height: 100vh;
    background-color: #f8f9fa;
}

.header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px;
    background-color: #fff;
    border-bottom: 1px solid #eee;
}

.headerLeft {
    display: flex;
    align-items: center;
}

.backButton {
    background: none;
    border: none;
    font-size: 24px;
    margin-right: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #333;
}

.title {
    font-size: 18px;
    font-weight: 600;
    color: #000;
}

.playButton {
    color: #d32f2f;
    font-size: 24px;
    cursor: pointer;
}

.content {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.formGroup {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.label {
    font-size: 12px;
    color: #666;
    margin-left: 4px;
}

.input {
    padding: 12px 16px;
    border: 1px solid #eee;
    border-radius: 8px;
    font-size: 16px;
    background-color: #f5f5f5;
    outline: none;
}

.input:focus {
    background-color: #fff;
    border-color: #2962ff;
}

.dateInputContainer {
    position: relative;
}

.calendarIcon {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #2962ff;
    pointer-events: none;
}

.selectButton {
    padding: 12px 16px;
    border: 1px solid #eee;
    border-radius: 8px;
    font-size: 16px;
    background-color: #f5f5f5;
    color: #666;
    text-align: left;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
}

.selectButton.selected {
    color: #000;
}

.toggleContainer {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.toggleLabel {
    font-size: 14px;
    font-weight: 500;
    color: #333;
}

.toggleSwitch {
    position: relative;
    display: inline-block;
    width: 48px;
    height: 24px;
}

.toggleSwitch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 24px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked+.slider {
    background-color: #2962ff;
}

input:checked+.slider:before {
    transform: translateX(24px);
}

.paymentTypes {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.paymentType {
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 14px;
    border: none;
    cursor: pointer;
    background-color: #eee;
    color: #333;
    display: flex;
    align-items: center;
    gap: 6px;
}

.paymentType.active {
    background-color: #e8f5e9;
    color: #2e7d32;
    font-weight: 500;
}

.checkIcon {
    font-size: 12px;
}

.textArea {
    padding: 12px 16px;
    border: 1px solid #eee;
    border-radius: 8px;
    font-size: 16px;
    background-color: #fff;
    outline: none;
    min-height: 100px;
    resize: none;
}

.attachmentButtons {
    display: flex;
    gap: 16px;
}

.attachButton {
    flex: 1;
    padding: 12px;
    border: 1px solid #eee;
    border-radius: 8px;
    background-color: #fff;
    color: #2962ff;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    cursor: pointer;
}

.footer {
    padding: 16px;
    background-color: #fff;
    border-top: 1px solid #eee;
}

.createButton {
    width: 100%;
    padding: 14px;
    background-color: #2962ff;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

/* Modal Styles */
.modalOverlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: flex-end;
    z-index: 1000;
}

.modalContent {
    background-color: #fff;
    width: 100%;
    border-top-left-radius: 16px;
    border-top-right-radius: 16px;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from {
        transform: translateY(100%);
    }

    to {
        transform: translateY(0);
    }
}

.modalHeader {
    padding: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #eee;
}

.modalTitle {
    font-size: 18px;
    font-weight: 600;
    color: #000;
}

.closeButton {
    background: none;
    border: none;
    font-size: 24px;
    color: #666;
    cursor: pointer;
}

.modalBody {
    padding: 16px;
    overflow-y: auto;
    flex: 1;
}

.modalSearch {
    display: flex;
    align-items: center;
    background-color: #f5f5f5;
    padding: 10px 16px;
    border-radius: 8px;
    margin-bottom: 16px;
}

.modalSearchInput {
    border: none;
    background: none;
    outline: none;
    flex: 1;
    margin-left: 8px;
    font-size: 14px;
}

.categoryList {
    display: flex;
    flex-direction: column;
}

.categoryItem {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #f5f5f5;
    cursor: pointer;
}

.categoryName {
    font-size: 16px;
    color: #333;
}

.editIcon {
    color: #666;
    font-size: 16px;
}

.modalFooter {
    padding: 16px;
    border-top: 1px solid #eee;
}

.addCategoryButton {
    width: 100%;
    padding: 14px;
    background-color: #2962ff;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
}

.deleteButton {
    flex: 1;
    padding: 14px;
    background-color: #d32f2f;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
}

.saveButton {
    flex: 1;
    padding: 14px;
    background-color: #2962ff;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
}

.modalActions {
    display: flex;
    gap: 16px;
}
</file>

<file path="src/app/more/bills/expenses/page.js">
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import Link from 'next/link';
import { FiChevronLeft, FiSearch, FiChevronDown, FiPlus } from 'react-icons/fi';
import { useExpenseStore } from '@/lib/store/expenseStore';
import styles from './page.module.css';

export default function ExpensesPage() {
    const router = useRouter();
    const { expenses } = useExpenseStore();
    const [activeTab, setActiveTab] = useState('All Transactions');
    const [searchQuery, setSearchQuery] = useState('');

    const filteredExpenses = expenses.filter((expense) => {
        const matchesSearch = expense.category.toLowerCase().includes(searchQuery.toLowerCase()) ||
            (expense.description && expense.description.toLowerCase().includes(searchQuery.toLowerCase()));

        if (activeTab === 'All Transactions') return matchesSearch;
        if (activeTab === 'Paid') return matchesSearch && expense.isPaid;
        if (activeTab === 'Pending') return matchesSearch && !expense.isPaid;
        if (activeTab === 'Cancelled') return matchesSearch && expense.status === 'cancelled'; // Assuming we add cancelled status later
        return matchesSearch;
    });

    const totalAmount = expenses.reduce((sum, exp) => sum + parseFloat(exp.amount || 0), 0);
    const pendingAmount = expenses.filter(exp => !exp.isPaid).reduce((sum, exp) => sum + parseFloat(exp.amount || 0), 0);

    const formatDate = (dateString) => {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
    };

    return (
        <div className={styles.container}>
            <header className={styles.header}>
                <button onClick={() => router.back()} className={styles.backButton}>
                    <FiChevronLeft />
                </button>
                <h1 className={styles.title}>Expenses</h1>
            </header>

            <div className={styles.content}>
                <div className={styles.searchSection}>
                    <FiSearch color="#888" size={18} />
                    <input
                        type="text"
                        placeholder="Search..."
                        className={styles.searchInput}
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                    />
                    <button className={styles.filterButton}>
                        This Year <FiChevronDown />
                    </button>
                </div>

                <div className={styles.summaryCard}>
                    <div className={styles.summaryHeader}>
                        <div className={styles.summaryLabel}>Total Amount <FiChevronDown /></div>
                        <div className={styles.pendingLabel}>Pending</div>
                    </div>
                    <div className={styles.summaryHeader}>
                        <div className={styles.totalAmount}>{totalAmount.toFixed(2)}</div>
                        <div className={styles.pendingAmount}>{pendingAmount.toFixed(2)}</div>
                    </div>
                </div>

                <div className={styles.tabs}>
                    {['All Transactions', 'Paid', 'Pending', 'Cancelled'].map((tab) => (
                        <button
                            key={tab}
                            className={`${styles.tab} ${activeTab === tab ? styles.active : ''}`}
                            onClick={() => setActiveTab(tab)}
                        >
                            {tab}
                            {tab === 'All Transactions' && <span className={styles.tabCount}>{expenses.length}</span>}
                        </button>
                    ))}
                </div>

                <div className={styles.transactionList}>
                    {filteredExpenses.map((expense, index) => (
                        <div key={expense.id} className={styles.transactionCard}>
                            <div className={styles.cardHeader}>
                                <span className={styles.cardId}>#{expenses.length - index}</span>
                                <span className={styles.cardAmount}>₹{parseFloat(expense.amount).toFixed(2)}</span>
                            </div>
                            <div className={styles.cardHeader}>
                                <span className={styles.cardCategory}>{expense.category}</span>
                                <span className={`${styles.cardStatus} ${expense.isPaid ? styles.statusPaid : styles.statusPending}`}>
                                    {expense.isPaid ? 'paid' : 'pending'}
                                </span>
                            </div>
                            <div className={styles.cardDate}>{formatDate(expense.date)}</div>
                        </div>
                    ))}
                </div>
            </div>

            <Link href="/more/bills/expenses/create" className={styles.createButton}>
                <FiPlus /> CREATE EXPENSE
            </Link>
        </div>
    );
}
</file>

<file path="src/app/more/bills/expenses/page.module.css">
.container {
    display: flex;
    flex-direction: column;
    height: 100vh;
    background-color: #f8f9fa;
}

.header {
    display: flex;
    align-items: center;
    padding: 16px;
    background-color: #fff;
    border-bottom: 1px solid #eee;
}

.backButton {
    background: none;
    border: none;
    font-size: 24px;
    margin-right: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #333;
}

.title {
    font-size: 18px;
    font-weight: 600;
    color: #000;
}

.content {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.searchSection {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: #fff;
    padding: 12px 16px;
    border-radius: 8px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.searchInput {
    border: none;
    outline: none;
    font-size: 14px;
    flex: 1;
    margin-left: 8px;
}

.filterButton {
    background: none;
    border: none;
    font-size: 14px;
    font-weight: 500;
    color: #333;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 4px;
}

.summaryCard {
    background-color: #fff;
    padding: 16px;
    border-radius: 8px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.summaryHeader {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.summaryLabel {
    font-size: 14px;
    color: #333;
    display: flex;
    align-items: center;
    gap: 4px;
}

.pendingLabel {
    font-size: 14px;
    color: #333;
}

.totalAmount {
    font-size: 18px;
    font-weight: 700;
    color: #000;
}

.pendingAmount {
    font-size: 18px;
    font-weight: 700;
    color: #e53935;
    text-align: right;
}

.tabs {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    padding-bottom: 4px;
}

.tab {
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 500;
    border: none;
    cursor: pointer;
    white-space: nowrap;
    background-color: #eee;
    color: #666;
}

.tab.active {
    background-color: #2962ff;
    color: #fff;
}

.tabCount {
    background-color: #fff;
    color: #2962ff;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    margin-left: 6px;
}

.tab.active .tabCount {
    background-color: #fff;
    color: #2962ff;
}

.transactionList {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.transactionCard {
    background-color: #fff;
    padding: 16px;
    border-radius: 8px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.cardHeader {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.cardId {
    font-size: 12px;
    color: #666;
}

.cardAmount {
    font-size: 16px;
    font-weight: 600;
    color: #000;
}

.cardCategory {
    font-size: 15px;
    font-weight: 500;
    color: #333;
}

.cardStatus {
    font-size: 12px;
    padding: 2px 8px;
    border-radius: 4px;
    font-weight: 500;
    text-transform: uppercase;
}

.statusPaid {
    background-color: #e8f5e9;
    color: #2e7d32;
}

.statusPending {
    background-color: #ffebee;
    color: #c62828;
}

.cardDate {
    font-size: 12px;
    color: #888;
}

.createButton {
    position: fixed;
    bottom: 90px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #2962ff;
    color: #fff;
    border: none;
    border-radius: 24px;
    padding: 12px 24px;
    font-size: 16px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 12px rgba(41, 98, 255, 0.3);
    cursor: pointer;
    z-index: 100;
    text-decoration: none;
}
</file>

<file path="src/app/more/label-templates/page.js">
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { FiArrowLeft, FiCheck } from 'react-icons/fi';
import { TAG_TEMPLATES, DEFAULT_TEMPLATE_ID } from '@/lib/data/tagTemplates';
import { db } from '@/lib/db';
import styles from './page.module.css';

export default function LabelTemplatesPage() {
    const router = useRouter();
    const [selectedTemplate, setSelectedTemplate] = useState(DEFAULT_TEMPLATE_ID);
    const [showBack, setShowBack] = useState(false);
    const [saving, setSaving] = useState(false);

    // Load saved template preference
    useEffect(() => {
        const loadSavedTemplate = async () => {
            try {
                const setting = await db.settings.get('selectedLabelTemplate');
                if (setting) {
                    setSelectedTemplate(setting.value);
                }
            } catch (err) {
                console.error('Failed to load template setting:', err);
            }
        };
        loadSavedTemplate();
    }, []);

    const handleSelectTemplate = async (templateId) => {
        setSelectedTemplate(templateId);
        setSaving(true);
        try {
            await db.settings.put({ key: 'selectedLabelTemplate', value: templateId });
        } catch (err) {
            console.error('Failed to save template setting:', err);
        }
        setSaving(false);
    };

    return (
        <div className={styles.container}>
            {/* Header */}
            <div className={styles.header}>
                <FiArrowLeft size={24} onClick={() => router.back()} style={{ cursor: 'pointer' }} />
                <h1 className={styles.title}>Label Templates</h1>
                <div style={{ width: 24 }}></div>
            </div>

            {/* Toggle Front/Back */}
            <div className={styles.toggleContainer}>
                <button
                    className={`${styles.toggleBtn} ${!showBack ? styles.active : ''}`}
                    onClick={() => setShowBack(false)}
                >
                    Front View
                </button>
                <button
                    className={`${styles.toggleBtn} ${showBack ? styles.active : ''}`}
                    onClick={() => setShowBack(true)}
                >
                    Back View
                </button>
            </div>

            {/* Template Grid */}
            <div className={styles.grid}>
                {TAG_TEMPLATES.map((template) => (
                    <div
                        key={template.template_id}
                        className={`${styles.card} ${selectedTemplate === template.template_id ? styles.selected : ''}`}
                        onClick={() => handleSelectTemplate(template.template_id)}
                    >
                        {selectedTemplate === template.template_id && (
                            <div className={styles.checkBadge}>
                                <FiCheck size={16} />
                            </div>
                        )}

                        <div className={styles.previewContainer}>
                            <img
                                key={`${template.template_id}-${showBack ? 'back' : 'front'}`}
                                src={showBack ? template.preview_back : template.preview_front}
                                alt={`${template.name} preview`}
                                className={styles.previewImage}
                                onError={(e) => {
                                    // Fallback to placeholder if image not found
                                    e.target.style.display = 'none';
                                    e.target.nextSibling.style.display = 'flex';
                                }}
                            />
                            <div className={styles.previewPlaceholder} style={{ display: 'none' }}>
                                <div className={styles.barcodePlaceholder}></div>
                                <div className={styles.textPlaceholder}></div>
                                {template.template_id === 'WEIGHT' && (
                                    <div className={styles.weightBig}>9.97g</div>
                                )}
                            </div>
                        </div>

                        <div className={styles.cardContent}>
                            <h3 className={styles.templateName}>{template.name}</h3>
                            <p className={styles.templateDesc}>{template.description}</p>
                        </div>
                    </div>
                ))}
            </div>

            {/* Coming Soon Note */}
            <div className={styles.note}>
                More templates coming soon
            </div>

            {saving && (
                <div className={styles.savingIndicator}>Saving...</div>
            )}
        </div>
    );
}
</file>

<file path="src/app/more/label-templates/page.module.css">
.container {
    min-height: 100vh;
    background: #f8fafc;
    padding-bottom: 80px;
}

.header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px;
    background: white;
    border-bottom: 1px solid #e5e7eb;
}

.title {
    font-size: 18px;
    font-weight: 600;
    color: #111827;
    margin: 0;
}

.toggleContainer {
    display: flex;
    gap: 8px;
    padding: 16px;
    background: white;
}

.toggleBtn {
    flex: 1;
    padding: 10px 16px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    background: white;
    color: #6b7280;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
}

.toggleBtn.active {
    background: #2563eb;
    color: white;
    border-color: #2563eb;
}

.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 16px;
    padding: 16px;
}

.card {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    border: 2px solid transparent;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.card.selected {
    border-color: #2563eb;
}

.checkBadge {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 28px;
    height: 28px;
    background: #2563eb;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
}

.previewContainer {
    width: 100%;
    aspect-ratio: 4/3;
    background: #f9fafb;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 16px;
    overflow: hidden;
}

.previewImage {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}

.previewPlaceholder {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

.barcodePlaceholder {
    width: 80%;
    height: 32px;
    background: linear-gradient(90deg, #333 2px, transparent 2px) 0 0 / 4px 100%;
}

.textPlaceholder {
    width: 60%;
    height: 8px;
    background: #d1d5db;
    border-radius: 4px;
}

.weightBig {
    font-size: 24px;
    font-weight: 700;
    color: #111827;
    margin-top: 8px;
}

.cardContent {
    padding: 12px;
    border-top: 1px solid #f3f4f6;
}

.templateName {
    margin: 0 0 4px;
    font-size: 14px;
    font-weight: 600;
    color: #111827;
}

.templateDesc {
    margin: 0;
    font-size: 12px;
    color: #6b7280;
    line-height: 1.4;
}

.note {
    text-align: center;
    padding: 24px;
    color: #9ca3af;
    font-size: 13px;
    font-style: italic;
}

.savingIndicator {
    position: fixed;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%);
    background: #111827;
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 14px;
}
</file>

<file path="src/app/more/masters/products/page.js">
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { useMasterStore } from '@/lib/store/masterStore';
import { FiArrowLeft, FiPlus, FiSearch, FiEdit2, FiX, FiCheck } from 'react-icons/fi';
import styles from './page.module.css';
import clsx from 'clsx';

export default function ProductMastersPage() {
    const router = useRouter();
    const {
        categories, loadCategories,
        subCategories, loadSubCategories,
        addCategory, updateCategory, deleteCategory,
        addSubCategory, updateSubCategory, deleteSubCategory
    } = useMasterStore();

    const [activeTab, setActiveTab] = useState('categories'); // 'categories' | 'subcategories'
    const [search, setSearch] = useState('');
    const [isModalOpen, setIsModalOpen] = useState(false);
    const [editingItem, setEditingItem] = useState(null); // If set, we are editing

    useEffect(() => {
        loadCategories();
        loadSubCategories();
    }, []);

    const filteredItems = activeTab === 'categories'
        ? categories.filter(c => c.name.toLowerCase().includes(search.toLowerCase()))
        : subCategories.filter(sc =>
            sc.name.toLowerCase().includes(search.toLowerCase()) ||
            categories.find(c => c.id === sc.categoryId)?.name.toLowerCase().includes(search.toLowerCase())
        );

    const handleEdit = (item) => {
        setEditingItem(item);
        setIsModalOpen(true);
    };

    const handleAdd = () => {
        setEditingItem(null);
        setIsModalOpen(true);
    };

    return (
        <div className={styles.container}>
            {/* Header */}
            <div className={styles.header}>
                <div className={styles.headerLeft}>
                    <button className={styles.backButton} onClick={() => router.back()}>
                        <FiArrowLeft />
                    </button>
                    <div className={styles.title}>Product Masters</div>
                </div>
            </div>

            {/* Tabs */}
            <div className={styles.tabContainer}>
                <div
                    className={clsx(styles.tab, activeTab === 'categories' && styles.active)}
                    onClick={() => setActiveTab('categories')}
                >
                    Categories
                </div>
                <div
                    className={clsx(styles.tab, activeTab === 'subcategories' && styles.active)}
                    onClick={() => setActiveTab('subcategories')}
                >
                    Sub-Categories
                </div>
            </div>

            {/* Search */}
            <div style={{ padding: '16px 16px 0 16px' }}>
                <div className={styles.searchBar}>
                    <FiSearch color="#9ca3af" size={20} />
                    <input
                        className={styles.searchInput}
                        placeholder={`Search ${activeTab === 'categories' ? 'categories...' : 'sub-categories...'}`}
                        value={search}
                        onChange={(e) => setSearch(e.target.value)}
                    />
                </div>
            </div>

            {/* List */}
            <div className={styles.content}>
                {filteredItems.map(item => (
                    <div key={item.id} className={styles.itemCard} onClick={() => handleEdit(item)}>
                        <div className={styles.itemInfo}>
                            <div className={styles.itemName}>{item.name}</div>
                            {activeTab === 'subcategories' && (
                                <div className={styles.itemSub}>
                                    {categories.find(c => c.id === item.categoryId)?.name || 'Unknown Category'}
                                </div>
                            )}
                        </div>
                        <FiEdit2 color="#6b7280" />
                    </div>
                ))}
                {filteredItems.length === 0 && (
                    <div style={{ textAlign: 'center', color: '#9ca3af', marginTop: 32 }}>
                        No {activeTab} found
                    </div>
                )}
            </div>

            {/* FAB */}
            <div className={styles.fab} onClick={handleAdd}>
                <FiPlus size={24} />
                <span>NEW {activeTab === 'categories' ? 'CATEGORY' : 'SUB-CATEGORY'}</span>
            </div>

            {/* Modal */}
            {isModalOpen && (
                <MasterModal
                    isOpen={isModalOpen}
                    onClose={() => setIsModalOpen(false)}
                    mode={activeTab}
                    item={editingItem}
                    categories={categories}
                    actions={{
                        addCategory, updateCategory, deleteCategory,
                        addSubCategory, updateSubCategory, deleteSubCategory
                    }}
                />
            )}
        </div>
    );
}

function MasterModal({ isOpen, onClose, mode, item, categories, actions }) {
    // Shared State
    const [name, setName] = useState(item ? item.name : '');
    const [categoryId, setCategoryId] = useState(item ? item.categoryId : '');

    // Reset when modal opens/changes
    useEffect(() => {
        if (isOpen) {
            setName(item ? item.name : '');
            setCategoryId(item ? item.categoryId : '');
        }
    }, [isOpen, item]);

    const handleSave = async () => {
        if (!name.trim()) return alert('Name is required');

        if (mode === 'categories') {
            if (item) {
                await actions.updateCategory(item.id, { name });
            } else {
                await actions.addCategory(name);
            }
        } else {
            // Subcategory
            if (!categoryId) return alert('Category is required for Sub-Category');
            if (item) {
                await actions.updateSubCategory(item.id, { name, categoryId: Number(categoryId) });
            } else {
                await actions.addSubCategory(name, Number(categoryId));
            }
        }
        onClose();
    };

    const handleDelete = async () => {
        if (!item) return;
        if (confirm('Are you sure you want to delete this item?')) {
            if (mode === 'categories') {
                await actions.deleteCategory(item.id);
            } else {
                await actions.deleteSubCategory(item.id);
            }
            onClose();
        }
    };

    if (!isOpen) return null;

    return (
        <div className={styles.modalOverlay} onClick={onClose}>
            <div className={styles.modalContent} onClick={e => e.stopPropagation()}>
                <div className={styles.modalHeader}>
                    <div className={styles.modalTitle}>
                        {item ? 'Edit' : 'Add'} {mode === 'categories' ? 'Category' : 'Sub-Category'}
                    </div>
                    <button className={styles.closeButton} onClick={onClose}>
                        <FiX />
                    </button>
                </div>

                <div className={styles.modalBody}>
                    <div className={styles.formGroup}>
                        <label className={styles.label}>Name</label>
                        <input
                            className={styles.input}
                            placeholder="Enter Name"
                            value={name}
                            onChange={(e) => setName(e.target.value)}
                            autoFocus
                        />
                    </div>

                    {mode === 'subcategories' && (
                        <div className={styles.formGroup}>
                            <label className={styles.label}>Parent Category</label>
                            <select
                                className={styles.select}
                                value={categoryId}
                                onChange={(e) => setCategoryId(e.target.value)}
                            >
                                <option value="">Select Category</option>
                                {categories.map(c => (
                                    <option key={c.id} value={c.id}>{c.name}</option>
                                ))}
                            </select>
                        </div>
                    )}
                </div>

                <div className={styles.modalFooter}>
                    <div className={styles.modalActions}>
                        {item && (
                            <button className={styles.deleteButton} onClick={handleDelete}>Delete</button>
                        )}
                        <button className={styles.saveButton} onClick={handleSave}>Save</button>
                    </div>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="src/app/more/masters/page.js">
'use client';

import { useEffect } from 'react';
import { useRouter } from 'next/navigation';

export default function MastersPage() {
    const router = useRouter();

    useEffect(() => {
        router.replace('/more/masters/products');
    }, []);

    return null;
}
</file>

<file path="src/app/more/profile/page.module.css">
.container {
    padding: 16px;
    padding-bottom: 80px;
    background: #f3f4f6;
    min-height: 100vh;
}

.header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 24px;
    font-size: 18px;
    font-weight: 600;
}

.sectionLabel {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 12px;
    color: #1f2937;
    margin-left: 4px;
}

.card {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 24px;
}

.item {
    display: flex;
    align-items: center;
    padding: 16px;
    gap: 16px;
    border-bottom: 1px solid #f3f4f6;
    cursor: pointer;
}

.item:last-child {
    border-bottom: none;
}

.icon {
    color: #4b5563;
    font-size: 20px;
}

.content {
    flex: 1;
}

.label {
    font-size: 14px;
    color: #1f2937;
    margin-bottom: 2px;
}

.subLabel {
    font-size: 12px;
    color: #6b7280;
}

.arrow {
    color: var(--primary);
}

.dangerItem {
    display: flex;
    align-items: center;
    padding: 16px;
    gap: 16px;
    border-bottom: 1px solid #f3f4f6;
    cursor: pointer;
    color: #ef4444;
}

.dangerIcon {
    font-size: 20px;
}

.dangerLabel {
    flex: 1;
    font-size: 14px;
}

.footer {
    text-align: center;
    margin-top: 40px;
}

.supportButton {
    background: white;
    border: 1px solid #e5e7eb;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    color: #1f2937;
}
</file>

<file path="src/app/more/templates/lending/page.js">
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { useSettingsStore } from '@/lib/store/settingsStore';
import { templates } from '@/components/InvoiceTemplates';
import { FiArrowLeft, FiCheck } from 'react-icons/fi';

export default function LendingTemplatesPage() {
    const router = useRouter();
    const { lendingBillTemplateId, setLendingBillTemplateId, loadSettings } = useSettingsStore();
    const [selectedId, setSelectedId] = useState('modern');

    useEffect(() => {
        loadSettings();
    }, []);

    useEffect(() => {
        if (lendingBillTemplateId) {
            setSelectedId(lendingBillTemplateId);
        }
    }, [lendingBillTemplateId]);

    const handleSave = async () => {
        await setLendingBillTemplateId(selectedId);
        router.back();
    };

    const selectedTemplate = templates[selectedId] || templates.modern;

    return (
        <div style={{ background: '#f3f4f6', minHeight: '100vh', display: 'flex', flexDirection: 'column' }}>
            {/* Header */}
            <div style={{
                background: 'white',
                padding: '16px',
                display: 'flex',
                alignItems: 'center',
                gap: 12,
                borderBottom: '1px solid #e5e7eb',
                position: 'sticky', top: 0, zIndex: 10
            }}>
                <FiArrowLeft size={24} onClick={() => router.back()} style={{ cursor: 'pointer' }} />
                <div style={{ fontWeight: 700, fontSize: 18 }}>Lending Bill Template</div>
            </div>

            {/* Preview Area */}
            <div style={{ flex: 1, overflow: 'auto', padding: '20px', display: 'flex', justifyContent: 'center', background: '#f3f4f6' }}>
                <div style={{
                    width: '100%', maxWidth: '400px',
                    boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                    borderRadius: '8px', overflow: 'hidden'
                }}>
                    <img
                        src={selectedTemplate.previewImage}
                        alt="Template Preview"
                        style={{ width: '100%', height: 'auto', display: 'block' }}
                    />
                </div>
            </div>

            {/* Template Selector */}
            <div style={{
                background: 'white',
                padding: '20px',
                borderTop: '1px solid #e5e7eb',
                zIndex: 10
            }}>
                <div style={{ marginBottom: '16px' }}>
                    <div style={{ fontWeight: 600 }}>Choose Lending Bill Template</div>
                    <div style={{ fontSize: '12px', color: '#6b7280', marginTop: '4px' }}>This template controls the layout and styling of your Lending Bill PDFs.</div>
                </div>
                <div style={{ display: 'flex', gap: '16px', overflowX: 'auto', paddingBottom: '8px' }}>
                    {Object.values(templates).map((template) => (
                        <div
                            key={template.id}
                            onClick={() => setSelectedId(template.id)}
                            style={{
                                minWidth: '100px',
                                cursor: 'pointer',
                                display: 'flex',
                                flexDirection: 'column',
                                alignItems: 'center',
                                gap: '8px'
                            }}
                        >
                            <div style={{
                                width: '80px',
                                height: '100px',
                                border: selectedId === template.id ? '2px solid #2563eb' : '1px solid #e5e7eb',
                                borderRadius: '8px',
                                background: '#f9fafb',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                position: 'relative',
                                overflow: 'hidden'
                            }}>
                                <img
                                    src={template.thumbnail}
                                    alt={template.name}
                                    style={{ width: '100%', height: '100%', objectFit: 'cover' }}
                                />
                                {selectedId === template.id && (
                                    <div style={{
                                        position: 'absolute', top: 4, right: 4,
                                        background: '#2563eb', borderRadius: '50%',
                                        width: 16, height: 16, display: 'flex', alignItems: 'center', justifyContent: 'center'
                                    }}>
                                        <FiCheck size={10} color="white" />
                                    </div>
                                )}
                            </div>
                            <div style={{ fontSize: '12px', fontWeight: selectedId === template.id ? 600 : 400 }}>
                                {template.name}
                            </div>
                        </div>
                    ))}
                </div>

                <button
                    onClick={handleSave}
                    style={{
                        width: '100%',
                        background: '#2563eb',
                        color: 'white',
                        border: 'none',
                        padding: '14px',
                        borderRadius: '8px',
                        fontWeight: 600,
                        marginTop: '16px'
                    }}
                >
                    Save & Update
                </button>
            </div>
        </div>
    );
}
</file>

<file path="src/app/parties/payment/create/page.module.css">
.container {
    background-color: #f9fafb;
    min-height: 100vh;
    padding-bottom: 100px;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
}

.header {
    background-color: white;
    padding: 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid #e5e7eb;
    position: sticky;
    top: 0;
    z-index: 10;
}

.headerTitle {
    font-size: 18px;
    font-weight: 600;
    color: #111827;
}

.headerSubtitle {
    font-size: 12px;
    color: #6b7280;
}

.content {
    padding: 16px;
}

.sectionTitle {
    font-size: 14px;
    color: #374151;
    margin-bottom: 4px;
}

.sectionTitleBold {
    font-size: 16px;
    font-weight: 700;
    color: #111827;
    margin-bottom: 16px;
}

.inputGroup {
    margin-bottom: 20px;
}

.label {
    font-size: 14px;
    color: #4b5563;
    margin-bottom: 8px;
    display: block;
}

.resetLink {
    font-size: 12px;
    color: #ef4444;
    cursor: pointer;
    font-weight: 500;
}

.amountInputContainer {
    position: relative;
    background: white;
    border: 1px solid #16a34a;
    border-radius: 8px;
    padding: 12px;
    display: flex;
    align-items: center;
}

.currencySymbol {
    font-size: 20px;
    font-weight: 600;
    color: #111827;
    margin-right: 4px;
}

.amountInput {
    border: none;
    outline: none;
    font-size: 20px;
    font-weight: 600;
    width: 100%;
    color: #111827;
}

.pendingText {
    font-size: 12px;
    color: #9ca3af;
    margin-top: 4px;
}

.dateInputContainer {
    position: relative;
}

.dateInput {
    width: 100%;
    padding: 12px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    background: white;
    font-size: 14px;
    color: #111827;
    outline: none;
}

.calendarIcon {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #6b7280;
    pointer-events: none;
}

.chipContainer {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.chip {
    padding: 8px 16px;
    background: #f3f4f6;
    border-radius: 20px;
    font-size: 14px;
    color: #374151;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 4px;
    font-weight: 500;
}

.activeChip {
    background: #dcfce7;
    color: #166534;
}

.checkIcon {
    font-size: 12px;
}

.addNewButton {
    display: flex;
    align-items: center;
    gap: 6px;
    background: #e5e7eb;
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    color: #374151;
    cursor: pointer;
}

.textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    font-size: 14px;
    outline: none;
    min-height: 80px;
    resize: vertical;
}

.divider {
    height: 1px;
    background: #e5e7eb;
    margin: 24px 0;
}

.attachmentButtons {
    display: flex;
    gap: 12px;
}

.attachmentButton {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    background: white;
    border: 1px solid #e5e7eb;
    padding: 12px;
    border-radius: 8px;
    color: #2563eb;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
}

.toggleGroup {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px solid #f3f4f6;
}

.toggleLabel {
    font-size: 14px;
    font-weight: 600;
    color: #374151;
}

.toggleSubLabel {
    font-size: 12px;
    color: #6b7280;
}

/* Switch Styles */
.switch {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 24px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 24px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked+.slider {
    background-color: #16a34a;
}

input:checked+.slider:before {
    transform: translateX(20px);
}

.footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    padding: 16px;
    border-top: 1px solid #e5e7eb;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
}

.footerAmount {
    flex: 1;
}

.footerLabel {
    font-size: 12px;
    color: #6b7280;
}

.footerValue {
    font-size: 20px;
    font-weight: 700;
    color: #111827;
}

.recordButton {
    background: #16a34a;
    color: white;
    border: none;
    padding: 12px 32px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
}

.bankButton {
    padding: 8px 16px;
    border-radius: 20px;
    display: inline-flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
}

.cancelButton {
    font-size: 16px;
    font-weight: 600;
    color: #111827;
    cursor: pointer;
    padding: 12px;
    text-decoration: underline;
}
</file>

<file path="src/app/parties/vendor/edit/page.js">
'use client';

import { useState, useEffect, Suspense } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { usePartyStore } from '@/lib/store/partyStore';
import { FiArrowLeft, FiMoreHorizontal, FiPlayCircle, FiPlusCircle, FiCopy, FiChevronDown } from 'react-icons/fi';
import { AddressBottomSheet } from '@/components/AddressBottomSheet';
import AnimatedButton from '@/components/AnimatedButton';
import styles from './page.module.css';

function VendorEditContent() {
    const router = useRouter();
    const searchParams = useSearchParams();
    const id = searchParams.get('id');
    const { getVendor, updateVendor } = usePartyStore();

    const [formData, setFormData] = useState({
        name: '',
        phone: '',
        email: '',
        gstin: '',
        companyName: '',
        billingAddress: null,
        shippingAddress: null,
        sameAsBilling: false
    });

    const [isBillingSheetOpen, setIsBillingSheetOpen] = useState(false);
    const [isShippingSheetOpen, setIsShippingSheetOpen] = useState(false);

    useEffect(() => {
        if (id) {
            const vendor = getVendor(id);
            if (vendor) {
                setFormData(prev => ({ ...prev, ...vendor }));
            }
        }
    }, [id]);

    const handleChange = (e) => {
        const { name, value } = e.target;
        if (name === 'phone') {
            const numericValue = value.replace(/\D/g, '').slice(0, 10);
            setFormData(prev => ({ ...prev, [name]: numericValue }));
        } else {
            setFormData(prev => ({ ...prev, [name]: value }));
        }
    };

    const handleSave = async () => {
        if (!formData.name) {
            alert('Name is required');
            return;
        }
        if (formData.phone && formData.phone.length !== 10) {
            alert('Phone number must be 10 digits');
            return;
        }
        await updateVendor(parseInt(id), formData);
        router.back();
    };

    const handleAddressSave = (type, addressData) => {
        if (type === 'billing') {
            setFormData(prev => ({
                ...prev,
                billingAddress: addressData,
                shippingAddress: prev.sameAsBilling ? addressData : prev.shippingAddress
            }));
        } else {
            setFormData(prev => ({ ...prev, shippingAddress: addressData }));
        }
    };

    const toggleSameAsBilling = () => {
        setFormData(prev => {
            const newSame = !prev.sameAsBilling;
            return {
                ...prev,
                sameAsBilling: newSame,
                shippingAddress: newSame ? prev.billingAddress : prev.shippingAddress
            };
        });
    };

    return (
        <div className={styles.container}>
            {/* Header */}
            <div className={styles.header}>
                <div style={{ display: 'flex', alignItems: 'center' }}>
                    <FiArrowLeft size={24} onClick={() => router.back()} style={{ cursor: 'pointer' }} />
                    <span className={styles.headerTitle}>Update Vendor</span>
                </div>
                <div className={styles.headerActions}>
                    <div className={styles.importAction}>
                        Import <FiChevronDown />
                    </div>
                    <FiMoreHorizontal size={24} />
                </div>
            </div>

            <div className={styles.content}>
                {/* Basic Details */}
                <div className={styles.section}>
                    <div className={styles.sectionHeader}>
                        <div className={styles.sectionTitle}>Basic Details</div>
                        <FiPlayCircle size={20} color="#dc2626" />
                    </div>

                    <div className={styles.inputGroup}>
                        <input
                            className={styles.input}
                            name="name"
                            value={formData.name}
                            onChange={handleChange}
                            placeholder=" "
                        />
                        <label className={styles.label}>Name <span style={{ color: 'red' }}>*</span></label>
                    </div>

                    <div className={styles.phoneInputContainer} style={{ marginBottom: '16px' }}>
                        <img src="https://flagcdn.com/w40/in.png" alt="IN" className={styles.flag} />
                        <span className={styles.phonePrefix}>IN +91 <FiChevronDown size={12} /></span>
                        <input
                            className={styles.phoneInput}
                            name="phone"
                            value={formData.phone}
                            onChange={handleChange}
                            placeholder="Enter Phone Number"
                        />
                    </div>

                    <div className={styles.inputGroup} style={{ marginBottom: 0 }}>
                        <input
                            className={styles.input}
                            name="email"
                            value={formData.email}
                            onChange={handleChange}
                            placeholder=" "
                        />
                        <label className={styles.label}>Email</label>
                    </div>
                </div>

                {/* Company Details */}
                <div className={styles.section}>
                    <div className={styles.sectionTitle} style={{ marginBottom: '16px' }}>Company Details (Optional)</div>

                    <div style={{ marginBottom: '16px' }}>
                        <div className={styles.gstContainer}>
                            <div style={{ position: 'relative', flex: 1 }}>
                                <input
                                    className={styles.gstInput}
                                    name="gstin"
                                    value={formData.gstin || ''}
                                    onChange={handleChange}
                                    placeholder="GST Number"
                                    style={{ paddingTop: '20px', paddingBottom: '4px' }}
                                />
                                <label style={{ position: 'absolute', left: '12px', top: '4px', fontSize: '10px', color: '#6b7280' }}>GST Number</label>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div className={styles.inputGroup} style={{ marginBottom: '4px' }}>
                            <input
                                className={styles.input}
                                name="companyName"
                                value={formData.companyName || ''}
                                onChange={handleChange}
                                placeholder=" "
                            />
                            <label className={styles.label}>Company Name</label>
                        </div>
                        <div className={styles.helperText}>eg. Tata Motors Private Limited</div>
                    </div>
                </div>

                {/* Billing Address */}
                <div className={styles.section}>
                    <div className={styles.sectionTitle} style={{ marginBottom: '16px' }}>Billing Address (Optional)</div>
                    <button className={styles.addressButton} onClick={() => setIsBillingSheetOpen(true)}>
                        <FiPlusCircle size={18} /> {formData.billingAddress ? 'Edit Billing Address' : 'Billing Address'}
                    </button>
                </div>

                {/* Shipping Address */}
                <div className={styles.section}>
                    <div className={styles.sectionHeader}>
                        <div className={styles.sectionTitle}>Shipping Address (Optional)</div>
                    </div>

                    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', background: '#f9fafb', border: '1px solid #e5e7eb', borderRadius: '8px', padding: '8px 12px' }}>
                        <div
                            style={{ display: 'flex', alignItems: 'center', gap: '8px', fontWeight: 600, color: '#6b7280', cursor: 'pointer', flex: 1 }}
                            onClick={() => setIsShippingSheetOpen(true)}
                        >
                            <FiPlusCircle size={18} /> {formData.shippingAddress ? 'Edit Shipping Address' : 'Shipping Address'}
                        </div>
                        <div className={styles.checkboxContainer} onClick={toggleSameAsBilling}>
                            <span>Same as Billing?</span>
                            <FiCopy size={16} color={formData.sameAsBilling ? '#2563eb' : '#9ca3af'} />
                        </div>
                    </div>
                </div>

                <AnimatedButton className={styles.updateButton} onClick={handleSave}>
                    Update Vendor
                </AnimatedButton>
            </div>

            <AddressBottomSheet
                isOpen={isBillingSheetOpen}
                onClose={() => setIsBillingSheetOpen(false)}
                onSave={(data) => handleAddressSave('billing', data)}
                initialData={formData.billingAddress}
                title="Enter Billing Address"
            />

            <AddressBottomSheet
                isOpen={isShippingSheetOpen}
                onClose={() => setIsShippingSheetOpen(false)}
                onSave={(data) => handleAddressSave('shipping', data)}
                initialData={formData.shippingAddress}
                title="Enter Shipping Address"
            />
        </div>
    );
}

export default function VendorEditPage() {
    return (
        <Suspense fallback={<div>Loading...</div>}>
            <VendorEditContent />
        </Suspense>
    );
}
</file>

<file path="src/app/parties/vendor/edit/page.module.css">
.container {
    background: #f3f4f6;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

.header {
    background: white;
    padding: 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid #eee;
}

.headerTitle {
    font-size: 18px;
    font-weight: 700;
    color: #111827;
    margin-left: 12px;
}

.headerActions {
    display: flex;
    align-items: center;
    gap: 16px;
}

.importAction {
    color: #2563eb;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 4px;
    cursor: pointer;
}

.content {
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    flex: 1;
}

.section {
    background: white;
    padding: 16px;
    border-radius: 12px;
}

.sectionHeader {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.sectionTitle {
    font-weight: 700;
    font-size: 14px;
    color: #111827;
}

.inputGroup {
    margin-bottom: 16px;
    position: relative;
}

.input {
    width: 100%;
    padding: 16px 12px 4px;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
    font-size: 16px;
    outline: none;
    transition: border-color 0.2s;
}

.input:focus {
    border-color: #2563eb;
}

.label {
    position: absolute;
    left: 12px;
    top: 12px;
    font-size: 14px;
    color: #6b7280;
    pointer-events: none;
    transition: all 0.2s;
}

.input:focus+.label,
.input:not(:placeholder-shown)+.label {
    top: 4px;
    font-size: 10px;
    color: #2563eb;
}

.phoneInputContainer {
    display: flex;
    align-items: center;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 8px 12px;
    background: white;
}

.flag {
    width: 24px;
    height: 16px;
    margin-right: 8px;
    border-radius: 2px;
    object-fit: cover;
}

.phonePrefix {
    font-weight: 500;
    margin-right: 8px;
    color: #111827;
    display: flex;
    align-items: center;
    gap: 4px;
}

.phoneInput {
    border: none;
    outline: none;
    font-size: 16px;
    width: 100%;
}

.gstContainer {
    display: flex;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    overflow: hidden;
}

.gstInput {
    flex: 1;
    padding: 12px;
    border: none;
    outline: none;
    font-size: 16px;
}

.helperText {
    font-size: 12px;
    color: #9ca3af;
    margin-top: 4px;
}

.addressButton {
    width: 100%;
    padding: 16px;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
    background: #f9fafb;
    text-align: left;
    color: #6b7280;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
}

.checkboxContainer {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    color: #6b7280;
    cursor: pointer;
}

.updateButton {
    width: 100%;
    background: #2563eb;
    color: white;
    padding: 16px;
    border-radius: 12px;
    border: none;
    font-size: 16px;
    font-weight: 700;
    margin-top: auto;
    cursor: pointer;
}
</file>

<file path="src/app/products/bulk-upload/page.js">
'use client';

import { useState, useRef } from 'react';
import { useRouter } from 'next/navigation';
import { FiArrowLeft, FiDownload, FiUploadCloud, FiFileText, FiAlertCircle, FiCheckCircle, FiLoader } from 'react-icons/fi';
import { BulkUploadService } from '@/lib/services/bulkUploadService';
import styles from './page.module.css';
import Link from 'next/link';

export default function BulkUploadPage() {
    const router = useRouter();
    const fileInputRef = useRef(null);
    const [file, setFile] = useState(null);
    const [validationState, setValidationState] = useState({
        status: 'idle', // idle, validating, valid, invalid 
        errors: [],
        data: [],
        totalReceived: 0
    });
    const [processingState, setProcessingState] = useState({
        status: 'idle', // idle, processing, complete, error
        successCount: 0,
        failureCount: 0,
        failedRows: []
    });

    const handleFileSelect = (e) => {
        const selectedFile = e.target.files[0];
        if (selectedFile) {
            if (selectedFile.type !== 'text/csv' && !selectedFile.name.endsWith('.csv')) {
                alert('Please upload a CSV file.');
                return;
            }
            setFile(selectedFile);
            setValidationState({ status: 'idle', errors: [], data: [], totalReceived: 0 });
            setProcessingState({ status: 'idle', successCount: 0, failureCount: 0, failedRows: [] });
        }
    };

    const handleDownloadTemplate = () => {
        BulkUploadService.downloadTemplate();
    };

    const handleValidate = async () => {
        if (!file) return;

        setValidationState(prev => ({ ...prev, status: 'validating' }));
        try {
            const result = await BulkUploadService.validateFile(file);
            setValidationState({
                status: result.valid ? 'valid' : 'invalid',
                errors: result.errors,
                data: result.data,
                totalReceived: result.totalReceived
            });
        } catch (error) {
            console.error(error);
            setValidationState({
                status: 'invalid',
                errors: ['Failed to validate file. Please check format.'],
                data: [],
                totalReceived: 0
            });
        }
    };

    const handleProcess = async () => {
        if (validationState.status !== 'valid') return;

        setProcessingState({ status: 'processing', successCount: 0, failureCount: 0, failedRows: [] });
        try {
            const result = await BulkUploadService.processFile(validationState.data);
            setProcessingState({
                status: 'complete',
                successCount: result.successCount,
                failureCount: result.failureCount,
                failedRows: result.failedRows
            });
            // Optional: reset file after success? 
            // setFile(null); 
        } catch (error) {
            console.error(error);
            setProcessingState({ status: 'error', successCount: 0, failureCount: 0, failedRows: [] });
        }
    };

    return (
        <div className={styles.container}>
            {/* Header */}
            <div className={styles.header}>
                <Link href="/products">
                    <FiArrowLeft size={24} color="#111827" style={{ cursor: 'pointer' }} />
                </Link>
                <h1 className={styles.title}>Bulk Product Upload</h1>
            </div>

            {/* Step 1: Download Template */}
            <div className={styles.card}>
                <h2 className={styles.sectionTitle}>1. Download Template</h2>
                <p className={styles.sectionDesc}>
                    Use this standardized CSV template to enter your product details.
                    Do not change the column headers.
                </p>
                <button
                    onClick={handleDownloadTemplate}
                    className={`${styles.button} ${styles.outlineButton}`}
                >
                    <FiDownload size={18} />
                    Download CSV Template
                </button>
            </div>

            {/* Step 2: Upload CSV */}
            <div className={styles.card}>
                <h2 className={styles.sectionTitle}>2. Upload CSV File</h2>
                <p className={styles.sectionDesc}>
                    Upload your filled CSV file here. Ensure all mandatory fields are present.
                </p>

                <input
                    type="file"
                    accept=".csv"
                    ref={fileInputRef}
                    style={{ display: 'none' }}
                    onChange={handleFileSelect}
                />

                <div
                    className={styles.dropZone}
                    onClick={() => fileInputRef.current?.click()}
                >
                    <FiUploadCloud size={48} color="#9ca3af" />
                    <p style={{ marginTop: 12, color: '#4b5563', fontWeight: 500 }}>
                        Click to upload CSV
                    </p>
                    <p style={{ fontSize: 12, color: '#9ca3af' }}>
                        Supported format: .csv
                    </p>
                </div>

                {file && (
                    <div className={styles.fileInfo}>
                        <FiFileText size={20} color="#4b5563" />
                        <span style={{ fontSize: 14, fontWeight: 500, flex: 1 }}>{file.name}</span>
                        <button
                            onClick={(e) => { e.stopPropagation(); setFile(null); setValidationState({ status: 'idle', errors: [], data: [], totalReceived: 0 }); }}
                            style={{ border: 'none', background: 'none', color: '#ef4444', cursor: 'pointer' }}
                        >
                            Remove
                        </button>
                    </div>
                )}
            </div>

            {/* Step 3: Validation & Processing */}
            {file && (
                <div className={styles.card}>
                    <h2 className={styles.sectionTitle}>3. Validate & Process</h2>

                    <div style={{ display: 'flex', gap: 12, marginTop: 16 }}>
                        <button
                            onClick={handleValidate}
                            className={`${styles.button} ${styles.outlineButton}`}
                            disabled={validationState.status === 'validating' || processingState.status === 'processing' || processingState.status === 'complete'}
                            style={{ opacity: (validationState.status === 'validating' || processingState.status === 'processing') ? 0.7 : 1 }}
                        >
                            {validationState.status === 'validating' ? <FiLoader className="spin" /> : 'Validate File'}
                        </button>

                        <button
                            onClick={handleProcess}
                            className={`${styles.button} ${styles.primaryButton}`}
                            disabled={validationState.status !== 'valid'}
                            style={{ opacity: validationState.status !== 'valid' ? 0.5 : 1, cursor: validationState.status !== 'valid' ? 'not-allowed' : 'pointer' }}
                        >
                            {processingState.status === 'processing' ? (
                                <>
                                    <FiLoader className="spin" /> Processing...
                                </>
                            ) : 'Upload & Process'}
                        </button>
                    </div>

                    {/* Validation Errors */}
                    {validationState.status === 'invalid' && validationState.errors.length > 0 && (
                        <div className={styles.validationResults}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 12, color: '#dc2626' }}>
                                <FiAlertCircle />
                                <span style={{ fontWeight: 600 }}>Validation Failed</span>
                            </div>
                            <div className={styles.errorList}>
                                {validationState.errors.map((err, idx) => (
                                    <div key={idx} className={styles.errorItem}>• {err}</div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Validation Success */}
                    {validationState.status === 'valid' && processingState.status === 'idle' && (
                        <div className={styles.validationResults}>
                            <div className={styles.successSummary}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                                    <FiCheckCircle size={20} />
                                    <span style={{ fontWeight: 600 }}>Validation Successful!</span>
                                </div>
                                <p style={{ marginTop: 4, fontSize: 14 }}>
                                    Found {validationState.data.length} valid records out of {validationState.totalReceived}. Ready to process.
                                </p>
                            </div>
                        </div>
                    )}

                    {/* Processing Complete */}
                    {processingState.status === 'complete' && (
                        <div className={styles.validationResults}>
                            <div className={styles.successSummary} style={{ background: processingState.failureCount > 0 ? '#fff7ed' : '#f0fdf4', borderColor: processingState.failureCount > 0 ? '#fdba74' : '#bbf7d0', color: processingState.failureCount > 0 ? '#9a3412' : '#166534' }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                                    <FiCheckCircle size={20} />
                                    <span style={{ fontWeight: 600 }}>Processing Complete</span>
                                </div>
                                <p style={{ marginTop: 4, fontSize: 14 }}>
                                    Successfully processed: <strong>{processingState.successCount}</strong>
                                </p>
                                {processingState.failureCount > 0 && (
                                    <p style={{ marginTop: 4, fontSize: 14, color: '#dc2626' }}>
                                        Failed: <strong>{processingState.failureCount}</strong>
                                    </p>
                                )}
                            </div>

                            {processingState.failedRows.length > 0 && (
                                <div className={styles.errorList} style={{ marginTop: 16 }}>
                                    <p style={{ fontWeight: 600, marginBottom: 8, color: '#dc2626' }}>Failed Rows Details:</p>
                                    {processingState.failedRows.map((item, idx) => (
                                        <div key={idx} className={styles.errorItem}>
                                            • Row {item.row.product_name || 'Generic'}: {item.error}
                                        </div>
                                    ))}
                                </div>
                            )}

                            <div style={{ marginTop: 16 }}>
                                <Link href="/products">
                                    <button className={`${styles.button} ${styles.outlineButton}`}>
                                        Go back to Products
                                    </button>
                                </Link>
                            </div>
                        </div>
                    )}
                </div>
            )}
        </div>
    );
}
</file>

<file path="src/app/products/bulk-upload/page.module.css">
.container {
    padding: 24px;
    max-width: 1200px;
    margin: 0 auto;
    padding-bottom: 100px;
    /* Space for bottom nav */
}

.header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 24px;
}

.title {
    font-size: 24px;
    font-weight: 600;
    color: #111827;
}

.card {
    background: #fff;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    border: 1px solid #e5e7eb;
}

.sectionTitle {
    font-size: 18px;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
}

.sectionDesc {
    font-size: 14px;
    color: #6b7280;
    margin-bottom: 16px;
}

.button {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
}

.primaryButton {
    background: #2563eb;
    color: #fff;
}

/* Removed hover for mobile touch primarily */

.outlineButton {
    background: #fff;
    border: 1px solid #d1d5db;
    color: #374151;
}

.dropZone {
    border: 2px dashed #d1d5db;
    border-radius: 12px;
    padding: 40px;
    text-align: center;
    cursor: pointer;
    transition: border-color 0.2s;
    background: #f9fafb;
}

.dropZoneActive {
    border-color: #2563eb;
    background: #eff6ff;
}

.fileInfo {
    margin-top: 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    background: #f3f4f6;
    padding: 12px;
    border-radius: 8px;
}

.validationResults {
    margin-top: 20px;
    border-top: 1px solid #e5e7eb;
    padding-top: 20px;
}

.errorList {
    background: #fef2f2;
    border: 1px solid #fecaca;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 16px;
    max-height: 200px;
    overflow-y: auto;
}

.errorItem {
    color: #991b1b;
    font-size: 14px;
    margin-bottom: 4px;
}

.successSummary {
    background: #f0fdf4;
    border: 1px solid #bbf7d0;
    border-radius: 8px;
    padding: 16px;
    color: #166534;
}
</file>

<file path="src/app/products/components/__tests__/ProductCard.test.js">
import React from 'react';
import { render, screen, fireEvent } from '@testing-library/react';
import ProductCard from '../ProductCard';

// Mock next/navigation
jest.mock('next/navigation', () => ({
    useRouter: () => ({
        push: jest.fn(),
    }),
}));

// Mock next/link
jest.mock('next/link', () => {
    return ({ children, href }) => <a href={href}>{children}</a>;
});

describe('ProductCard', () => {
    const mockProduct = {
        id: 1,
        name: 'Gold Ring',
        category: 'Ring',
        purity: '22K',
        grossWeight: 10.5,
        stoneType: 'Diamond',
        tags: '',
    };

    const mockOnAddToTray = jest.fn();
    const mockOnShare = jest.fn();

    beforeEach(() => {
        jest.clearAllMocks();
    });

    describe('rendering', () => {
        it('should render product title with category and purity', () => {
            render(
                <ProductCard
                    product={mockProduct}
                    onAddToTray={mockOnAddToTray}
                    onShare={mockOnShare}
                />
            );

            expect(screen.getByText('Ring – 22K')).toBeInTheDocument();
        });

        it('should display weight correctly formatted', () => {
            render(
                <ProductCard
                    product={mockProduct}
                    onAddToTray={mockOnAddToTray}
                    onShare={mockOnShare}
                />
            );

            expect(screen.getByText(/Weight: 10.50g/)).toBeInTheDocument();
        });

        it('should display stone type', () => {
            render(
                <ProductCard
                    product={mockProduct}
                    onAddToTray={mockOnAddToTray}
                    onShare={mockOnShare}
                />
            );

            expect(screen.getByText(/Stone: Diamond/)).toBeInTheDocument();
        });

        it('should show purity badge', () => {
            render(
                <ProductCard
                    product={mockProduct}
                    onAddToTray={mockOnAddToTray}
                    onShare={mockOnShare}
                />
            );

            expect(screen.getByText('22K')).toBeInTheDocument();
        });

        it('should show Bestseller badge when product has bestseller tag', () => {
            const bestsellerProduct = {
                ...mockProduct,
                tags: 'bestseller, popular',
            };

            render(
                <ProductCard
                    product={bestsellerProduct}
                    onAddToTray={mockOnAddToTray}
                    onShare={mockOnShare}
                />
            );

            expect(screen.getByText('Bestseller')).toBeInTheDocument();
        });

        it('should not show Bestseller badge when tag is absent', () => {
            render(
                <ProductCard
                    product={mockProduct}
                    onAddToTray={mockOnAddToTray}
                    onShare={mockOnShare}
                />
            );

            expect(screen.queryByText('Bestseller')).not.toBeInTheDocument();
        });
    });

    describe('default values', () => {
        it('should show default purity when not provided', () => {
            const productWithoutPurity = { ...mockProduct, purity: '' };

            render(
                <ProductCard
                    product={productWithoutPurity}
                    onAddToTray={mockOnAddToTray}
                    onShare={mockOnShare}
                />
            );

            // Default is 22K
            expect(screen.getAllByText('22K').length).toBeGreaterThan(0);
        });

        it('should show 0.00g when grossWeight is not provided', () => {
            const productWithoutWeight = { ...mockProduct, grossWeight: null };

            render(
                <ProductCard
                    product={productWithoutWeight}
                    onAddToTray={mockOnAddToTray}
                    onShare={mockOnShare}
                />
            );

            expect(screen.getByText(/Weight: 0.00g/)).toBeInTheDocument();
        });

        it('should show Plain Gold when stoneType is not provided', () => {
            const productWithoutStone = { ...mockProduct, stoneType: '' };

            render(
                <ProductCard
                    product={productWithoutStone}
                    onAddToTray={mockOnAddToTray}
                    onShare={mockOnShare}
                />
            );

            expect(screen.getByText(/Stone: Plain Gold/)).toBeInTheDocument();
        });
    });

    describe('interactions', () => {
        it('should call onAddToTray when Add to Tray button is clicked', () => {
            render(
                <ProductCard
                    product={mockProduct}
                    onAddToTray={mockOnAddToTray}
                    onShare={mockOnShare}
                />
            );

            const addButton = screen.getByText('Add to Tray');
            fireEvent.click(addButton);

            expect(mockOnAddToTray).toHaveBeenCalledWith(mockProduct);
            expect(mockOnAddToTray).toHaveBeenCalledTimes(1);
        });

        it('should call onShare when share button is clicked', () => {
            render(
                <ProductCard
                    product={mockProduct}
                    onAddToTray={mockOnAddToTray}
                    onShare={mockOnShare}
                />
            );

            // Find the WhatsApp button (it's an icon button)
            const buttons = screen.getAllByRole('button');
            const shareButton = buttons.find(btn => btn.querySelector('svg'));

            if (shareButton) {
                fireEvent.click(shareButton);
                expect(mockOnShare).toHaveBeenCalledWith(mockProduct);
            }
        });

        it('should stop propagation when action buttons are clicked', () => {
            const mockCardClick = jest.fn();

            render(
                <ProductCard
                    product={mockProduct}
                    onAddToTray={mockOnAddToTray}
                    onShare={mockOnShare}
                />
            );

            const addButton = screen.getByText('Add to Tray');
            fireEvent.click(addButton);

            // onAddToTray should be called, but not navigate (we can't test navigation directly)
            expect(mockOnAddToTray).toHaveBeenCalled();
        });
    });

    describe('image handling', () => {
        it('should show placeholder when no images', () => {
            render(
                <ProductCard
                    product={mockProduct}
                    onAddToTray={mockOnAddToTray}
                    onShare={mockOnShare}
                />
            );

            // Placeholder contains FiShoppingBag icon
            expect(screen.queryByRole('img')).not.toBeInTheDocument();
        });

        it('should render image when images array has data', () => {
            const productWithImage = {
                ...mockProduct,
                images: [{ data: 'data:image/png;base64,abc123' }],
            };

            render(
                <ProductCard
                    product={productWithImage}
                    onAddToTray={mockOnAddToTray}
                    onShare={mockOnShare}
                />
            );

            const img = screen.getByRole('img');
            expect(img).toHaveAttribute('src', 'data:image/png;base64,abc123');
        });
    });
});
</file>

<file path="src/app/products/components/FilterBar.js">
import styles from './FilterBar.module.css';
import { FiX } from 'react-icons/fi';

const FILTERS = {
    purity: ['22K', '18K'],
    weight: ['0-5g', '5-10g'],
    gender: ['Ladies', 'Gents', 'Kids'],
};

export default function FilterBar({ filters, onFilterChange, categories = [] }) {

    const handleFilterToggle = (type, value) => {
        const current = filters[type] || [];
        const updated = current.includes(value)
            ? current.filter(item => item !== value)
            : [...current, value];
        onFilterChange({ ...filters, [type]: updated });
    };

    const removeFilter = (type, value) => {
        const current = filters[type] || [];
        const updated = current.filter(item => item !== value);
        onFilterChange({ ...filters, [type]: updated });
    };

    // Flatten selected filters for the chip view
    const selectedChips = [];
    Object.keys(filters).forEach(key => {
        filters[key].forEach(val => {
            selectedChips.push({ type: key, value: val });
        });
    });

    return (
        <div className={styles.container}>
            {/* Scrollable Filter Pills */}
            <div className={styles.scrollContainer}>
                {/* Purity Group */}
                <div className={styles.filterGroup}>
                    <span className={styles.groupLabel}>Purity:</span>
                    {FILTERS.purity.map(val => (
                        <button
                            key={val}
                            className={`${styles.pill} ${filters.purity.includes(val) ? styles.active : ''}`}
                            onClick={() => handleFilterToggle('purity', val)}
                        >
                            {val}
                        </button>
                    ))}
                </div>

                {/* Weight Group */}
                <div className={styles.filterGroup}>
                    <span className={styles.groupLabel}>Weight:</span>
                    {FILTERS.weight.map(val => (
                        <button
                            key={val}
                            className={`${styles.pill} ${filters.weight.includes(val) ? styles.active : ''}`}
                            onClick={() => handleFilterToggle('weight', val)}
                        >
                            {val}
                        </button>
                    ))}
                </div>

                {/* Gender Group */}
                <div className={styles.filterGroup}>
                    <span className={styles.groupLabel}>Gender:</span>
                    {FILTERS.gender.map(val => (
                        <button
                            key={val}
                            className={`${styles.pill} ${filters.gender.includes(val) ? styles.active : ''}`}
                            onClick={() => handleFilterToggle('gender', val)}
                        >
                            {val}
                        </button>
                    ))}
                </div>

                {/* Category Group - if categories provided */}
                {categories.length > 0 && (
                    <div className={styles.filterGroup}>
                        <span className={styles.groupLabel}>Category:</span>
                        {categories.map(cat => (
                            <button
                                key={cat.name}
                                className={`${styles.pill} ${filters.category && filters.category.includes(cat.name) ? styles.active : ''}`}
                                onClick={() => handleFilterToggle('category', cat.name)}
                            >
                                {cat.name}
                            </button>
                        ))}
                    </div>
                )}
            </div>

            {/* Selected Chips */}
            {selectedChips.length > 0 && (
                <div className={styles.chipContainer}>
                    {selectedChips.map((chip, idx) => (
                        <div key={`${chip.type}-${chip.value}-${idx}`} className={styles.chip}>
                            {chip.value}
                            <button
                                className={styles.chipClose}
                                onClick={() => removeFilter(chip.type, chip.value)}
                            >
                                <FiX size={14} />
                            </button>
                        </div>
                    ))}
                </div>
            )}
        </div>
    );
}
</file>

<file path="src/app/products/components/FilterBar.module.css">
.container {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 12px 16px;
    background: #fff;
    border-bottom: 1px solid #e5e7eb;
}

.scrollContainer {
    display: flex;
    overflow-x: auto;
    gap: 16px;
    white-space: nowrap;
    scrollbar-width: none;
    /* Firefox */
    -ms-overflow-style: none;
    /* IE 10+ */
    padding-bottom: 4px;
    /* Space for scrollbar if visible on some OS */
}

.scrollContainer::-webkit-scrollbar {
    display: none;
    /* Chrome/Safari */
}

.filterGroup {
    display: flex;
    align-items: center;
    gap: 8px;
    padding-right: 8px;
    border-right: 1px solid #f3f4f6;
}

.filterGroup:last-child {
    border-right: none;
}

.groupLabel {
    font-size: 13px;
    font-weight: 600;
    color: #374151;
}

.pill {
    background: #f3f4f6;
    border: none;
    border-radius: 6px;
    padding: 6px 12px;
    font-size: 13px;
    color: #4b5563;
    cursor: pointer;
    transition: all 0.2s;
}

.pill:hover {
    background: #e5e7eb;
}

.pill.active {
    background: #ca8a04;
    /* Gold */
    color: white;
}

.chipContainer {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.chip {
    display: flex;
    align-items: center;
    gap: 6px;
    background: #e5e7eb;
    padding: 4px 10px;
    border-radius: 16px;
    font-size: 12px;
    color: #1f2937;
}

.chipClose {
    background: none;
    border: none;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #6b7280;
}

.chipClose:hover {
    color: #1f2937;
}
</file>

<file path="src/app/products/components/Pagination.js">
import styles from './Pagination.module.css';
import { FiChevronLeft, FiChevronRight, FiClock } from 'react-icons/fi';
import { useState } from 'react';

export default function Pagination({ currentPage, totalPages, onPageChange, onRecentlyViewed }) {
    const [jumpPage, setJumpPage] = useState('');

    const handleJump = (e) => {
        if (e.key === 'Enter') {
            const page = parseInt(jumpPage);
            if (!isNaN(page) && page >= 1 && page <= totalPages) {
                onPageChange(page);
                setJumpPage('');
            }
        }
    };

    return (
        <div className={styles.container}>
            <div className={styles.controls}>
                <button
                    className={styles.navButton}
                    disabled={currentPage === 1}
                    onClick={() => onPageChange(currentPage - 1)}
                >
                    <FiChevronLeft />
                </button>

                <span className={styles.pageInfo}>
                    Page {currentPage} of {totalPages}
                </span>

                <button
                    className={styles.navButton}
                    disabled={currentPage === totalPages}
                    onClick={() => onPageChange(currentPage + 1)}
                >
                    <FiChevronRight />
                </button>
            </div>

            <div className={styles.jumpContainer}>
                <span className={styles.jumpLabel}>Jump to:</span>
                <input
                    className={styles.jumpInput}
                    value={jumpPage}
                    onChange={(e) => setJumpPage(e.target.value)}
                    onKeyDown={handleJump}
                    placeholder="#"
                />
            </div>

            <button className={styles.recentButton} onClick={onRecentlyViewed}>
                <FiClock size={16} />
                Recently Viewed
            </button>
        </div>
    );
}
</file>

<file path="src/app/products/components/Pagination.module.css">
.container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px;
    background: #fff;
    border-top: 1px solid #e5e7eb;
    flex-wrap: wrap;
    gap: 12px;
}

.controls {
    display: flex;
    align-items: center;
    gap: 12px;
}

.navButton {
    background: white;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #4b5563;
}

.navButton:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: #f3f4f6;
}

.navButton:hover:not(:disabled) {
    background: #f9fafb;
    border-color: #9ca3af;
}

.pageInfo {
    font-size: 14px;
    font-weight: 500;
    color: #374151;
}

.jumpContainer {
    display: flex;
    align-items: center;
    gap: 8px;
}

.jumpLabel {
    font-size: 13px;
    color: #6b7280;
}

.jumpInput {
    width: 50px;
    padding: 6px;
    border: 1px solid #d1d5db;
    border-radius: 4px;
    text-align: center;
    font-size: 13px;
    background: #fff;
    color: #000;
}

.jumpInput:focus {
    outline: none;
    border-color: #ca8a04;
}

.recentButton {
    display: flex;
    align-items: center;
    gap: 8px;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 13px;
    font-weight: 500;
    color: #4b5563;
    cursor: pointer;
    margin-left: auto;
    /* Push to right */
}

.recentButton:hover {
    background: #f9fafb;
    color: #111827;
}

@media (max-width: 600px) {
    .container {
        justify-content: center;
    }

    .recentButton {
        margin-left: 0;
        width: 100%;
        justify-content: center;
    }
}
</file>

<file path="src/app/purchase/create/select-vendor/page.js">
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import Link from 'next/link';
import { usePartyStore } from '@/lib/store/partyStore';
import { usePurchaseStore } from '@/lib/store/purchaseStore';
import { FiArrowLeft, FiSearch, FiPlus, FiX } from 'react-icons/fi';
import { formatCurrency } from '@/lib/utils/tax';

export default function SelectVendorPage() {
    const router = useRouter();
    const { vendors, loadParties } = usePartyStore();
    const { setVendor } = usePurchaseStore();
    const [searchQuery, setSearchQuery] = useState('');

    useEffect(() => {
        loadParties();
    }, [loadParties]);

    const filteredVendors = vendors.filter(v =>
        v.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
        (v.phone && v.phone.includes(searchQuery))
    );

    const handleSelect = (vendor) => {
        setVendor(vendor);
        router.back();
    };

    return (
        <div style={{ background: '#f3f4f6', minHeight: '100vh', display: 'flex', flexDirection: 'column' }}>
            {/* Header */}
            <div style={{
                background: 'white',
                padding: '16px',
                display: 'flex',
                alignItems: 'center',
                gap: '12px',
                borderBottom: '1px solid #e5e7eb'
            }}>
                <button onClick={() => router.back()} style={{ border: 'none', background: 'none', cursor: 'pointer' }}>
                    <FiArrowLeft size={24} />
                </button>
                <div style={{ flex: 1, position: 'relative' }}>
                    <input
                        placeholder="Search Vendor"
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                        style={{
                            width: '100%',
                            padding: '8px 0',
                            fontSize: '16px',
                            border: 'none',
                            outline: 'none'
                        }}
                        autoFocus
                    />
                </div>
                {searchQuery && (
                    <button onClick={() => setSearchQuery('')} style={{ border: 'none', background: 'none', cursor: 'pointer' }}>
                        <FiX size={20} color="#6b7280" />
                    </button>
                )}
            </div>

            {/* Add New Vendor Button */}
            <Link href="/parties/vendor/add?returnUrl=/purchase/create" style={{ textDecoration: 'none' }}>
                <div style={{
                    background: '#fef3c7',
                    padding: '12px',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '8px',
                    color: '#92400e',
                    fontWeight: 500,
                    cursor: 'pointer'
                }}>
                    <FiPlus size={18} /> Add new vendor
                </div>
            </Link>

            {/* Vendor List */}
            <div style={{ flex: 1, overflowY: 'auto', padding: '16px', display: 'flex', flexDirection: 'column', gap: '12px' }}>
                {filteredVendors.length === 0 ? (
                    <div style={{ textAlign: 'center', padding: '40px', color: '#9ca3af' }}>
                        {vendors.length === 0 ? 'No vendors found. Add a vendor first.' : 'No vendors match your search.'}
                    </div>
                ) : (
                    filteredVendors.map(vendor => (
                        <div
                            key={vendor.id}
                            onClick={() => handleSelect(vendor)}
                            style={{
                                background: 'white',
                                padding: '16px',
                                borderRadius: '12px',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'space-between',
                                cursor: 'pointer',
                                boxShadow: '0 1px 2px rgba(0,0,0,0.05)'
                            }}
                        >
                            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                                <div style={{
                                    width: '40px',
                                    height: '40px',
                                    borderRadius: '50%',
                                    background: '#fef3c7',
                                    color: '#92400e',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    fontWeight: 600,
                                    fontSize: '16px'
                                }}>
                                    {vendor.name.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <div style={{ fontWeight: 500, color: '#111827' }}>{vendor.name}</div>
                                    {vendor.phone && (
                                        <div style={{ fontSize: '13px', color: '#6b7280' }}>{vendor.phone}</div>
                                    )}
                                </div>
                            </div>
                            <div style={{ textAlign: 'right' }}>
                                {vendor.balance ? (
                                    <div style={{
                                        color: vendor.balance > 0 ? '#dc2626' : '#10b981',
                                        fontWeight: 500
                                    }}>
                                        {vendor.balance > 0 ? '↑' : ''} {formatCurrency(Math.abs(vendor.balance))}
                                        <div style={{ fontSize: '10px', color: '#6b7280' }}>
                                            {vendor.balance > 0 ? 'You owe' : 'They owe'}
                                        </div>
                                    </div>
                                ) : (
                                    <div style={{ fontSize: '13px', color: '#6b7280', fontWeight: 500 }}>No dues</div>
                                )}
                            </div>
                        </div>
                    ))
                )}
            </div>
        </div>
    );
}
</file>

<file path="src/app/purchase/create/page.js">
'use client';

import PurchaseForm from '@/components/PurchaseForm';
import { FiArrowLeft } from 'react-icons/fi';
import Link from 'next/link';
import { useEffect } from 'react';
import { usePurchaseStore } from '@/lib/store/purchaseStore';

export default function CreatePurchasePage() {
    const { resetPurchase } = usePurchaseStore();

    useEffect(() => {
        // Reset the store when entering create mode
        resetPurchase();
    }, []);

    return (
        <div>
            <div style={{
                padding: '16px',
                background: 'white',
                display: 'flex',
                alignItems: 'center',
                gap: '16px',
                borderBottom: '1px solid #eee'
            }}>
                <Link href="/">
                    <FiArrowLeft size={24} />
                </Link>
                <h1 style={{ fontSize: '18px', fontWeight: 600 }}>Create Purchase</h1>
                <span style={{
                    fontSize: '12px',
                    background: '#fef3c7',
                    color: '#92400e',
                    padding: '2px 8px',
                    borderRadius: '4px',
                    fontWeight: 600
                }}>
                    Purchase Order
                </span>
            </div>
            <PurchaseForm />
        </div>
    );
}
</file>

<file path="src/app/reports/page.js">
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { FiChevronLeft, FiChevronDown } from 'react-icons/fi';
import styles from './page.module.css';

const reportSections = [
    {
        title: 'Taxes',
        items: [
            'GSTR – 1',
            'GSTR – 2B',
            'GSTR – 3B',
            'GSTR – 7',
            'Sale Summary by HSN',
            'IUS Receivable',
            'TDS Payable',
            'TCS Receivable',
            'ICS Payable',
        ],
    },
    {
        title: 'Transaction Reports',
        items: [
            'Sales',
            'Purchases',
            'Sale Returns / Credit Notes',
            'Purchase Returns / Debit Notes',
            'Quotations',
            'Sales Orders (NEW)',
            'Delivery Challans',
            'Pro Forma Invoices',
            'Purchase Orders',
            'Payments',
            'Indirect Income',
            'Category-Wise Expenses',
            'Category-Wise Indirect Income',
        ],
    },
    {
        title: 'Bill-wise Item Reports',
        items: [
            'Sales',
            'Purchases',
            'Sale Returns / Credit Notes',
            'Purchase Returns / Debit Notes',
            'Quotations',
            'Sales Orders (NEW)',
            'Delivery Challans',
            'Pro Forma Invoices',
            'Purchase Orders',
        ],
    },
    {
        title: 'Item Reports',
        items: [
            'Stock Summary',
            'Item-wise Discount',
            'Stock Value',
            'Inventory Timeline',
            'Low Stock (NEW)',
        ],
    },
    {
        title: 'Party Reports',
        items: [
            'All Customers',
            'All Vendors',
            'Customer Statement',
            'Vendor Statement',
            'Customer-wise Items',
            'Vendor-wise Items',
        ],
    },
    {
        title: 'Profit & Loss (P/L) Reports',
        items: [
            'P/L Statement',
            'Seller P/L Report',
            'Sale Items P/L Report',
            'Item-wise P/L (Purchases)',
            'Item-wise P/L Report (Purchase Price)',
            'Category-wise P/L Report (Purchase Price)',
            'Customer-wise P/L Statement',
        ],
    },
    {
        title: 'Payments Reports',
        items: [
            'Payment Timeline',
            'Payouts',
        ],
    },
    {
        title: 'Other Reports',
        items: [
            'Day Book',
            'Document Conversion',
        ],
    },
];

export default function ReportsPage() {
    const router = useRouter();
    // Initialize with all sections collapsed or expanded as per preference. 
    // The screenshot shows them collapsed, so we'll start with empty or specific ones if needed.
    // Let's keep them all collapsed initially to match the clean look, or maybe just the first one?
    // The screenshot shows all collapsed.
    const [expandedSections, setExpandedSections] = useState({});

    const toggleSection = (index) => {
        setExpandedSections((prev) => ({
            ...prev,
            [index]: !prev[index],
        }));
    };

    return (
        <div className={styles.container}>
            <header className={styles.header}>
                <button onClick={() => router.back()} className={styles.backButton}>
                    <FiChevronLeft />
                </button>
                <h1 className={styles.title}>Reports</h1>
            </header>

            <div className={styles.content}>
                {reportSections.map((section, index) => (
                    <div key={index} className={styles.section}>
                        <div
                            className={styles.sectionHeader}
                            onClick={() => toggleSection(index)}
                        >
                            <span className={styles.sectionTitle}>{section.title}</span>
                            <FiChevronDown
                                className={`${styles.chevron} ${expandedSections[index] ? styles.expanded : ''}`}
                            />
                        </div>
                        {expandedSections[index] && (
                            <div className={styles.reportList}>
                                {section.items.map((item, itemIndex) => (
                                    <div key={itemIndex} className={styles.reportItem}>
                                        {item}
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                ))}
            </div>
        </div>
    );
}
</file>

<file path="src/app/reports/page.module.css">
.container {
    display: flex;
    flex-direction: column;
    height: 100vh;
    background-color: #f8f9fa;
}

.header {
    display: flex;
    align-items: center;
    padding: 16px;
    background-color: #fff;
    border-bottom: 1px solid #eee;
    position: sticky;
    top: 0;
    z-index: 10;
}

.backButton {
    background: none;
    border: none;
    font-size: 24px;
    margin-right: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #333;
}

.title {
    font-size: 18px;
    font-weight: 600;
    color: #000;
}

.content {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.section {
    background-color: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.sectionHeader {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    cursor: pointer;
    user-select: none;
}

.sectionTitle {
    font-size: 15px;
    font-weight: 500;
    color: #333;
}

.chevron {
    font-size: 20px;
    color: #666;
    transition: transform 0.2s ease;
}

.chevron.expanded {
    transform: rotate(180deg);
}

.reportList {
    border-top: 1px solid #f0f0f0;
}

.reportItem {
    padding: 14px 16px;
    font-size: 14px;
    color: #555;
    border-bottom: 1px solid #f5f5f5;
    cursor: pointer;
    display: block;
    text-decoration: none;
}

.reportItem:last-child {
    border-bottom: none;
}

.reportItem:hover {
    background-color: #f9f9f9;
}
</file>

<file path="src/app/template.js">
'use client';

import { motion } from 'framer-motion';
import { ANIMATIONS } from '@/lib/animations';

export default function Template({ children }) {
    return (
        <motion.div
            initial={ANIMATIONS.variants.slideUp.initial}
            animate={ANIMATIONS.variants.slideUp.animate}
            transition={{
                duration: ANIMATIONS.duration.medium,
                ease: ANIMATIONS.ease.out,
            }}
            className="page-transition-container"
        >
            {children}
        </motion.div>
    );
}
</file>

<file path="src/components/__tests__/BottomNav.test.js">
import React from 'react';
import { render, screen } from '@testing-library/react';
import BottomNav from '../BottomNav';

// Mock next/navigation
jest.mock('next/navigation', () => ({
    usePathname: jest.fn(),
}));

// Mock next/link to render as regular anchor
jest.mock('next/link', () => {
    return ({ children, href }) => {
        return <a href={href}>{children}</a>;
    };
});

// Import the mocked usePathname
import { usePathname } from 'next/navigation';

describe('BottomNav', () => {
    beforeEach(() => {
        // Default to home route
        usePathname.mockReturnValue('/');
    });

    describe('rendering', () => {
        it('should render all navigation items on home page', () => {
            usePathname.mockReturnValue('/');
            render(<BottomNav />);

            expect(screen.getByText('Home')).toBeInTheDocument();
            expect(screen.getByText('Bills')).toBeInTheDocument();
            expect(screen.getByText('Products')).toBeInTheDocument();
            expect(screen.getByText('Parties')).toBeInTheDocument();
            expect(screen.getByText('More')).toBeInTheDocument();
        });

        it('should render correct navigation links', () => {
            usePathname.mockReturnValue('/');
            render(<BottomNav />);

            const homeLink = screen.getByText('Home').closest('a');
            expect(homeLink).toHaveAttribute('href', '/');

            const billsLink = screen.getByText('Bills').closest('a');
            expect(billsLink).toHaveAttribute('href', '/bills');

            const productsLink = screen.getByText('Products').closest('a');
            expect(productsLink).toHaveAttribute('href', '/products');

            const partiesLink = screen.getByText('Parties').closest('a');
            expect(partiesLink).toHaveAttribute('href', '/parties');

            const moreLink = screen.getByText('More').closest('a');
            expect(moreLink).toHaveAttribute('href', '/more');
        });
    });

    describe('route-based visibility', () => {
        it('should hide on /add routes', () => {
            usePathname.mockReturnValue('/products/add');
            const { container } = render(<BottomNav />);

            expect(container.firstChild).toBeNull();
        });

        it('should hide on /create routes', () => {
            usePathname.mockReturnValue('/invoice/create');
            const { container } = render(<BottomNav />);

            expect(container.firstChild).toBeNull();
        });

        it('should hide on /view routes', () => {
            usePathname.mockReturnValue('/invoice/view');
            const { container } = render(<BottomNav />);

            expect(container.firstChild).toBeNull();
        });

        it('should hide on /edit routes', () => {
            usePathname.mockReturnValue('/products/edit');
            const { container } = render(<BottomNav />);

            expect(container.firstChild).toBeNull();
        });

        it('should show on main listing pages', () => {
            usePathname.mockReturnValue('/products');
            render(<BottomNav />);

            expect(screen.getByText('Products')).toBeInTheDocument();
        });

        it('should show on parties page', () => {
            usePathname.mockReturnValue('/parties');
            render(<BottomNav />);

            expect(screen.getByText('Home')).toBeInTheDocument();
        });
    });

    describe('active state', () => {
        it('should apply active class to current route', () => {
            usePathname.mockReturnValue('/products');
            render(<BottomNav />);

            // The Products link should be in the document
            const productsLink = screen.getByText('Products').closest('a');
            expect(productsLink).toBeInTheDocument();
        });

        it('should not apply active class to non-current routes', () => {
            usePathname.mockReturnValue('/');
            render(<BottomNav />);

            // Home should be active, all others should not be
            const homeLink = screen.getByText('Home').closest('a');
            const billsLink = screen.getByText('Bills').closest('a');

            expect(homeLink).toBeInTheDocument();
            expect(billsLink).toBeInTheDocument();
        });
    });
});
</file>

<file path="src/components/Auth/AuthWrapper.js">
'use client';

import { useEffect } from 'react';
import { useAuthStore } from '@/lib/store/authStore';
import LoginFlow from './LoginFlow';

export default function AuthWrapper({ children }) {
    const { isAuthenticated, isLoading, loadAuth } = useAuthStore();

    useEffect(() => {
        loadAuth();
    }, []);

    if (isLoading) {
        return (
            <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}>
                Loading...
            </div>
        );
    }

    if (!isAuthenticated) {
        return <LoginFlow />;
    }

    return <>{children}</>;
}
</file>

<file path="src/components/Auth/LoginFlow.module.css">
.container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 24px;
    background: var(--background);
}

.logo {
    font-size: 48px;
    font-weight: 800;
    color: var(--foreground);
    margin-bottom: 16px;
}

.title {
    font-size: 24px;
    font-weight: 700;
    color: var(--foreground);
    margin-bottom: 8px;
    text-align: center;
}

.subtitle {
    font-size: 14px;
    color: var(--text-secondary);
    margin-bottom: 48px;
    text-align: center;
}

.card {
    background: var(--card-bg);
    padding: 32px 24px;
    border-radius: 20px;
    width: 100%;
    max-width: 400px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.input {
    width: 100%;
    padding: 16px;
    border: 1px solid var(--border);
    border-radius: 12px;
    font-size: 16px;
    margin-bottom: 16px;
    outline: none;
    background: #F9FAFB;
}

.input:focus {
    border-color: var(--primary);
    background: white;
}

.button {
    width: 100%;
    padding: 16px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    margin-bottom: 12px;
}

.button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.backButton {
    width: 100%;
    padding: 16px;
    background: transparent;
    color: var(--primary);
    border: 1px solid var(--primary);
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
}

.otpContainer {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-bottom: 24px;
}

.otpInput {
    width: 48px;
    height: 56px;
    text-align: center;
    font-size: 24px;
    font-weight: 700;
    border: 2px solid var(--border);
    border-radius: 12px;
    outline: none;
}

.otpInput:focus {
    border-color: var(--primary);
}

.error {
    color: #EF4444;
    font-size: 14px;
    margin-bottom: 16px;
    text-align: center;
}
</file>

<file path="src/components/Expenses/AddCategoryModal.js">
import { useState, useEffect } from 'react';
import { FiX } from 'react-icons/fi';
import { useExpenseStore } from '@/lib/store/expenseStore';
import styles from '@/app/more/bills/expenses/create/page.module.css';

export default function AddCategoryModal({ onClose, categoryToEdit }) {
    const { addCategory, updateCategory, deleteCategory } = useExpenseStore();
    const [categoryName, setCategoryName] = useState('');

    useEffect(() => {
        if (categoryToEdit) {
            setCategoryName(categoryToEdit);
        } else {
            setCategoryName('');
        }
    }, [categoryToEdit]);

    const handleSave = () => {
        if (!categoryName.trim()) return;

        if (categoryToEdit) {
            updateCategory(categoryToEdit, categoryName);
        } else {
            addCategory(categoryName);
        }
        onClose();
    };

    const handleDelete = () => {
        if (categoryToEdit) {
            deleteCategory(categoryToEdit);
            onClose();
        }
    };

    return (
        <div className={styles.modalOverlay} onClick={onClose}>
            <div className={styles.modalContent} onClick={(e) => e.stopPropagation()}>
                <div className={styles.modalHeader}>
                    <h2 className={styles.modalTitle}>
                        {categoryToEdit ? 'Edit Category' : 'Add Category'}
                    </h2>
                    <button onClick={onClose} className={styles.closeButton}>
                        <FiX />
                    </button>
                </div>
                <div className={styles.modalBody}>
                    <div className={styles.formGroup}>
                        <label className={styles.label}>Category Name</label>
                        <input
                            type="text"
                            value={categoryName}
                            onChange={(e) => setCategoryName(e.target.value)}
                            className={styles.input}
                            placeholder="Enter category name"
                            autoFocus
                        />
                    </div>
                </div>
                <div className={styles.modalFooter}>
                    <div className={styles.modalActions}>
                        {categoryToEdit && (
                            <button className={styles.deleteButton} onClick={handleDelete}>
                                Delete
                            </button>
                        )}
                        <button className={styles.saveButton} onClick={handleSave}>
                            Save
                        </button>
                    </div>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="src/components/Expenses/CategoryModal.js">
import { useState } from 'react';
import { FiX, FiSearch, FiEdit2 } from 'react-icons/fi';
import { useExpenseStore } from '@/lib/store/expenseStore';
import styles from '@/app/more/bills/expenses/create/page.module.css'; // Reusing styles

export default function CategoryModal({ onClose, onSelect, onEdit }) {
    const { categories } = useExpenseStore();
    const [searchQuery, setSearchQuery] = useState('');

    const filteredCategories = categories.filter((cat) =>
        cat.toLowerCase().includes(searchQuery.toLowerCase())
    );

    return (
        <div className={styles.modalOverlay} onClick={onClose}>
            <div className={styles.modalContent} onClick={(e) => e.stopPropagation()}>
                <div className={styles.modalHeader}>
                    <h2 className={styles.modalTitle}>Select Category</h2>
                    <button onClick={onClose} className={styles.closeButton}>
                        <FiX />
                    </button>
                </div>
                <div className={styles.modalBody}>
                    <div className={styles.modalSearch}>
                        <FiSearch color="#888" />
                        <input
                            type="text"
                            placeholder="Search Expense Category"
                            className={styles.modalSearchInput}
                            value={searchQuery}
                            onChange={(e) => setSearchQuery(e.target.value)}
                        />
                    </div>
                    <div className={styles.categoryList}>
                        {filteredCategories.map((category) => (
                            <div
                                key={category}
                                className={styles.categoryItem}
                                onClick={() => onSelect(category)}
                            >
                                <span className={styles.categoryName}>{category}</span>
                                <FiEdit2
                                    className={styles.editIcon}
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        onEdit(category);
                                    }}
                                />
                            </div>
                        ))}
                    </div>
                </div>
                <div className={styles.modalFooter}>
                    <button
                        className={styles.addCategoryButton}
                        onClick={() => onEdit(null)} // null means adding new
                    >
                        Add Category
                    </button>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="src/components/icons/index.js">
// Custom SVG Icons with Gray Outlines and Gold Accents
// Design specs: 30x30 canvas, 2.25px stroke, rounded caps/joins
// Primary: #666666 | Accent: #D4AF37

// Invoice - Document with header line accent
export const InvoiceIcon = ({ size = 30, className }) => (
    <svg
        width={size}
        height={size}
        viewBox="0 0 30 30"
        fill="none"
        className={className}
    >
        {/* Document outline */}
        <rect x="5" y="4" width="20" height="22" rx="2.5" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        {/* Gold header line */}
        <line x1="9" y1="9" x2="21" y2="9" stroke="#D4AF37" strokeWidth="2.25" strokeLinecap="round" />
        {/* Content lines */}
        <line x1="9" y1="14" x2="21" y2="14" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
        <line x1="9" y1="19" x2="16" y2="19" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
    </svg>
);

// Purchase - Shopping Bag with plus accent
export const PurchaseIcon = ({ size = 30, className }) => (
    <svg
        width={size}
        height={size}
        viewBox="0 0 30 30"
        fill="none"
        className={className}
    >
        {/* Bag handles */}
        <path d="M11 10V7a4 4 0 018 0v3" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        {/* Bag body */}
        <rect x="6" y="10" width="18" height="16" rx="2.5" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        {/* Gold plus sign */}
        <line x1="15" y1="15" x2="15" y2="21" stroke="#D4AF37" strokeWidth="2.25" strokeLinecap="round" />
        <line x1="12" y1="18" x2="18" y2="18" stroke="#D4AF37" strokeWidth="2.25" strokeLinecap="round" />
    </svg>
);

// Quotation - Clipboard with header accent
export const QuotationIcon = ({ size = 30, className }) => (
    <svg
        width={size}
        height={size}
        viewBox="0 0 30 30"
        fill="none"
        className={className}
    >
        {/* Clipboard body */}
        <rect x="5" y="5" width="20" height="21" rx="2.5" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        {/* Clipboard clip */}
        <path d="M11 3h8v4a1 1 0 01-1 1h-6a1 1 0 01-1-1V3z" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        {/* Gold header bar */}
        <line x1="9" y1="12" x2="21" y2="12" stroke="#D4AF37" strokeWidth="2.25" strokeLinecap="round" />
        {/* Content lines */}
        <line x1="9" y1="17" x2="21" y2="17" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
        <line x1="9" y1="22" x2="15" y2="22" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
    </svg>
);

// DailyLogin - Calendar with checkmark accent
export const DailyLoginIcon = ({ size = 30, className }) => (
    <svg
        width={size}
        height={size}
        viewBox="0 0 30 30"
        fill="none"
        className={className}
    >
        {/* Calendar body */}
        <rect x="4" y="5" width="22" height="21" rx="2.5" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        {/* Calendar hooks */}
        <line x1="10" y1="3" x2="10" y2="8" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
        <line x1="20" y1="3" x2="20" y2="8" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
        {/* Horizontal divider */}
        <line x1="4" y1="11" x2="26" y2="11" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
        {/* Gold checkmark */}
        <path d="M10 18l3 3L20 15" stroke="#D4AF37" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
    </svg>
);

// LendingBill - Archive box with stroked arrow (fixed weight consistency)
export const LendingBillIcon = ({ size = 30, className }) => (
    <svg
        width={size}
        height={size}
        viewBox="0 0 30 30"
        fill="none"
        className={className}
    >
        {/* Archive box top */}
        <path d="M4 6.5a2.5 2.5 0 012.5-2.5h17a2.5 2.5 0 012.5 2.5v2.5H4V6.5z" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        {/* Archive box body */}
        <path d="M4 9h22v15a2.5 2.5 0 01-2.5 2.5h-17A2.5 2.5 0 014 24V9z" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        {/* Gold arrow pointing down - Simple stroke */}
        <line x1="15" y1="13" x2="15" y2="21" stroke="#D4AF37" strokeWidth="2.25" strokeLinecap="round" />
        <line x1="11" y1="17" x2="15" y2="21" stroke="#D4AF37" strokeWidth="2.25" strokeLinecap="round" />
        <line x1="19" y1="17" x2="15" y2="21" stroke="#D4AF37" strokeWidth="2.25" strokeLinecap="round" />
    </svg>
);

// Expenses - Wallet with coin accent (centered)
export const ExpensesIcon = ({ size = 30, className }) => (
    <svg
        width={size}
        height={size}
        viewBox="0 0 30 30"
        fill="none"
        className={className}
    >
        {/* Wallet body - optically centered */}
        <rect x="3" y="6" width="24" height="18" rx="2.5" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        {/* Wallet flap */}
        <path d="M3 11h24" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
        {/* Gold coin circle */}
        <circle cx="21" cy="16.5" r="2.5" stroke="#D4AF37" strokeWidth="2.25" />
    </svg>
);

// ProFormaInvoice - Simplified density (replaced buttons with lines)
export const ProFormaInvoiceIcon = ({ size = 30, className }) => (
    <svg
        width={size}
        height={size}
        viewBox="0 0 30 30"
        fill="none"
        className={className}
    >
        {/* Calculator body */}
        <rect x="5" y="3" width="20" height="24" rx="2.5" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        {/* Gold display screen */}
        <rect x="8" y="7" width="14" height="4" rx="1" stroke="#D4AF37" strokeWidth="2.25" />
        {/* Simple keypad lines - Less noise */}
        <line x1="8" y1="16" x2="13" y2="16" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
        <line x1="17" y1="16" x2="22" y2="16" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
        <line x1="8" y1="21" x2="13" y2="21" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
        <line x1="17" y1="21" x2="22" y2="21" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
    </svg>
);

// PaymentsTimeline - Document/card with checkmark
export const PaymentsTimelineIcon = ({ size = 30, className }) => (
    <svg
        width={size}
        height={size}
        viewBox="0 0 30 30"
        fill="none"
        className={className}
    >
        {/* Card/document outline */}
        <rect x="4" y="5" width="22" height="20" rx="2.5" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        {/* Horizontal lines */}
        <line x1="8" y1="11" x2="13" y2="11" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
        <line x1="8" y1="16" x2="15" y2="16" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
        {/* Gold checkmark */}
        <path d="M17 14l2.5 2.5 5-5" stroke="#D4AF37" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
    </svg>
);

// Reports - Clock with gold hands
export const ReportsIcon = ({ size = 30, className }) => (
    <svg
        width={size}
        height={size}
        viewBox="0 0 30 30"
        fill="none"
        className={className}
    >
        {/* Clock circle */}
        <circle cx="15" cy="15" r="11" stroke="#666666" strokeWidth="2.25" />
        {/* Tick marks */}
        <line x1="15" y1="4.5" x2="15" y2="6.5" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
        <line x1="15" y1="23.5" x2="15" y2="25.5" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
        <line x1="4.5" y1="15" x2="6.5" y2="15" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
        <line x1="23.5" y1="15" x2="25.5" y2="15" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
        {/* Gold clock hands */}
        <line x1="15" y1="15" x2="15" y2="9" stroke="#D4AF37" strokeWidth="2.25" strokeLinecap="round" />
        <line x1="15" y1="15" x2="20" y2="15" stroke="#D4AF37" strokeWidth="2.25" strokeLinecap="round" />
    </svg>
);

// Insights - Optically balanced
export const InsightsIcon = ({ size = 30, className }) => (
    <svg
        width={size}
        height={size}
        viewBox="0 0 30 30"
        fill="none"
        className={className}
    >
        {/* X and Y axis - shifted down slightly to ground it */}
        <path d="M4 5v21h22" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        {/* Gold rising trend line with nodes */}
        <path d="M9 20l5-5 5 2.5 6-7.5" stroke="#D4AF37" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        <circle cx="9" cy="20" r="2" fill="#D4AF37" />
        <circle cx="14" cy="15" r="2" fill="#D4AF37" />
        <circle cx="19" cy="17.5" r="2" fill="#D4AF37" />
        <circle cx="25" cy="10" r="2" fill="#D4AF37" />
    </svg>
);

// InvoiceTemplates - Simplified visual density
export const InvoiceTemplatesIcon = ({ size = 30, className }) => (
    <svg
        width={size}
        height={size}
        viewBox="0 0 30 30"
        fill="none"
        className={className}
    >
        {/* Document outline */}
        <path d="M17.5 3H8a2.5 2.5 0 00-2.5 2.5v19A2.5 2.5 0 008 27h14a2.5 2.5 0 002.5-2.5V10l-7-7z" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        {/* Folded corner */}
        <path d="M17.5 3v7.5H25" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        {/* Gold title line */}
        <line x1="10" y1="15" x2="20" y2="15" stroke="#D4AF37" strokeWidth="2.25" strokeLinecap="round" />
        {/* Content lines - Removed extra lines for density */}
        <line x1="10" y1="21" x2="20" y2="21" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" />
    </svg>
);

// DocumentSettings - Consistency fix
export const DocumentSettingsIcon = ({ size = 30, className }) => (
    <svg
        width={size}
        height={size}
        viewBox="0 0 30 30"
        fill="none"
        className={className}
    >
        {/* Gear outer shape */}
        <path d="M15 18.75a3.75 3.75 0 100-7.5 3.75 3.75 0 000 7.5z" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        <path d="M24.25 18.75a2.06 2.06 0 00.41 2.28l.08.08a2.5 2.5 0 11-3.54 3.54l-.08-.08a2.06 2.06 0 00-2.28-.41 2.06 2.06 0 00-1.25 1.89v.2a2.5 2.5 0 01-5 0v-.11a2.06 2.06 0 00-1.35-1.89 2.06 2.06 0 00-2.28.41l-.08.08a2.5 2.5 0 11-3.54-3.54l.08-.08a2.06 2.06 0 00.41-2.28 2.06 2.06 0 00-1.89-1.25h-.2a2.5 2.5 0 010-5h.11a2.06 2.06 0 001.89-1.35 2.06 2.06 0 00-.41-2.28l-.08-.08a2.5 2.5 0 113.54-3.54l.08.08a2.06 2.06 0 002.28.41h.09a2.06 2.06 0 001.25-1.89v-.2a2.5 2.5 0 015 0v.11a2.06 2.06 0 001.25 1.89 2.06 2.06 0 002.28-.41l.08-.08a2.5 2.5 0 113.54 3.54l-.08.08a2.06 2.06 0 00-.41 2.28v.09a2.06 2.06 0 001.89 1.25h.2a2.5 2.5 0 010 5h-.11a2.06 2.06 0 00-1.89 1.25z" stroke="#666666" strokeWidth="2.25" strokeLinecap="round" strokeLinejoin="round" />
        {/* Gold center hub */}
        <circle cx="15" cy="15" r="2" fill="#D4AF37" />
    </svg>
);
</file>

<file path="src/components/InvoiceTemplates/index.js">
import { Template1 } from './Template1';
import { Template2 } from './Template2';
import { Template3 } from './Template3';

export const templates = {
    modern: {
        id: 'modern',
        name: 'Modern',
        component: Template1,
        thumbnail: '/templates/modern.svg',
        previewImage: '/templates/modern-preview.svg'
    },
    classic: {
        id: 'classic',
        name: 'Classic',
        component: Template2,
        thumbnail: '/templates/classic.svg',
        previewImage: '/templates/classic-preview.svg'
    },
    elegant: {
        id: 'elegant',
        name: 'Elegant',
        component: Template3,
        thumbnail: '/templates/elegant.svg',
        previewImage: '/templates/modern-preview.svg' // Placeholder
    }
};

export const getTemplate = (id) => {
    return templates[id] || templates.modern;
};
</file>

<file path="src/components/LandingPage/LandingPage.js">
'use client';

import { motion } from 'framer-motion';
import {
    RiRocketLine, RiPieChartLine, RiSecurePaymentLine, RiSmartphoneLine,
    RiInstagramLine, RiYoutubeFill, RiLinkedinFill, RiTwitterXFill, RiFacebookCircleFill,
    RiArrowUpLine
} from 'react-icons/ri';
import styles from './LandingPage.module.css';

export default function LandingPage({ onGetStarted }) {
    return (
        <div className={styles.container}>
            <nav className={styles.nav}>
                <div className={styles.logo}>swipe 🇮🇳</div>
                <button className={styles.secondaryButton} onClick={onGetStarted} style={{ padding: '0.5rem 1.5rem', fontSize: '0.9rem' }}>
                    Login
                </button>
            </nav>

            <main className={styles.hero}>
                <motion.div
                    className={styles.heroContent}
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.8 }}
                >
                    <span className={styles.badge}>New: GST E-Invoicing Support</span>
                    <h1 className={styles.title}>
                        Invoicing for the <br />
                        <span style={{ color: '#60a5fa' }}>Modern Business</span>
                    </h1>
                    <p className={styles.subtitle}>
                        Create professional invoices, track payments, and manage your inventory with the #1 billing app for Indian MSMEs.
                    </p>

                    <div className={styles.ctaGroup}>
                        <button className={styles.primaryButton} onClick={onGetStarted}>
                            Get Started Free
                        </button>
                        <button className={styles.secondaryButton}>
                            Watch Demo
                        </button>
                    </div>
                </motion.div>

                <motion.div
                    className={styles.heroImageContainer}
                    initial={{ opacity: 0, y: 40, rotateX: 10 }}
                    animate={{ opacity: 1, y: 0, rotateX: 0 }}
                    transition={{ duration: 1, delay: 0.2 }}
                >
                    <img
                        src="/hero-dashboard.png"
                        alt="Swipe Dashboard"
                        className={styles.heroImage}
                    />
                </motion.div>
            </main>

            <section className={styles.features}>
                <h2 className={styles.sectionTitle}>Everything you need to grow</h2>
                <div className={styles.grid}>
                    <FeatureCard
                        icon={RiRocketLine}
                        title="Lightning Fast"
                        text="Create invoices in less than 10 seconds. Share via WhatsApp or Email instantly."
                        delay={0}
                    />
                    <FeatureCard
                        icon={RiPieChartLine}
                        title="Smart Analytics"
                        text="Track your sales, expenses, and profits with beautiful, easy-to-understand charts."
                        delay={0.1}
                    />
                    <FeatureCard
                        icon={RiSecurePaymentLine}
                        title="Secure & Safe"
                        text="Your data is encrypted and backed up automatically. Access it from anywhere."
                        delay={0.2}
                    />
                    <FeatureCard
                        icon={RiSmartphoneLine}
                        title="Mobile First"
                        text="Designed for your phone. Manage your entire business from your pocket."
                        delay={0.3}
                    />
                </div>
            </section>
            <footer className={styles.footer}>
                <div className={styles.footerGrid}>
                    <div className={styles.footerColumn}>
                        <div className={styles.footerLogo}>
                            <div className={styles.logo}>swipe 🇮🇳</div>
                        </div>
                        <div className={styles.socialIcons}>
                            <RiInstagramLine className={styles.socialIcon} />
                            <RiYoutubeFill className={styles.socialIcon} />
                            <RiLinkedinFill className={styles.socialIcon} />
                            <RiTwitterXFill className={styles.socialIcon} />
                            <RiFacebookCircleFill className={styles.socialIcon} />
                        </div>
                    </div>

                    <div className={styles.footerColumn}>
                        <h4 className={styles.footerHeading}>Quick Links</h4>
                        <a href="#" className={styles.footerLink}>Home</a>
                        <a href="#" className={styles.footerLink}>Features</a>
                        <a href="#" className={styles.footerLink}>Pricing</a>
                        <a href="#" className={styles.footerLink}>Invoice Formats</a>
                        <a href="#" className={styles.footerLink}>Tutorials</a>
                    </div>

                    <div className={styles.footerColumn}>
                        <h4 className={styles.footerHeading}>Features</h4>
                        <a href="#" className={styles.footerLink}>Einvoices</a>
                        <a href="#" className={styles.footerLink}>Ewaybills</a>
                        <a href="#" className={styles.footerLink}>Swipe AI</a>
                        <a href="#" className={styles.footerLink}>Online Store</a>
                        <a href="#" className={styles.footerLink}>Integrations</a>
                    </div>

                    <div className={styles.footerColumn}>
                        <h4 className={styles.footerHeading}>Register</h4>
                        <a href="#" className={styles.footerLink}>Get Started</a>
                        <a href="#" className={styles.footerLink}>Login</a>
                        <a href="#" className={styles.footerLink}>Contact Us</a>
                    </div>

                    <div className={styles.footerColumn}>
                        <h4 className={styles.footerHeading}>Legal</h4>
                        <a href="#" className={styles.footerLink}>Privacy Policy</a>
                        <a href="#" className={styles.footerLink}>Refund Policy</a>
                        <a href="#" className={styles.footerLink}>Terms of Service</a>
                        <a href="#" className={styles.footerLink}>Refer your friends</a>
                    </div>

                    <div className={styles.footerColumn}>
                        <h4 className={styles.footerHeading}>Explore</h4>
                        <a href="#" className={styles.footerLink}>Blog</a>
                        <a href="#" className={styles.footerLink}>Join Community 🤝</a>
                        <a href="#" className={styles.footerLink}>Product Updates</a>
                        <a href="#" className={styles.footerLink}>Developers 👷</a>
                        <a href="#" className={styles.footerLink}>Swipe for Startups 🤝</a>
                        <a href="#" className={styles.footerLink}>Swipe for Accountants 💼</a>
                        <a href="#" className={styles.footerLink}>Tools</a>
                        <a href="#" className={styles.footerLink}>We're hiring 🚀</a>
                    </div>
                </div>
            </footer>

            <button
                className={styles.scrollTopButton}
                onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}
            >
                <RiArrowUpLine size={24} />
            </button>
        </div>
    );
}

function FeatureCard({ icon: Icon, title, text, delay }) {
    return (
        <motion.div
            className={styles.card}
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.5, delay }}
        >
            <Icon className={styles.cardIcon} />
            <h3 className={styles.cardTitle}>{title}</h3>
            <p className={styles.cardText}>{text}</p>
        </motion.div>
    );
}
</file>

<file path="src/components/AddressBottomSheet.js">
import React, { useState, useEffect } from 'react';
import { createPortal } from 'react-dom';
import { FiX } from 'react-icons/fi';
import styles from './BottomSheet.module.css'; // Reusing existing BottomSheet styles

export const AddressBottomSheet = ({ isOpen, onClose, onSave, initialData, title, showAutofill }) => {
    const [formData, setFormData] = useState({
        addressLine1: '',
        addressLine2: '',
        pincode: '',
        city: '',
        state: ''
    });

    useEffect(() => {
        if (isOpen && initialData) {
            setFormData(initialData);
        }
    }, [isOpen, initialData]);

    if (!isOpen) return null;

    const handleChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: value }));
    };

    const handleSave = () => {
        if (!formData.addressLine1 || !formData.state) {
            alert('Please fill required fields (*)');
            return;
        }
        onSave(formData);
        onClose();
    };

    // Mock fetch details
    const fetchDetails = () => {
        if (formData.pincode === '500032') {
            setFormData(prev => ({ ...prev, city: 'Hyderabad', state: 'Telangana' }));
        } else {
            alert('Details not found for this pincode (Try 500032)');
        }
    };

    return createPortal(
        <div className={styles.overlay} onClick={onClose}>
            <div className={styles.sheet} onClick={e => e.stopPropagation()}>
                <div className={styles.handleBar} />

                <div style={{ padding: '16px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', borderBottom: '1px solid #eee' }}>
                    <h3 style={{ margin: 0, fontSize: '18px' }}>{title}</h3>
                    <FiX size={24} onClick={onClose} style={{ cursor: 'pointer' }} />
                </div>

                <div style={{ padding: '20px', display: 'flex', flexDirection: 'column', gap: '16px', maxHeight: '70vh', overflowY: 'auto' }}>
                    {showAutofill && (
                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px', color: '#2563eb', fontSize: '14px', fontWeight: 500 }}>
                            <input type="checkbox" /> Autofill Company Name
                        </div>
                    )}

                    <div>
                        <label style={{ display: 'block', fontSize: '12px', color: '#666', marginBottom: '4px' }}>Address Line 1 <span style={{ color: 'red' }}>*</span></label>
                        <input
                            name="addressLine1"
                            value={formData.addressLine1}
                            onChange={handleChange}
                            style={{ width: '100%', padding: '12px', borderRadius: '8px', border: '1px solid #e5e7eb', fontSize: '16px' }}
                        />
                    </div>

                    <div>
                        <label style={{ display: 'block', fontSize: '12px', color: '#666', marginBottom: '4px' }}>Address Line 2</label>
                        <input
                            name="addressLine2"
                            value={formData.addressLine2}
                            onChange={handleChange}
                            style={{ width: '100%', padding: '12px', borderRadius: '8px', border: '1px solid #e5e7eb', fontSize: '16px' }}
                        />
                    </div>

                    <div style={{ display: 'flex', gap: '12px' }}>
                        <div style={{ flex: 1 }}>
                            <label style={{ display: 'block', fontSize: '12px', color: '#666', marginBottom: '4px' }}>Pincode</label>
                            <div style={{ position: 'relative' }}>
                                <input
                                    name="pincode"
                                    value={formData.pincode}
                                    onChange={handleChange}
                                    style={{ width: '100%', padding: '12px', borderRadius: '8px', border: '1px solid #e5e7eb', fontSize: '16px' }}
                                />
                                <button
                                    onClick={fetchDetails}
                                    style={{ position: 'absolute', right: '4px', top: '4px', bottom: '4px', background: '#2563eb', color: 'white', border: 'none', borderRadius: '6px', padding: '0 12px', fontSize: '12px', cursor: 'pointer' }}
                                >
                                    Fetch Details
                                </button>
                            </div>
                        </div>
                    </div>

                    <div style={{ display: 'flex', gap: '12px' }}>
                        <div style={{ flex: 1 }}>
                            <label style={{ display: 'block', fontSize: '12px', color: '#666', marginBottom: '4px' }}>City</label>
                            <input
                                name="city"
                                value={formData.city}
                                onChange={handleChange}
                                style={{ width: '100%', padding: '12px', borderRadius: '8px', border: '1px solid #e5e7eb', fontSize: '16px' }}
                            />
                        </div>
                        <div style={{ flex: 1 }}>
                            <label style={{ display: 'block', fontSize: '12px', color: '#666', marginBottom: '4px' }}>State <span style={{ color: 'red' }}>*</span></label>
                            <input
                                name="state"
                                value={formData.state}
                                onChange={handleChange}
                                style={{ width: '100%', padding: '12px', borderRadius: '8px', border: '1px solid #e5e7eb', fontSize: '16px' }}
                            />
                        </div>
                    </div>

                    <button
                        onClick={handleSave}
                        style={{ width: '100%', background: '#2563eb', color: 'white', padding: '16px', borderRadius: '8px', border: 'none', fontSize: '16px', fontWeight: 'bold', marginTop: '16px' }}
                    >
                        Save & Update
                    </button>
                </div>
            </div>
        </div>,
        document.body
    );
};
</file>

<file path="src/components/AnimatedButton.js">
'use client';

import { motion } from 'framer-motion';
import { ANIMATIONS } from '@/lib/animations';

export default function AnimatedButton({ children, className, onClick, ...props }) {
    return (
        <motion.button
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.95 }}
            transition={{
                duration: ANIMATIONS.duration.fast,
                ease: ANIMATIONS.ease.out,
            }}
            className={className}
            onClick={onClick}
            {...props}
        >
            {children}
        </motion.button>
    );
}
</file>

<file path="src/components/BackButtonHandler.js">
'use client';

import { useBackButton } from '@/lib/hooks/useBackButton';

export default function BackButtonHandler() {
    useBackButton();
    return null;
}
</file>

<file path="src/components/BottomSheet.module.css">
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    animation: fadeIn 0.2s ease-out;
}

.sheet {
    background-color: white;
    border-top-left-radius: 16px;
    border-top-right-radius: 16px;
    padding-bottom: env(safe-area-inset-bottom);
    max-height: 90vh;
    overflow-y: auto;
    animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
}

.handleBar {
    width: 100%;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.handle {
    width: 40px;
    height: 4px;
    background-color: #e5e7eb;
    border-radius: 2px;
}

.content {
    padding: 0 16px 16px 16px;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

@keyframes slideUp {
    from {
        transform: translateY(100%);
    }

    to {
        transform: translateY(0);
    }
}
</file>

<file path="src/components/CancelInvoiceModal.js">
'use client';

import { useState, useEffect } from 'react';
import { createPortal } from 'react-dom';
import { motion, AnimatePresence } from 'framer-motion';
import { ANIMATIONS } from '@/lib/animations';

export default function CancelInvoiceModal({ isOpen, onClose, onConfirm }) {
    const [mounted, setMounted] = useState(false);
    const [reason, setReason] = useState('');

    useEffect(() => {
        setMounted(true);
    }, []);

    if (!mounted) return null;

    return createPortal(
        <AnimatePresence>
            {isOpen && (
                <div style={{
                    position: 'fixed', inset: 0, zIndex: 50,
                    display: 'flex', alignItems: 'center', justifyContent: 'center',
                    padding: '16px'
                }}>
                    {/* Backdrop */}
                    <motion.div
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        exit={{ opacity: 0 }}
                        onClick={onClose}
                        style={{
                            position: 'absolute', inset: 0,
                            background: 'rgba(0, 0, 0, 0.5)',
                            backdropFilter: 'blur(2px)'
                        }}
                    />

                    {/* Modal Content */}
                    <motion.div
                        initial={{ opacity: 0, scale: 0.95, y: 10 }}
                        animate={{ opacity: 1, scale: 1, y: 0 }}
                        exit={{ opacity: 0, scale: 0.95, y: 10 }}
                        transition={{ duration: ANIMATIONS.duration.fast, ease: ANIMATIONS.ease.out }}
                        style={{
                            position: 'relative',
                            background: 'white',
                            borderRadius: '16px',
                            padding: '24px',
                            width: '100%',
                            maxWidth: '340px',
                            boxShadow: '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)'
                        }}
                    >
                        <h3 style={{
                            fontSize: '18px', fontWeight: 700, color: '#111827',
                            marginBottom: '16px', textAlign: 'center', lineHeight: 1.3
                        }}>
                            Do you want to cancel this invoice?
                        </h3>

                        <div style={{ position: 'relative', marginBottom: '16px' }}>
                            <input
                                type="text"
                                value={reason}
                                onChange={(e) => setReason(e.target.value)}
                                placeholder=" "
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    border: '1px solid #2563eb',
                                    borderRadius: '8px',
                                    fontSize: '14px',
                                    outline: 'none',
                                    color: '#111827'
                                }}
                            />
                            <label style={{
                                position: 'absolute',
                                left: '12px',
                                top: '-8px',
                                background: 'white',
                                padding: '0 4px',
                                fontSize: '12px',
                                color: '#2563eb'
                            }}>
                                Enter reason
                            </label>
                            <div style={{
                                position: 'absolute',
                                left: '14px',
                                top: '14px',
                                width: '1px',
                                height: '20px',
                                background: '#111827',
                                animation: 'blink 1s step-end infinite'
                            }} />
                            <style jsx>{`
                                @keyframes blink {
                                    0%, 100% { opacity: 1; }
                                    50% { opacity: 0; }
                                }
                            `}</style>
                        </div>

                        <p style={{
                            color: '#ef4444',
                            fontSize: '13px',
                            marginBottom: '24px',
                            textAlign: 'left'
                        }}>
                            This action cannot be reversed
                        </p>

                        <div style={{ display: 'flex', gap: '12px' }}>
                            <button
                                onClick={onClose}
                                style={{
                                    flex: 1,
                                    padding: '10px',
                                    borderRadius: '8px',
                                    background: '#e5e7eb',
                                    color: '#4b5563',
                                    fontWeight: 600,
                                    fontSize: '14px'
                                }}
                            >
                                No
                            </button>
                            <button
                                onClick={() => onConfirm(reason)}
                                style={{
                                    flex: 1,
                                    padding: '10px',
                                    borderRadius: '8px',
                                    background: '#ef4444',
                                    color: 'white',
                                    fontWeight: 600,
                                    fontSize: '14px'
                                }}
                            >
                                Yes
                            </button>
                        </div>
                    </motion.div>
                </div>
            )}
        </AnimatePresence>,
        document.body
    );
}
</file>

<file path="src/components/ComingSoon.js">
'use client';

import { useRouter } from 'next/navigation';
import { RiRocketLine, RiArrowLeftLine } from 'react-icons/ri';
import styles from './ComingSoon.module.css';

export default function ComingSoon({ showBackButton = true }) {
    const router = useRouter();

    return (
        <div className={styles.container}>
            <div className={styles.iconWrapper}>
                <RiRocketLine size={64} color="#2563eb" />
            </div>
            <h1 className={styles.title}>Coming Soon!</h1>
            <p className={styles.subtitle}>
                We are working hard to bring this feature to you. Stay tuned for updates!
            </p>
            {showBackButton && (
                <button className={styles.button} onClick={() => router.back()}>
                    <RiArrowLeftLine size={20} />
                    Go Back
                </button>
            )}
        </div>
    );
}
</file>

<file path="src/components/ComingSoon.module.css">
.container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 24px;
    background-color: #F5F7FA;
    text-align: center;
}

.iconWrapper {
    width: 120px;
    height: 120px;
    background: #EFF6FF;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 32px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
}

.title {
    font-size: 28px;
    font-weight: 800;
    color: #111111;
    margin-bottom: 12px;
}

.subtitle {
    font-size: 16px;
    color: #6B7280;
    margin-bottom: 48px;
    line-height: 1.5;
    max-width: 300px;
}

.button {
    background: #2563eb;
    color: white;
    padding: 16px 32px;
    border-radius: 16px;
    font-weight: 600;
    font-size: 16px;
    border: none;
    cursor: pointer;
    transition: background 0.2s;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.button:active {
    transform: scale(0.98);
}
</file>

<file path="src/components/ImagePicker.js">
import React, { useRef } from 'react';
import { FiCamera } from 'react-icons/fi';

export const ImagePicker = ({ image, onImageSelect }) => {
    const fileInputRef = useRef(null);

    const handleFileChange = (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onloadend = () => {
                onImageSelect(reader.result);
            };
            reader.readAsDataURL(file);
        }
    };

    return (
        <div
            onClick={() => fileInputRef.current.click()}
            style={{
                width: '100px',
                height: '100px',
                borderRadius: '16px',
                background: image ? `url(${image}) center/cover no-repeat` : '#f3f4f6',
                border: '1px solid #e5e7eb',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                cursor: 'pointer',
                position: 'relative',
                boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)'
            }}
        >
            <input
                type="file"
                ref={fileInputRef}
                onChange={handleFileChange}
                accept="image/*"
                style={{ display: 'none' }}
            />
            {!image && <FiCamera size={32} color="#9ca3af" />}

            {/* Edit Icon Overlay */}
            <div style={{
                position: 'absolute',
                top: -8,
                right: -8,
                background: 'white',
                borderRadius: '50%',
                padding: '4px',
                boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
            }}>
                <div style={{ width: '20px', height: '20px', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#2563eb', fontSize: '16px' }}>+</div>
            </div>
        </div>
    );
};
</file>

<file path="src/components/InvoiceTemplate.js">
import React from 'react';
import { formatCurrency } from '@/lib/utils/tax';

export const InvoiceTemplate = ({ data }) => {
    const { invoiceNumber, date, items, totals } = data;

    return (
        <div style={{ padding: '40px', background: 'white', width: '800px', fontFamily: 'Arial, sans-serif' }} id="invoice-template">
            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '40px' }}>
                <div>
                    <h1 style={{ fontSize: '32px', color: '#2563eb', margin: 0 }}>INVOICE</h1>
                    <p style={{ color: '#666', marginTop: '8px' }}>#{invoiceNumber}</p>
                </div>
                <div style={{ textAlign: 'right' }}>
                    <p style={{ fontWeight: 'bold' }}>Date: {date}</p>
                </div>
            </div>

            <table style={{ width: '100%', borderCollapse: 'collapse', marginBottom: '40px' }}>
                <thead>
                    <tr style={{ background: '#f8f9fa', textAlign: 'left' }}>
                        <th style={{ padding: '12px', borderBottom: '2px solid #eee' }}>Item</th>
                        <th style={{ padding: '12px', borderBottom: '2px solid #eee', textAlign: 'right' }}>Qty</th>
                        <th style={{ padding: '12px', borderBottom: '2px solid #eee', textAlign: 'right' }}>Rate</th>
                        <th style={{ padding: '12px', borderBottom: '2px solid #eee', textAlign: 'right' }}>Amount</th>
                    </tr>
                </thead>
                <tbody>
                    {items.map((item, index) => (
                        <tr key={index} style={{ borderBottom: '1px solid #eee' }}>
                            <td style={{ padding: '12px' }}>{item.name}</td>
                            <td style={{ padding: '12px', textAlign: 'right' }}>{item.quantity}</td>
                            <td style={{ padding: '12px', textAlign: 'right' }}>{formatCurrency(item.rate)}</td>
                            <td style={{ padding: '12px', textAlign: 'right' }}>{formatCurrency(item.quantity * item.rate)}</td>
                        </tr>
                    ))}
                </tbody>
            </table>

            <div style={{ display: 'flex', justifyContent: 'flex-end' }}>
                <div style={{ width: '300px' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', padding: '8px 0' }}>
                        <span>Subtotal:</span>
                        <span>{formatCurrency(totals.subtotal)}</span>
                    </div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', padding: '8px 0' }}>
                        <span>Tax:</span>
                        <span>{formatCurrency(totals.totalTax)}</span>
                    </div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', padding: '12px 0', borderTop: '2px solid #eee', fontWeight: 'bold', fontSize: '18px' }}>
                        <span>Total:</span>
                        <span>{formatCurrency(totals.total)}</span>
                    </div>
                </div>
            </div>
        </div>
    );
};
</file>

<file path="src/components/PartyListItem.js">
import React from 'react';
import { FiArrowDown } from 'react-icons/fi';

export const PartyListItem = ({ party, onClick }) => {
    const balance = party.balance || 0;
    const isDue = balance > 0;
    const isAdvance = balance < 0;

    return (
        <div
            onClick={onClick}
            style={{
                display: 'flex',
                alignItems: 'center',
                padding: '16px',
                background: 'white',
                borderBottom: '1px solid #f3f4f6',
                cursor: 'pointer'
            }}
        >
            <div style={{
                width: '40px',
                height: '40px',
                borderRadius: '50%',
                background: '#e0e7ff',
                color: '#3730a3',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                fontWeight: 'bold',
                marginRight: '12px'
            }}>
                {party.name[0].toUpperCase()}
            </div>

            <div style={{ flex: 1 }}>
                <div style={{ fontWeight: 600, color: '#111827' }}>{party.name}</div>
                <div style={{ fontSize: '12px', color: '#6b7280' }}>
                    {party.phone || 'No phone'}
                </div>
            </div>

            <div style={{ textAlign: 'right' }}>
                {balance === 0 ? (
                    <div style={{ fontSize: '14px', color: '#6b7280' }}>No dues</div>
                ) : (
                    <div style={{
                        fontSize: '14px',
                        fontWeight: 600,
                        color: isDue ? '#dc2626' : '#16a34a',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'flex-end',
                        gap: '4px'
                    }}>
                        {isDue && <FiArrowDown />}
                        ₹ {Math.abs(balance).toFixed(2)}
                    </div>
                )}
                {balance !== 0 && (
                    <div style={{ fontSize: '10px', color: isDue ? '#dc2626' : '#16a34a' }}>
                        {isDue ? 'You get' : 'You pay'}
                    </div>
                )}
            </div>
        </div>
    );
};
</file>

<file path="src/components/PurchaseForm.module.css">
.container {
    padding: 16px;
    padding-bottom: 120px;
    /* Space for fixed footer */
}

.card {
    background: white;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.label {
    font-size: 12px;
    color: #6b7280;
    margin-bottom: 4px;
}

.value {
    font-size: 14px;
    font-weight: 500;
    color: #111827;
}

.sectionTitle {
    font-size: 14px;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.addButton {
    width: 100%;
    padding: 12px;
    background: #eff6ff;
    border: 1px dashed #3b82f6;
    border-radius: 8px;
    color: #2563eb;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    cursor: pointer;
}

.itemRow {
    border-bottom: 1px solid #f3f4f6;
    padding-bottom: 12px;
    margin-bottom: 12px;
}

.itemHeader {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
}

.itemInputs {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 12px;
    align-items: center;
}

.input {
    width: 100%;
    padding: 8px;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    font-size: 14px;
}

/* Optional Fields */
.optionalRow {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    border-bottom: 1px solid #f3f4f6;
}

.optionalLabel {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    color: #4b5563;
}

.optionalInput {
    border: none;
    text-align: right;
    font-size: 14px;
    outline: none;
    width: 120px;
}

/* Toggles */
.toggleRow {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.toggleRow:last-child {
    margin-bottom: 0;
}

.toggleLabel {
    font-size: 14px;
    font-weight: 600;
    color: #111827;
}

.toggleSwitch {
    width: 44px;
    height: 24px;
    background: #e5e7eb;
    border-radius: 12px;
    position: relative;
    cursor: pointer;
    transition: background 0.2s;
}

.toggleSwitch.active {
    background: #2563eb;
}

.toggleKnob {
    width: 20px;
    height: 20px;
    background: white;
    border-radius: 50%;
    position: absolute;
    top: 2px;
    left: 2px;
    transition: transform 0.2s;
}

.toggleSwitch.active .toggleKnob {
    transform: translateX(20px);
}

/* Payments */
.checkboxRow {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 16px;
}

.paymentGrid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
}

.inputWrapper {
    display: flex;
    align-items: center;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    padding: 0 8px;
}

.paymentInput {
    width: 100%;
    padding: 8px;
    border: none;
    outline: none;
}

.select {
    width: 100%;
    padding: 8px;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    background: white;
}

/* Footer */
.footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #fef3c7;
    padding: 16px;
    border-top: 1px solid #e5e7eb;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 10;
}

.footerLeft {
    flex: 1;
}

.footerRow {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    color: #6b7280;
    margin-bottom: 4px;
}

.totalAmount {
    font-size: 16px;
    font-weight: 700;
    color: #111827;
    margin-top: 4px;
}

.createButton {
    background: #f59e0b;
    color: white;
    border: none;
    padding: 10px 24px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
}

/* Vendor Selection Styles */
.selectedVendor {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.vendorInfo {
    flex: 1;
}

.vendorName {
    font-weight: 600;
    font-size: 16px;
    color: #111827;
}

.vendorPhone {
    font-size: 13px;
    color: #6b7280;
}

.vendorActions {
    display: flex;
    gap: 12px;
}

.actionButton {
    background: none;
    border: none;
    color: #f59e0b;
    font-weight: 500;
    font-size: 14px;
    cursor: pointer;
    padding: 4px 8px;
}

/* Item Actions */
.itemActions {
    display: flex;
    gap: 8px;
}

.itemActionBtn {
    border: none;
    background: none;
    padding: 4px;
    cursor: pointer;
    color: #6b7280;
}

.itemActionBtn:hover {
    color: #111827;
}

.itemActionBtn.delete {
    color: #ef4444;
}
</file>

<file path="src/components/ScanResultModal.js">
'use client';

import { FiShoppingBag, FiX, FiRefreshCw, FiPlus } from 'react-icons/fi';
import styles from './ScanResultModal.module.css';

export default function ScanResultModal({
    isOpen,
    product,
    barcode,
    onAddToTray,
    onScanAgain,
    onAddManually,
    onClose
}) {
    if (!isOpen) return null;

    const hasProduct = !!product;

    return (
        <div className={styles.overlay} onClick={onClose}>
            <div className={styles.modal} onClick={(e) => e.stopPropagation()}>
                <button className={styles.closeBtn} onClick={onClose}>
                    <FiX size={24} />
                </button>

                {hasProduct ? (
                    <>
                        {/* Product Found */}
                        <div className={styles.productCard}>
                            <div className={styles.imageContainer}>
                                {product.images && product.images.length > 0 ? (
                                    <img src={product.images[0].data} alt={product.name} className={styles.image} />
                                ) : (
                                    <div className={styles.placeholderImage}>
                                        <FiShoppingBag size={40} color="#9ca3af" />
                                    </div>
                                )}
                            </div>
                            <div className={styles.productDetails}>
                                <div className={styles.purity}>{product.purity || '22K'}</div>
                                <h3 className={styles.productName}>{product.name || product.subCategory}</h3>
                                <div className={styles.productMeta}>
                                    Weight: {product.grossWeight || 0}g | {product.stoneType || 'Plain Gold'}
                                </div>
                            </div>
                        </div>

                        <button className={styles.primaryBtn} onClick={() => onAddToTray(product)}>
                            <FiPlus size={18} />
                            Add to Tray
                        </button>
                    </>
                ) : (
                    <>
                        {/* Product Not Found */}
                        <div className={styles.notFoundIcon}>
                            <FiShoppingBag size={48} color="#9ca3af" />
                        </div>
                        <h3 className={styles.title}>No Product Found</h3>
                        <p className={styles.message}>
                            No product matches barcode: <strong>{barcode}</strong>
                        </p>

                        <div className={styles.actions}>
                            <button className={styles.secondaryBtn} onClick={onScanAgain}>
                                <FiRefreshCw size={18} />
                                Scan Again
                            </button>
                            <button className={styles.primaryBtn} onClick={() => onAddManually(barcode)}>
                                <FiPlus size={18} />
                                Add Manually
                            </button>
                        </div>
                    </>
                )}
            </div>
        </div>
    );
}
</file>

<file path="src/components/ScanResultModal.module.css">
.overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
}

.modal {
    background: white;
    border-radius: 16px;
    width: 100%;
    max-width: 360px;
    padding: 24px;
    position: relative;
}

.closeBtn {
    position: absolute;
    top: 16px;
    right: 16px;
    background: none;
    border: none;
    color: #6b7280;
    cursor: pointer;
}

.productCard {
    display: flex;
    gap: 16px;
    margin-bottom: 24px;
}

.imageContainer {
    width: 80px;
    height: 80px;
    border-radius: 12px;
    overflow: hidden;
    flex-shrink: 0;
}

.image {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.placeholderImage {
    width: 100%;
    height: 100%;
    background: #f3f4f6;
    display: flex;
    align-items: center;
    justify-content: center;
}

.productDetails {
    flex: 1;
}

.purity {
    background: rgba(234, 179, 8, 0.9);
    color: white;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    display: inline-block;
    margin-bottom: 8px;
}

.productName {
    margin: 0 0 4px;
    font-size: 16px;
    font-weight: 600;
    color: #111827;
}

.productMeta {
    font-size: 13px;
    color: #6b7280;
}

.notFoundIcon {
    width: 80px;
    height: 80px;
    background: #f3f4f6;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 16px;
}

.title {
    text-align: center;
    margin: 0 0 8px;
    font-size: 18px;
    font-weight: 600;
    color: #111827;
}

.message {
    text-align: center;
    margin: 0 0 24px;
    font-size: 14px;
    color: #6b7280;
}

.actions {
    display: flex;
    gap: 12px;
}

.primaryBtn {
    flex: 1;
    background: #ca8a04;
    color: white;
    border: none;
    padding: 12px 16px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.primaryBtn:hover {
    background: #a16207;
}

.secondaryBtn {
    flex: 1;
    background: #f3f4f6;
    color: #374151;
    border: none;
    padding: 12px 16px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.secondaryBtn:hover {
    background: #e5e7eb;
}
</file>

<file path="src/components/Toast.js">
'use client';

import { useState, useEffect, createContext, useContext, useCallback } from 'react';
import { createPortal } from 'react-dom';
import { registerToastCallback } from '@/lib/utils/invoiceActions';

// Toast Context
const ToastContext = createContext(null);

export const useToast = () => {
    const context = useContext(ToastContext);
    if (!context) {
        console.warn('useToast must be used within ToastProvider');
        return { showToast: () => { } };
    }
    return context;
};

// Toast styles
const toastStyles = {
    container: {
        position: 'fixed',
        bottom: '100px',
        left: '50%',
        transform: 'translateX(-50%)',
        zIndex: 9999,
        pointerEvents: 'none'
    },
    toast: {
        padding: '12px 20px',
        borderRadius: '8px',
        fontSize: '14px',
        fontWeight: 500,
        boxShadow: '0 4px 12px rgba(0,0,0,0.15)',
        display: 'flex',
        alignItems: 'center',
        gap: '8px',
        animation: 'slideUp 0.3s ease-out',
        maxWidth: '90vw',
        textAlign: 'center'
    },
    success: {
        background: '#10b981',
        color: 'white'
    },
    error: {
        background: '#ef4444',
        color: 'white'
    },
    info: {
        background: '#3b82f6',
        color: 'white'
    }
};

// Toast Component
const Toast = ({ message, type, onClose }) => {
    useEffect(() => {
        const timer = setTimeout(onClose, 3000);
        return () => clearTimeout(timer);
    }, [onClose]);

    const icons = {
        success: '✓',
        error: '✕',
        info: 'ℹ'
    };

    return (
        <div style={{ ...toastStyles.toast, ...toastStyles[type] }}>
            <span>{icons[type]}</span>
            <span>{message}</span>
        </div>
    );
};

// Toast Provider Component
export const ToastProvider = ({ children }) => {
    const [toasts, setToasts] = useState([]);
    const [mounted, setMounted] = useState(false);

    const showToast = useCallback((message, type = 'info') => {
        const id = Date.now();
        setToasts(prev => [...prev, { id, message, type }]);
    }, []);

    const removeToast = useCallback((id) => {
        setToasts(prev => prev.filter(t => t.id !== id));
    }, []);

    // Register callback with invoiceActions utility
    useEffect(() => {
        setMounted(true);
        registerToastCallback(showToast);
        return () => registerToastCallback(null);
    }, [showToast]);

    // Inject keyframes for animation
    useEffect(() => {
        if (typeof document !== 'undefined') {
            const styleId = 'toast-animations';
            if (!document.getElementById(styleId)) {
                const style = document.createElement('style');
                style.id = styleId;
                style.textContent = `
                    @keyframes slideUp {
                        from { opacity: 0; transform: translateY(20px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                `;
                document.head.appendChild(style);
            }
        }
    }, []);

    return (
        <ToastContext.Provider value={{ showToast }}>
            {children}
            {mounted && typeof document !== 'undefined' && createPortal(
                <div style={toastStyles.container}>
                    {toasts.map(toast => (
                        <Toast
                            key={toast.id}
                            message={toast.message}
                            type={toast.type}
                            onClose={() => removeToast(toast.id)}
                        />
                    ))}
                </div>,
                document.body
            )}
        </ToastContext.Provider>
    );
};

export default ToastProvider;
</file>

<file path="src/lib/data/tagTemplates.js">
// Tag Template Definitions
// These are static template configurations used for barcode label printing

export const TAG_TEMPLATES = [
    {
        template_id: 'MINIMAL',
        name: 'Minimal Tag',
        description: 'Fast printing, least clutter',
        preview_front: '/images/templates/minimal_front.png',
        preview_back: '/images/templates/minimal_back.png',
        fields_front: ['barcode', 'sku', 'category'],
        fields_back: ['netWeight', 'purity'],
        version: 1
    },
    {
        template_id: 'WEIGHT',
        name: 'Weight-Focused Tag',
        description: 'Highlights product weight prominently',
        preview_front: '/images/templates/weight_front.png',
        preview_back: '/images/templates/weight_back.png',
        fields_front: ['barcode', 'netWeight', 'purity'],
        fields_back: ['sku', 'grossWeight', 'price'],
        version: 1
    },
    {
        template_id: 'DETAILED',
        name: 'Detailed Tag',
        description: 'High-detail for premium jewellery',
        preview_front: '/images/templates/detailed_front.png',
        preview_back: '/images/templates/detailed_back.png',
        fields_front: ['barcode', 'sku', 'category', 'netWeight', 'purity'],
        fields_back: ['stoneDetails', 'makingCharges', 'finalPrice'],
        version: 1
    }
];

// Helper to get template by ID
export const getTemplateById = (templateId) => {
    return TAG_TEMPLATES.find(t => t.template_id === templateId);
};

// Default template
export const DEFAULT_TEMPLATE_ID = 'MINIMAL';
</file>

<file path="src/lib/hooks/useBackButton.js">
import { useEffect } from 'react';
import { App } from '@capacitor/app';
import { useRouter, usePathname } from 'next/navigation';

export const useBackButton = () => {
    const router = useRouter();
    const pathname = usePathname();

    useEffect(() => {
        const handleBackButton = async () => {
            App.addListener('backButton', ({ canGoBack }) => {
                if (pathname === '/') {
                    App.exitApp();
                } else {
                    router.back();
                }
            });
        };

        handleBackButton();

        return () => {
            App.removeAllListeners();
        };
    }, [router, pathname]);
};
</file>

<file path="src/lib/services/bulkUploadService.js">
import Papa from 'papaparse';
import { db } from '@/lib/db';
import { useProductStore } from '@/lib/store/productStore';

export const BulkUploadService = {
    // 1. Download Template
    downloadTemplate: () => {
        const headers = [
            'product_name', 'product_code', 'category', 'sub_category',
            'gross_weight', 'net_weight', 'purity', 'metal_type',
            'making_charge_per_gram', 'rate_per_gram', 'description',
            'stock_qty', 'stone_weight', 'size', 'hsn_code', 'selling_price', 'purchase_price'
        ];

        const csvContent = headers.join(',');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', 'product_bulk_upload_template.csv');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    },

    // 2. Download All Products
    downloadAllProducts: async () => {
        try {
            const products = await db.products.toArray();
            if (products.length === 0) {
                alert("No products to download.");
                return;
            }

            const headers = [
                'sku', 'name', 'category', 'subCategory', 'grossWeight', 'netWeight',
                'purity', 'metalType', 'makingCharge', 'sellingPrice', 'description',
                'stock', 'stoneWeight', 'size', 'hsn', 'purchasePrice'
            ];

            const csvData = products.map(p => ({
                sku: p.sku || '',
                name: p.name || '',
                category: p.category || '',
                subCategory: p.subCategory || '',
                grossWeight: p.grossWeight || 0,
                netWeight: p.netWeight || 0,
                purity: p.purity || '',
                metalType: p.type || '', // mapping metal type to type in db
                makingCharge: p.makingCharges || 0,
                sellingPrice: p.sellingPrice || 0,
                description: p.description || '',
                stock: p.stock || 0,
                stoneWeight: p.stoneWeight || 0,
                size: p.size || '',
                hsn: p.hsn || '',
                purchasePrice: p.purchasePrice || 0
            }));

            const csvContent = [
                headers.join(','),
                ...csvData.map(row => headers.map(fieldName => {
                    const value = row[fieldName];
                    return typeof value === 'string' && value.includes(',') ? `"${value}"` : value;
                }).join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'all_products.csv');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        } catch (error) {
            console.error("Error downloading products:", error);
            throw error;
        }
    },

    // 3. Validate File
    validateFile: (file) => {
        return new Promise((resolve) => {
            Papa.parse(file, {
                header: true,
                skipEmptyLines: true,
                complete: async (results) => {
                    const rows = results.data;
                    const errors = [];
                    const validRows = [];

                    // Fetch existing categories/subcategories for validation
                    const categories = await db.categories.toArray();
                    const subCategories = await db.subCategories.toArray();
                    const categoryNames = new Set(categories.map(c => c.name.toLowerCase()));
                    const subCategoryNames = new Set(subCategories.map(s => s.name.toLowerCase()));

                    rows.forEach((row, index) => {
                        const rowNum = index + 2; // +1 for 0-index, +1 for header
                        const rowErrors = [];

                        // Mandatory Fields
                        if (!row.product_name) rowErrors.push(`Row ${rowNum}: product_name is required.`);
                        if (!row.category) rowErrors.push(`Row ${rowNum}: category is required.`);

                        // Category Validation
                        if (row.category && !categoryNames.has(row.category.toLowerCase().trim())) {
                            rowErrors.push(`Row ${rowNum}: Category '${row.category}' not found.`);
                        }

                        // SubCategory Validation
                        if (row.sub_category && !subCategoryNames.has(row.sub_category.toLowerCase().trim())) {
                            rowErrors.push(`Row ${rowNum}: SubCategory '${row.sub_category}' not found.`);
                        }

                        // Numeric Validations
                        if (row.gross_weight && isNaN(parseFloat(row.gross_weight))) {
                            rowErrors.push(`Row ${rowNum}: gross_weight must be numeric.`);
                        }
                        if (row.net_weight && isNaN(parseFloat(row.net_weight))) {
                            rowErrors.push(`Row ${rowNum}: net_weight must be numeric.`);
                        }
                        if (row.selling_price && isNaN(parseFloat(row.selling_price))) {
                            rowErrors.push(`Row ${rowNum}: selling_price must be numeric.`);
                        }

                        if (rowErrors.length > 0) {
                            errors.push(...rowErrors);
                        } else {
                            validRows.push(row);
                        }
                    });

                    resolve({
                        valid: errors.length === 0,
                        errors,
                        data: validRows,
                        totalReceived: rows.length
                    });
                },
                error: (err) => {
                    resolve({ valid: false, errors: [`CSV Parse Error: ${err.message}`], data: [] });
                }
            });
        });
    },

    // 4. Process File
    processFile: async (rows, userId = 'user') => { // userId hardcoded for now or passed from auth
        let successCount = 0;
        let failureCount = 0;
        const failedRows = [];

        try {
            for (const row of rows) {
                try {
                    // Logic to auto-generate SKU if needed
                    let sku = row.product_code;
                    if (!sku) {
                        const store = useProductStore.getState();
                        sku = await store.generateSKU(row.category, row.sub_category);
                        await store.incrementSKUSequence();
                    }

                    const productData = {
                        name: row.product_name,
                        sku: sku,
                        category: row.category,
                        subCategory: row.sub_category,
                        grossWeight: parseFloat(row.gross_weight) || 0,
                        netWeight: parseFloat(row.net_weight) || 0,
                        purity: row.purity,
                        type: row.metal_type, // DB uses 'type' for metal type usually? or checks schema
                        makingCharges: parseFloat(row.making_charge_per_gram) || 0,
                        ratePerGram: parseFloat(row.rate_per_gram) || 0,
                        description: row.description,
                        stock: parseFloat(row.stock_qty) || 1,
                        stoneWeight: parseFloat(row.stone_weight) || 0,
                        size: row.size,
                        hsn: row.hsn_code,
                        sellingPrice: parseFloat(row.selling_price) || 0,
                        purchasePrice: parseFloat(row.purchase_price) || 0,
                        images: [], // Placeholder
                        createdAt: new Date(),
                        updatedAt: new Date()
                    };

                    // Check if product exists by SKU to update? 
                    // For now, if SKU is provided and exists, we update. If not, create.
                    let existingProduct = null;
                    if (row.product_code) {
                        existingProduct = await db.products.where('sku').equals(row.product_code).first();
                    }

                    if (existingProduct) {
                        await db.products.update(existingProduct.id, productData);
                    } else {
                        await db.products.add(productData);
                    }
                    successCount++;
                } catch (err) {
                    console.error("Row processing error", err);
                    failureCount++;
                    failedRows.push({ row, error: err.message });
                }
            }

            // Log entry
            await db.bulk_upload_logs.add({
                userId,
                fileName: 'bulk_upload.csv', // Ideally passed in
                totalRecords: rows.length,
                successCount,
                failureCount,
                timestamp: new Date()
            });

            return { success: true, successCount, failureCount, failedRows };

        } catch (error) {
            console.error("Bulk process critical error", error);
            return { success: false, error: error.message };
        }
    }
};
</file>

<file path="src/lib/store/__tests__/invoiceStore.test.js">
// Mock the database
jest.mock('@/lib/db', () => ({
    db: {
        invoices: {
            toArray: jest.fn(),
            add: jest.fn(),
            update: jest.fn(),
            delete: jest.fn(),
        },
        payments: { add: jest.fn() },
        payment_allocations: { add: jest.fn() },
        customers: { get: jest.fn(), update: jest.fn() },
        transaction: jest.fn((mode, tables, callback) => callback()),
    },
}));

import { useInvoiceStore } from '../invoiceStore';
import { db } from '@/lib/db';

describe('invoiceStore', () => {
    beforeEach(() => {
        // Reset to default state
        useInvoiceStore.getState().resetInvoice();
        jest.clearAllMocks();
    });

    describe('calculateTotals', () => {
        describe('with jewellery items', () => {
            it('should calculate item total from weight and rate', () => {
                useInvoiceStore.setState({
                    items: [{
                        id: 1,
                        productId: 100,
                        netWeight: 10, // 10 grams
                        ratePerGram: 5000, // ₹5000 per gram
                        makingChargePerGram: 500, // ₹500 per gram
                        quantity: 1,
                    }],
                    type: 'INVOICE',
                    roundOff: false,
                    details: { extraDiscount: 0, shippingCharges: 0, packagingCharges: 0 },
                });

                const { calculateTotals } = useInvoiceStore.getState();
                const totals = calculateTotals();

                // Material Value = 10 * 5000 = 50000
                // Making Charge = 10 * 500 = 5000
                // Subtotal = 55000
                expect(totals.subtotal).toBe(55000);

                // Tax = 1.5% CGST + 1.5% SGST = 3% = 1650
                expect(totals.cgst).toBe(825);
                expect(totals.sgst).toBe(825);
                expect(totals.totalTax).toBe(1650);

                // Total = 55000 + 1650 = 56650
                expect(totals.total).toBe(56650);
            });

            it('should handle multiple items', () => {
                useInvoiceStore.setState({
                    items: [
                        {
                            id: 1,
                            productId: 100,
                            netWeight: 10,
                            ratePerGram: 5000,
                            makingChargePerGram: 500,
                            quantity: 1,
                        },
                        {
                            id: 2,
                            productId: 101,
                            netWeight: 5,
                            ratePerGram: 6000,
                            makingChargePerGram: 600,
                            quantity: 1,
                        },
                    ],
                    type: 'INVOICE',
                    roundOff: false,
                    details: { extraDiscount: 0, shippingCharges: 0, packagingCharges: 0 },
                });

                const totals = useInvoiceStore.getState().calculateTotals();

                // Item 1: 10 * (5000 + 500) = 55000
                // Item 2: 5 * (6000 + 600) = 33000
                // Subtotal = 88000
                expect(totals.subtotal).toBe(88000);
            });

            it('should multiply by quantity', () => {
                useInvoiceStore.setState({
                    items: [{
                        id: 1,
                        productId: 100,
                        netWeight: 10,
                        ratePerGram: 1000,
                        makingChargePerGram: 100,
                        quantity: 2,
                    }],
                    type: 'INVOICE',
                    roundOff: false,
                    details: { extraDiscount: 0, shippingCharges: 0, packagingCharges: 0 },
                });

                const totals = useInvoiceStore.getState().calculateTotals();

                // Per piece: 10 * (1000 + 100) = 11000
                // x2 quantity = 22000
                expect(totals.subtotal).toBe(22000);
            });
        });

        describe('with extra charges and discounts', () => {
            it('should add shipping and packaging charges', () => {
                useInvoiceStore.setState({
                    items: [{
                        id: 1,
                        productId: 100,
                        netWeight: 10,
                        ratePerGram: 1000,
                        makingChargePerGram: 0,
                        quantity: 1,
                    }],
                    type: 'INVOICE',
                    roundOff: false,
                    details: {
                        extraDiscount: 0,
                        shippingCharges: 500,
                        packagingCharges: 200,
                    },
                });

                const totals = useInvoiceStore.getState().calculateTotals();

                // Subtotal = 10000
                // Tax = 300
                // + Shipping 500 + Packaging 200 = 11000
                expect(totals.total).toBe(10000 + 300 + 500 + 200);
            });

            it('should subtract extra discount', () => {
                useInvoiceStore.setState({
                    items: [{
                        id: 1,
                        productId: 100,
                        netWeight: 10,
                        ratePerGram: 1000,
                        makingChargePerGram: 0,
                        quantity: 1,
                    }],
                    type: 'INVOICE',
                    roundOff: false,
                    details: {
                        extraDiscount: 1000,
                        shippingCharges: 0,
                        packagingCharges: 0,
                    },
                });

                const totals = useInvoiceStore.getState().calculateTotals();

                // Subtotal = 10000, Tax = 300, Discount = -1000
                expect(totals.total).toBe(10000 + 300 - 1000);
            });
        });

        describe('round off', () => {
            it('should round total when roundOff is enabled', () => {
                useInvoiceStore.setState({
                    items: [{
                        id: 1,
                        productId: 100,
                        netWeight: 1,
                        ratePerGram: 1000,
                        makingChargePerGram: 0,
                        quantity: 1,
                    }],
                    type: 'INVOICE',
                    roundOff: true,
                    details: { extraDiscount: 0, shippingCharges: 0, packagingCharges: 0 },
                });

                const totals = useInvoiceStore.getState().calculateTotals();

                // Subtotal = 1000, Tax = 30, Total = 1030 (already round)
                expect(totals.total).toBe(1030);
                expect(totals.roundOffAmount).toBe(0);
            });

            it('should calculate round off amount correctly', () => {
                useInvoiceStore.setState({
                    items: [{
                        id: 1,
                        productId: 100,
                        netWeight: 1,
                        ratePerGram: 1001,
                        makingChargePerGram: 0,
                        quantity: 1,
                    }],
                    type: 'INVOICE',
                    roundOff: true,
                    details: { extraDiscount: 0, shippingCharges: 0, packagingCharges: 0 },
                });

                const totals = useInvoiceStore.getState().calculateTotals();

                // Subtotal = 1001, Tax = 30.03, Raw Total = 1031.03
                // Rounded = 1031, roundOffAmount = -0.03
                expect(totals.total).toBe(1031);
                expect(totals.roundOffAmount).toBeCloseTo(-0.03, 2);
            });
        });

        describe('invoice types', () => {
            it('should return zero totals for LENDING type', () => {
                useInvoiceStore.setState({
                    items: [{
                        id: 1,
                        productId: 100,
                        netWeight: 10,
                        ratePerGram: 5000,
                        makingChargePerGram: 500,
                        quantity: 1,
                    }],
                    type: 'LENDING',
                    roundOff: false,
                    details: { extraDiscount: 0, shippingCharges: 0, packagingCharges: 0 },
                });

                const totals = useInvoiceStore.getState().calculateTotals();

                expect(totals.subtotal).toBe(0);
                expect(totals.totalTax).toBe(0);
                expect(totals.total).toBe(0);
                expect(totals.cgst).toBe(0);
                expect(totals.sgst).toBe(0);
            });

            it('should skip tax for PROFORMA type', () => {
                useInvoiceStore.setState({
                    items: [{
                        id: 1,
                        productId: 100,
                        netWeight: 10,
                        ratePerGram: 1000,
                        makingChargePerGram: 0,
                        quantity: 1,
                    }],
                    type: 'PROFORMA',
                    roundOff: false,
                    details: { extraDiscount: 0, shippingCharges: 0, packagingCharges: 0 },
                });

                const totals = useInvoiceStore.getState().calculateTotals();

                expect(totals.subtotal).toBe(10000);
                expect(totals.totalTax).toBe(0);
                expect(totals.cgst).toBe(0);
                expect(totals.sgst).toBe(0);
                expect(totals.total).toBe(10000);
            });
        });

        describe('legacy items (without productId)', () => {
            it('should use rate * quantity for legacy items', () => {
                useInvoiceStore.setState({
                    items: [{
                        id: 1,
                        name: 'Manual Item',
                        rate: 500,
                        quantity: 3,
                        // No productId or netWeight
                    }],
                    type: 'INVOICE',
                    roundOff: false,
                    details: { extraDiscount: 0, shippingCharges: 0, packagingCharges: 0 },
                });

                const totals = useInvoiceStore.getState().calculateTotals();

                // rate * quantity = 500 * 3 = 1500
                expect(totals.subtotal).toBe(1500);
            });
        });
    });

    describe('item management', () => {
        it('should add empty item with addItem', () => {
            const { addItem } = useInvoiceStore.getState();
            addItem();

            const items = useInvoiceStore.getState().items;
            expect(items.length).toBe(1);
            expect(items[0]).toEqual(expect.objectContaining({
                name: '',
                rate: 0,
                quantity: 1,
            }));
        });

        it('should update item field with updateItem', () => {
            useInvoiceStore.setState({
                items: [{ id: 1, name: 'Test', quantity: 1 }],
            });

            const { updateItem } = useInvoiceStore.getState();
            updateItem(1, 'quantity', 5);

            expect(useInvoiceStore.getState().items[0].quantity).toBe(5);
        });

        it('should remove item with removeItem', () => {
            useInvoiceStore.setState({
                items: [
                    { id: 1, name: 'Item 1' },
                    { id: 2, name: 'Item 2' },
                ],
            });

            const { removeItem } = useInvoiceStore.getState();
            removeItem(1);

            const items = useInvoiceStore.getState().items;
            expect(items.length).toBe(1);
            expect(items[0].name).toBe('Item 2');
        });
    });

    describe('addOrUpdateItem', () => {
        it('should add new product to items', () => {
            const product = {
                id: 100,
                name: 'Gold Ring',
                subCategory: 'Ring',
                sellingPrice: 5000,
                makingCharges: 500,
                grossWeight: 12,
                netWeight: 10,
                hsn: '7113',
                purity: '22K',
            };

            const { addOrUpdateItem } = useInvoiceStore.getState();
            addOrUpdateItem(product, 1);

            const items = useInvoiceStore.getState().items;
            expect(items.length).toBe(1);
            expect(items[0]).toEqual(expect.objectContaining({
                productId: 100,
                name: 'Ring', // Uses subCategory
                ratePerGram: 5000,
                makingChargePerGram: 500,
                grossWeight: 12,
                netWeight: 10,
                hsn: '7113',
                purity: '22K',
                quantity: 1,
            }));
        });

        it('should increment quantity for existing product', () => {
            useInvoiceStore.setState({
                items: [{
                    id: 1,
                    productId: 100,
                    name: 'Ring',
                    quantity: 2,
                }],
            });

            const { addOrUpdateItem } = useInvoiceStore.getState();
            addOrUpdateItem({ id: 100 }, 1);

            expect(useInvoiceStore.getState().items[0].quantity).toBe(3);
        });

        it('should remove item when quantity goes to zero', () => {
            useInvoiceStore.setState({
                items: [{
                    id: 1,
                    productId: 100,
                    name: 'Ring',
                    quantity: 1,
                }],
            });

            const { addOrUpdateItem } = useInvoiceStore.getState();
            addOrUpdateItem({ id: 100 }, -1);

            expect(useInvoiceStore.getState().items.length).toBe(0);
        });
    });

    describe('resetInvoice', () => {
        it('should reset all fields to defaults', () => {
            useInvoiceStore.setState({
                customer: { id: 1, name: 'Test' },
                items: [{ id: 1 }],
                type: 'PROFORMA',
            });

            const { resetInvoice } = useInvoiceStore.getState();
            resetInvoice();

            const state = useInvoiceStore.getState();
            expect(state.customer).toBeNull();
            expect(state.items).toEqual([]);
            expect(state.type).toBe('INVOICE');
        });
    });
});
</file>

<file path="src/lib/store/__tests__/productStore.test.js">
// Mock the database
jest.mock('@/lib/db', () => ({
    db: {
        products: {
            toArray: jest.fn(),
            add: jest.fn(),
            delete: jest.fn(),
            update: jest.fn(),
        },
        sequences: {
            get: jest.fn(),
            add: jest.fn(),
            update: jest.fn(),
        },
    },
}));

import { useProductStore } from '../productStore';
import { db } from '@/lib/db';

describe('productStore', () => {
    beforeEach(() => {
        // Reset the store state before each test
        useProductStore.setState({
            products: [],
            isLoading: false,
        });
        jest.clearAllMocks();
    });

    describe('generateSKU', () => {
        it('should return empty string when category is missing', async () => {
            const { generateSKU } = useProductStore.getState();
            const result = await generateSKU('', 'Ring');
            expect(result).toBe('');
        });

        it('should return empty string when subCategory is missing', async () => {
            const { generateSKU } = useProductStore.getState();
            const result = await generateSKU('Gold', '');
            expect(result).toBe('');
        });

        it('should generate SKU with correct format when no sequence exists', async () => {
            db.sequences.get.mockResolvedValue(null);

            const { generateSKU } = useProductStore.getState();
            const result = await generateSKU('Gold', 'Ring');

            expect(result).toBe('GOL-RIN-000001');
        });

        it('should generate SKU with incremented sequence', async () => {
            db.sequences.get.mockResolvedValue({ key: 'product_sku', value: 42 });

            const { generateSKU } = useProductStore.getState();
            const result = await generateSKU('Silver', 'Necklace');

            expect(result).toBe('SIL-NEC-000043');
        });

        it('should handle errors gracefully', async () => {
            db.sequences.get.mockRejectedValue(new Error('DB error'));

            const { generateSKU } = useProductStore.getState();
            const result = await generateSKU('Gold', 'Ring');

            expect(result).toBe('');
        });
    });

    describe('loadProducts', () => {
        it('should load products and reverse the order', async () => {
            const mockProducts = [
                { id: 1, name: 'Product 1' },
                { id: 2, name: 'Product 2' },
            ];
            db.products.toArray.mockResolvedValue(mockProducts);

            const { loadProducts } = useProductStore.getState();
            await loadProducts();

            const state = useProductStore.getState();
            expect(state.products).toEqual([
                { id: 2, name: 'Product 2' },
                { id: 1, name: 'Product 1' },
            ]);
            expect(state.isLoading).toBe(false);
        });

        it('should set isLoading to true while loading', async () => {
            db.products.toArray.mockImplementation(() => new Promise(() => { })); // Never resolves

            const { loadProducts } = useProductStore.getState();
            loadProducts(); // Don't await

            expect(useProductStore.getState().isLoading).toBe(true);
        });

        it('should handle errors and set isLoading to false', async () => {
            db.products.toArray.mockRejectedValue(new Error('DB error'));

            const { loadProducts } = useProductStore.getState();
            await loadProducts();

            expect(useProductStore.getState().isLoading).toBe(false);
        });
    });

    describe('addProduct', () => {
        it('should add product to database and state', async () => {
            db.products.add.mockResolvedValue(123);
            db.sequences.get.mockResolvedValue({ key: 'product_sku', value: 1 });
            db.sequences.update.mockResolvedValue(1);

            const newProduct = { name: 'Gold Ring', category: 'Gold' };
            const { addProduct } = useProductStore.getState();
            const id = await addProduct(newProduct);

            expect(id).toBe(123);
            expect(db.products.add).toHaveBeenCalledWith(expect.objectContaining({
                name: 'Gold Ring',
                category: 'Gold',
                createdAt: expect.any(Date),
            }));

            const state = useProductStore.getState();
            expect(state.products[0]).toEqual(expect.objectContaining({
                id: 123,
                name: 'Gold Ring',
            }));
        });
    });

    describe('deleteProduct', () => {
        it('should remove product from database and state', async () => {
            useProductStore.setState({
                products: [
                    { id: 1, name: 'Product 1' },
                    { id: 2, name: 'Product 2' },
                ],
            });
            db.products.delete.mockResolvedValue(undefined);

            const { deleteProduct } = useProductStore.getState();
            await deleteProduct(1);

            expect(db.products.delete).toHaveBeenCalledWith(1);
            expect(useProductStore.getState().products).toEqual([
                { id: 2, name: 'Product 2' },
            ]);
        });
    });

    describe('updateProduct', () => {
        it('should update product in database and state', async () => {
            useProductStore.setState({
                products: [{ id: 1, name: 'Old Name', price: 100 }],
            });
            db.products.update.mockResolvedValue(1);

            const { updateProduct } = useProductStore.getState();
            await updateProduct(1, { name: 'New Name' });

            expect(db.products.update).toHaveBeenCalledWith(1, { name: 'New Name' });
            expect(useProductStore.getState().products[0]).toEqual({
                id: 1,
                name: 'New Name',
                price: 100,
            });
        });
    });

    describe('incrementSKUSequence', () => {
        it('should create sequence if it does not exist', async () => {
            db.sequences.get.mockResolvedValue(null);
            db.sequences.add.mockResolvedValue(1);

            const { incrementSKUSequence } = useProductStore.getState();
            await incrementSKUSequence();

            expect(db.sequences.add).toHaveBeenCalledWith({ key: 'product_sku', value: 1 });
        });

        it('should increment existing sequence', async () => {
            db.sequences.get.mockResolvedValue({ key: 'product_sku', value: 5 });
            db.sequences.update.mockResolvedValue(1);

            const { incrementSKUSequence } = useProductStore.getState();
            await incrementSKUSequence();

            expect(db.sequences.update).toHaveBeenCalledWith('product_sku', { value: 6 });
        });
    });
});
</file>

<file path="src/lib/store/authStore.js">
import { create } from 'zustand';
import { db } from '@/lib/db';

export const useAuthStore = create((set, get) => ({
    isAuthenticated: false,
    isLoading: true,
    phoneNumber: '',
    currentStep: 'welcome', // welcome, phone, otp

    loadAuth: async () => {
        try {
            const auth = await db.settings.get('auth');
            if (auth && auth.value) {
                set({ isAuthenticated: true, phoneNumber: auth.value.phoneNumber, isLoading: false });
            } else {
                set({ isAuthenticated: false, isLoading: false });
            }
        } catch (error) {
            console.error('Failed to load auth:', error);
            set({ isAuthenticated: false, isLoading: false });
        }
    },

    setStep: (step) => set({ currentStep: step }),

    setPhoneNumber: (phone) => set({ phoneNumber: phone, currentStep: 'otp' }),

    verifyOTP: async (otp) => {
        if (otp === '111111') {
            const authData = { phoneNumber: get().phoneNumber, authenticatedAt: new Date() };
            await db.settings.put({ key: 'auth', value: authData });
            set({ isAuthenticated: true, currentStep: 'welcome' });
            return true;
        }
        return false;
    },

    logout: async () => {
        await db.settings.delete('auth');
        set({ isAuthenticated: false, phoneNumber: '', currentStep: 'welcome' });
    }
}));
</file>

<file path="src/lib/store/expenseStore.js">
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

export const useExpenseStore = create(
    persist(
        (set, get) => ({
            expenses: [],
            categories: [
                'Karigar',
                'Miscellaneous',
                'Transportation & Travel Expense',
                'Telephone & Internet Bills',
                'Repair & Maintenance',
                'Rent Expense',
                'Raw Material',
                'Printing and Stationery',
                'Employee Salaries & Advances',
                'Electricity Bill',
                'Bank Fee and Charges',
            ],

            addExpense: (expense) =>
                set((state) => ({
                    expenses: [
                        {
                            id: Date.now().toString(),
                            createdAt: new Date().toISOString(),
                            ...expense,
                        },
                        ...state.expenses,
                    ],
                })),

            updateExpense: (id, updatedExpense) =>
                set((state) => ({
                    expenses: state.expenses.map((exp) =>
                        exp.id === id ? { ...exp, ...updatedExpense } : exp
                    ),
                })),

            deleteExpense: (id) =>
                set((state) => ({
                    expenses: state.expenses.filter((exp) => exp.id !== id),
                })),

            addCategory: (category) =>
                set((state) => ({
                    categories: [...state.categories, category],
                })),

            updateCategory: (oldCategory, newCategory) =>
                set((state) => ({
                    categories: state.categories.map((cat) =>
                        cat === oldCategory ? newCategory : cat
                    ),
                    // Also update expenses that use this category
                    expenses: state.expenses.map((exp) =>
                        exp.category === oldCategory ? { ...exp, category: newCategory } : exp
                    ),
                })),

            deleteCategory: (category) =>
                set((state) => ({
                    categories: state.categories.filter((cat) => cat !== category),
                })),
        }),
        {
            name: 'expense-storage',
        }
    )
);
</file>

<file path="src/lib/store/masterStore.js">
import { create } from 'zustand';
import { db } from '@/lib/db';

export const useMasterStore = create((set, get) => ({
    categories: [],
    subCategories: [],
    isLoading: false,

    // Categories
    loadCategories: async () => {
        set({ isLoading: true });
        try {
            const categories = await db.categories.toArray();
            set({ categories, isLoading: false });
        } catch (error) {
            console.error('Failed to load categories:', error);
            set({ isLoading: false });
        }
    },

    addCategory: async (name, type = 'product_category') => {
        try {
            const id = await db.categories.add({ name, type });
            set(state => ({ categories: [...state.categories, { id, name, type }] }));
            return id;
        } catch (error) {
            console.error('Failed to add category:', error);
            throw error;
        }
    },

    updateCategory: async (id, updates) => {
        try {
            await db.categories.update(id, updates);
            set(state => ({
                categories: state.categories.map(c => c.id === id ? { ...c, ...updates } : c)
            }));
        } catch (error) {
            console.error('Failed to update category:', error);
            throw error;
        }
    },

    deleteCategory: async (id) => {
        try {
            await db.categories.delete(id);
            // Also delete associated subcategories? Or strict constraint?
            // For now, let's keep it simple, maybe add a warning in UI if needed.
            // But to be clean:
            const subCats = await db.subCategories.where('categoryId').equals(id).toArray();
            const subCatIds = subCats.map(sc => sc.id);
            if (subCatIds.length > 0) {
                await db.subCategories.bulkDelete(subCatIds);
                set(state => ({
                    subCategories: state.subCategories.filter(sc => sc.categoryId !== id)
                }));
            }

            set(state => ({ categories: state.categories.filter(c => c.id !== id) }));
        } catch (error) {
            console.error('Failed to delete category:', error);
            throw error;
        }
    },

    // SubCategories
    loadSubCategories: async () => {
        set({ isLoading: true });
        try {
            const subCategories = await db.subCategories.toArray();
            set({ subCategories, isLoading: false });
        } catch (error) {
            console.error('Failed to load subcategories:', error);
            set({ isLoading: false });
        }
    },

    addSubCategory: async (name, categoryId) => {
        try {
            const id = await db.subCategories.add({ name, categoryId });
            set(state => ({ subCategories: [...state.subCategories, { id, name, categoryId }] }));
            return id;
        } catch (error) {
            console.error('Failed to add subcategory:', error);
            throw error;
        }
    },

    updateSubCategory: async (id, updates) => {
        try {
            await db.subCategories.update(id, updates);
            set(state => ({
                subCategories: state.subCategories.map(sc => sc.id === id ? { ...sc, ...updates } : sc)
            }));
        } catch (error) {
            console.error('Failed to update subcategory:', error);
            throw error;
        }
    },

    deleteSubCategory: async (id) => {
        try {
            await db.subCategories.delete(id);
            set(state => ({ subCategories: state.subCategories.filter(sc => sc.id !== id) }));
        } catch (error) {
            console.error('Failed to delete subcategory:', error);
            throw error;
        }
    },

    getSubCategoriesByCategory: (categoryId) => {
        const state = get();
        // Handle string vs number comparison if needed, usually Dexie IDs are numbers
        return state.subCategories.filter(sc => sc.categoryId == categoryId);
    }
}));
</file>

<file path="src/lib/store/paymentStore.js">
import { create } from 'zustand';
import { db } from '@/lib/db';

export const usePaymentStore = create((set, get) => ({
    payments: [],
    isLoading: false,

    loadPayments: async () => {
        set({ isLoading: true });
        try {
            const payments = await db.payments.toArray();
            set({ payments: payments.reverse(), isLoading: false });
        } catch (error) {
            console.error('Failed to load payments:', error);
            set({ isLoading: false });
        }
    },

    addPayment: async (payment) => {
        try {
            // payment object should match schema: 
            // { transactionNumber, date, type, partyType, partyId, amount, mode, notes }

            const id = await db.payments.add({
                ...payment,
                createdAt: new Date().toISOString()
            });

            // Update local state
            set((state) => ({
                payments: [{ ...payment, id }, ...state.payments]
            }));

            // TODO: Update party balance here or in partyStore?
            // Ideally, we trigger a balance refresh in partyStore

            return id;
        } catch (error) {
            console.error('Failed to add payment:', error);
            throw error;
        }
    },

    deletePayment: async (id) => {
        try {
            await db.payments.delete(id);
            set((state) => ({
                payments: state.payments.filter(p => p.id !== id)
            }));
        } catch (error) {
            console.error('Failed to delete payment:', error);
            throw error;
        }
    },

    getPaymentsByParty: async (partyId) => {
        // This might be better as a selector or just filtering the loaded payments
        // For now, let's query DB for efficiency if list is large
        return await db.payments.where('partyId').equals(partyId).toArray();
    }
}));
</file>

<file path="src/lib/utils/__tests__/exportUtils.test.js">
/**
 * @jest-environment jsdom
 */

// Mock jsPDF
jest.mock('jspdf', () => {
    return jest.fn().mockImplementation(() => ({
        setFontSize: jest.fn(),
        text: jest.fn(),
        line: jest.fn(),
        setTextColor: jest.fn(),
        addPage: jest.fn(),
        save: jest.fn(),
    }));
});

import { exportToCSV, exportToPDF } from '../exportUtils';

describe('exportUtils', () => {
    describe('exportToCSV', () => {
        let mockCreateElement;
        let mockLink;

        beforeEach(() => {
            mockLink = {
                setAttribute: jest.fn(),
                click: jest.fn(),
                style: {},
                download: '',
            };
            mockCreateElement = jest.spyOn(document, 'createElement').mockReturnValue(mockLink);
            jest.spyOn(document.body, 'appendChild').mockImplementation(() => { });
            jest.spyOn(document.body, 'removeChild').mockImplementation(() => { });
            global.URL.createObjectURL = jest.fn(() => 'blob:test-url');
        });

        afterEach(() => {
            jest.restoreAllMocks();
        });

        it('should return early for empty data', () => {
            exportToCSV([], 'test.csv');
            expect(mockCreateElement).not.toHaveBeenCalled();
        });

        it('should return early for null data', () => {
            exportToCSV(null, 'test.csv');
            expect(mockCreateElement).not.toHaveBeenCalled();
        });

        it('should create CSV with correct headers', () => {
            const data = [
                { name: 'Product 1', price: 100, category: 'Gold' },
                { name: 'Product 2', price: 200, category: 'Silver' },
            ];

            exportToCSV(data, 'products.csv');

            expect(mockLink.setAttribute).toHaveBeenCalledWith('download', 'products.csv');
            expect(mockLink.click).toHaveBeenCalled();
        });

        it('should handle strings with commas by wrapping in quotes', () => {
            const data = [
                { name: 'Gold, 22K Ring', price: 5000 },
            ];

            exportToCSV(data, 'test.csv');

            // The blob should contain the wrapped value
            expect(mockLink.click).toHaveBeenCalled();
        });

        it('should create downloadable link', () => {
            const data = [{ id: 1, name: 'Test' }];

            exportToCSV(data, 'export.csv');

            expect(mockCreateElement).toHaveBeenCalledWith('a');
            expect(mockLink.setAttribute).toHaveBeenCalledWith('href', 'blob:test-url');
            expect(mockLink.setAttribute).toHaveBeenCalledWith('download', 'export.csv');
            expect(document.body.appendChild).toHaveBeenCalledWith(mockLink);
            expect(mockLink.click).toHaveBeenCalled();
            expect(document.body.removeChild).toHaveBeenCalledWith(mockLink);
        });
    });

    describe('exportToPDF', () => {
        it('should create PDF with customer information', () => {
            const customer = {
                name: 'John Doe',
                phone: '9876543210',
                balance: 15000.50,
            };

            const transactions = [
                { date: new Date(), type: 'invoice', number: 'INV-001', amount: 10000, balance: 10000 },
                { date: new Date(), type: 'payment_in', number: 'PAY-001', amount: 5000, balance: 5000 },
            ];

            exportToPDF(customer, transactions, 'ledger.pdf');

            // Verify jsPDF was instantiated and methods were called
            const jsPDF = require('jspdf');
            expect(jsPDF).toHaveBeenCalled();
        });

        it('should handle customer without phone', () => {
            const customer = {
                name: 'Jane Doe',
                balance: 5000,
            };

            const transactions = [];

            // Should not throw
            expect(() => {
                exportToPDF(customer, transactions, 'ledger.pdf');
            }).not.toThrow();
        });

        it('should format transaction types correctly', () => {
            const customer = { name: 'Test', balance: 0 };
            const transactions = [
                { date: new Date(), type: 'payment_in', number: 'P1', amount: 100, balance: 100 },
                { date: new Date(), type: 'payment_out', number: 'P2', amount: 50, balance: 50 },
                { date: new Date(), type: 'invoice', number: 'I1', amount: 200, balance: 250 },
            ];

            exportToPDF(customer, transactions, 'test.pdf');

            const jsPDF = require('jspdf');
            expect(jsPDF).toHaveBeenCalled();
        });

        it('should handle transactions without balance', () => {
            const customer = { name: 'Test', balance: 1000 };
            const transactions = [
                { date: new Date(), type: 'invoice', number: 'INV-1', amount: 1000 },
            ];

            expect(() => {
                exportToPDF(customer, transactions, 'test.pdf');
            }).not.toThrow();
        });
    });
});
</file>

<file path="src/lib/utils/__tests__/numberToWords.test.js">
import { numberToWords } from '../numberToWords';

describe('numberToWords', () => {
    describe('basic numbers (1-19)', () => {
        it('should convert single digit numbers', () => {
            expect(numberToWords(1)).toBe('One only ');
            expect(numberToWords(5)).toBe('Five only ');
            expect(numberToWords(9)).toBe('Nine only ');
        });

        it('should convert teen numbers', () => {
            expect(numberToWords(11)).toBe('Eleven only ');
            expect(numberToWords(15)).toBe('Fifteen only ');
            expect(numberToWords(19)).toBe('Nineteen only ');
        });
    });

    describe('tens (20-99)', () => {
        it('should convert round tens', () => {
            expect(numberToWords(20)).toBe('Twenty only ');
            expect(numberToWords(50)).toBe('Fifty only ');
            expect(numberToWords(90)).toBe('Ninety only ');
        });

        it('should convert compound numbers', () => {
            expect(numberToWords(21)).toBe('Twenty One only ');
            expect(numberToWords(45)).toBe('Forty Five only ');
            expect(numberToWords(99)).toBe('Ninety Nine only ');
        });
    });

    describe('hundreds', () => {
        it('should convert round hundreds', () => {
            // Note: Function doesn't append 'only' for round hundreds without units
            expect(numberToWords(100)).toBe('One Hundred ');
            expect(numberToWords(500)).toBe('Five Hundred ');
        });

        it('should convert compound hundreds', () => {
            expect(numberToWords(101)).toBe('One Hundred and One only ');
            expect(numberToWords(250)).toBe('Two Hundred and Fifty only ');
            expect(numberToWords(999)).toBe('Nine Hundred and Ninety Nine only ');
        });
    });

    describe('thousands', () => {
        it('should convert round thousands', () => {
            // Note: Function doesn't append 'only' for round thousands without units
            expect(numberToWords(1000)).toBe('One Thousand ');
            expect(numberToWords(5000)).toBe('Five Thousand ');
        });

        it('should convert compound thousands', () => {
            expect(numberToWords(1234)).toBe('One Thousand Two Hundred and Thirty Four only ');
            expect(numberToWords(10000)).toBe('Ten Thousand ');
            expect(numberToWords(99999)).toBe('Ninety Nine Thousand Nine Hundred and Ninety Nine only ');
        });
    });

    describe('lakhs (Indian number system)', () => {
        it('should convert round lakhs', () => {
            // Note: Function doesn't append 'only' for round lakhs without units
            expect(numberToWords(100000)).toBe('One Lakh ');
            expect(numberToWords(500000)).toBe('Five Lakh ');
        });

        it('should convert compound lakhs', () => {
            expect(numberToWords(123456)).toBe('One Lakh Twenty Three Thousand Four Hundred and Fifty Six only ');
            expect(numberToWords(999999)).toBe('Nine Lakh Ninety Nine Thousand Nine Hundred and Ninety Nine only ');
        });
    });

    describe('crores (Indian number system)', () => {
        it('should convert round crores', () => {
            // Note: Function doesn't append 'only' for round crores without units
            expect(numberToWords(10000000)).toBe('One Crore ');
            expect(numberToWords(50000000)).toBe('Five Crore ');
        });

        it('should convert compound crores', () => {
            expect(numberToWords(12345678)).toBe('One Crore Twenty Three Lakh Forty Five Thousand Six Hundred and Seventy Eight only ');
        });
    });

    describe('edge cases', () => {
        it('should return empty string for zero', () => {
            expect(numberToWords(0)).toBe('');
        });

        it('should handle typical invoice amounts', () => {
            // Round amounts don't get 'only' suffix
            expect(numberToWords(1500)).toBe('One Thousand Five Hundred ');
            expect(numberToWords(25000)).toBe('Twenty Five Thousand ');
            expect(numberToWords(150000)).toBe('One Lakh Fifty Thousand ');
        });
    });
});
</file>

<file path="src/lib/utils/__tests__/tax.test.js">
import { calculateGST, formatCurrency } from '../tax';

describe('calculateGST', () => {
    describe('intra-state transactions (same state)', () => {
        it('should split GST equally between CGST and SGST', () => {
            const result = calculateGST(1000, 18, false);

            expect(result.cgst).toBe(90);
            expect(result.sgst).toBe(90);
            expect(result.igst).toBe(0);
            expect(result.totalTax).toBe(180);
        });

        it('should handle 5% GST rate', () => {
            const result = calculateGST(2000, 5, false);

            expect(result.cgst).toBe(50);
            expect(result.sgst).toBe(50);
            expect(result.igst).toBe(0);
            expect(result.totalTax).toBe(100);
        });

        it('should handle 3% GST rate (for jewellery)', () => {
            const result = calculateGST(10000, 3, false);

            expect(result.cgst).toBe(150);
            expect(result.sgst).toBe(150);
            expect(result.igst).toBe(0);
            expect(result.totalTax).toBe(300);
        });

        it('should handle zero amount', () => {
            const result = calculateGST(0, 18, false);

            expect(result.cgst).toBe(0);
            expect(result.sgst).toBe(0);
            expect(result.igst).toBe(0);
            expect(result.totalTax).toBe(0);
        });
    });

    describe('inter-state transactions (different states)', () => {
        it('should apply full GST as IGST', () => {
            const result = calculateGST(1000, 18, true);

            expect(result.cgst).toBe(0);
            expect(result.sgst).toBe(0);
            expect(result.igst).toBe(180);
            expect(result.totalTax).toBe(180);
        });

        it('should handle 12% GST rate', () => {
            const result = calculateGST(5000, 12, true);

            expect(result.cgst).toBe(0);
            expect(result.sgst).toBe(0);
            expect(result.igst).toBe(600);
            expect(result.totalTax).toBe(600);
        });
    });

    describe('edge cases', () => {
        it('should handle decimal amounts', () => {
            const result = calculateGST(999.99, 18, false);

            expect(result.totalTax).toBeCloseTo(179.9982, 2);
        });

        it('should handle zero GST rate', () => {
            const result = calculateGST(1000, 0, false);

            expect(result.cgst).toBe(0);
            expect(result.sgst).toBe(0);
            expect(result.igst).toBe(0);
            expect(result.totalTax).toBe(0);
        });
    });
});

describe('formatCurrency', () => {
    it('should format whole numbers in INR', () => {
        const formatted = formatCurrency(1000);

        expect(formatted).toContain('1,000');
        expect(formatted).toMatch(/₹|INR/);
    });

    it('should format decimal amounts', () => {
        const formatted = formatCurrency(1234.56);

        expect(formatted).toContain('1,234.56');
    });

    it('should format large amounts with Indian number system', () => {
        const formatted = formatCurrency(1234567);

        // Indian format: 12,34,567
        expect(formatted).toContain('12,34,567');
    });

    it('should handle zero', () => {
        const formatted = formatCurrency(0);

        expect(formatted).toContain('0');
    });

    it('should handle negative amounts', () => {
        const formatted = formatCurrency(-500);

        expect(formatted).toContain('500');
        expect(formatted).toContain('-');
    });
});
</file>

<file path="src/lib/utils/exportUtils.js">
import jsPDF from 'jspdf';

export const exportToCSV = (data, filename) => {
    if (!data || !data.length) return;

    // Get headers from first object
    const headers = Object.keys(data[0]);
    const csvContent = [
        headers.join(','),
        ...data.map(row => headers.map(fieldName => {
            const value = row[fieldName];
            // Handle strings with commas by wrapping in quotes
            return typeof value === 'string' && value.includes(',') ? `"${value}"` : value;
        }).join(','))
    ].join('\n');

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    if (link.download !== undefined) {
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', filename);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
};

export const exportToPDF = (customer, transactions, filename) => {
    const doc = new jsPDF();

    // Header
    doc.setFontSize(20);
    doc.text(customer.name, 14, 22);
    doc.setFontSize(12);
    doc.text(`Phone: ${customer.phone || 'N/A'}`, 14, 30);
    doc.text(`Balance: ${customer.balance?.toFixed(2)}`, 14, 38);

    // Table Header
    let y = 50;
    doc.setFontSize(10);
    doc.setTextColor(100);
    doc.text('Date', 14, y);
    doc.text('Type', 60, y);
    doc.text('Number', 100, y);
    doc.text('Amount', 150, y);
    doc.text('Balance', 180, y);

    doc.line(14, y + 2, 200, y + 2); // Header line
    y += 10;
    doc.setTextColor(0);

    // Table Rows
    transactions.forEach(tx => {
        if (y > 280) { // New page
            doc.addPage();
            y = 20;
        }

        const date = new Date(tx.date).toLocaleDateString();
        const type = tx.type === 'payment_in' ? 'Payment In' :
            tx.type === 'payment_out' ? 'Payment Out' : 'Invoice';
        const number = tx.number;
        const amount = tx.amount.toFixed(2);
        const balance = tx.balance !== undefined ? tx.balance.toFixed(2) : '-';

        doc.text(date, 14, y);
        doc.text(type, 60, y);
        doc.text(number, 100, y);
        doc.text(amount, 150, y);
        doc.text(balance, 180, y);

        y += 8;
    });

    doc.save(filename);
};
</file>

<file path="src/lib/utils/numberToWords.js">
export function numberToWords(num) {
    const a = [
        '', 'One ', 'Two ', 'Three ', 'Four ', 'Five ', 'Six ', 'Seven ', 'Eight ', 'Nine ', 'Ten ',
        'Eleven ', 'Twelve ', 'Thirteen ', 'Fourteen ', 'Fifteen ', 'Sixteen ', 'Seventeen ', 'Eighteen ', 'Nineteen '
    ];
    const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];

    const n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
    if (!n) return '';

    let str = '';
    str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + 'Crore ' : '';
    str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + 'Lakh ' : '';
    str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + 'Thousand ' : '';
    str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + 'Hundred ' : '';
    str += (n[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) + 'only ' : '';

    return str;
}
</file>

<file path="src/lib/utils/tax.js">
export const calculateGST = (amount, rate, isInterState) => {
    const gstAmount = (amount * rate) / 100;
    if (isInterState) {
        return {
            cgst: 0,
            sgst: 0,
            igst: gstAmount,
            totalTax: gstAmount
        };
    } else {
        return {
            cgst: gstAmount / 2,
            sgst: gstAmount / 2,
            igst: 0,
            totalTax: gstAmount
        };
    }
};

export const formatCurrency = (amount) => {
    return new Intl.NumberFormat('en-IN', {
        style: 'currency',
        currency: 'INR',
        maximumFractionDigits: 2
    }).format(amount);
};
</file>

<file path="src/lib/animations.js">
export const ANIMATIONS = {
    // Durations
    duration: {
        fast: 0.2,
        medium: 0.3,
        slow: 0.5,
    },
    // Easings
    ease: {
        // Smooth, modern ease-out
        out: [0.25, 0.1, 0.25, 1.0],
        // Bouncy for playful elements
        elastic: [0.5, 1.5, 0.5, 0.8],
    },
    // Variants
    variants: {
        fadeIn: {
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            exit: { opacity: 0 },
        },
        slideUp: {
            initial: { opacity: 0, y: 10 },
            animate: { opacity: 1, y: 0 },
            exit: { opacity: 0, y: -10 },
        },
        scaleIn: {
            initial: { opacity: 0, scale: 0.95 },
            animate: { opacity: 1, scale: 1 },
            exit: { opacity: 0, scale: 0.95 },
        },
        staggerContainer: {
            animate: {
                transition: {
                    staggerChildren: 0.05,
                },
            },
        },
        listItem: {
            initial: { opacity: 0, y: 10 },
            animate: { opacity: 1, y: 0 },
        },
    },
};
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="capacitor.config.json">
{
    "appId": "com.swipe.app",
    "appName": "Swipe",
    "webDir": "out",
    "server": {
        "androidScheme": "https"
    }
}
</file>

<file path="cypress.config.js">
const { defineConfig } = require('cypress');

module.exports = defineConfig({
    e2e: {
        // Base URL for cy.visit() commands
        baseUrl: 'http://localhost:3000',

        // Spec file pattern
        specPattern: 'cypress/e2e/**/*.cy.{js,jsx,ts,tsx}',

        // Support file location
        supportFile: 'cypress/support/e2e.js',

        // Viewport size (mobile-first for this app)
        viewportWidth: 390,
        viewportHeight: 844,

        // Video recording settings
        video: false,

        // Screenshot settings
        screenshotOnRunFailure: true,

        // Timeouts
        defaultCommandTimeout: 10000,
        pageLoadTimeout: 30000,

        // Retry failed tests
        retries: {
            runMode: 2,
            openMode: 0,
        },

        setupNodeEvents(on, config) {
            // Implement node event listeners here if needed
        },
    },
});
</file>

<file path="jest.config.js">
const nextJest = require('next/jest');

const createJestConfig = nextJest({
    // Provide the path to your Next.js app to load next.config.js and .env files
    dir: './',
});

/** @type {import('jest').Config} */
const customJestConfig = {
    // Setup files to run after Jest is installed
    setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],

    // Test environment for React components
    testEnvironment: 'jsdom',

    // Module path aliases matching jsconfig.json
    moduleNameMapper: {
        '^@/(.*)$': '<rootDir>/src/$1',
    },

    // Test file patterns
    testMatch: [
        '**/__tests__/**/*.test.[jt]s?(x)',
        '**/?(*.)+(spec|test).[jt]s?(x)',
    ],

    // Files to ignore
    testPathIgnorePatterns: [
        '<rootDir>/node_modules/',
        '<rootDir>/.next/',
        '<rootDir>/cypress/',
    ],

    // Coverage configuration
    collectCoverageFrom: [
        'src/**/*.{js,jsx}',
        '!src/**/*.d.ts',
        '!src/**/__tests__/**',
    ],

    // Coverage thresholds (start with lower thresholds, increase over time)
    coverageThreshold: {
        global: {
            branches: 50,
            functions: 50,
            lines: 50,
            statements: 50,
        },
    },
};

module.exports = createJestConfig(customJestConfig);
</file>

<file path="jest.setup.js">
// Jest setup file
// This file runs after Jest is installed but before tests run

// Import custom jest-dom matchers for DOM assertions
// e.g., toBeInTheDocument(), toHaveTextContent(), etc.
import '@testing-library/jest-dom';

// Clean up after each test
afterEach(() => {
    // Clear all mocks between tests
    jest.clearAllMocks();
});

// Mock window.matchMedia for components that use media queries
Object.defineProperty(window, 'matchMedia', {
    writable: true,
    value: jest.fn().mockImplementation(query => ({
        matches: false,
        media: query,
        onchange: null,
        addListener: jest.fn(),
        removeListener: jest.fn(),
        addEventListener: jest.fn(),
        removeEventListener: jest.fn(),
        dispatchEvent: jest.fn(),
    })),
});

// Mock IntersectionObserver for components that use it
global.IntersectionObserver = class IntersectionObserver {
    constructor() { }
    observe() { return null; }
    unobserve() { return null; }
    disconnect() { return null; }
};

// Mock ResizeObserver for components that use it
global.ResizeObserver = class ResizeObserver {
    constructor() { }
    observe() { return null; }
    unobserve() { return null; }
    disconnect() { return null; }
};
</file>

<file path="jsconfig.json">
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}
</file>

<file path="style_guide.md">
Here is a comprehensive yet crisp **UI Design Guideline** tailored for your development team. This document standardizes the visual language of the "First Screenshot" (the ideal state) to ensure consistency across all future screens.

***

# 🎨 Swipe App – UI Design System & Guidelines
**Version 1.0** | **Goal:** Clean, Modern, High-Contrast Consistency

---

## 1. Color Palette
**Rule:** Avoid pastel/washed-out colors. Use high-contrast neutrals for structure and the specific Blue Accent for actions/highlights.

### **Primary Colors (Neutrals)**
*   **`#FFFFFF` (Surface White):** Main cards, bottom navigation, input fields.
*   **`#F5F7FA` (Background Grey):** The global background behind the white cards. *Crucial for depth.*
*   **`#111827` (Ink Black):** Primary Headings (e.g., "Create"), Icon Strokes.
*   **`#6B7280` (Slate Grey):** Secondary text, sub-labels (e.g., "Invoice," "Purchase").

### **Accent Colors (Brand)**
*   **`#0F6CBD` (Brand Blue):** Primary buttons, links, active tab icons.
*   **`#E0F2FE` (Soft Blue Wash):** Backgrounds for informational banners (e.g., the "Add Logo" banner).

---

## 2. Typography
**Font Family:** Use a modern Geometric Sans-Serif (e.g., **Inter**, **Roboto**, or System Default).
**Rule:** Text must never be lighter than Medium (500) weight for labels. Avoid "Regular (400)" weight for small text to prevent a "washed out" look.

| Element | Weight | Size (px/sp) | Color | Usage |
| :--- | :--- | :--- | :--- | :--- |
| **Section Header** | **Bold (700)** | 18px | Ink Black | "Create", "Quick Access" |
| **Icon Label** | **Medium (500)** | 12px | Slate Grey | "Invoice", "Purchase Order" |
| **Banner Title** | **SemiBold (600)** | 14px | Brand Blue | "Add company logo..." |
| **Banner Body** | **Regular (400)** | 12px | Brand Blue | "Get Swipe PRO & grow..." |

---

## 3. Iconography (Strict Rules)
**Rule:** Icons must be uniform. Do not mix filled and outlined styles. Do not use multiple colors for icons.

*   **Style:** **Linear / Outline** (Stroke-based).
*   **Stroke Width:** **1.5px** constant width.
*   **Color:** **`#111827` (Ink Black)**.
*   **Container:** Every icon must reside inside a **Squircle** (rounded square) container.
    *   *Container Border:* 1px solid `#E5E7EB` (Light Grey).
    *   *Container Radius:* `12px`.
    *   *Container Size:* `48x48px` (approx).
    *   *Container Background:* Transparent or `#FFFFFF`.

---

## 4. Layout & Spacing (The "Card" Look)
**Rule:** The app is not a flat white sheet. It is a collection of **White Cards** floating on a **Grey Background**.

### **Grid System**
*   **Columns:** 4-column grid for icons.
*   **Alignment:** Center-aligned text relative to the icon container.

### **Spacing (Padding & Margins)**
*   **Global Page Background:** `#F5F7FA`.
*   **Card Padding:** `16px` internal padding.
*   **Card Radius:** `16px` (Rounded corners for the white sections).
*   **Section Gap:** `24px` vertical space between "Create" and "Quick Access" sections.
*   **Element Gap:** `8px` vertical space between an Icon and its Label.

---

## 5. UI Components

### **A. The Feature Card (White Area)**
*   **Usage:** Wrapper for all icon grids.
*   **CSS/Style:**
    ```css
    background-color: #FFFFFF;
    border-radius: 16px;
    margin-bottom: 16px;
    /* Optional: Very subtle shadow for lift */
    box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.05);
    ```

### **B. The Action Banner (Blue Box)**
*   **Usage:** Upsells, Tips, or "Add Logo" prompts.
*   **Style:**
    *   **Background:** `#E0F2FE` (Light Blue).
    *   **Icon:** Brand Blue color, left-aligned.
    *   **Text:** Brand Blue color (`#0F6CBD`).
    *   **Border Radius:** `8px` or `12px`.

### **C. Bottom Navigation**
*   **Background:** White (`#FFFFFF`).
*   **Border Top:** 1px solid `#F3F4F6`.
*   **Active State:** Icon turns Filled + Brand Blue. Text turns Brand Blue.
*   **Inactive State:** Icon is Outline + Grey. Text is Grey.

---

## 6. Developer Checklist (Do's & Don'ts)

*   ✅ **DO** ensure the background behind the icons is pure white, but the screen background is light grey.
*   ✅ **DO** use `text-transform: capitalize` for labels.
*   ❌ **DON'T** use shadows on the text.
*   ❌ **DON'T** use the "Trusted by" footer inside the main dashboard; it creates clutter.
*   ❌ **DON'T** color the icons; keep them black/dark grey. Color is reserved for interactive buttons only.
</file>

<file path=".github/workflows/build-apk.yml">
name: Build Android APK

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout source
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install Dependencies
        run: npm install

      - name: Build Next.js App
        run: npm run build

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '21'

      - name: Setup Android SDK
        uses: android-actions/setup-android@v3

      - name: Sync Capacitor
        run: npx cap sync

      - name: Build APK
        run: |
          cd android
          chmod +x gradlew
          ./gradlew assembleDebug

      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: app-debug
          path: android/app/build/outputs/apk/debug/app-debug.apk
</file>

<file path="android/app/src/main/res/xml/file_paths.xml">
<?xml version="1.0" encoding="utf-8"?>
<paths xmlns:android="http://schemas.android.com/apk/res/android">
    <external-path name="my_images" path="." />
    <cache-path name="my_cache_images" path="." />
    <files-path name="my_documents" path="." />
</paths>
</file>

<file path="src/app/invoice/create/select-customer/page.js">
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import Link from 'next/link';
import { usePartyStore } from '@/lib/store/partyStore';
import { useInvoiceStore } from '@/lib/store/invoiceStore';
import { FiArrowLeft, FiSearch, FiPlus, FiX } from 'react-icons/fi';
import { formatCurrency } from '@/lib/utils/tax';

export default function SelectCustomerPage() {
    const router = useRouter();
    const { customers, loadParties } = usePartyStore();
    const { setCustomer } = useInvoiceStore();
    const [searchQuery, setSearchQuery] = useState('');

    useEffect(() => {
        loadParties();
    }, [loadParties]);

    const filteredCustomers = customers.filter(c =>
        c.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
        (c.phone && c.phone.includes(searchQuery))
    );

    const handleSelect = (customer) => {
        setCustomer(customer);
        router.back();
    };

    return (
        <div style={{ background: '#f3f4f6', minHeight: '100vh', display: 'flex', flexDirection: 'column' }}>
            {/* Header */}
            <div style={{
                background: 'white',
                padding: '16px',
                display: 'flex',
                alignItems: 'center',
                gap: '12px',
                borderBottom: '1px solid #e5e7eb'
            }}>
                <button onClick={() => router.back()} style={{ border: 'none', background: 'none', cursor: 'pointer' }}>
                    <FiArrowLeft size={24} />
                </button>
                <div style={{ flex: 1, position: 'relative' }}>
                    <input
                        placeholder="Search Customer"
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                        style={{
                            width: '100%',
                            padding: '8px 0',
                            fontSize: '16px',
                            border: 'none',
                            outline: 'none'
                        }}
                        autoFocus
                    />
                </div>
                {searchQuery && (
                    <button onClick={() => setSearchQuery('')} style={{ border: 'none', background: 'none', cursor: 'pointer' }}>
                        <FiX size={20} color="#6b7280" />
                    </button>
                )}
            </div>

            {/* Add New Customer Button */}
            <Link href="/parties/customer/add?returnUrl=/invoice/create" style={{ textDecoration: 'none' }}>
                <div style={{
                    background: '#e0e7ff',
                    padding: '12px',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '8px',
                    color: '#3730a3',
                    fontWeight: 500,
                    cursor: 'pointer'
                }}>
                    <FiPlus size={18} /> Add new customer
                </div>
            </Link>

            {/* Customer List */}
            <div style={{ flex: 1, overflowY: 'auto', padding: '16px', display: 'flex', flexDirection: 'column', gap: '12px' }}>
                {filteredCustomers.map(customer => (
                    <div
                        key={customer.id}
                        onClick={() => handleSelect(customer)}
                        style={{
                            background: 'white',
                            padding: '16px',
                            borderRadius: '12px',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'space-between',
                            cursor: 'pointer',
                            boxShadow: '0 1px 2px rgba(0,0,0,0.05)'
                        }}
                    >
                        <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                            <div style={{
                                width: '40px',
                                height: '40px',
                                borderRadius: '50%',
                                background: '#fce7f3',
                                color: '#be185d',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                fontWeight: 600,
                                fontSize: '16px'
                            }}>
                                {customer.name.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div style={{ fontWeight: 500, color: '#111827' }}>{customer.name}</div>
                                {customer.phone && (
                                    <div style={{ fontSize: '13px', color: '#6b7280' }}>{customer.phone}</div>
                                )}
                            </div>
                        </div>
                        <div style={{ textAlign: 'right' }}>
                            {customer.balance ? (
                                <div style={{
                                    color: customer.balance > 0 ? '#ef4444' : '#10b981',
                                    fontWeight: 500
                                }}>
                                    {customer.balance > 0 ? '↓' : ''} {formatCurrency(Math.abs(customer.balance))}
                                </div>
                            ) : (
                                <div style={{ fontSize: '13px', color: '#6b7280', fontWeight: 500 }}>No dues</div>
                            )}
                        </div>
                    </div>
                ))}

                {/* Export/SEZ Banner (Static for now as per screenshot design) */}

            </div>
        </div>
    );
}
</file>

<file path="src/app/invoice/create/select-product/page.js">
'use client';

import { useEffect } from 'react';
import { useRouter } from 'next/navigation';

// Redirect to products page with select mode
export default function SelectProductPage() {
    const router = useRouter();

    useEffect(() => {
        // Redirect to the unified products page with select mode enabled
        router.replace('/products?mode=select&returnUrl=/invoice/create');
    }, [router]);

    return (
        <div style={{ padding: 40, textAlign: 'center', color: '#6b7280' }}>
            Loading products...
        </div>
    );
}
</file>

<file path="src/app/invoice/create/page.js">
'use client';

import InvoiceForm from '@/components/InvoiceForm';
import { FiArrowLeft } from 'react-icons/fi';
import Link from 'next/link';
import { useSearchParams } from 'next/navigation';
import { useEffect } from 'react';
import { useInvoiceStore } from '@/lib/store/invoiceStore';

export default function CreateInvoicePage() {
    const searchParams = useSearchParams();
    const type = searchParams.get('type');
    const { setInvoiceType } = useInvoiceStore();

    // Set the invoice type based on query param when component mounts
    // We assume resetInvoice has already been called or we call it here to be safe?
    // Usually a layout or a parent "create" wrapper would handle reset.
    // For now we just ensure type is set.

    // We need to allow effect to run.
    useEffect(() => {
        if (type === 'proforma') {
            setInvoiceType('PROFORMA');
        } else if (type === 'lending') {
            setInvoiceType('LENDING');
        } else {
            setInvoiceType('INVOICE');
        }
    }, [type, setInvoiceType]);

    return (
        <div>
            <div style={{
                padding: '16px',
                background: 'white',
                display: 'flex',
                alignItems: 'center',
                gap: '16px',
                borderBottom: '1px solid #eee'
            }}>
                <Link href="/">
                    <FiArrowLeft size={24} />
                </Link>
                <h1 style={{ fontSize: '18px', fontWeight: 600 }}>
                    {type === 'proforma' ? 'Create Pro Forma Invoice' : type === 'LENDING' ? 'Create Lending Bill' : 'Create Invoice'}
                </h1>
                {(type === 'proforma' || type === 'LENDING') && (
                    <span style={{ fontSize: '12px', background: type === 'LENDING' ? '#f3f4f6' : '#e0e7ff', color: type === 'LENDING' ? '#374151' : '#4338ca', padding: '2px 8px', borderRadius: '4px', fontWeight: 600 }}>
                        {type === 'LENDING' ? 'Lending Bill' : 'Pro Forma'}
                    </span>
                )}
            </div>
            <InvoiceForm />
        </div>
    );
}
</file>

<file path="src/app/more/company/page.module.css">
.container {
    min-height: 100vh;
    background-color: #f3f4f6;
    display: flex;
    flex-direction: column;
}

.header {
    background: white;
    padding: 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid #e5e7eb;
    position: sticky;
    top: 0;
    z-index: 10;
}

.headerTitle {
    font-weight: 700;
    font-size: 18px;
    color: #111827;
}

.editButton {
    background: #fef3c7;
    color: #d97706;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 4px;
}

.content {
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    padding-bottom: 100px; /* Space for footer if needed */
}

.card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    position: relative;
    margin-top: 40px; /* Space for floating logo */
}

.logoContainer {
    position: absolute;
    top: -50px;
    left: 50%;
    transform: translateX(-50%);
}

.formGroup {
    margin-bottom: 16px;
}

.label {
    font-size: 12px;
    color: #6b7280;
    margin-bottom: 4px;
    display: block;
}

.value {
    font-size: 16px;
    font-weight: 600;
    color: #111827;
}

.input {
    width: 100%;
    padding: 10px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    font-size: 16px;
    outline: none;
}

.input:focus {
    border-color: #3b82f6;
}

.addressButton {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    font-weight: 600;
    color: #111827;
}

.iconCircle {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: #6b7280;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
}

.accordionHeader {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 0;
    cursor: pointer;
    font-weight: 600;
    color: #111827;
}

.accordionContent {
    padding-top: 8px;
    display: flex;
    flex-direction: column;
    gap: 16px;
}
</file>

<file path="src/app/more/masters/products/page.module.css">
.container {
    display: flex;
    flex-direction: column;
    height: 100vh;
    background-color: #f8f9fa;
}

.header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px;
    background-color: #fff;
    border-bottom: 1px solid #eee;
}

.headerLeft {
    display: flex;
    align-items: center;
    gap: 12px;
}

.backButton {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #333;
}

.title {
    font-size: 18px;
    font-weight: 600;
    color: #000;
}

.tabContainer {
    display: flex;
    background-color: #fff;
    border-bottom: 1px solid #eee;
}

.tab {
    flex: 1;
    padding: 16px;
    text-align: center;
    cursor: pointer;
    font-weight: 500;
    color: #666;
    border-bottom: 2px solid transparent;
}

.tab.active {
    color: #2962ff;
    border-bottom-color: #2962ff;
}

.content {
    flex: 1;
    overflow-y: auto;
    padding: 16px 16px 120px 16px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.searchBar {
    display: flex;
    align-items: center;
    background-color: #fff;
    padding: 12px 16px;
    border-radius: 8px;
    border: 1px solid #eee;
}

.searchInput {
    border: none;
    background: none;
    outline: none;
    flex: 1;
    margin-left: 8px;
    font-size: 16px;
}

.itemCard {
    background-color: #fff;
    padding: 16px;
    border-radius: 8px;
    border: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.itemInfo {
    display: flex;
    flex-direction: column;
}

.itemName {
    font-size: 16px;
    color: #333;
    font-weight: 500;
}

.itemSub {
    font-size: 12px;
    color: #666;
    margin-top: 4px;
}

.fab {
    position: fixed;
    bottom: 100px;
    right: 24px;
    background-color: #2962ff;
    color: #fff;
    padding: 16px 24px;
    border-radius: 32px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(41, 98, 255, 0.3);
    cursor: pointer;
    z-index: 100;
}

/* Modal Styles */
.modalOverlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: flex-end;
    /* Bottom sheet style */
    z-index: 1000;
}

.modalContent {
    background-color: #fff;
    width: 100%;
    border-top-left-radius: 16px;
    border-top-right-radius: 16px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from {
        transform: translateY(100%);
    }

    to {
        transform: translateY(0);
    }
}

.modalHeader {
    padding: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #eee;
}

.modalTitle {
    font-size: 18px;
    font-weight: 600;
}

.closeButton {
    background: none;
    border: none;
    font-size: 24px;
    color: #666;
    cursor: pointer;
}

.modalBody {
    padding: 16px;
    overflow-y: auto;
    flex: 1;
}

.formGroup {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 16px;
}

.label {
    font-size: 14px;
    color: #666;
    font-weight: 500;
}

.input {
    padding: 12px 16px;
    border: 1px solid #eee;
    border-radius: 8px;
    font-size: 16px;
    background-color: #f9f9f9;
    outline: none;
}

.input:focus {
    background-color: #fff;
    border-color: #2962ff;
}

.select {
    padding: 12px 16px;
    border: 1px solid #eee;
    border-radius: 8px;
    font-size: 16px;
    background-color: #f9f9f9;
    outline: none;
    appearance: none;
    /* simple styling */
}

.modalFooter {
    padding: 16px;
    border-top: 1px solid #eee;
}

.modalActions {
    display: flex;
    gap: 16px;
}

.deleteButton {
    flex: 1;
    padding: 14px;
    background-color: #ffebee;
    color: #d32f2f;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
}

.saveButton {
    flex: 1;
    padding: 14px;
    background-color: #2962ff;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
}
</file>

<file path="src/app/more/profile/page.js">
'use client';

import { useEffect } from 'react';
import Link from 'next/link';
import { useSettingsStore } from '@/lib/store/settingsStore';
import { useAuthStore } from '@/lib/store/authStore';
import { FiArrowLeft, FiUser, FiMail, FiPhone, FiTrash2, FiLogOut, FiChevronRight } from 'react-icons/fi';
import styles from './page.module.css';

export default function UserProfilePage() {
    const { userProfile, loadSettings, resetData } = useSettingsStore();
    const { logout } = useAuthStore();

    useEffect(() => {
        loadSettings();
    }, []);

    const handleReset = async () => {
        if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
            await resetData();
        }
    };

    return (
        <div className={styles.container}>
            <div className={styles.header}>
                <Link href="/more"><FiArrowLeft size={24} /></Link>
                User Profile
            </div>

            <div className={styles.sectionLabel}>User Details</div>
            <div className={styles.card}>
                <div className={styles.item}>
                    <FiUser className={styles.icon} />
                    <div className={styles.content}>
                        <div className={styles.label}>User Name</div>
                        <div className={styles.subLabel}>{userProfile.name || 'Add User Name'}</div>
                    </div>
                    <FiChevronRight className={styles.arrow} />
                </div>
                <div className={styles.item}>
                    <FiMail className={styles.icon} />
                    <div className={styles.content}>
                        <div className={styles.label}>Email Address</div>
                        <div className={styles.subLabel}>{userProfile.email || 'Add Email Address'}</div>
                    </div>
                    <FiChevronRight className={styles.arrow} />
                </div>
                <div className={styles.item}>
                    <FiPhone className={styles.icon} />
                    <div className={styles.content}>
                        <div className={styles.label}>Phone Number</div>
                        <div className={styles.subLabel}>{userProfile.phone || '8454881721'}</div>
                    </div>
                    <FiChevronRight className={styles.arrow} />
                </div>
            </div>

            <div className={styles.sectionLabel}>Privacy Settings</div>
            <div className={styles.card}>
                <div className={styles.item} onClick={handleReset}>
                    <FiTrash2 className={styles.icon} />
                    <div className={styles.content}>
                        <div className={styles.label}>Reset Data</div>
                    </div>
                    <FiChevronRight className={styles.arrow} />
                </div>
                <div className={styles.dangerItem}>
                    <FiUser className={styles.dangerIcon} />
                    <div className={styles.dangerLabel}>Delete Account</div>
                    <FiChevronRight className={styles.arrow} />
                </div>
                <div className={styles.item} onClick={() => {
                    if (confirm('Are you sure you want to logout?')) {
                        logout();
                    }
                }}>
                    <FiLogOut className={styles.icon} />
                    <div className={styles.content}>
                        <div className={styles.label}>Logout</div>
                    </div>
                    <FiChevronRight className={styles.arrow} />
                </div>
                <div className={styles.item} onClick={() => alert('This feature is coming soon')}>
                    <FiLogOut className={styles.icon} />
                    <div className={styles.content}>
                        <div className={styles.label}>Logout from all devices</div>
                    </div>
                    <FiChevronRight className={styles.arrow} />
                </div>
            </div>

            <div className={styles.footer}>
                <button className={styles.supportButton}>
                    Support Code <span style={{ color: 'var(--primary)' }}>***</span>
                </button>
            </div>
        </div>
    );
}
</file>

<file path="src/app/more/page.module.css">
.container {
    padding: 16px;
    padding-bottom: 80px;
    background: var(--background);
    min-height: 100vh;
}

.profileCard {
    background: var(--card-bg);
    padding: 20px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 24px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

.avatar {
    width: 56px;
    height: 56px;
    border-radius: 18px;
    /* Squircle */
    background: var(--primary-light);
    color: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    font-weight: 700;
    border: 1px solid #DBEAFE;
}

.profileInfo {
    flex: 1;
}

.profileName {
    font-size: 18px;
    font-weight: 700;
    color: var(--foreground);
    margin-bottom: 4px;
}

.profileSub {
    font-size: 13px;
    color: var(--text-secondary);
    font-weight: 500;
}

.sectionTitle {
    font-size: 14px;
    font-weight: 700;
    color: var(--foreground);
    margin-bottom: 12px;
    margin-left: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.menuGroup {
    background: var(--card-bg);
    border-radius: 16px;
    overflow: hidden;
    margin-bottom: 24px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

.menuItem {
    display: flex;
    align-items: center;
    padding: 16px 20px;
    gap: 16px;
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    transition: background 0.2s;
}

.menuItem:last-child {
    border-bottom: none;
}

.menuItem:active {
    background: #F9FAFB;
}

.menuIcon {
    color: var(--foreground);
    font-size: 20px;
    display: flex;
    align-items: center;
}

.menuLabel {
    flex: 1;
    font-size: 14px;
    color: var(--foreground);
    font-weight: 500;
}

.menuArrow {
    color: #9CA3AF;
}
</file>

<file path="src/app/parties/customer/edit/page.module.css">
.container {
    background: #f3f4f6;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

.header {
    background: white;
    padding: 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid #eee;
}

.headerTitle {
    font-size: 18px;
    font-weight: 700;
    color: #111827;
    margin-left: 12px;
}

.headerActions {
    display: flex;
    align-items: center;
    gap: 16px;
}

.importAction {
    color: #2563eb;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 4px;
    cursor: pointer;
}

.content {
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    flex: 1;
}

.banner {
    background: #e0e7ff;
    padding: 16px;
    border-radius: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.bannerTitle {
    font-weight: 700;
    color: #111827;
    font-size: 14px;
    margin-bottom: 4px;
}

.bannerText {
    font-size: 12px;
    color: #4b5563;
}

.section {
    background: white;
    padding: 16px;
    border-radius: 12px;
}

.sectionHeader {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.sectionTitle {
    font-weight: 700;
    font-size: 14px;
    color: #111827;
}

.inputGroup {
    margin-bottom: 16px;
    position: relative;
}

.input {
    width: 100%;
    padding: 16px 12px 4px;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
    font-size: 16px;
    outline: none;
    transition: border-color 0.2s;
}

.input:focus {
    border-color: #2563eb;
}

.label {
    position: absolute;
    left: 12px;
    top: 12px;
    font-size: 14px;
    color: #6b7280;
    pointer-events: none;
    transition: all 0.2s;
}

.input:focus+.label,
.input:not(:placeholder-shown)+.label {
    top: 4px;
    font-size: 10px;
    color: #2563eb;
}

.phoneInputContainer {
    display: flex;
    align-items: center;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 8px 12px;
    background: white;
}

.flag {
    width: 24px;
    height: 16px;
    margin-right: 8px;
    border-radius: 2px;
    object-fit: cover;
}

.phonePrefix {
    font-weight: 500;
    margin-right: 8px;
    color: #111827;
    display: flex;
    align-items: center;
    gap: 4px;
}

.phoneInput {
    border: none;
    outline: none;
    font-size: 16px;
    width: 100%;
}

.gstContainer {
    display: flex;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    overflow: hidden;
}

.gstInput {
    flex: 1;
    padding: 12px;
    border: none;
    outline: none;
    font-size: 16px;
}

.fetchButton {
    background: #2563eb;
    color: white;
    border: none;
    padding: 0 16px;
    font-weight: 600;
    font-size: 12px;
    cursor: pointer;
}

.helperText {
    font-size: 12px;
    color: #9ca3af;
    margin-top: 4px;
}

.addressButton {
    width: 100%;
    padding: 16px;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
    background: #f9fafb;
    text-align: left;
    color: #6b7280;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
}

.checkboxContainer {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    color: #6b7280;
    cursor: pointer;
}

.updateButton {
    width: 100%;
    background: #2563eb;
    color: white;
    padding: 16px;
    border-radius: 12px;
    border: none;
    font-size: 16px;
    font-weight: 700;
    margin-top: auto;
    cursor: pointer;
}
</file>

<file path="src/app/parties/payment/create/page.js">
'use client';

import { useState, useEffect, Suspense } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { usePartyStore } from '@/lib/store/partyStore';
import { FiArrowLeft, FiPlayCircle, FiCalendar, FiPlus, FiCamera, FiUpload } from 'react-icons/fi';
import AnimatedButton from '@/components/AnimatedButton';
import styles from './page.module.css';

function RecordPaymentContent() {
    const router = useRouter();
    const searchParams = useSearchParams();
    const customerId = searchParams.get('customerId');
    const vendorId = searchParams.get('vendorId');
    const partyType = searchParams.get('partyType') || 'customer'; // 'customer' or 'vendor'
    const mode = searchParams.get('mode') || 'in'; // 'in' (You Got) or 'out' (You Gave)
    const { getCustomer, addPayment, getVendor, addVendorPayment } = usePartyStore();

    const isVendor = partyType === 'vendor';
    const partyId = isVendor ? vendorId : customerId;

    const [party, setParty] = useState(null);
    const [amount, setAmount] = useState('');
    const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
    const [paymentType, setPaymentType] = useState('Cash');
    const [notes, setNotes] = useState('');
    const [internalNotes, setInternalNotes] = useState('');
    const [sendSms, setSendSms] = useState(false);
    const [sendEmail, setSendEmail] = useState(false);

    useEffect(() => {
        if (partyId) {
            const p = isVendor ? getVendor(partyId) : getCustomer(partyId);
            if (p) setParty(p);
        }
    }, [partyId, isVendor]);

    const handleRecord = async () => {
        if (!amount) {
            alert('Please enter an amount');
            return;
        }

        if (isVendor) {
            const paymentData = {
                vendorId: parseInt(vendorId),
                amount: parseFloat(amount),
                date,
                type: paymentType,
                notes,
                internalNotes,
                sendSms,
                sendEmail,
                timestamp: Date.now(),
                mode: mode
            };
            await addVendorPayment(paymentData);
        } else {
            const paymentData = {
                customerId: parseInt(customerId),
                amount: parseFloat(amount),
                date,
                type: paymentType,
                notes,
                internalNotes,
                sendSms,
                sendEmail,
                timestamp: Date.now(),
                mode: mode
            };
            await addPayment(paymentData);
        }
        router.back();
    };

    const paymentTypes = ['UPI', 'Cash', 'Card', 'Net Banking', 'Cheque', 'EMI', 'TDS'];

    if (!party) return <div>Loading...</div>;

    const isIn = mode === 'in';
    const themeColor = isIn ? '#16a34a' : '#2563eb'; // Green : Blue
    const themeBg = isIn ? '#dcfce7' : '#dbeafe'; // Light Green : Light Blue
    const themeText = isIn ? '#166534' : '#1e40af'; // Dark Green : Dark Blue

    return (
        <div className={styles.container}>
            {/* Header */}
            <div className={styles.header}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                    <FiArrowLeft size={24} onClick={() => router.back()} style={{ cursor: 'pointer' }} />
                    <div>
                        <div className={styles.headerTitle}>Record Payment</div>
                        <div className={styles.headerSubtitle}>{isVendor ? 'Vendor' : 'Customer'}: {party.name}</div>
                    </div>
                </div>
                <FiPlayCircle size={24} color="#ef4444" />
            </div>

            <div className={styles.content}>
                <div className={styles.sectionTitle}>Payment</div>
                <div className={styles.sectionTitleBold}>Details</div>

                {/* Amount Input */}
                <div className={styles.inputGroup}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                        <label className={styles.label}>
                            {isIn ? 'Amount to be Recorded (₹)' : 'Amount to be paid (₹)'}
                        </label>
                        <span className={styles.resetLink} onClick={() => setAmount('')}>Reset</span>
                    </div>
                    <div className={styles.amountInputContainer} style={{ borderColor: themeColor }}>
                        <span className={styles.currencySymbol}>₹</span>
                        <input
                            type="number"
                            className={styles.amountInput}
                            value={amount}
                            onChange={(e) => setAmount(e.target.value)}
                            placeholder={isIn ? "0" : "Enter Amount"}
                        />
                    </div>
                    {isIn && <div className={styles.pendingText}>Pending ₹{party.balance?.toFixed(2) || '0.00'}</div>}
                </div>

                {/* Date Picker */}
                <div className={styles.inputGroup}>
                    <label className={styles.label}>Payment date</label>
                    <div className={styles.dateInputContainer}>
                        <input
                            type="date"
                            className={styles.dateInput}
                            value={date}
                            onChange={(e) => setDate(e.target.value)}
                        />
                        <FiCalendar className={styles.calendarIcon} />
                    </div>
                </div>

                {/* Payment Type */}
                <div className={styles.inputGroup}>
                    <label className={styles.label}>Payment type</label>
                    <div className={styles.chipContainer}>
                        {paymentTypes.map(type => (
                            <div
                                key={type}
                                className={styles.chip}
                                style={paymentType === type ? { background: themeBg, color: themeText } : {}}
                                onClick={() => setPaymentType(type)}
                            >
                                {paymentType === type && <span className={styles.checkIcon}>✓</span>}
                                {type}
                            </div>
                        ))}
                    </div>
                </div>

                {/* Bank */}
                <div className={styles.inputGroup}>
                    <label className={styles.label}>Bank</label>
                    {/* Mock Bank Selection for 'You Gave' as per screenshot */}
                    {!isIn && (
                        <button className={styles.bankButton} style={{ background: '#2563eb', color: 'white', border: 'none', marginRight: '8px' }}>
                            <span style={{ fontSize: '10px', display: 'block' }}>✓</span>
                            IDFC FIRST Bank
                            <span style={{ fontSize: '10px', display: 'block', opacity: 0.8 }}>xx6789</span>
                        </button>
                    )}
                    <button className={styles.addNewButton}>
                        <FiPlus /> Add New
                    </button>
                </div>

                {/* Notes */}
                <div className={styles.inputGroup}>
                    <label className={styles.label}>Notes</label>
                    <textarea
                        className={styles.textarea}
                        placeholder="Enter your notes..."
                        value={notes}
                        onChange={(e) => setNotes(e.target.value)}
                    />
                </div>

                <div className={styles.divider} />

                <div className={styles.sectionTitleBold}>Other Details</div>

                {/* Internal Notes */}
                <div className={styles.inputGroup}>
                    <label className={styles.label}>Internal notes</label>
                    <textarea
                        className={styles.textarea}
                        placeholder="Enter your notes..."
                        value={internalNotes}
                        onChange={(e) => setInternalNotes(e.target.value)}
                    />
                </div>

                {/* Attachments */}
                <div className={styles.inputGroup}>
                    <label className={styles.label}>Attachments (Max: 3)</label>
                    <div className={styles.attachmentButtons}>
                        <button className={styles.attachmentButton}>
                            <FiCamera size={18} /> Camera
                        </button>
                        <button className={styles.attachmentButton}>
                            <FiUpload size={18} /> Upload File
                        </button>
                    </div>
                </div>

                {/* Toggles */}
                {/* Note: Screenshot for 'You Gave' doesn't explicitly show toggles but 'You Got' did. Keeping them for consistency or hiding if needed. 
                    The 'You Gave' screenshot ends at attachments. Let's keep them but maybe they are below fold.
                    Actually, let's keep them as they are useful features.
                */}
                <div className={styles.toggleGroup}>
                    <div>
                        <div className={styles.toggleLabel}>SMS to {isVendor ? 'Vendor' : 'Customer'}</div>
                        <div className={styles.toggleSubLabel}>We'll send a confirmation to their mobile no.</div>
                    </div>
                    <label className={styles.switch}>
                        <input type="checkbox" checked={sendSms} onChange={(e) => setSendSms(e.target.checked)} />
                        <span className={styles.slider} style={sendSms ? { backgroundColor: themeColor } : {}}></span>
                    </label>
                </div>

                {/* Footer */}
                <div className={styles.footer}>
                    {isIn ? (
                        <div className={styles.footerAmount}>
                            <div className={styles.footerLabel}>Pay In Amount</div>
                            <div className={styles.footerValue}>₹{amount || '0'}</div>
                        </div>
                    ) : (
                        <div className={styles.cancelButton} onClick={() => router.back()}>
                            Cancel
                        </div>
                    )}

                    <AnimatedButton
                        className={styles.recordButton}
                        style={{ background: themeColor, flex: isIn ? 'initial' : 1 }} // Expand button in 'You Gave' mode
                        onClick={handleRecord}
                    >
                        Record
                    </AnimatedButton>
                </div>
            </div>
        </div>
    );
}

export default function RecordPaymentPage() {
    return (
        <Suspense fallback={<div>Loading...</div>}>
            <RecordPaymentContent />
        </Suspense>
    );
}
</file>

<file path="src/app/parties/vendor/add/page.js">
'use client';

import { useState } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import Link from 'next/link';
import { usePartyStore } from '@/lib/store/partyStore';
import { FiArrowLeft, FiPlusCircle, FiUpload, FiX } from 'react-icons/fi';
import styles from '../../form.module.css';

export default function AddVendorPage() {
    const router = useRouter();
    const { addVendor } = usePartyStore();
    const [formData, setFormData] = useState({
        name: '',
        phone: '',
        email: '',
        address: '',
        gstin: '',
        companyName: '',
        documents: []
    });
    const [showBillingAddress, setShowBillingAddress] = useState(false);

    const handleFileChange = (e) => {
        const files = Array.from(e.target.files);

        files.forEach(file => {
            const reader = new FileReader();
            reader.onloadend = () => {
                setFormData(prev => ({
                    ...prev,
                    documents: [...prev.documents, {
                        name: file.name,
                        type: file.type,
                        data: reader.result
                    }]
                }));
            };
            reader.readAsDataURL(file);
        });
    };

    const removeDocument = (index) => {
        setFormData(prev => ({
            ...prev,
            documents: prev.documents.filter((_, i) => i !== index)
        }));
    };

    const searchParams = useSearchParams();
    const returnUrl = searchParams.get('returnUrl');

    const handleSave = async () => {
        if (!formData.name) return alert('Name is required');
        if (formData.phone && formData.phone.length !== 10) return alert('Phone number must be 10 digits');
        const id = await addVendor({ ...formData, balance: 0 });

        if (returnUrl) {
            router.push(returnUrl);
        } else {
            router.push('/parties');
        }
    };

    return (
        <div className={styles.container}>
            <div className={styles.header}>
                <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                    <Link href="/parties"><FiArrowLeft size={24} /></Link>
                    Add Vendor
                </div>
            </div>

            <div className={styles.sectionLabel}>Basic Details</div>
            <div className={styles.card}>
                <input
                    className={styles.input}
                    placeholder="Name *"
                    value={formData.name}
                    onChange={e => setFormData({ ...formData, name: e.target.value })}
                    style={{ marginBottom: 12 }}
                />
                <div className={styles.row} style={{ marginBottom: 12 }}>
                    <div style={{ padding: 12, background: '#f9fafb', border: '1px solid #e5e7eb', borderRadius: 8 }}>🇮🇳 +91</div>
                    <input
                        className={styles.input}
                        placeholder="Enter Phone Number"
                        value={formData.phone}
                        onChange={e => {
                            const value = e.target.value.replace(/\D/g, '').slice(0, 10);
                            setFormData({ ...formData, phone: value });
                        }}
                    />
                </div>
                <input
                    className={styles.input}
                    placeholder="Email"
                    value={formData.email}
                    onChange={e => setFormData({ ...formData, email: e.target.value })}
                />
            </div>

            <div className={styles.sectionLabel}>Company Details (Optional)</div>
            <div className={styles.card}>
                <input
                    className={styles.input}
                    placeholder="GST Number"
                    value={formData.gstin}
                    onChange={e => setFormData({ ...formData, gstin: e.target.value })}
                    style={{ marginBottom: 12 }}
                />
                <input
                    className={styles.input}
                    placeholder="Company Name"
                    value={formData.companyName}
                    onChange={e => setFormData({ ...formData, companyName: e.target.value })}
                />
            </div>

            <div className={styles.sectionLabel}>Billing Address (Optional)</div>
            <div className={styles.card}>
                {!showBillingAddress ? (
                    <div className={styles.actionRow} onClick={() => setShowBillingAddress(true)}>
                        <FiPlusCircle size={20} color="#6b7280" />
                        <span>Billing Address</span>
                    </div>
                ) : (
                    <textarea
                        className={styles.textarea}
                        placeholder="Enter Billing Address"
                        value={formData.address}
                        onChange={e => setFormData({ ...formData, address: e.target.value })}
                        autoFocus
                    />
                )}
            </div>

            <div className={styles.sectionLabel}>Documents (Optional)</div>
            <div className={styles.card}>
                <label className={styles.uploadBox}>
                    <input
                        type="file"
                        multiple
                        accept="image/*,application/pdf"
                        style={{ display: 'none' }}
                        onChange={handleFileChange}
                    />
                    <FiUpload className={styles.uploadIcon} />
                    <span className={styles.uploadText}>Upload Identity Documents (Image/PDF)</span>
                </label>

                {formData.documents.length > 0 && (
                    <div className={styles.fileList}>
                        {formData.documents.map((doc, index) => (
                            <div key={index} className={styles.fileItem}>
                                <span>{doc.name}</span>
                                <FiX
                                    style={{ cursor: 'pointer', color: '#ef4444' }}
                                    onClick={() => removeDocument(index)}
                                />
                            </div>
                        ))}
                    </div>
                )}
            </div>

            <div className={styles.footer}>
                <button className={styles.saveButton} onClick={handleSave}>Add Vendor</button>
            </div>
        </div>
    );
}
</file>

<file path="src/app/parties/vendor/view/page.js">
'use client';

import { db } from '@/lib/db';
import { useState, useEffect, Suspense } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { usePartyStore } from '@/lib/store/partyStore';
import { usePurchaseStore } from '@/lib/store/purchaseStore';
import { shareText, downloadCSV, downloadPDFBlob } from '@/lib/utils/invoiceActions';
import { FiArrowLeft, FiPhone, FiMail, FiShare2, FiMessageCircle, FiEdit2, FiMoreHorizontal, FiFileText, FiFile, FiPlusSquare, FiGitMerge, FiTrash2 } from 'react-icons/fi';
import { motion, AnimatePresence } from 'framer-motion';
import { TransactionCard } from '@/components/TransactionCard';
import jsPDF from 'jspdf';

function VendorLedgerContent() {
    const router = useRouter();
    const searchParams = useSearchParams();
    const id = searchParams.get('id');
    const { getVendor, deleteVendor } = usePartyStore();
    const { purchases, loadPurchases } = usePurchaseStore ? usePurchaseStore() : { purchases: [], loadPurchases: () => { } };

    const [vendor, setVendor] = useState(null);
    const [transactions, setTransactions] = useState([]);
    const [activeTab, setActiveTab] = useState('ledger');
    const [isMenuOpen, setIsMenuOpen] = useState(false);

    const handleWhatsApp = () => {
        if (vendor.phone) {
            const cleanNumber = vendor.phone.replace(/\D/g, '');
            window.open(`https://wa.me/${cleanNumber}`, '_blank');
        } else {
            alert('Phone number not available');
        }
    };

    const handleCall = () => {
        if (vendor.phone) {
            window.open(`tel:${vendor.phone}`, '_self');
        } else {
            alert('Phone number not available');
        }
    };

    const handleEmail = () => {
        if (vendor.email) {
            window.open(`mailto:${vendor.email}`, '_self');
        } else {
            alert('Email not available');
        }
    };

    const handleShare = async () => {
        await shareText({
            title: 'Vendor Details',
            text: `Vendor: ${vendor.name}\nPhone: ${vendor.phone || 'N/A'}\nBalance: ₹${vendor.balance?.toFixed(2) || '0.00'}`,
            dialogTitle: 'Share Vendor Details'
        });
    };

    const handleDownloadExcel = async () => {
        const data = transactions.map(tx => ({
            Date: new Date(tx.date).toLocaleDateString(),
            Type: tx.type,
            Number: tx.number,
            Amount: tx.amount,
            Status: tx.status
        }));

        if (!data || !data.length) {
            alert('No transactions to export');
            return;
        }

        const headers = Object.keys(data[0]);
        const csvContent = [
            headers.join(','),
            ...data.map(row => headers.map(fieldName => {
                const value = row[fieldName];
                return typeof value === 'string' && value.includes(',') ? `"${value}"` : value;
            }).join(','))
        ].join('\n');

        await downloadCSV(csvContent, `${vendor.name}_ledger.csv`);
        setIsMenuOpen(false);
    };

    const handleDownloadPDF = async () => {
        const doc = new jsPDF();

        doc.setFontSize(20);
        doc.text(vendor.name, 14, 22);
        doc.setFontSize(12);
        doc.text(`Phone: ${vendor.phone || 'N/A'}`, 14, 30);
        doc.text(`Balance: ${vendor.balance?.toFixed(2)}`, 14, 38);

        let y = 50;
        doc.setFontSize(10);
        doc.setTextColor(100);
        doc.text('Date', 14, y);
        doc.text('Type', 60, y);
        doc.text('Number', 100, y);
        doc.text('Amount', 150, y);
        doc.text('Balance', 180, y);
        doc.line(14, y + 2, 200, y + 2);
        y += 10;
        doc.setTextColor(0);

        transactions.forEach(tx => {
            if (y > 280) { doc.addPage(); y = 20; }
            doc.text(new Date(tx.date).toLocaleDateString(), 14, y);
            doc.text(tx.type === 'payment_out' ? 'Payment Out' : tx.type === 'payment_in' ? 'Payment In' : 'Purchase', 60, y);
            doc.text(tx.number, 100, y);
            doc.text(tx.amount.toFixed(2), 150, y);
            doc.text(tx.balance !== undefined ? tx.balance.toFixed(2) : '-', 180, y);
            y += 8;
        });

        const pdfBlob = doc.output('blob');
        await downloadPDFBlob(pdfBlob, `${vendor.name}_ledger.pdf`);
        setIsMenuOpen(false);
    };

    const handleDeleteVendor = async () => {
        if (confirm('Are you sure you want to delete this vendor? This action cannot be undone.')) {
            await deleteVendor(vendor.id);
            router.push('/parties');
        }
    };

    const menuItemStyle = {
        display: 'flex', alignItems: 'center', gap: '12px', padding: '12px',
        fontSize: '16px', fontWeight: 500, color: '#374151', cursor: 'pointer',
        borderRadius: '8px', transition: 'background 0.2s'
    };

    useEffect(() => {
        if (id) {
            const v = getVendor(id);
            if (v) setVendor(v);
            if (loadPurchases) loadPurchases();
        }
    }, [id]);

    useEffect(() => {
        const loadData = async () => {
            if (vendor) {
                // Get Purchases from 'purchases' table (vendor invoices)
                const allPurchaseRecords = purchases?.filter(p =>
                    p.vendorId === vendor.id || p.vendor?.id === vendor.id
                ) || [];

                // Get Payments from 'payments' table for this vendor
                const vendorPayments = await db.payments.where('partyId').equals(vendor.id).and(p => p.partyType === 'VENDOR').toArray();

                const purchaseTxs = allPurchaseRecords.map(p => ({
                    id: `pur-${p.id}`,
                    date: p.date,
                    type: 'purchase',
                    number: p.purchaseNumber,
                    amount: p.totals?.total || 0,
                    status: p.status || 'Unpaid',
                    balance: p.balanceDue !== undefined ? p.balanceDue : (p.totals?.total || 0),
                    data: p
                }));

                const paymentTxs = vendorPayments.map(pay => ({
                    id: `pay-${pay.id}`,
                    date: pay.date,
                    type: pay.type === 'OUT' ? 'payment_out' : 'payment_in',
                    number: pay.transactionNumber,
                    amount: pay.amount,
                    status: 'Paid',
                    balance: 0,
                    data: pay
                }));

                const allTxs = [...purchaseTxs, ...paymentTxs];
                allTxs.sort((a, b) => new Date(b.date) - new Date(a.date));
                setTransactions(allTxs);
            }
        };
        loadData();
    }, [vendor, purchases]);

    if (!vendor) return <div>Loading...</div>;

    return (
        <div style={{ background: '#f3f4f6', minHeight: '100vh', display: 'flex', flexDirection: 'column' }}>
            {/* Header */}
            <div style={{ background: 'white', padding: '16px', borderBottom: '1px solid #eee' }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '16px' }}>
                    <FiArrowLeft size={24} onClick={() => router.back()} style={{ cursor: 'pointer' }} />
                    <div style={{ display: 'flex', gap: '16px', position: 'relative' }}>
                        <FiMoreHorizontal size={24} onClick={() => setIsMenuOpen(true)} style={{ cursor: 'pointer' }} />
                    </div>
                </div>

                {/* Menu Bottom Sheet */}
                <AnimatePresence>
                    {isMenuOpen && (
                        <>
                            <motion.div
                                initial={{ opacity: 0 }}
                                animate={{ opacity: 1 }}
                                exit={{ opacity: 0 }}
                                onClick={() => setIsMenuOpen(false)}
                                style={{
                                    position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.5)', zIndex: 40
                                }}
                            />
                            <motion.div
                                initial={{ y: '100%' }}
                                animate={{ y: 0 }}
                                exit={{ y: '100%' }}
                                transition={{ type: 'spring', damping: 25, stiffness: 300 }}
                                style={{
                                    position: 'fixed', bottom: 0, left: 0, right: 0,
                                    background: 'white', borderTopLeftRadius: '20px', borderTopRightRadius: '20px',
                                    padding: '20px', zIndex: 50, maxHeight: '80vh', overflowY: 'auto'
                                }}
                            >
                                <div style={{ width: '40px', height: '4px', background: '#e5e7eb', borderRadius: '2px', margin: '0 auto 20px' }} />

                                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                                    <div onClick={() => { setIsMenuOpen(false); router.push(`/parties/vendor/edit?id=${vendor.id}`); }} style={menuItemStyle}>
                                        <FiEdit2 size={20} /> Edit Vendor
                                    </div>
                                    <div style={{ height: '1px', background: '#f3f4f6', margin: '4px 0' }} />

                                    <div onClick={handleDownloadExcel} style={menuItemStyle}>
                                        <FiFileText size={20} /> Download Ledger Excel
                                    </div>
                                    <div onClick={handleDownloadPDF} style={menuItemStyle}>
                                        <FiFile size={20} /> Download Ledger Pdf
                                    </div>
                                    <div style={{ height: '1px', background: '#f3f4f6', margin: '4px 0' }} />

                                    <div onClick={() => { setIsMenuOpen(false); router.push(`/purchase/create?vendorId=${vendor.id}`); }} style={menuItemStyle}>
                                        <FiPlusSquare size={20} /> Create Purchase Order
                                    </div>
                                    <div style={{ height: '1px', background: '#f3f4f6', margin: '4px 0' }} />

                                    <div onClick={() => alert('Merge functionality coming soon')} style={menuItemStyle}>
                                        <FiGitMerge size={20} /> Merge
                                    </div>
                                    <div style={{ height: '1px', background: '#f3f4f6', margin: '4px 0' }} />

                                    <div onClick={handleDeleteVendor} style={{ ...menuItemStyle, color: '#dc2626' }}>
                                        <FiTrash2 size={20} /> Delete Vendor
                                    </div>
                                </div>
                            </motion.div>
                        </>
                    )}
                </AnimatePresence>

                <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', marginBottom: '24px' }}>
                    <div style={{
                        width: '64px', height: '64px', borderRadius: '50%', background: '#fef3c7',
                        color: '#92400e', display: 'flex', alignItems: 'center', justifyContent: 'center',
                        fontSize: '24px', fontWeight: 'bold', marginBottom: '12px'
                    }}>
                        {vendor.name[0]}
                    </div>
                    <div style={{ fontSize: '20px', fontWeight: 'bold', marginBottom: '4px' }}>{vendor.name}</div>
                    <div style={{ fontSize: '16px', color: vendor.balance > 0 ? '#dc2626' : '#16a34a', fontWeight: 600 }}>
                        ₹ {Math.abs(vendor.balance || 0).toFixed(2)}
                        <span style={{ fontSize: '12px', marginLeft: '4px' }}>
                            {(vendor.balance || 0) > 0 ? '(You owe)' : (vendor.balance || 0) < 0 ? '(They owe)' : ''}
                        </span>
                    </div>
                </div>

                <div style={{ display: 'flex', justifyContent: 'space-around', paddingBottom: '8px' }}>
                    <div onClick={handleWhatsApp} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px', cursor: 'pointer' }}>
                        <div style={{ padding: '10px', borderRadius: '50%', border: '1px solid #eee' }}><FiMessageCircle size={20} color="#2563eb" /></div>
                        <span style={{ fontSize: '12px', color: '#666' }}>WhatsApp</span>
                    </div>
                    <div onClick={handleCall} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px', cursor: 'pointer' }}>
                        <div style={{ padding: '10px', borderRadius: '50%', border: '1px solid #eee' }}><FiPhone size={20} color="#2563eb" /></div>
                        <span style={{ fontSize: '12px', color: '#666' }}>Call</span>
                    </div>
                    <div onClick={handleEmail} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px', cursor: 'pointer' }}>
                        <div style={{ padding: '10px', borderRadius: '50%', border: '1px solid #eee' }}><FiMail size={20} color="#2563eb" /></div>
                        <span style={{ fontSize: '12px', color: '#666' }}>Mail</span>
                    </div>
                    <div onClick={handleShare} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px', cursor: 'pointer' }}>
                        <div style={{ padding: '10px', borderRadius: '50%', border: '1px solid #eee' }}><FiShare2 size={20} color="#2563eb" /></div>
                        <span style={{ fontSize: '12px', color: '#666' }}>Share</span>
                    </div>
                </div>
            </div>

            {/* Tabs */}
            <div style={{ background: 'white', display: 'flex', borderBottom: '1px solid #eee' }}>
                <div
                    onClick={() => setActiveTab('ledger')}
                    style={{
                        flex: 1, textAlign: 'center', padding: '16px', fontWeight: 600, cursor: 'pointer',
                        color: activeTab === 'ledger' ? '#2563eb' : '#6b7280',
                        borderBottom: activeTab === 'ledger' ? '2px solid #2563eb' : 'none'
                    }}
                >
                    Ledger
                </div>
                <div
                    onClick={() => setActiveTab('transactions')}
                    style={{
                        flex: 1, textAlign: 'center', padding: '16px', fontWeight: 600, cursor: 'pointer',
                        color: activeTab === 'transactions' ? '#2563eb' : '#6b7280',
                        borderBottom: activeTab === 'transactions' ? '2px solid #2563eb' : 'none'
                    }}
                >
                    Transactions
                </div>
            </div>

            {/* List */}
            <div style={{ flex: 1, overflowY: 'auto', paddingBottom: '80px' }}>
                {transactions.length === 0 ? (
                    <div style={{ textAlign: 'center', padding: '40px', color: '#9ca3af' }}>No transactions found</div>
                ) : (
                    transactions.map(tx => (
                        <TransactionCard
                            key={tx.id}
                            transaction={tx}
                            onClick={() => { }}
                        />
                    ))
                )}
            </div>

            {/* Footer Actions */}
            <div style={{
                position: 'fixed', bottom: 0, left: 0, right: 0, background: 'white', padding: '16px',
                display: 'flex', gap: '16px', boxShadow: '0 -2px 10px rgba(0,0,0,0.05)'
            }}>
                <button
                    onClick={() => router.push(`/parties/payment/create?vendorId=${vendor.id}&partyType=vendor&mode=out`)}
                    style={{
                        flex: 1, background: '#dc2626', color: 'white', padding: '16px', borderRadius: '8px',
                        border: 'none', fontWeight: 'bold', fontSize: '16px', cursor: 'pointer'
                    }}>
                    YOU GAVE ₹
                </button>
                <button
                    onClick={() => router.push(`/parties/payment/create?vendorId=${vendor.id}&partyType=vendor&mode=in`)}
                    style={{
                        flex: 1, background: '#16a34a', color: 'white', padding: '16px', borderRadius: '8px',
                        border: 'none', fontWeight: 'bold', fontSize: '16px', cursor: 'pointer'
                    }}>
                    YOU GOT ₹
                </button>
            </div>
        </div>
    );
}

export default function VendorLedgerPage() {
    return (
        <Suspense fallback={<div>Loading...</div>}>
            <VendorLedgerContent />
        </Suspense>
    );
}
</file>

<file path="src/app/parties/form.module.css">
.container {
    padding: 16px;
    padding-bottom: 80px;
    background: #f3f4f6;
    min-height: 100vh;
}

.header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
    font-size: 18px;
    font-weight: 600;
}

.sectionLabel {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 12px;
    color: #1f2937;
    margin-left: 4px;
}

.card {
    background: white;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 24px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.inputGroup {
    margin-bottom: 16px;
}

.input {
    width: 100%;
    padding: 12px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    font-size: 14px;
    outline: none;
}

.input:focus {
    border-color: var(--primary);
}

.textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    font-size: 14px;
    outline: none;
    resize: vertical;
    min-height: 80px;
    font-family: inherit;
}

.textarea:focus {
    border-color: var(--primary);
}

.row {
    display: flex;
    gap: 12px;
}

.fetchButton {
    background: var(--primary);
    color: white;
    border: none;
    padding: 0 16px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 600;
    white-space: nowrap;
}

.actionRow {
    display: flex;
    align-items: center;
    gap: 12px;
    color: #4b5563;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
}

.uploadBox {
    border: 2px dashed #e5e7eb;
    border-radius: 12px;
    padding: 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    cursor: pointer;
    transition: border-color 0.2s;
    text-align: center;
}

.uploadBox:hover {
    border-color: var(--primary);
}

.uploadIcon {
    font-size: 24px;
    color: #9ca3af;
}

.uploadText {
    font-size: 14px;
    color: #6b7280;
}

.fileList {
    margin-top: 12px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.fileItem {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 12px;
    background: #f9fafb;
    border-radius: 8px;
    font-size: 12px;
    color: #374151;
}

.footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    padding: 16px;
    border-top: 1px solid #eee;
    z-index: 50;
}

.saveButton {
    width: 100%;
    background: var(--primary);
    color: white;
    padding: 14px;
    border-radius: 12px;
    font-weight: 600;
}
</file>

<file path="src/app/parties/page.module.css">
.container {
    padding: 16px;
    padding-bottom: 80px;
    background: var(--background);
    min-height: 100vh;
}

.tabs {
    display: flex;
    background: var(--card-bg);
    padding: 0 16px;
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    z-index: 10;
}

.tab {
    padding: 16px;
    font-weight: 600;
    color: var(--text-secondary);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    font-size: 14px;
}

.activeTab {
    color: var(--primary);
    border-bottom-color: var(--primary);
}

.summaryRow {
    display: flex;
    gap: 12px;
    margin: 16px 0;
}

.summaryCard {
    flex: 1;
    padding: 16px;
    border-radius: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: white;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

.collectCard {
    background: #ECFDF5;
    color: #065F46;
    border: 1px solid #D1FAE5;
}

.payCard {
    background: #FEF2F2;
    color: #991B1B;
    border: 1px solid #FEE2E2;
}

.summaryLabel {
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
}

.summaryAmount {
    font-size: 16px;
    font-weight: 700;
}

.emptyState {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
    text-align: center;
    background: var(--card-bg);
    border-radius: 16px;
    min-height: 300px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

.emptyIcon {
    font-size: 48px;
    color: #CBD5E1;
    margin-bottom: 16px;
}

.emptyText {
    color: var(--text-secondary);
    margin-bottom: 24px;
    font-weight: 500;
}

.addButton {
    background: var(--primary);
    color: white;
    padding: 14px 24px;
    border-radius: 12px;
    font-weight: 600;
    width: 100%;
    margin-bottom: 12px;
    font-size: 14px;
}

.secondaryButton {
    background: white;
    color: var(--primary);
    border: 1px solid var(--primary);
    padding: 14px 24px;
    border-radius: 12px;
    font-weight: 600;
    width: 100%;
    font-size: 14px;
}

.list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.listItem {
    background: var(--card-bg);
    padding: 16px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    gap: 16px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

.avatar {
    width: 48px;
    height: 48px;
    border-radius: 16px;
    /* Squircle */
    background: var(--primary-light);
    color: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 18px;
}

.info {
    flex: 1;
}

.name {
    font-weight: 600;
    color: var(--foreground);
    font-size: 14px;
    margin-bottom: 2px;
}

.subtext {
    font-size: 12px;
    color: var(--text-secondary);
    font-weight: 500;
}
</file>

<file path="src/app/products/components/ProductCard.js">
import styles from './ProductCard.module.css';
import { FiShoppingBag, FiCheck } from 'react-icons/fi';
import { FaWhatsapp } from 'react-icons/fa';
import Link from 'next/link';
import { useRouter } from 'next/navigation';

export default function ProductCard({ product, onAddToTray, onShare, quantity = 0, isSelectMode = false }) {
    const router = useRouter();

    const isBestseller = product.tags && product.tags.toLowerCase().includes('bestseller');
    const isInTray = quantity > 0;

    // Format fields
    const purity = product.purity || '22K';
    const category = product.category || 'Product';
    const title = `${category} – ${purity}`;
    const weight = product.grossWeight ? `${Number(product.grossWeight).toFixed(2)}g` : '0.00g';
    const stone = product.stoneType || 'Plain Gold';

    const handleCardClick = () => {
        if (!isSelectMode) {
            router.push(`/products/edit?id=${product.id}`);
        }
    };

    const handleAction = (e, callback) => {
        e.stopPropagation();
        callback();
    };

    return (
        <div className={styles.card} onClick={handleCardClick} style={{ cursor: isSelectMode ? 'default' : 'pointer' }}>
            <div className={styles.imageContainer}>
                {/* Badges */}
                <div className={styles.purityBadge}>{purity}</div>
                {isBestseller && (
                    <div className={`${styles.statusBadge} ${styles.bestseller}`}>
                        Bestseller
                    </div>
                )}
                {/* Quantity Badge in Select Mode */}
                {isSelectMode && isInTray && (
                    <div className={styles.quantityBadge}>
                        {quantity}
                    </div>
                )}

                {/* Image */}
                {product.images && product.images.length > 0 ? (
                    <img src={product.images[0].data} alt={product.name} className={styles.image} />
                ) : (
                    <div className={styles.placeholderImage}>
                        <FiShoppingBag size={32} color="#ccc" />
                    </div>
                )}
            </div>

            <div className={styles.details}>
                <h3 className={styles.title}>{title}</h3>
                <div className={styles.infoRow}>Weight: {weight} | Stone: {stone}</div>
            </div>

            <div className={styles.actions}>
                <button
                    className={`${styles.primaryBtn} ${isInTray ? styles.addedBtn : ''}`}
                    onClick={(e) => handleAction(e, () => onAddToTray(product))}
                >
                    {isInTray ? (
                        <>
                            <FiCheck size={14} style={{ marginRight: 4 }} />
                            Added ({quantity})
                        </>
                    ) : (
                        'Add to Tray'
                    )}
                </button>
                {!isSelectMode && (
                    <button
                        className={styles.iconBtn}
                        onClick={(e) => handleAction(e, () => onShare(product))}
                    >
                        <FaWhatsapp size={18} color="#25D366" />
                    </button>
                )}
            </div>
        </div>
    );
}
</file>

<file path="src/app/products/components/ProductCard.module.css">
.card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.05);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    border: 1px solid #f3f4f6;
    transition: transform 0.2s, box-shadow 0.2s;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

.imageContainer {
    position: relative;
    width: 100%;
    padding-top: 75%;
    /* 4:3 Aspect Ratio */
    background: #f9fafb;
    overflow: hidden;
}

.image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.placeholderImage {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f3f4f6;
}

.purityBadge {
    position: absolute;
    top: 8px;
    left: 8px;
    background: rgba(234, 179, 8, 0.9);
    /* Goldish */
    color: #fff;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    z-index: 10;
}

.statusBadge {
    position: absolute;
    top: 8px;
    right: 8px;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    z-index: 10;
    color: white;
}

.new {
    background: #3b82f6;
    /* Blue */
}

.bestseller {
    background: #d97706;
    /* Darker Gold/Orange */
}

.details {
    padding: 12px;
    flex: 1;
    /* Pushes footer down */
}

.title {
    margin: 0 0 4px 0;
    font-size: 14px;
    font-weight: 600;
    color: #111827;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.infoRow {
    font-size: 12px;
    color: #6b7280;
    margin-bottom: 8px;
}

.price {
    font-size: 15px;
    font-weight: 700;
    color: #111827;
}

.actions {
    padding: 12px;
    border-top: 1px solid #f3f4f6;
    display: flex;
    gap: 8px;
    background: #ffffff;
}

.primaryBtn {
    flex: 1;
    background: #ca8a04;
    /* Gold */
    color: white;
    border: none;
    border-radius: 6px;
    padding: 8px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
}

.primaryBtn:hover {
    background: #a16207;
}

.iconBtn {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #4b5563;
    cursor: pointer;
    padding: 0;
    transition: background 0.2s;
}

.iconBtn:hover {
    background: #f9fafb;
    color: #111827;
}

/* Quantity Badge for Select Mode */
.quantityBadge {
    position: absolute;
    top: 8px;
    right: 8px;
    background: #2563eb;
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    font-size: 12px;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
}

/* Added Button State */
.addedBtn {
    background: #16a34a;
    display: flex;
    align-items: center;
    justify-content: center;
}

.addedBtn:hover {
    background: #15803d;
}
</file>

<file path="src/components/Auth/LoginFlow.js">
'use client';

import { useState } from 'react';
import { useAuthStore } from '@/lib/store/authStore';
import styles from './LoginFlow.module.css';
import LandingPage from '../LandingPage/LandingPage';

export default function LoginFlow() {
    const { currentStep, setStep, phoneNumber, setPhoneNumber, verifyOTP } = useAuthStore();
    const [phone, setPhone] = useState(phoneNumber || '');
    const [otp, setOtp] = useState(['', '', '', '', '', '']);
    const [error, setError] = useState('');

    const handlePhoneSubmit = () => {
        if (phone.length === 10) {
            setPhoneNumber(phone);
            setStep('otp');
            setError('');
        } else {
            setError('Please enter a valid 10-digit phone number');
        }
    };

    const handleOtpChange = (index, value) => {
        if (value.length > 1) return;
        const newOtp = [...otp];
        newOtp[index] = value;
        setOtp(newOtp);

        if (value && index < 5) {
            document.getElementById(`otp-${index + 1}`)?.focus();
        }
    };

    const handleOtpSubmit = async () => {
        const otpValue = otp.join('');
        const success = await verifyOTP(otpValue);
        if (!success) {
            setError('Invalid OTP. Please use 111111');
        }
    };

    if (currentStep === 'welcome') {
        return <LandingPage onGetStarted={() => setStep('phone')} />;
    }

    if (currentStep === 'phone') {
        return (
            <div className={styles.container}>
                <div className={styles.card}>
                    <h2 className={styles.title}>Enter Phone Number</h2>
                    <p className={styles.subtitle}>We'll send you an OTP</p>
                    <input
                        className={styles.input}
                        type="tel"
                        placeholder="10-digit mobile number"
                        value={phone}
                        onChange={(e) => setPhone(e.target.value.replace(/\D/g, '').slice(0, 10))}
                        maxLength={10}
                    />
                    {error && <div className={styles.error}>{error}</div>}
                    <button className={styles.button} onClick={handlePhoneSubmit}>
                        Send OTP
                    </button>
                    <button className={styles.backButton} onClick={() => setStep('welcome')}>
                        Back
                    </button>
                </div>
            </div>
        );
    }

    if (currentStep === 'otp') {
        return (
            <div className={styles.container}>
                <div className={styles.card}>
                    <h2 className={styles.title}>Enter OTP</h2>
                    <p className={styles.subtitle}>Sent to {phoneNumber}</p>
                    <div className={styles.otpContainer}>
                        {otp.map((digit, index) => (
                            <input
                                key={index}
                                id={`otp-${index}`}
                                className={styles.otpInput}
                                type="tel"
                                maxLength={1}
                                value={digit}
                                onChange={(e) => handleOtpChange(index, e.target.value)}
                            />
                        ))}
                    </div>
                    {error && <div className={styles.error}>{error}</div>}
                    <button className={styles.button} onClick={handleOtpSubmit} disabled={otp.join('').length !== 6}>
                        Verify OTP
                    </button>
                    <button className={styles.backButton} onClick={() => setStep('phone')}>
                        Change Number
                    </button>
                </div>
            </div>
        );
    }

    return null;
}
</file>

<file path="src/components/LandingPage/LandingPage.module.css">
.container {
    min-height: 100vh;
    background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
    color: white;
    overflow-x: hidden;
    font-family: 'Inter', sans-serif;
}

.nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 2rem;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    z-index: 10;
}

.logo {
    font-size: 1.5rem;
    font-weight: 800;
    background: linear-gradient(to right, #60a5fa, #a78bfa);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.hero {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 6rem 2rem 2rem;
    position: relative;
}

.heroContent {
    max-width: 800px;
    z-index: 2;
}

.badge {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 9999px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    font-size: 0.875rem;
    margin-bottom: 1.5rem;
    color: #93c5fd;
}

.title {
    font-size: 3.5rem;
    font-weight: 800;
    line-height: 1.1;
    margin-bottom: 1.5rem;
    background: linear-gradient(to right, #ffffff, #94a3b8);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.subtitle {
    font-size: 1.25rem;
    color: #94a3b8;
    margin-bottom: 2.5rem;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
}

.ctaGroup {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-bottom: 4rem;
}

.primaryButton {
    padding: 1rem 2rem;
    background: linear-gradient(to right, #2563eb, #4f46e5);
    color: white;
    border: none;
    border-radius: 9999px;
    font-weight: 600;
    font-size: 1.125rem;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.5);
}

.primaryButton:hover {
    transform: translateY(-2px);
    box-shadow: 0 20px 25px -5px rgba(59, 130, 246, 0.6);
}

.secondaryButton {
    padding: 1rem 2rem;
    background: rgba(255, 255, 255, 0.05);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 9999px;
    font-weight: 600;
    font-size: 1.125rem;
    cursor: pointer;
    backdrop-filter: blur(10px);
    transition: background 0.2s;
}

.secondaryButton:hover {
    background: rgba(255, 255, 255, 0.1);
}

.heroImageContainer {
    position: relative;
    width: 100%;
    max-width: 1000px;
    margin: 0 auto;
    perspective: 1000px;
}

.heroImage {
    width: 100%;
    height: auto;
    border-radius: 1rem;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.features {
    padding: 6rem 2rem;
    background: rgba(0, 0, 0, 0.2);
}

.sectionTitle {
    text-align: center;
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 4rem;
}

.grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    max-width: 1200px;
    margin: 0 auto;
}

.card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.05);
    padding: 2rem;
    border-radius: 1rem;
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-5px);
    background: rgba(255, 255, 255, 0.05);
}

.cardIcon {
    font-size: 2rem;
    color: #60a5fa;
    margin-bottom: 1.5rem;
}

.cardTitle {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
}

.cardText {
    color: #94a3b8;
    line-height: 1.6;
}

/* Footer Styles */
.footer {
    padding: 4rem 2rem 2rem;
    background: #0f172a;
    border-top: 1px solid rgba(255, 255, 255, 0.05);
}

.footerGrid {
    display: grid;
    grid-template-columns: 1.5fr 1fr 1fr 1fr 1fr 1fr;
    gap: 2rem;
    max-width: 1200px;
    margin: 0 auto;
}

.footerColumn {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.footerLogo {
    font-size: 1.5rem;
    font-weight: 800;
    color: white;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
}

.socialIcons {
    display: flex;
    gap: 1rem;
}

.socialIcon {
    font-size: 1.5rem;
    color: #94a3b8;
    cursor: pointer;
    transition: color 0.2s;
}

.socialIcon:hover {
    color: white;
}

.footerHeading {
    font-size: 0.875rem;
    font-weight: 600;
    color: #94a3b8;
    margin-bottom: 0.5rem;
}

.footerLink {
    color: #cbd5e1;
    text-decoration: none;
    font-size: 0.9rem;
    transition: color 0.2s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.footerLink:hover {
    color: #60a5fa;
}

.scrollTopButton {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 3rem;
    height: 3rem;
    background: white;
    color: #0f172a;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s;
    z-index: 50;
}

.scrollTopButton:hover {
    transform: translateY(-2px);
}

@media (max-width: 1024px) {
    .footerGrid {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 768px) {
    .title {
        font-size: 2.5rem;
    }

    .hero {
        padding-top: 8rem;
    }

    .ctaGroup {
        flex-direction: column;
    }

    .ctaGroup .primaryButton,
    .ctaGroup .secondaryButton {
        width: 100%;
    }

    .footerGrid {
        grid-template-columns: 1fr;
        gap: 3rem;
    }
}
</file>

<file path="src/components/BarcodeScanner.module.css">
.overlay {
    position: fixed;
    inset: 0;
    background: #000;
    z-index: 1000;
    display: flex;
    flex-direction: column;
}

.header {
    display: flex;
    justify-content: space-between;
    padding: 16px 24px;
    padding-top: env(safe-area-inset-top, 16px);
}

.headerBtn {
    background: none;
    border: none;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    font-size: 12px;
    cursor: pointer;
}

.scannerContainer {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
}

.reader {
    width: 100%;
    height: 100%;
}

.reader video {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
}

.scanFrame {
    position: absolute;
    width: 260px;
    height: 260px;
    pointer-events: none;
}

.corner {
    position: absolute;
    width: 40px;
    height: 40px;
    border: 3px solid #4ade80;
}

.topLeft {
    top: 0;
    left: 0;
    border-right: none;
    border-bottom: none;
    border-radius: 12px 0 0 0;
}

.topRight {
    top: 0;
    right: 0;
    border-left: none;
    border-bottom: none;
    border-radius: 0 12px 0 0;
}

.bottomLeft {
    bottom: 0;
    left: 0;
    border-right: none;
    border-top: none;
    border-radius: 0 0 0 12px;
}

.bottomRight {
    bottom: 0;
    right: 0;
    border-left: none;
    border-top: none;
    border-radius: 0 0 12px 0;
}

.errorMessage {
    color: white;
    text-align: center;
    padding: 20px;
    font-size: 14px;
}

.errorContainer {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 16px;
    padding: 32px;
}

.loadingMessage {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 16px;
    color: white;
    font-size: 16px;
}

.retryBtn {
    display: flex;
    align-items: center;
    gap: 8px;
    background: #3b82f6;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    margin-top: 8px;
}

.retryBtn:active {
    background: #2563eb;
}

.instructions {
    text-align: center;
    color: white;
    padding: 24px;
    font-size: 16px;
}

.manualEntryBtn {
    background: none;
    border: none;
    color: white;
    text-decoration: underline;
    font-size: 16px;
    padding: 24px;
    padding-bottom: env(safe-area-inset-bottom, 24px);
    cursor: pointer;
    text-align: center;
}

.manualInputContainer {
    display: flex;
    gap: 12px;
    padding: 16px 24px;
    padding-bottom: env(safe-area-inset-bottom, 24px);
}

.manualInput {
    flex: 1;
    padding: 12px 16px;
    border-radius: 8px;
    border: none;
    font-size: 16px;
    background: white;
}

.submitBtn {
    background: #2563eb;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
}
</file>

<file path="src/components/BottomNav.module.css">
.nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  border-top: 1px solid #eee;
  display: flex;
  justify-content: space-around;
  padding: 8px 0;
  z-index: 100;
  padding-bottom: env(safe-area-inset-bottom);
}

.item {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-decoration: none;
  color: #666;
  font-size: 12px;
  gap: 4px;
}

.active {
  color: #D4AF37;
  font-weight: 600;
}

.label {
  margin-top: 2px;
}
</file>

<file path="src/components/BottomSheet.js">
'use client';

import { useEffect, useState } from 'react';
import { createPortal } from 'react-dom';
import { motion, AnimatePresence } from 'framer-motion';
import { ANIMATIONS } from '@/lib/animations';
import styles from './BottomSheet.module.css';

export default function BottomSheet({ isOpen, onClose, children }) {
    const [mounted, setMounted] = useState(false);

    useEffect(() => {
        setMounted(true);
    }, []);

    useEffect(() => {
        if (isOpen) {
            document.body.style.overflow = 'hidden';
        } else {
            document.body.style.overflow = 'unset';
        }
        return () => {
            document.body.style.overflow = 'unset';
        };
    }, [isOpen]);

    if (!mounted) return null;

    return createPortal(
        <AnimatePresence>
            {isOpen && (
                <motion.div
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    exit={{ opacity: 0 }}
                    transition={{ duration: ANIMATIONS.duration.fast }}
                    className={styles.overlay}
                    onClick={onClose}
                >
                    <motion.div
                        initial={{ y: '100%' }}
                        animate={{ y: 0 }}
                        exit={{ y: '100%' }}
                        transition={{
                            type: 'spring',
                            damping: 25,
                            stiffness: 300,
                        }}
                        className={styles.sheet}
                        onClick={(e) => e.stopPropagation()}
                    >
                        <div className={styles.handleBar}>
                            <div className={styles.handle} />
                        </div>
                        <div className={styles.content}>
                            {children}
                        </div>
                    </motion.div>
                </motion.div>
            )}
        </AnimatePresence>,
        document.body
    );
}
</file>

<file path="src/components/InvoiceBottomSheet.js">
import React from 'react';
import { createPortal } from 'react-dom';
import { FiX, FiShare2, FiDollarSign } from 'react-icons/fi';
import { shareInvoicePDF } from '@/lib/utils/invoiceActions';
import styles from './BottomSheet.module.css'; // Reusing existing styles

export const InvoiceBottomSheet = ({ isOpen, onClose, invoice, onRecordPayment, onShare }) => {
    if (!isOpen || !invoice) return null;

    const handleShare = async () => {
        // Use the passed onShare callback if provided (for backwards compatibility)
        // Otherwise use the centralized shareInvoicePDF utility
        if (onShare && typeof onShare === 'function') {
            // Check if it's a placeholder (like the alert callback)
            const result = onShare(invoice);
            // If onShare returns void/undefined or the invoice, also try our utility
            if (result === undefined) {
                // It was likely a placeholder - use our utility instead
                await shareInvoicePDF(invoice);
            }
        } else {
            await shareInvoicePDF(invoice);
        }
        onClose();
    };

    return createPortal(
        <div className={styles.overlay} onClick={onClose}>
            <div className={styles.sheet} onClick={e => e.stopPropagation()}>
                <div className={styles.handleBar} />

                <div style={{ padding: '16px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', borderBottom: '1px solid #eee' }}>
                    <div>
                        <h3 style={{ margin: 0, fontSize: '18px' }}>Invoice #{invoice.invoiceNumber}</h3>
                        <div style={{ fontSize: '12px', color: '#666' }}>
                            {new Date(invoice.date).toLocaleDateString()} • <span style={{ color: '#dc2626' }}>{invoice.status || 'Pending'}</span>
                        </div>
                    </div>
                    <FiX size={24} onClick={onClose} style={{ cursor: 'pointer' }} />
                </div>

                <div style={{ padding: '20px' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '24px' }}>
                        <div style={{ fontSize: '14px', color: '#666' }}>Amount Due</div>
                        <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#dc2626' }}>
                            ₹ {(invoice.totals?.total || invoice.total || 0).toFixed(2)}
                        </div>
                    </div>

                    <div style={{ display: 'flex', gap: '16px' }}>
                        <button
                            onClick={() => onRecordPayment(invoice)}
                            style={{
                                flex: 1,
                                padding: '12px',
                                borderRadius: '8px',
                                background: '#2563eb',
                                color: 'white',
                                border: 'none',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                gap: '8px',
                                fontWeight: 600
                            }}
                        >
                            <FiDollarSign /> Record Payment
                        </button>
                        <button
                            onClick={handleShare}
                            style={{
                                flex: 1,
                                padding: '12px',
                                borderRadius: '8px',
                                background: 'white',
                                color: '#2563eb',
                                border: '1px solid #2563eb',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                gap: '8px',
                                fontWeight: 600
                            }}
                        >
                            <FiShare2 /> Share Invoice
                        </button>
                    </div>
                </div>
            </div>
        </div>,
        document.body
    );
};
</file>

<file path="src/components/InvoiceForm.module.css">
.container {
    padding: 16px;
    padding-bottom: 120px;
    /* Space for fixed footer */
}

.card {
    background: white;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.label {
    font-size: 12px;
    color: #6b7280;
    margin-bottom: 4px;
}

.value {
    font-size: 14px;
    font-weight: 500;
    color: #111827;
}

.sectionTitle {
    font-size: 14px;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.addButton {
    width: 100%;
    padding: 12px;
    background: #eff6ff;
    border: 1px dashed #3b82f6;
    border-radius: 8px;
    color: #2563eb;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    cursor: pointer;
}

.itemRow {
    border-bottom: 1px solid #f3f4f6;
    padding-bottom: 12px;
    margin-bottom: 12px;
}

.itemHeader {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
}

.itemInputs {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 12px;
    align-items: center;
}

.input {
    width: 100%;
    padding: 8px;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    font-size: 14px;
}

/* Optional Fields */
.optionalRow {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    border-bottom: 1px solid #f3f4f6;
}

.optionalLabel {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    color: #4b5563;
}

.optionalInput {
    border: none;
    text-align: right;
    font-size: 14px;
    outline: none;
    width: 120px;
}

/* Toggles */
.toggleRow {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.toggleRow:last-child {
    margin-bottom: 0;
}

.toggleLabel {
    font-size: 14px;
    font-weight: 600;
    color: #111827;
}

.toggleSwitch {
    width: 44px;
    height: 24px;
    background: #e5e7eb;
    border-radius: 12px;
    position: relative;
    cursor: pointer;
    transition: background 0.2s;
}

.toggleSwitch.active {
    background: #2563eb;
}

.toggleKnob {
    width: 20px;
    height: 20px;
    background: white;
    border-radius: 50%;
    position: absolute;
    top: 2px;
    left: 2px;
    transition: transform 0.2s;
}

.toggleSwitch.active .toggleKnob {
    transform: translateX(20px);
}

/* Payments */
.checkboxRow {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 16px;
}

.paymentGrid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
}

.inputWrapper {
    display: flex;
    align-items: center;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    padding: 0 8px;
}

.paymentInput {
    width: 100%;
    padding: 8px;
    border: none;
    outline: none;
}

.select {
    width: 100%;
    padding: 8px;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    background: white;
}

/* Footer */
.footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #eff6ff;
    padding: 16px;
    border-top: 1px solid #e5e7eb;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 10;
}

.footerLeft {
    flex: 1;
}

.footerRow {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    color: #6b7280;
    margin-bottom: 4px;
}

.totalAmount {
    font-size: 16px;
    font-weight: 700;
    color: #111827;
    margin-top: 4px;
}

.createButton {
    background: #2563eb;
    color: white;
    border: none;
    padding: 10px 24px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
}

/* Customer Selection Styles */
.selectedCustomer {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.customerInfo {
    flex: 1;
}

.customerName {
    font-weight: 600;
    font-size: 16px;
    color: #111827;
}

.customerPhone {
    font-size: 13px;
    color: #6b7280;
}

.customerActions {
    display: flex;
    gap: 12px;
}

.actionButton {
    background: none;
    border: none;
    color: #2563eb;
    font-weight: 500;
    font-size: 14px;
    cursor: pointer;
    padding: 4px 8px;
}
</file>

<file path="src/components/TransactionCard.js">
import React from 'react';
import { motion } from 'framer-motion';
import { ANIMATIONS } from '@/lib/animations';

export const TransactionCard = ({ transaction, onClick }) => {
    const isCredit = transaction.type === 'credit' || transaction.type === 'payment';
    const amount = parseFloat(transaction.amount || 0);

    return (
        <motion.div
            layout
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            whileTap={{ scale: 0.98 }}
            transition={{ duration: ANIMATIONS.duration.fast }}
            onClick={onClick}
            style={{
                background: 'white',
                padding: '16px',
                borderBottom: '1px solid #f3f4f6',
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                cursor: 'pointer'
            }}
        >
            <div>
                <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '4px' }}>
                    <span style={{
                        fontSize: '12px',
                        color: '#6b7280',
                        background: '#f3f4f6',
                        padding: '2px 6px',
                        borderRadius: '4px'
                    }}>
                        {transaction.type?.toUpperCase() || 'TRANSACTION'}
                    </span>
                    {transaction.status === 'pending' && (
                        <span style={{ fontSize: '12px', color: '#dc2626' }}>• Pending</span>
                    )}
                </div>
                <div style={{ fontWeight: 600, fontSize: '14px' }}>
                    {transaction.number || 'REF-NA'}
                </div>
                <div style={{ fontSize: '12px', color: '#9ca3af' }}>
                    {new Date(transaction.date).toLocaleDateString()}
                </div>
            </div>

            <div style={{ textAlign: 'right' }}>
                <div style={{
                    fontSize: '14px',
                    color: isCredit ? '#16a34a' : '#dc2626',
                    fontWeight: 500
                }}>
                    {isCredit ? '+' : '-'} ₹ {amount.toFixed(2)}
                </div>
                <div style={{ fontSize: '12px', color: '#111827', fontWeight: 600, marginTop: '4px' }}>
                    ₹ {transaction.balance?.toFixed(2) || '0.00'}
                </div>
            </div>
        </motion.div>
    );
};
</file>

<file path="src/lib/store/purchaseStore.js">
import { create } from 'zustand';
import { db } from '@/lib/db';

export const usePurchaseStore = create((set, get) => ({
    purchaseNumber: 'PUR-1',
    date: new Date().toISOString().split('T')[0],
    dueDate: new Date().toISOString().split('T')[0],
    vendor: null,
    items: [],
    purchases: [], // List of all purchases

    // GST Toggle
    gstEnabled: true,

    // Details
    details: {
        reference: '',
        notes: '',
        terms: '',
        extraDiscount: 0,
        shippingCharges: 0,
        packagingCharges: 0,
    },

    // Weight Summary
    weightSummary: {
        grossWeight: '',
        netWeight: '',
    },

    // Payment tracking
    payment: {
        isFullyPaid: false,
        amountPaid: 0,
        mode: 'Cash',
        notes: '',
    },

    roundOff: false,
    id: null, // For editing

    // Setters
    setPurchaseNumber: (num) => set({ purchaseNumber: num }),
    setDate: (date) => set({ date }),
    setDueDate: (date) => set({ dueDate: date }),
    setVendor: (vendor) => set({ vendor }),
    toggleGst: () => set((state) => ({ gstEnabled: !state.gstEnabled })),
    toggleRoundOff: () => set((state) => ({ roundOff: !state.roundOff })),

    setWeightSummary: (field, value) => set((state) => ({
        weightSummary: { ...state.weightSummary, [field]: value }
    })),

    updateDetails: (field, value) => set((state) => ({
        details: { ...state.details, [field]: value }
    })),

    updatePayment: (field, value) => set((state) => ({
        payment: { ...state.payment, [field]: value }
    })),

    // Load purchases from DB
    loadPurchases: async () => {
        const purchases = await db.purchases.toArray();
        set({ purchases: purchases.reverse() });
    },

    // Item management
    addItem: () => set((state) => ({
        items: [...state.items, {
            id: Date.now(),
            name: '',
            netWeight: 0,
            grossWeight: 0,
            wastage: 0,
            ratePerGram: 0,
            quantity: 1,
            purity: '',
            hsn: '',
        }]
    })),

    updateItem: (id, field, value) => set((state) => ({
        items: state.items.map(item =>
            item.id === id ? { ...item, [field]: value } : item
        )
    })),

    removeItem: (id) => set((state) => ({
        items: state.items.filter(item => item.id !== id)
    })),

    duplicateItem: (id) => set((state) => {
        const itemToDuplicate = state.items.find(item => item.id === id);
        if (itemToDuplicate) {
            return {
                items: [...state.items, { ...itemToDuplicate, id: Date.now() }]
            };
        }
        return state;
    }),

    // Calculate totals
    calculateTotals: () => {
        const { items, details, roundOff, gstEnabled } = get();
        let subtotal = 0;

        // Calculate line item totals
        items.forEach(item => {
            // Effective Weight = Net Weight + Wastage
            const netWeight = Number(item.netWeight) || 0;
            const wastage = Number(item.wastage) || 0;
            const effectiveWeight = netWeight + wastage;

            // Amount = Effective Weight × Rate per gram
            const ratePerGram = Number(item.ratePerGram) || 0;
            const itemTotal = effectiveWeight * ratePerGram * (item.quantity || 1);

            subtotal += itemTotal;
        });

        // Tax Calculation (when GST is enabled)
        let cgstAmount = 0;
        let sgstAmount = 0;
        let totalTax = 0;

        if (gstEnabled) {
            const cgstRate = 1.5;
            const sgstRate = 1.5;

            cgstAmount = (subtotal * cgstRate) / 100;
            sgstAmount = (subtotal * sgstRate) / 100;
            totalTax = cgstAmount + sgstAmount;
        }

        let total = subtotal + totalTax;

        // Add/Subtract extra charges
        total += Number(details.shippingCharges || 0);
        total += Number(details.packagingCharges || 0);
        total -= Number(details.extraDiscount || 0);

        let finalTotal = total;
        let roundOffAmount = 0;

        if (roundOff) {
            finalTotal = Math.round(total);
            roundOffAmount = finalTotal - total;
        }

        return {
            subtotal,
            totalTax,
            total: finalTotal,
            roundOffAmount,
            rawTotal: total,
            cgst: cgstAmount,
            sgst: sgstAmount,
            igst: 0
        };
    },

    // Save purchase to database
    savePurchase: async () => {
        const state = get();
        const { purchaseNumber, date, dueDate, vendor, items, details, weightSummary, payment, id, gstEnabled } = state;

        if (!vendor) throw new Error('Vendor is required');
        if (items.length === 0) throw new Error('At least one item is required');

        // Calculate totals
        const totals = state.calculateTotals();

        const balanceDue = totals.total - (payment.amountPaid || 0);
        const status = balanceDue <= 0 ? 'Paid' : (payment.amountPaid > 0 ? 'Partial' : 'Unpaid');

        // Prepare items with computed values
        const persistedItems = items.map(item => {
            const netWeight = Number(item.netWeight) || 0;
            const wastage = Number(item.wastage) || 0;
            const effectiveWeight = netWeight + wastage;
            const ratePerGram = Number(item.ratePerGram) || 0;
            const itemTotal = effectiveWeight * ratePerGram * (item.quantity || 1);

            return {
                ...item,
                effectiveWeight,
                itemTotal
            };
        });

        const purchaseData = {
            purchaseNumber,
            date,
            dueDate,
            vendorId: vendor.id,
            vendor: { name: vendor.name, id: vendor.id, phone: vendor.phone },
            items: persistedItems,
            details,
            weightSummary,
            gstEnabled,
            totals,
            status,
            balanceDue,

            // Tax columns for easy querying
            cgstAmount: totals.cgst,
            sgstAmount: totals.sgst,
            totalBeforeTax: totals.subtotal,
            totalAfterTax: totals.total,

            updatedAt: new Date().toISOString()
        };

        return await db.transaction('rw', db.purchases, db.payments, db.vendors, async () => {
            let purchaseId = id;

            if (id) {
                await db.purchases.update(id, purchaseData);
            } else {
                purchaseId = await db.purchases.add({ ...purchaseData, createdAt: new Date().toISOString() });
            }

            // Update vendor balance (purchase increases what you owe the vendor)
            if (!id) {
                const currentVendor = await db.vendors.get(vendor.id);
                if (currentVendor) {
                    // Purchase increases balance (you owe more to vendor)
                    // Payment decreases it
                    const newBalance = (currentVendor.balance || 0) + totals.total - Number(payment.amountPaid || 0);
                    await db.vendors.update(vendor.id, { balance: newBalance });
                }

                // Record payment if any
                if (payment.amountPaid > 0) {
                    await db.payments.add({
                        transactionNumber: 'VPAYOUT-' + Date.now().toString().slice(-4),
                        date: date,
                        type: 'OUT',
                        partyType: 'VENDOR',
                        partyId: vendor.id,
                        amount: Number(payment.amountPaid),
                        mode: payment.mode,
                        notes: payment.notes,
                        createdAt: new Date().toISOString()
                    });
                }
            }

            // Reload purchases
            const purchases = await db.purchases.toArray();
            set({ purchases: purchases.reverse() });

            return purchaseId;
        });
    },

    // Delete purchase
    deletePurchase: async (id) => {
        await db.purchases.delete(id);
        const purchases = await db.purchases.toArray();
        set({ purchases: purchases.reverse() });
    },

    // Reset store
    resetPurchase: () => set({
        id: null,
        purchaseNumber: 'PUR-' + Date.now().toString().slice(-4),
        date: new Date().toISOString().split('T')[0],
        dueDate: new Date().toISOString().split('T')[0],
        vendor: null,
        items: [],
        gstEnabled: true,
        details: { reference: '', notes: '', terms: '', extraDiscount: 0, shippingCharges: 0, packagingCharges: 0 },
        weightSummary: { grossWeight: '', netWeight: '' },
        payment: { isFullyPaid: false, amountPaid: 0, mode: 'Cash', notes: '' },
        roundOff: false
    }),

    // Set purchase for editing
    setPurchase: (purchase) => set({
        id: purchase.id,
        purchaseNumber: purchase.purchaseNumber,
        date: purchase.date,
        dueDate: purchase.dueDate || purchase.date,
        vendor: purchase.vendor,
        items: purchase.items,
        gstEnabled: purchase.gstEnabled !== false,
        details: purchase.details || { reference: '', notes: '', terms: '', extraDiscount: 0, shippingCharges: 0, packagingCharges: 0 },
        weightSummary: purchase.weightSummary || { grossWeight: '', netWeight: '' },
        payment: purchase.payment || { isFullyPaid: false, amountPaid: 0, mode: 'Cash', notes: '' },
        roundOff: purchase.totals?.roundOffAmount !== 0
    })
}));
</file>

<file path="src/lib/utils/invoiceActions.js">
'use client';

/**
 * Centralized Invoice Actions Utility
 * Handles share, download, and view operations with proper Capacitor/native support
 */

import { generatePDF } from './pdf';
import { db } from '@/lib/db';

// ============================================================================
// PLATFORM DETECTION
// ============================================================================

/**
 * Check if running in Capacitor native environment
 */
export const isNativePlatform = () => {
    return typeof window !== 'undefined' && window.Capacitor && window.Capacitor.isNative;
};

// ============================================================================
// TOAST NOTIFICATIONS
// ============================================================================

let toastCallback = null;

/**
 * Register a callback to show toast messages
 * Called by ToastProvider component on mount
 */
export const registerToastCallback = (callback) => {
    toastCallback = callback;
};

/**
 * Show a toast notification to the user
 * @param {string} message - Message to display
 * @param {'success' | 'error' | 'info'} type - Toast type
 */
export const showToast = (message, type = 'info') => {
    console.log(`[Toast ${type}]: ${message}`);
    if (toastCallback) {
        toastCallback(message, type);
    } else {
        // Fallback to alert if Toast component not mounted
        if (type === 'error') {
            alert(`Error: ${message}`);
        }
    }
};

// ============================================================================
// FILE SYSTEM UTILITIES (NATIVE)
// ============================================================================

/**
 * Convert Blob to base64 string
 */
const blobToBase64 = (blob) => {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = () => {
            const base64data = reader.result;
            const pureBase64 = base64data.split(',')[1];
            resolve(pureBase64);
        };
        reader.onerror = reject;
        reader.readAsDataURL(blob);
    });
};

/**
 * Write file to device storage (native only)
 * @returns {Promise<{uri: string, path: string}>} File result with URI
 */
const writeFileNative = async (fileName, blob, directory = 'Cache') => {
    const { Filesystem, Directory } = await import('@capacitor/filesystem');
    const base64 = await blobToBase64(blob);

    const directoryMap = {
        'Cache': Directory.Cache,
        'Documents': Directory.Documents,
        'Data': Directory.Data,
        'External': Directory.External,
        'ExternalStorage': Directory.ExternalStorage
    };

    const result = await Filesystem.writeFile({
        path: fileName,
        data: base64,
        directory: directoryMap[directory] || Directory.Cache
    });

    return result;
};

// ============================================================================
// SHARE UTILITIES
// ============================================================================

/**
 * Share invoice as PDF
 * @param {object} invoice - Invoice data object
 * @returns {Promise<boolean>} Success status
 */
export const shareInvoicePDF = async (invoice) => {
    if (!invoice) {
        showToast('No invoice to share', 'error');
        return false;
    }

    try {
        // Get settings
        const settings = await db.settings.get('templateId');
        const company = await db.settings.get('companyDetails');
        const lendingTemplate = await db.settings.get('lendingBillTemplateId');

        const templateId = invoice.type === 'LENDING'
            ? (lendingTemplate?.value || 'modern')
            : (settings?.value || 'modern');
        const companyDetails = company?.value || {};

        console.log('[ShareInvoice] Generating PDF...');
        const blob = await generatePDF({
            ...invoice,
            templateId,
            companyDetails,
            returnBlob: true
        });

        const fileName = `Invoice-${invoice.invoiceNumber}.pdf`;

        if (isNativePlatform()) {
            console.log('[ShareInvoice] Native platform detected, using Capacitor');

            // Write to cache for sharing
            const result = await writeFileNative(fileName, blob, 'Cache');

            // Share the file
            const { Share } = await import('@capacitor/share');
            await Share.share({
                title: `Invoice ${invoice.invoiceNumber}`,
                text: `Please find attached invoice ${invoice.invoiceNumber}`,
                files: [result.uri],
                dialogTitle: 'Send Invoice'
            });

            console.log('[ShareInvoice] Shared successfully');
            return true;
        } else {
            console.log('[ShareInvoice] Web platform, using navigator.share');
            const file = new File([blob], fileName, { type: 'application/pdf' });

            if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                await navigator.share({
                    title: `Invoice ${invoice.invoiceNumber}`,
                    text: `Please find attached invoice ${invoice.invoiceNumber}`,
                    files: [file]
                });
                return true;
            } else {
                // Fallback: download the file
                console.log('[ShareInvoice] Web Share API not available, downloading instead');
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                a.click();
                URL.revokeObjectURL(url);
                showToast('Sharing not supported - file downloaded instead', 'info');
                return true;
            }
        }
    } catch (error) {
        console.error('[ShareInvoice] Error:', error);
        if (error.name !== 'AbortError') {
            showToast('Failed to share invoice: ' + error.message, 'error');
        }
        return false;
    }
};

/**
 * Download invoice PDF to device
 * @param {object} invoice - Invoice data object
 * @returns {Promise<boolean>} Success status
 */
export const downloadInvoicePDF = async (invoice) => {
    if (!invoice) {
        showToast('No invoice to download', 'error');
        return false;
    }

    try {
        const settings = await db.settings.get('templateId');
        const company = await db.settings.get('companyDetails');
        const lendingTemplate = await db.settings.get('lendingBillTemplateId');

        const templateId = invoice.type === 'LENDING'
            ? (lendingTemplate?.value || 'modern')
            : (settings?.value || 'modern');
        const companyDetails = company?.value || {};

        const fileName = `Invoice-${invoice.invoiceNumber}.pdf`;

        if (isNativePlatform()) {
            console.log('[DownloadInvoice] Native platform, saving to Documents');
            const blob = await generatePDF({
                ...invoice,
                templateId,
                companyDetails,
                returnBlob: true
            });

            await writeFileNative(fileName, blob, 'Documents');
            showToast(`Invoice saved: ${fileName}`, 'success');
            return true;
        } else {
            console.log('[DownloadInvoice] Web platform, using jsPDF save');
            await generatePDF({ ...invoice, templateId, companyDetails });
            showToast('Invoice downloaded', 'success');
            return true;
        }
    } catch (error) {
        console.error('[DownloadInvoice] Error:', error);
        showToast('Failed to download invoice: ' + error.message, 'error');
        return false;
    }
};

/**
 * Share simple text content
 * @param {object} options - Share options { title, text, url }
 * @returns {Promise<boolean>} Success status
 */
export const shareText = async (options) => {
    const { title, text, url, dialogTitle } = options;

    try {
        if (isNativePlatform()) {
            console.log('[ShareText] Using Capacitor Share');
            const { Share } = await import('@capacitor/share');
            await Share.share({ title, text, url, dialogTitle });
            return true;
        } else {
            console.log('[ShareText] Using navigator.share');
            if (navigator.share) {
                await navigator.share({ title, text, url });
                return true;
            } else {
                showToast('Sharing not supported on this device', 'info');
                return false;
            }
        }
    } catch (error) {
        console.error('[ShareText] Error:', error);
        if (error.name !== 'AbortError') {
            showToast('Failed to share: ' + error.message, 'error');
        }
        return false;
    }
};

/**
 * Download CSV file
 * @param {string} csvContent - CSV content string
 * @param {string} filename - File name
 * @returns {Promise<boolean>} Success status
 */
export const downloadCSV = async (csvContent, filename) => {
    try {
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });

        if (isNativePlatform()) {
            console.log('[DownloadCSV] Native platform, saving to Documents');
            await writeFileNative(filename, blob, 'Documents');
            showToast(`Exported: ${filename}`, 'success');
            return true;
        } else {
            console.log('[DownloadCSV] Web platform, using download link');
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            showToast(`Exported: ${filename}`, 'success');
            return true;
        }
    } catch (error) {
        console.error('[DownloadCSV] Error:', error);
        showToast('Failed to export: ' + error.message, 'error');
        return false;
    }
};

/**
 * Download PDF blob
 * @param {Blob} pdfBlob - PDF blob
 * @param {string} filename - File name
 * @returns {Promise<boolean>} Success status
 */
export const downloadPDFBlob = async (pdfBlob, filename) => {
    try {
        if (isNativePlatform()) {
            console.log('[DownloadPDF] Native platform, saving to Documents');
            await writeFileNative(filename, pdfBlob, 'Documents');
            showToast(`Exported: ${filename}`, 'success');
            return true;
        } else {
            console.log('[DownloadPDF] Web platform, using download link');
            const url = URL.createObjectURL(pdfBlob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            showToast(`Exported: ${filename}`, 'success');
            return true;
        }
    } catch (error) {
        console.error('[DownloadPDF] Error:', error);
        showToast('Failed to export: ' + error.message, 'error');
        return false;
    }
};
</file>

<file path="src/lib/utils/pdf.js">
import jsPDF from 'jspdf';
import html2canvas from 'html2canvas';
import { createRoot } from 'react-dom/client';
import { flushSync } from 'react-dom';
import { getTemplate } from '@/components/InvoiceTemplates';

export const generatePDF = async (data) => {
    const div = document.createElement('div');
    div.style.position = 'absolute';
    div.style.left = '-9999px';
    div.style.top = '0';
    document.body.appendChild(div);

    const TemplateComponent = getTemplate(data.templateId || 'modern').component;

    const root = createRoot(div);
    flushSync(() => {
        root.render(<TemplateComponent data={data} />);
    });

    // Wait for render? flushSync should handle it, but images might need load time.
    // Since we have no images yet, it's fine.

    try {
        const canvas = await html2canvas(div.querySelector('#invoice-template'), {
            scale: 2, // Higher quality
            logging: false,
            useCORS: true
        });

        const imgData = canvas.toDataURL('image/png');
        const pdf = new jsPDF({
            orientation: 'portrait',
            unit: 'mm',
            format: 'a4'
        });

        const imgWidth = 210;
        const pageHeight = 297;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;

        pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);

        if (data.returnBlob) {
            return pdf.output('blob');
        }

        pdf.save(`Invoice-${data.invoiceNumber}.pdf`);
    } catch (error) {
        console.error('Error generating PDF:', error);
    } finally {
        document.body.removeChild(div);
    }
};
</file>

<file path="next.config.mjs">
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export',
  images: {
    unoptimized: true,
  },
};

export default nextConfig;
</file>

<file path="README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.js`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Testing

This project includes a comprehensive testing setup with unit tests, component tests, and end-to-end tests.

### Running Unit & Component Tests

```bash
# Run all tests
pnpm test

# Run tests in watch mode (re-runs on file changes)
pnpm test:watch

# Run tests with coverage report
pnpm test:coverage
```

### Running End-to-End Tests (Cypress)

First, make sure the development server is running:

```bash
pnpm dev
```

Then in another terminal:

```bash
# Open Cypress interactive UI
pnpm cypress:open

# Run Cypress tests headlessly (for CI)
pnpm cypress:run
```

### Test Structure

```
/src
  /components/__tests__/    # Component tests (React Testing Library)
  /lib/utils/__tests__/     # Unit tests for utilities
/cypress
  /e2e/                     # End-to-end tests
  /support/                 # Cypress support files
```

### Writing New Tests

- **Unit Tests**: Place in `__tests__` folder next to the module being tested
- **Component Tests**: Use React Testing Library (RTL)
- **E2E Tests**: Add `.cy.js` files in `cypress/e2e/`

Follow TDD: **Red → Green → Refactor**

## Deploy on Vercel


The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

<file path="android/app/src/main/res/mipmap-anydpi-v26/ic_launcher_round.xml">
<?xml version="1.0" encoding="utf-8"?>
<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
    <background android:drawable="@color/ic_launcher_background" />
    <foreground>
        <inset android:drawable="@mipmap/ic_launcher_foreground" android:inset="16.7%" />
    </foreground>
</adaptive-icon>
</file>

<file path="android/app/src/main/res/mipmap-anydpi-v26/ic_launcher.xml">
<?xml version="1.0" encoding="utf-8"?>
<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
    <background android:drawable="@color/ic_launcher_background" />
    <foreground>
        <inset android:drawable="@mipmap/ic_launcher_foreground" android:inset="16.7%" />
    </foreground>
</adaptive-icon>
</file>

<file path="android/app/src/main/AndroidManifest.xml">
<?xml version="1.0" encoding="utf-8" ?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    <application
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/AppTheme">
        <activity
            android:configChanges="orientation|keyboardHidden|keyboard|screenSize|locale|smallestScreenSize|screenLayout|uiMode|navigation"
            android:name=".MainActivity"
            android:label="@string/title_activity_main"
            android:theme="@style/AppTheme.NoActionBarLaunch"
            android:launchMode="singleTask"
            android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>

        <provider
            android:name="androidx.core.content.FileProvider"
            android:authorities="${applicationId}.fileprovider"
            android:exported="false"
            android:grantUriPermissions="true">
            <meta-data android:name="android.support.FILE_PROVIDER_PATHS" android:resource="@xml/file_paths" />
        </provider>
    </application>

    <!-- Permissions -->

    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.CAMERA" />
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" android:maxSdkVersion="32" />
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" android:maxSdkVersion="29" />
</manifest>
</file>

<file path="src/app/more/company/page.js">
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { useSettingsStore } from '@/lib/store/settingsStore';
import { FiArrowLeft, FiEdit2, FiPlus, FiChevronDown, FiChevronUp } from 'react-icons/fi';
import { ImagePicker } from '@/components/ImagePicker';
import { AddressBottomSheet } from '@/components/AddressBottomSheet';
import styles from './page.module.css';

export default function CompanyDetailsPage() {
    const router = useRouter();
    const { companyDetails, updateCompanyDetails, loadSettings } = useSettingsStore();

    const [isBillingSheetOpen, setIsBillingSheetOpen] = useState(false);
    const [isShippingSheetOpen, setIsShippingSheetOpen] = useState(false);
    const [isOptionalExpanded, setIsOptionalExpanded] = useState(false);
    const [isGSTEnabled, setIsGSTEnabled] = useState(false);

    useEffect(() => {
        loadSettings();
    }, []);

    useEffect(() => {
        if (companyDetails.gstin) {
            setIsGSTEnabled(true);
        }
    }, [companyDetails.gstin]);

    const handleInputChange = (e) => {
        const { name, value } = e.target;
        if (name === 'phone' || name === 'alternatePhone') {
            const numericValue = value.replace(/\D/g, '').slice(0, 10);
            updateCompanyDetails({ [name]: numericValue });
        } else {
            updateCompanyDetails({ [name]: value });
        }
    };

    const handleImageSelect = (imageData) => {
        updateCompanyDetails({ logo: imageData });
    };

    const handleAddressSave = (type, addressData) => {
        if (type === 'billing') {
            updateCompanyDetails({ billingAddress: addressData });
        } else {
            updateCompanyDetails({ shippingAddress: addressData });
        }
    };

    return (
        <div className={styles.container}>
            {/* Header */}
            <div className={styles.header}>
                <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                    <FiArrowLeft size={24} onClick={() => router.back()} style={{ cursor: 'pointer' }} />
                    <div className={styles.headerTitle}>Company Details</div>
                </div>
                <button className={styles.editButton}>
                    <FiEdit2 size={14} /> Edit
                </button>
            </div>

            <div className={styles.content}>
                {/* Main Card */}
                <div className={styles.card}>
                    <div className={styles.logoContainer}>
                        <ImagePicker image={companyDetails.logo} onImageSelect={handleImageSelect} />
                    </div>

                    <div style={{ marginTop: '40px' }}>
                        <div className={styles.formGroup}>
                            <label className={styles.label}>Business/Company Name</label>
                            <input
                                name="name"
                                value={companyDetails.name || ''}
                                onChange={handleInputChange}
                                className={styles.input}
                                placeholder="Enter Business Name"
                            />
                        </div>

                        <div className={styles.formGroup}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '8px' }}>
                                <input
                                    type="checkbox"
                                    checked={isGSTEnabled}
                                    onChange={(e) => setIsGSTEnabled(e.target.checked)}
                                    style={{ width: 16, height: 16 }}
                                />
                                <label className={styles.label} style={{ margin: 0 }}>GST Number (Optional)</label>
                            </div>
                            {isGSTEnabled && (
                                <input
                                    name="gstin"
                                    value={companyDetails.gstin || ''}
                                    onChange={handleInputChange}
                                    className={styles.input}
                                    placeholder="Enter GSTIN"
                                />
                            )}
                            {!isGSTEnabled && <div className={styles.value}>NA</div>}
                        </div>

                        <div className={styles.formGroup}>
                            <label className={styles.label}>Business Phone No.</label>
                            <input
                                name="phone"
                                value={companyDetails.phone || ''}
                                onChange={handleInputChange}
                                className={styles.input}
                                placeholder="Enter Phone Number"
                            />
                        </div>

                        <div className={styles.formGroup}>
                            <label className={styles.label}>Business Email</label>
                            <input
                                name="email"
                                value={companyDetails.email || ''}
                                onChange={handleInputChange}
                                className={styles.input}
                                placeholder="Enter Email"
                            />
                        </div>

                        <div className={styles.formGroup}>
                            <label className={styles.label}>Trade/Brand Name</label>
                            <input
                                name="tradeName"
                                value={companyDetails.tradeName || companyDetails.name || ''}
                                onChange={handleInputChange}
                                className={styles.input}
                                placeholder="Enter Trade Name"
                            />
                        </div>
                    </div>
                </div>

                {/* Address Section */}
                <div>
                    <div style={{ fontWeight: 600, marginBottom: '12px' }}>Billing Address</div>
                    <button className={styles.addressButton} onClick={() => setIsBillingSheetOpen(true)}>
                        <div className={styles.iconCircle}><FiPlus size={16} /></div>
                        {companyDetails.billingAddress?.addressLine1 ? 'Edit Billing Address' : 'Billing Address'}
                    </button>
                    {companyDetails.billingAddress?.addressLine1 && (
                        <div style={{ marginTop: '8px', fontSize: '14px', color: '#666', paddingLeft: '12px' }}>
                            {companyDetails.billingAddress.addressLine1}, {companyDetails.billingAddress.city}
                        </div>
                    )}
                </div>

                <div>
                    <div style={{ fontWeight: 600, marginBottom: '12px' }}>Shipping Address</div>
                    <button className={styles.addressButton} onClick={() => setIsShippingSheetOpen(true)}>
                        <div className={styles.iconCircle}><FiPlus size={16} /></div>
                        {companyDetails.shippingAddress?.addressLine1 ? 'Edit Shipping Address' : 'Shipping Address'}
                    </button>
                    {companyDetails.shippingAddress?.addressLine1 && (
                        <div style={{ marginTop: '8px', fontSize: '14px', color: '#666', paddingLeft: '12px' }}>
                            {companyDetails.shippingAddress.addressLine1}, {companyDetails.shippingAddress.city}
                        </div>
                    )}
                </div>

                {/* Optional Fields */}
                <div>
                    <div className={styles.accordionHeader} onClick={() => setIsOptionalExpanded(!isOptionalExpanded)}>
                        <div>
                            <div>Optional Fields</div>
                            <div style={{ fontSize: '12px', color: '#666', fontWeight: 400 }}>Pan Number, Alternate Contact Number, Website</div>
                        </div>
                        {isOptionalExpanded ? <FiChevronUp /> : <FiChevronDown />}
                    </div>

                    {isOptionalExpanded && (
                        <div className={styles.accordionContent}>
                            <div className={styles.formGroup}>
                                <label className={styles.label}>PAN Number</label>
                                <input
                                    name="panNumber"
                                    value={companyDetails.panNumber || ''}
                                    onChange={handleInputChange}
                                    className={styles.input}
                                    placeholder="Enter PAN"
                                />
                            </div>
                            <div className={styles.formGroup}>
                                <label className={styles.label}>Alternate Contact Number</label>
                                <input
                                    name="alternatePhone"
                                    value={companyDetails.alternatePhone || ''}
                                    onChange={handleInputChange}
                                    className={styles.input}
                                    placeholder="Enter Alternate Number"
                                />
                            </div>
                            <div className={styles.formGroup}>
                                <label className={styles.label}>Website</label>
                                <input
                                    name="website"
                                    value={companyDetails.website || ''}
                                    onChange={handleInputChange}
                                    className={styles.input}
                                    placeholder="Enter Website"
                                />
                            </div>
                        </div>
                    )}
                </div>
            </div>

            <AddressBottomSheet
                isOpen={isBillingSheetOpen}
                onClose={() => setIsBillingSheetOpen(false)}
                onSave={(data) => handleAddressSave('billing', data)}
                initialData={companyDetails.billingAddress}
                title="Enter Billing Address"
            />

            <AddressBottomSheet
                isOpen={isShippingSheetOpen}
                onClose={() => setIsShippingSheetOpen(false)}
                onSave={(data) => handleAddressSave('shipping', data)}
                initialData={companyDetails.shippingAddress}
                title="Enter Shipping Address"
                showAutofill={true}
            />
        </div>
    );
}
</file>

<file path="src/app/more/templates/page.js">
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { useSettingsStore } from '@/lib/store/settingsStore';
import { templates } from '@/components/InvoiceTemplates';
import { FiArrowLeft, FiCheck } from 'react-icons/fi';
import styles from '../page.module.css'; // Reuse existing styles or create new

// Dummy data for preview
const dummyData = {
    invoiceNumber: 'INV-001',
    date: '2023-11-21',
    customer: {
        name: 'John Doe',
        address: '123 Main St, City, Country'
    },
    items: [
        { name: 'Product A', quantity: 2, rate: 100 },
        { name: 'Service B', quantity: 1, rate: 500 }
    ],
    totals: {
        subtotal: 700,
        totalTax: 126,
        total: 826
    }
};

export default function TemplatesPage() {
    const router = useRouter();
    const { templateId, setTemplateId, loadSettings } = useSettingsStore();
    const [selectedId, setSelectedId] = useState('modern');

    useEffect(() => {
        loadSettings();
    }, []);

    useEffect(() => {
        if (templateId) {
            setSelectedId(templateId);
        }
    }, [templateId]);

    const handleSave = async () => {
        await setTemplateId(selectedId);
        router.back();
    };

    const selectedTemplate = templates[selectedId] || templates.modern;

    return (
        <div style={{ background: '#f3f4f6', minHeight: '100vh', display: 'flex', flexDirection: 'column' }}>
            {/* Header */}
            <div style={{
                background: 'white',
                padding: '16px',
                display: 'flex',
                alignItems: 'center',
                gap: 12,
                borderBottom: '1px solid #e5e7eb',
                position: 'sticky', top: 0, zIndex: 10
            }}>
                <FiArrowLeft size={24} onClick={() => router.back()} style={{ cursor: 'pointer' }} />
                <div style={{ fontWeight: 700, fontSize: 18 }}>Invoice Templates</div>
            </div>

            {/* Preview Area */}
            <div style={{ flex: 1, overflow: 'auto', padding: '20px', display: 'flex', justifyContent: 'center', background: '#f3f4f6' }}>
                <div style={{
                    width: '100%', maxWidth: '400px',
                    boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                    borderRadius: '8px', overflow: 'hidden'
                }}>
                    <img
                        src={selectedTemplate.previewImage}
                        alt="Template Preview"
                        style={{ width: '100%', height: 'auto', display: 'block' }}
                    />
                </div>
            </div>

            {/* Template Selector */}
            {/* Invoice Template Selector */}
            <div style={{
                background: 'white',
                padding: '20px',
                borderTop: '1px solid #e5e7eb',
                zIndex: 10
            }}>
                <div style={{ marginBottom: '16px', fontWeight: 600 }}>Choose Invoice Template</div>
                <div style={{ display: 'flex', gap: '16px', overflowX: 'auto', paddingBottom: '8px', marginBottom: '24px' }}>
                    {Object.values(templates).map((template) => (
                        <div
                            key={template.id}
                            onClick={() => setSelectedId(template.id)}
                            style={{
                                minWidth: '100px',
                                cursor: 'pointer',
                                display: 'flex',
                                flexDirection: 'column',
                                alignItems: 'center',
                                gap: '8px'
                            }}
                        >
                            <div style={{
                                width: '80px',
                                height: '100px',
                                border: selectedId === template.id ? '2px solid #2563eb' : '1px solid #e5e7eb',
                                borderRadius: '8px',
                                background: '#f9fafb',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                position: 'relative',
                                overflow: 'hidden'
                            }}>
                                <img
                                    src={template.thumbnail}
                                    alt={template.name}
                                    style={{ width: '100%', height: '100%', objectFit: 'cover' }}
                                />
                                {selectedId === template.id && (
                                    <div style={{
                                        position: 'absolute', top: 4, right: 4,
                                        background: '#2563eb', borderRadius: '50%',
                                        width: 16, height: 16, display: 'flex', alignItems: 'center', justifyContent: 'center'
                                    }}>
                                        <FiCheck size={10} color="white" />
                                    </div>
                                )}
                            </div>
                            <div style={{ fontSize: '12px', fontWeight: selectedId === template.id ? 600 : 400 }}>
                                {template.name}
                            </div>
                        </div>
                    ))}
                </div>



                <button
                    onClick={handleSave}
                    style={{
                        width: '100%',
                        background: '#2563eb',
                        color: 'white',
                        border: 'none',
                        padding: '14px',
                        borderRadius: '8px',
                        fontWeight: 600,
                        marginTop: '16px'
                    }}
                >
                    Save & Update
                </button>
            </div>
        </div>
    );
}
</file>

<file path="src/app/parties/customer/edit/page.js">
'use client';

import { useState, useEffect } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { usePartyStore } from '@/lib/store/partyStore';
import { FiArrowLeft, FiMoreHorizontal, FiHeadphones, FiPlayCircle, FiPlusCircle, FiCopy, FiChevronDown } from 'react-icons/fi';
import { AddressBottomSheet } from '@/components/AddressBottomSheet';
import AnimatedButton from '@/components/AnimatedButton';
import styles from './page.module.css';

export default function CustomerEditPage() {
    const router = useRouter();
    const searchParams = useSearchParams();
    const id = searchParams.get('id');
    const { getCustomer, updateCustomer } = usePartyStore();

    const [formData, setFormData] = useState({
        name: '',
        phone: '',
        email: '',
        gstin: '',
        companyName: '',
        billingAddress: null,
        shippingAddress: null,
        sameAsBilling: false
    });

    const [isBillingSheetOpen, setIsBillingSheetOpen] = useState(false);
    const [isShippingSheetOpen, setIsShippingSheetOpen] = useState(false);

    useEffect(() => {
        if (id) {
            const customer = getCustomer(id);
            if (customer) {
                setFormData(prev => ({ ...prev, ...customer }));
            }
        }
    }, [id]);

    const handleChange = (e) => {
        const { name, value } = e.target;
        if (name === 'phone') {
            const numericValue = value.replace(/\D/g, '').slice(0, 10);
            setFormData(prev => ({ ...prev, [name]: numericValue }));
        } else {
            setFormData(prev => ({ ...prev, [name]: value }));
        }
    };

    const handleSave = async () => {
        if (!formData.name) {
            alert('Name is required');
            return;
        }
        if (formData.phone && formData.phone.length !== 10) {
            alert('Phone number must be 10 digits');
            return;
        }
        await updateCustomer(parseInt(id), formData);
        router.back();
    };

    const handleAddressSave = (type, addressData) => {
        if (type === 'billing') {
            setFormData(prev => ({
                ...prev,
                billingAddress: addressData,
                shippingAddress: prev.sameAsBilling ? addressData : prev.shippingAddress
            }));
        } else {
            setFormData(prev => ({ ...prev, shippingAddress: addressData }));
        }
    };

    const toggleSameAsBilling = () => {
        setFormData(prev => {
            const newSame = !prev.sameAsBilling;
            return {
                ...prev,
                sameAsBilling: newSame,
                shippingAddress: newSame ? prev.billingAddress : prev.shippingAddress
            };
        });
    };

    return (
        <div className={styles.container}>
            {/* Header */}
            <div className={styles.header}>
                <div style={{ display: 'flex', alignItems: 'center' }}>
                    <FiArrowLeft size={24} onClick={() => router.back()} style={{ cursor: 'pointer' }} />
                    <span className={styles.headerTitle}>Update Customer</span>
                </div>
                <div className={styles.headerActions}>
                    <div className={styles.importAction}>
                        Import <FiChevronDown />
                    </div>
                    <FiMoreHorizontal size={24} />
                </div>
            </div>

            <div className={styles.content}>
                {/* Banner */}


                {/* Basic Details */}
                <div className={styles.section}>
                    <div className={styles.sectionHeader}>
                        <div className={styles.sectionTitle}>Basic Details</div>
                        <FiPlayCircle size={20} color="#dc2626" />
                    </div>

                    <div className={styles.inputGroup}>
                        <input
                            className={styles.input}
                            name="name"
                            value={formData.name}
                            onChange={handleChange}
                            placeholder=" "
                        />
                        <label className={styles.label}>Name <span style={{ color: 'red' }}>*</span></label>
                    </div>

                    <div className={styles.phoneInputContainer} style={{ marginBottom: '16px' }}>
                        <img src="https://flagcdn.com/w40/in.png" alt="IN" className={styles.flag} />
                        <span className={styles.phonePrefix}>IN +91 <FiChevronDown size={12} /></span>
                        <input
                            className={styles.phoneInput}
                            name="phone"
                            value={formData.phone}
                            onChange={handleChange}
                            placeholder="Enter Phone Number"
                        />
                    </div>

                    <div className={styles.inputGroup} style={{ marginBottom: 0 }}>
                        <input
                            className={styles.input}
                            name="email"
                            value={formData.email}
                            onChange={handleChange}
                            placeholder=" "
                        />
                        <label className={styles.label}>Email</label>
                    </div>
                </div>

                {/* Company Details */}
                <div className={styles.section}>
                    <div className={styles.sectionTitle} style={{ marginBottom: '16px' }}>Company Details (Optional)</div>

                    <div style={{ marginBottom: '16px' }}>
                        <div className={styles.gstContainer}>
                            <div style={{ position: 'relative', flex: 1 }}>
                                <input
                                    className={styles.gstInput}
                                    name="gstin"
                                    value={formData.gstin || ''}
                                    onChange={handleChange}
                                    placeholder="GST Number"
                                    style={{ paddingTop: '20px', paddingBottom: '4px' }}
                                />
                                <label style={{ position: 'absolute', left: '12px', top: '4px', fontSize: '10px', color: '#6b7280' }}>GST Number</label>
                            </div>
                        </div>

                    </div>

                    <div>
                        <div className={styles.inputGroup} style={{ marginBottom: '4px' }}>
                            <input
                                className={styles.input}
                                name="companyName"
                                value={formData.companyName || ''}
                                onChange={handleChange}
                                placeholder=" "
                            />
                            <label className={styles.label}>Company Name</label>
                        </div>
                        <div className={styles.helperText}>eg. Tata Motors Private Limited</div>
                    </div>
                </div>

                {/* Billing Address */}
                <div className={styles.section}>
                    <div className={styles.sectionTitle} style={{ marginBottom: '16px' }}>Billing Address (Optional)</div>
                    <button className={styles.addressButton} onClick={() => setIsBillingSheetOpen(true)}>
                        <FiPlusCircle size={18} /> {formData.billingAddress ? 'Edit Billing Address' : 'Billing Address'}
                    </button>
                </div>

                {/* Shipping Address */}
                <div className={styles.section}>
                    <div className={styles.sectionHeader}>
                        <div className={styles.sectionTitle}>Shipping Address (Optional)</div>
                    </div>

                    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', background: '#f9fafb', border: '1px solid #e5e7eb', borderRadius: '8px', padding: '8px 12px' }}>
                        <div
                            style={{ display: 'flex', alignItems: 'center', gap: '8px', fontWeight: 600, color: '#6b7280', cursor: 'pointer', flex: 1 }}
                            onClick={() => setIsShippingSheetOpen(true)}
                        >
                            <FiPlusCircle size={18} /> {formData.shippingAddress ? 'Edit Shipping Address' : 'Shipping Address'}
                        </div>
                        <div className={styles.checkboxContainer} onClick={toggleSameAsBilling}>
                            <span>Same as Billing?</span>
                            <FiCopy size={16} color={formData.sameAsBilling ? '#2563eb' : '#9ca3af'} />
                        </div>
                    </div>
                </div>

                <AnimatedButton className={styles.updateButton} onClick={handleSave}>
                    Update Customer
                </AnimatedButton>
            </div>

            <AddressBottomSheet
                isOpen={isBillingSheetOpen}
                onClose={() => setIsBillingSheetOpen(false)}
                onSave={(data) => handleAddressSave('billing', data)}
                initialData={formData.billingAddress}
                title="Enter Billing Address"
            />

            <AddressBottomSheet
                isOpen={isShippingSheetOpen}
                onClose={() => setIsShippingSheetOpen(false)}
                onSave={(data) => handleAddressSave('shipping', data)}
                initialData={formData.shippingAddress}
                title="Enter Shipping Address"
            />
        </div>
    );
}
</file>

<file path="src/components/BarcodeScanner.js">
'use client';

import { useEffect, useRef, useState, useCallback } from 'react';
import { Html5Qrcode } from 'html5-qrcode';
import { FiX, FiZap, FiZapOff, FiCamera, FiAlertCircle } from 'react-icons/fi';
import styles from './BarcodeScanner.module.css';

// Permission states
const PERMISSION_STATE = {
    CHECKING: 'checking',
    GRANTED: 'granted',
    DENIED: 'denied',
    PROMPT: 'prompt',
    UNSUPPORTED: 'unsupported',
    INSECURE: 'insecure'
};

export default function BarcodeScanner({ isOpen, onScan, onClose, onManualEntry }) {
    const scannerRef = useRef(null);
    const html5QrCodeRef = useRef(null);
    const [isFlashOn, setIsFlashOn] = useState(false);
    const [error, setError] = useState(null);
    const [permissionState, setPermissionState] = useState(PERMISSION_STATE.CHECKING);
    const [manualBarcode, setManualBarcode] = useState('');
    const [showManualInput, setShowManualInput] = useState(false);

    // Check if camera API is available
    const checkCameraSupport = useCallback(async () => {
        // Check HTTPS requirement (camera won't work on insecure origins except localhost)
        const isSecure = window.location.protocol === 'https:' ||
            window.location.hostname === 'localhost' ||
            window.location.hostname === '127.0.0.1';

        if (!isSecure && !window.Capacitor?.isNative) {
            setPermissionState(PERMISSION_STATE.INSECURE);
            setError('Camera requires a secure connection (HTTPS). Please access this page via HTTPS.');
            return false;
        }

        // Check if mediaDevices API is available
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            setPermissionState(PERMISSION_STATE.UNSUPPORTED);
            setError('Camera is not supported on this browser. Please try a different browser or use manual entry.');
            return false;
        }

        // Check camera permission status (if Permissions API is available)
        try {
            if (navigator.permissions && navigator.permissions.query) {
                const result = await navigator.permissions.query({ name: 'camera' });

                if (result.state === 'denied') {
                    setPermissionState(PERMISSION_STATE.DENIED);
                    setError('Camera permission was denied. Please enable camera access in your browser/device settings and try again.');
                    return false;
                } else if (result.state === 'granted') {
                    setPermissionState(PERMISSION_STATE.GRANTED);
                    return true;
                } else {
                    // 'prompt' - need to request permission
                    setPermissionState(PERMISSION_STATE.PROMPT);
                    return true;
                }
            } else {
                // Permissions API not available, try requesting directly
                setPermissionState(PERMISSION_STATE.PROMPT);
                return true;
            }
        } catch (err) {
            // Permissions API might not support 'camera' query, proceed anyway
            console.log('Permission query not supported:', err);
            setPermissionState(PERMISSION_STATE.PROMPT);
            return true;
        }
    }, []);

    // Request camera permission and start scanner
    const requestCameraAndStart = useCallback(async () => {
        try {
            setError(null);
            setPermissionState(PERMISSION_STATE.CHECKING);

            // First validate a stream can be obtained (triggers permission prompt if needed)
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: 'environment' }
            });

            // Stop the test stream immediately
            stream.getTracks().forEach(track => track.stop());

            setPermissionState(PERMISSION_STATE.GRANTED);

            // Wait for the DOM element to be rendered
            let attempts = 0;
            let element = null;
            while (attempts < 50) { // Try for up to 2.5s
                element = document.getElementById('barcode-reader');
                if (element) break;
                await new Promise(resolve => setTimeout(resolve, 50));
                attempts++;
            }

            if (!element) {
                throw new Error("Scanner element could not be initialized (DOM element not found)");
            }

            // Now start the Html5Qrcode scanner
            html5QrCodeRef.current = new Html5Qrcode('barcode-reader');

            await html5QrCodeRef.current.start(
                { facingMode: 'environment' },
                {
                    fps: 10,
                    qrbox: { width: 250, height: 250 },
                    aspectRatio: 1.0
                },
                (decodedText) => {
                    // Successfully scanned
                    stopScanner();
                    onScan(decodedText);
                },
                (errorMessage) => {
                    // Ignore scan errors (no QR found in frame)
                }
            );
        } catch (err) {
            console.error('Camera/Scanner error:', err);

            // Handle specific error types
            if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                setPermissionState(PERMISSION_STATE.DENIED);
                setError('Camera permission denied. Please allow camera access in your browser settings to scan barcodes.');
            } else if (err.name === 'NotFoundError' || err.name === 'DevicesNotFoundError') {
                setPermissionState(PERMISSION_STATE.UNSUPPORTED);
                setError('No camera found on this device. Please use the manual entry option.');
            } else if (err.name === 'NotReadableError' || err.name === 'TrackStartError') {
                setError('Camera is in use by another application. Please close other apps using the camera and try again.');
            } else if (err.name === 'OverconstrainedError') {
                // Try again without facingMode constraint
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    stream.getTracks().forEach(track => track.stop());

                    html5QrCodeRef.current = new Html5Qrcode('barcode-reader');
                    await html5QrCodeRef.current.start(
                        { facingMode: 'user' },
                        { fps: 10, qrbox: { width: 250, height: 250 }, aspectRatio: 1.0 },
                        (decodedText) => { stopScanner(); onScan(decodedText); },
                        () => { }
                    );
                    setPermissionState(PERMISSION_STATE.GRANTED);
                    return;
                } catch (fallbackErr) {
                    setError('Could not access camera with required settings. Please try manual entry.');
                }
            } else {
                setError(`Camera error: ${err.message || 'Unknown error'}. Please try again or use manual entry.`);
            }
        }
    }, [onScan]);

    useEffect(() => {
        if (!isOpen) return;

        const startScanner = async () => {
            // Wait for DOM element to be available
            await new Promise(resolve => requestAnimationFrame(resolve));

            const canProceed = await checkCameraSupport();
            if (canProceed) {
                await requestCameraAndStart();
            }
        };

        startScanner();

        return () => {
            stopScanner();
        };
    }, [isOpen, checkCameraSupport, requestCameraAndStart]);

    const stopScanner = async () => {
        if (html5QrCodeRef.current) {
            try {
                const state = html5QrCodeRef.current.getState();
                // Only stop if actually scanning (state 2 = SCANNING, state 3 = PAUSED)
                if (state === 2 || state === 3) {
                    await html5QrCodeRef.current.stop();
                }
                html5QrCodeRef.current = null;
            } catch (err) {
                // Silently ignore stop errors
                console.warn('Scanner stop warning:', err);
            }
        }
    };

    const handleClose = () => {
        stopScanner();
        onClose();
    };

    const handleRetry = async () => {
        // Clear error first - this triggers re-render to show the reader div
        setError(null);
        setPermissionState(PERMISSION_STATE.CHECKING);

        // Wait for React to re-render
        await new Promise(resolve => setTimeout(resolve, 100));

        const canProceed = await checkCameraSupport();
        if (canProceed) {
            await requestCameraAndStart();
        }
    };

    const toggleFlash = async () => {
        // Flash toggle requires torch capability
        // This may not work on all devices
        setIsFlashOn(!isFlashOn);
    };

    const handleManualSubmit = () => {
        if (manualBarcode.trim()) {
            onScan(manualBarcode.trim());
            setManualBarcode('');
            setShowManualInput(false);
        }
    };

    if (!isOpen) return null;

    return (
        <div className={styles.overlay}>
            {/* Header */}
            <div className={styles.header}>
                <button className={styles.headerBtn} onClick={handleClose}>
                    <FiX size={24} />
                    <span>Close</span>
                </button>
                <button className={styles.headerBtn} onClick={toggleFlash}>
                    {isFlashOn ? <FiZap size={24} /> : <FiZapOff size={24} />}
                    <span>Flash</span>
                </button>
            </div>

            {/* Scanner Area */}
            <div className={styles.scannerContainer}>
                {error ? (
                    <div className={styles.errorContainer}>
                        <FiAlertCircle size={48} color="#ef4444" />
                        <div className={styles.errorMessage}>{error}</div>
                        {permissionState !== PERMISSION_STATE.UNSUPPORTED &&
                            permissionState !== PERMISSION_STATE.INSECURE && (
                                <button className={styles.retryBtn} onClick={handleRetry}>
                                    <FiCamera size={18} />
                                    Try Again
                                </button>
                            )}
                    </div>
                ) : permissionState === PERMISSION_STATE.CHECKING ? (
                    <div className={styles.loadingMessage}>
                        <FiCamera size={48} color="#3b82f6" />
                        <div>Requesting camera access...</div>
                    </div>
                ) : (
                    <>
                        <div id="barcode-reader" className={styles.reader} ref={scannerRef}></div>
                        <div className={styles.scanFrame}>
                            <div className={styles.corner + ' ' + styles.topLeft}></div>
                            <div className={styles.corner + ' ' + styles.topRight}></div>
                            <div className={styles.corner + ' ' + styles.bottomLeft}></div>
                            <div className={styles.corner + ' ' + styles.bottomRight}></div>
                        </div>
                    </>
                )}
            </div>

            {/* Instructions */}
            <div className={styles.instructions}>
                {error ? 'Use manual entry below or fix the issue above' : 'Align the barcode within the frame'}
            </div>

            {/* Manual Entry */}
            {showManualInput ? (
                <div className={styles.manualInputContainer}>
                    <input
                        type="text"
                        className={styles.manualInput}
                        placeholder="Enter barcode..."
                        value={manualBarcode}
                        onChange={(e) => setManualBarcode(e.target.value)}
                        autoFocus
                    />
                    <button className={styles.submitBtn} onClick={handleManualSubmit}>
                        Submit
                    </button>
                </div>
            ) : (
                <button
                    className={styles.manualEntryBtn}
                    onClick={() => setShowManualInput(true)}
                >
                    Enter Barcode Manually
                </button>
            )}
        </div>
    );
}
</file>

<file path="src/components/PurchaseForm.js">
'use client';

import { useRouter, useSearchParams } from 'next/navigation';
import { usePurchaseStore } from '@/lib/store/purchaseStore';
import { usePartyStore } from '@/lib/store/partyStore';
import { useEffect } from 'react';
import { formatCurrency } from '@/lib/utils/tax';
import { FiPlus, FiTrash2, FiCopy, FiCalendar, FiUser, FiBox, FiArrowLeft } from 'react-icons/fi';
import styles from './PurchaseForm.module.css';

export default function PurchaseForm() {
    const router = useRouter();
    const searchParams = useSearchParams();
    const prefillVendorId = searchParams?.get('vendorId');
    const { getVendor } = usePartyStore();

    const {
        id, purchaseNumber, date, dueDate, items, vendor,
        details, payment, roundOff, gstEnabled,
        addItem, updateItem, removeItem, duplicateItem, calculateTotals,
        updateDetails, updatePayment, toggleRoundOff, toggleGst,
        resetPurchase, savePurchase, setVendor, setDate, setDueDate
    } = usePurchaseStore();

    useEffect(() => {
        if (prefillVendorId && !vendor) {
            const v = getVendor(prefillVendorId);
            if (v) setVendor(v);
        }
    }, [prefillVendorId, vendor, getVendor, setVendor]);

    const totals = calculateTotals();

    const handleSave = async () => {
        if (!vendor) return alert('Please select a vendor');
        if (items.length === 0) return alert('Please add at least one item');

        try {
            const savedId = await savePurchase();
            resetPurchase();
            router.push(`/parties/vendor/view?id=${vendor.id}`);
        } catch (error) {
            console.error('Failed to save purchase:', error);
            alert('Failed to save purchase: ' + error.message);
        }
    };

    // Calculate item amount
    const getItemAmount = (item) => {
        const netWeight = Number(item.netWeight) || 0;
        const wastage = Number(item.wastage) || 0;
        const effectiveWeight = netWeight + wastage;
        const ratePerGram = Number(item.ratePerGram) || 0;
        return effectiveWeight * ratePerGram * (item.quantity || 1);
    };

    return (
        <div className={styles.container}>
            {/* Purchase Details Card */}
            <div className={styles.card}>
                <div className={styles.row}>
                    <div>
                        <div className={styles.label}>Purchase #</div>
                        <div className={styles.value}>{purchaseNumber}</div>
                    </div>
                    <div className={styles.value} style={{ color: '#f59e0b' }}>Edit</div>
                </div>
                <div className={styles.row}>
                    <div className={styles.label}>Date</div>
                    <input
                        type="date"
                        className={styles.input}
                        value={date}
                        onChange={(e) => setDate(e.target.value)}
                    />
                </div>
                <div className={styles.row}>
                    <div className={styles.label}>Due Date</div>
                    <input
                        type="date"
                        className={styles.input}
                        value={dueDate}
                        onChange={(e) => setDueDate(e.target.value)}
                    />
                </div>
            </div>

            {/* Vendor Selection */}
            <div className={styles.sectionTitle}>
                Vendor <FiUser size={14} />
            </div>
            <div className={styles.card}>
                {vendor ? (
                    <div className={styles.selectedVendor}>
                        <div className={styles.vendorInfo}>
                            <div className={styles.vendorName}>{vendor.name}</div>
                            {vendor.phone && <div className={styles.vendorPhone}>{vendor.phone}</div>}
                        </div>
                        <div className={styles.vendorActions}>
                            <button
                                className={styles.actionButton}
                                onClick={() => router.push('/purchase/create/select-vendor')}
                            >
                                Change
                            </button>
                        </div>
                    </div>
                ) : (
                    <button
                        className={styles.addButton}
                        onClick={() => router.push('/purchase/create/select-vendor')}
                    >
                        <FiPlus /> Select Vendor
                    </button>
                )}
            </div>

            {/* Items Section */}
            <div className={styles.sectionTitle}>
                Items <FiBox size={14} />
            </div>
            <div className={styles.card}>
                {items.map((item) => (
                    <div key={item.id} className={styles.itemRow}>
                        <div className={styles.itemHeader} style={{ marginBottom: 8, justifyContent: 'space-between', alignItems: 'flex-start' }}>
                            <div style={{ flex: 1 }}>
                                <div style={{ marginBottom: 8 }}>
                                    <label style={{ fontSize: 10, color: '#6b7280', display: 'block', marginBottom: 4 }}>Item Name / Description</label>
                                    <input
                                        className={styles.input}
                                        value={item.name}
                                        onChange={(e) => updateItem(item.id, 'name', e.target.value)}
                                        placeholder="Enter Item Description"
                                    />
                                </div>
                            </div>
                            <div className={styles.itemActions}>
                                <button
                                    className={styles.itemActionBtn}
                                    onClick={() => duplicateItem(item.id)}
                                    title="Duplicate"
                                >
                                    <FiCopy size={16} />
                                </button>
                                <button
                                    className={`${styles.itemActionBtn} ${styles.delete}`}
                                    onClick={() => removeItem(item.id)}
                                    title="Delete"
                                >
                                    <FiTrash2 size={16} />
                                </button>
                            </div>
                        </div>

                        {/* Row 1: Weight Fields */}
                        <div style={{ display: 'flex', gap: 8, marginBottom: 8 }}>
                            <div style={{ flex: 1 }}>
                                <label style={{ fontSize: 10, color: '#6b7280' }}>Net Weight (g)</label>
                                <input
                                    className={styles.input}
                                    type="number"
                                    value={item.netWeight || ''}
                                    onChange={(e) => updateItem(item.id, 'netWeight', e.target.value)}
                                    placeholder="0"
                                />
                            </div>
                            <div style={{ flex: 1 }}>
                                <label style={{ fontSize: 10, color: '#6b7280' }}>Gross Weight (g)</label>
                                <input
                                    className={styles.input}
                                    type="number"
                                    value={item.grossWeight || ''}
                                    onChange={(e) => updateItem(item.id, 'grossWeight', e.target.value)}
                                    placeholder="0"
                                />
                            </div>
                            <div style={{ flex: 1 }}>
                                <label style={{ fontSize: 10, color: '#6b7280' }}>Wastage (g)</label>
                                <input
                                    className={styles.input}
                                    type="number"
                                    value={item.wastage || ''}
                                    onChange={(e) => updateItem(item.id, 'wastage', e.target.value)}
                                    placeholder="0"
                                />
                            </div>
                        </div>

                        {/* Row 2: Rate */}
                        <div style={{ display: 'flex', gap: 8, marginBottom: 8 }}>
                            <div style={{ flex: 1 }}>
                                <label style={{ fontSize: 10, color: '#6b7280' }}>Rate per gram (₹)</label>
                                <input
                                    className={styles.input}
                                    type="number"
                                    value={item.ratePerGram || ''}
                                    onChange={(e) => updateItem(item.id, 'ratePerGram', e.target.value)}
                                    placeholder="Rate"
                                />
                            </div>
                            <div style={{ flex: 1 }}>
                                <label style={{ fontSize: 10, color: '#6b7280' }}>Quantity</label>
                                <input
                                    className={styles.input}
                                    type="number"
                                    value={item.quantity || 1}
                                    onChange={(e) => updateItem(item.id, 'quantity', Number(e.target.value))}
                                    placeholder="1"
                                    min="1"
                                />
                            </div>
                        </div>

                        {/* Row 3: Calculated Amount */}
                        <div style={{ display: 'flex', gap: 8, background: '#fef9c3', padding: 8, borderRadius: 6 }}>
                            <div style={{ flex: 1 }}>
                                <div style={{ fontSize: 10, color: '#6b7280' }}>Eff. Weight</div>
                                <div style={{ fontSize: 12, fontWeight: 500 }}>
                                    {((Number(item.netWeight) || 0) + (Number(item.wastage) || 0)).toFixed(2)}g
                                </div>
                            </div>
                            <div style={{ flex: 1, textAlign: 'right' }}>
                                <div style={{ fontSize: 10, color: '#6b7280' }}>Amount</div>
                                <div style={{ fontSize: 14, fontWeight: 600, color: '#d97706' }}>
                                    {formatCurrency(getItemAmount(item))}
                                </div>
                            </div>
                        </div>
                    </div>
                ))}

                <button
                    className={styles.addButton}
                    onClick={() => addItem()}
                    style={{ background: 'white', border: '1px solid #e5e7eb', color: '#4b5563' }}
                >
                    <FiPlus /> Add Item Row
                </button>
            </div>

            {/* GST Toggle */}
            <div className={styles.sectionTitle}>Tax Settings</div>
            <div className={styles.card}>
                <div className={styles.toggleRow}>
                    <div className={styles.toggleLabel}>Enable GST</div>
                    <div
                        className={`${styles.toggleSwitch} ${gstEnabled ? styles.active : ''}`}
                        onClick={toggleGst}
                    >
                        <div className={styles.toggleKnob} />
                    </div>
                </div>
                {gstEnabled && (
                    <div style={{ fontSize: 12, color: '#6b7280', marginTop: 8 }}>
                        CGST (1.5%) + SGST (1.5%) will be applied
                    </div>
                )}
            </div>

            {/* Optional Fields */}
            <div className={styles.sectionTitle}>Optional</div>
            <div className={styles.card} style={{ padding: 0 }}>
                {[
                    { icon: '📄', label: 'Add Reference', field: 'reference', type: 'text' },
                    { icon: '📝', label: 'Add Notes', field: 'notes', type: 'text' },
                    { icon: '📋', label: 'Add Terms', field: 'terms', type: 'text' },
                ].map((opt, idx) => (
                    <div key={idx} className={styles.optionalRow}>
                        <div className={styles.optionalLabel}>
                            <span style={{ width: 24, textAlign: 'center' }}>{opt.icon}</span>
                            {opt.label}
                        </div>
                        <input
                            type={opt.type}
                            className={styles.optionalInput}
                            placeholder={opt.label}
                            value={details[opt.field]}
                            onChange={(e) => updateDetails(opt.field, e.target.value)}
                        />
                    </div>
                ))}
                <div className={styles.optionalRow} style={{ borderBottom: 'none' }}>
                    <div className={styles.optionalLabel}>
                        <span style={{ width: 24, textAlign: 'center' }}>📎</span>
                        Attachments
                    </div>
                </div>
            </div>

            {/* Payments */}
            <div className={styles.sectionTitle}>Payments</div>
            <div className={styles.card}>
                <div className={styles.checkboxRow}>
                    <input
                        type="checkbox"
                        checked={payment.isFullyPaid}
                        onChange={(e) => {
                            updatePayment('isFullyPaid', e.target.checked);
                            if (e.target.checked) updatePayment('amountPaid', totals.total);
                        }}
                        style={{ width: 18, height: 18 }}
                    />
                    <span style={{ fontWeight: 500 }}>Mark as fully paid</span>
                </div>

                <div className={styles.paymentGrid}>
                    <div>
                        <div className={styles.label}>Amount Paid</div>
                        <div className={styles.inputWrapper}>
                            <span style={{ color: '#6b7280' }}>₹</span>
                            <input
                                type="number"
                                className={styles.paymentInput}
                                value={payment.amountPaid}
                                onChange={(e) => updatePayment('amountPaid', e.target.value)}
                            />
                        </div>
                    </div>
                    <div>
                        <div className={styles.label}>Payment Mode</div>
                        <select
                            className={styles.select}
                            value={payment.mode}
                            onChange={(e) => updatePayment('mode', e.target.value)}
                        >
                            <option>Cash</option>
                            <option>UPI</option>
                            <option>Bank Transfer</option>
                            <option>Cheque</option>
                        </select>
                    </div>
                </div>

                <div style={{ marginTop: 12 }}>
                    <div className={styles.label}>Notes</div>
                    <input
                        className={styles.input}
                        placeholder="Payment notes..."
                        value={payment.notes}
                        onChange={(e) => updatePayment('notes', e.target.value)}
                    />
                </div>
            </div>

            {/* Footer */}
            <div className={styles.footer}>
                <div className={styles.footerLeft}>
                    <div className={styles.footerRow}>
                        <span>Sub Total</span>
                        <span>{formatCurrency(totals.subtotal)}</span>
                    </div>

                    {gstEnabled && (
                        <>
                            <div className={styles.footerRow} style={{ color: '#6b7280', fontSize: 12 }}>
                                <span>CGST (1.5%)</span>
                                <span>{formatCurrency(totals.cgst)}</span>
                            </div>
                            <div className={styles.footerRow} style={{ color: '#6b7280', fontSize: 12 }}>
                                <span>SGST (1.5%)</span>
                                <span>{formatCurrency(totals.sgst)}</span>
                            </div>
                        </>
                    )}

                    <div className={styles.footerRow}>
                        <span>Round Off</span>
                        <div
                            className={`${styles.toggleSwitch} ${roundOff ? styles.active : ''}`}
                            onClick={toggleRoundOff}
                            style={{ width: 36, height: 20 }}
                        >
                            <div className={styles.toggleKnob} style={{ width: 16, height: 16 }} />
                        </div>
                        <span>{totals.roundOffAmount.toFixed(2)}</span>
                    </div>
                    <div className={styles.totalAmount}>
                        <span>Total Amount</span>
                        <span style={{ marginLeft: 16 }}>{formatCurrency(totals.total)}</span>
                    </div>
                </div>
                <button className={styles.createButton} onClick={handleSave}>
                    {id ? 'Update' : 'Create'} <FiArrowLeft style={{ transform: 'rotate(180deg)' }} />
                </button>
            </div>
        </div>
    );
}
</file>

<file path="src/app/bills/page.js">
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import { db } from '@/lib/db';
import { formatCurrency } from '@/lib/utils/tax';
import { FiPlus, FiHeadphones } from 'react-icons/fi';
import styles from './page.module.css';

import ComingSoon from '@/components/ComingSoon';

export default function BillsPage() {
    const [activeTab, setActiveTab] = useState('sales');
    const [invoices, setInvoices] = useState([]);
    const [purchases, setPurchases] = useState([]);

    useEffect(() => {
        const loadData = async () => {
            const inv = await db.invoices.toArray();
            const pur = await db.purchases.toArray();
            setInvoices(inv.reverse());
            setPurchases(pur.reverse());
        };
        loadData();
    }, []);

    const currentList = activeTab === 'sales' ? invoices : purchases;
    const createLink = activeTab === 'sales' ? '/invoice/create' : '/bills/purchase/create';
    const createLabel = activeTab === 'sales' ? 'INVOICE' : 'PURCHASE';

    if (activeTab === 'quotations') {
        return (
            <div className={styles.container}>
                <div className={styles.tabs}>
                    {['Sales', 'Purchases', 'Quotations'].map((tab) => (
                        <div
                            key={tab}
                            className={`${styles.tab} ${activeTab === tab.toLowerCase() ? styles.activeTab : ''}`}
                            onClick={() => setActiveTab(tab.toLowerCase())}
                        >
                            {tab}
                        </div>
                    ))}
                </div>
                <ComingSoon showBackButton={false} />
            </div>
        );
    }

    return (
        <div className={styles.container}>
            <div className={styles.tabs}>
                {['Sales', 'Purchases', 'Quotations'].map((tab) => (
                    <div
                        key={tab}
                        className={`${styles.tab} ${activeTab === tab.toLowerCase() ? styles.activeTab : ''}`}
                        onClick={() => setActiveTab(tab.toLowerCase())}
                    >
                        {tab}
                    </div>
                ))}
            </div>

            <div className={styles.summaryCard}>
                <div>
                    <div className={styles.summaryLabel}>Total Amount</div>
                    <div className={styles.summaryAmount}>₹0.00</div>
                </div>
                <div style={{ textAlign: 'right' }}>
                    <div className={styles.summaryLabel}>Pending</div>
                    <div className={`${styles.summaryAmount} ${styles.pending}`}>₹0.00</div>
                </div>
            </div>

            <div className={styles.filterRow}>
                <div className={`${styles.filterChip} ${styles.activeFilter}`}>All Transactions</div>
                <div className={styles.filterChip}>Paid</div>
                <div className={styles.filterChip}>Pending</div>
                <div className={styles.filterChip}>Cancelled</div>
            </div>

            {currentList.length === 0 ? (
                <div className={styles.emptyState}>
                    <div className={styles.emptySub}>
                        There are no {activeTab} for This Year. Please choose different dates or create a new {activeTab === 'sales' ? 'invoice' : 'purchase'}.
                    </div>
                    <Link href={createLink} className={styles.link}>
                        Create {activeTab === 'sales' ? 'Invoice' : 'Purchase'}
                    </Link>
                </div>
            ) : (
                <div>
                    {currentList.map((item) => (
                        <div key={item.id} className={styles.listItem} onClick={() => {
                            if (activeTab === 'sales') {
                                window.location.href = `/invoice/view?id=${item.id}`;
                            } else {
                                // Placeholder for purchase view
                                alert('Purchase view coming soon');
                            }
                        }}>
                            <div className={styles.itemMain}>
                                <div className={styles.itemTitle}>
                                    {item.invoiceNumber || item.purchaseNumber}
                                    <span style={{ gap: 4, display: 'flex', alignItems: 'center' }}>
                                        {item.type === 'PROFORMA' && (
                                            <span style={{ fontSize: 10, background: '#e0e7ff', color: '#4338ca', padding: '1px 4px', borderRadius: 2 }}>PRO FORMA</span>
                                        )}
                                        {item.type === 'LENDING' && (
                                            <span style={{ fontSize: 10, background: '#f3f4f6', color: '#374151', padding: '1px 4px', borderRadius: 2 }}>LENDING</span>
                                        )}
                                        <span className={styles.status}>{item.status}</span>
                                    </span>
                                </div>
                                <div className={styles.itemSub}>{item.date}</div>
                            </div>
                            <div className={styles.itemAmount}>
                                {formatCurrency(item.totals?.total || 0)}
                            </div>
                        </div>
                    ))}
                </div>
            )}

            <Link href={createLink}>
                <div className={styles.fab}>
                    <FiPlus /> {createLabel}
                </div>
            </Link>
        </div>
    );
}
</file>

<file path="src/app/parties/customer/add/page.js">
'use client';

import { useState } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import Link from 'next/link';
import { usePartyStore } from '@/lib/store/partyStore';
import { useInvoiceStore } from '@/lib/store/invoiceStore';
import { FiArrowLeft, FiPlusCircle, FiUpload, FiX } from 'react-icons/fi';
import styles from '../../form.module.css';

export default function AddCustomerPage() {
    const router = useRouter();
    const { addCustomer } = usePartyStore();
    const [formData, setFormData] = useState({
        name: '',
        phone: '',
        email: '',
        address: '',
        documents: []
    });
    const [showBillingAddress, setShowBillingAddress] = useState(false);

    const handleFileChange = (e) => {
        const files = Array.from(e.target.files);

        files.forEach(file => {
            const reader = new FileReader();
            reader.onloadend = () => {
                setFormData(prev => ({
                    ...prev,
                    documents: [...prev.documents, {
                        name: file.name,
                        type: file.type,
                        data: reader.result
                    }]
                }));
            };
            reader.readAsDataURL(file);
        });
    };

    const removeDocument = (index) => {
        setFormData(prev => ({
            ...prev,
            documents: prev.documents.filter((_, i) => i !== index)
        }));
    };

    const searchParams = useSearchParams();
    const returnUrl = searchParams.get('returnUrl');
    const { setCustomer } = useInvoiceStore();

    const handleSave = async () => {
        if (!formData.name) return alert('Name is required');
        if (formData.phone && formData.phone.length !== 10) return alert('Phone number must be 10 digits');
        const id = await addCustomer(formData);

        if (returnUrl) {
            // If returning to invoice, set the new customer as selected
            if (returnUrl.includes('invoice')) {
                setCustomer({ ...formData, id });
            }
            router.push(returnUrl);
        } else {
            router.push('/parties');
        }
    };

    return (
        <div className={styles.container}>
            <div className={styles.header}>
                <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                    <Link href="/parties"><FiArrowLeft size={24} /></Link>
                    Add Customer
                </div>
            </div>

            <div className={styles.sectionLabel}>Basic Details</div>
            <div className={styles.card}>
                <input
                    className={styles.input}
                    placeholder="Name *"
                    value={formData.name}
                    onChange={e => setFormData({ ...formData, name: e.target.value })}
                    style={{ marginBottom: 12 }}
                />
                <div className={styles.row} style={{ marginBottom: 12 }}>
                    <div style={{ padding: 12, background: '#f9fafb', border: '1px solid #e5e7eb', borderRadius: 8 }}>🇮🇳 +91</div>
                    <input
                        className={styles.input}
                        placeholder="Enter Phone Number"
                        value={formData.phone}
                        onChange={e => {
                            const value = e.target.value.replace(/\D/g, '').slice(0, 10);
                            setFormData({ ...formData, phone: value });
                        }}
                    />
                </div>
                <input
                    className={styles.input}
                    placeholder="Email"
                    value={formData.email}
                    onChange={e => setFormData({ ...formData, email: e.target.value })}
                />
            </div>

            <div className={styles.sectionLabel}>Billing Address (Optional)</div>
            <div className={styles.card}>
                {!showBillingAddress ? (
                    <div className={styles.actionRow} onClick={() => setShowBillingAddress(true)}>
                        <FiPlusCircle size={20} color="#6b7280" />
                        <span>Billing Address</span>
                    </div>
                ) : (
                    <textarea
                        className={styles.textarea}
                        placeholder="Enter Billing Address"
                        value={formData.address}
                        onChange={e => setFormData({ ...formData, address: e.target.value })}
                        autoFocus
                    />
                )}
            </div>

            <div className={styles.sectionLabel}>Documents (Optional)</div>
            <div className={styles.card}>
                <label className={styles.uploadBox}>
                    <input
                        type="file"
                        multiple
                        accept="image/*,application/pdf"
                        style={{ display: 'none' }}
                        onChange={handleFileChange}
                    />
                    <FiUpload className={styles.uploadIcon} />
                    <span className={styles.uploadText}>Upload Identity Documents (Image/PDF)</span>
                </label>

                {formData.documents.length > 0 && (
                    <div className={styles.fileList}>
                        {formData.documents.map((doc, index) => (
                            <div key={index} className={styles.fileItem}>
                                <span>{doc.name}</span>
                                <FiX
                                    style={{ cursor: 'pointer', color: '#ef4444' }}
                                    onClick={() => removeDocument(index)}
                                />
                            </div>
                        ))}
                    </div>
                )}
            </div>

            <div className={styles.footer}>
                <button className={styles.saveButton} onClick={handleSave}>Add Customer</button>
            </div>
        </div>
    );
}
</file>

<file path="src/app/parties/customer/view/page.js">
'use client';

import { db } from '@/lib/db';
import { useState, useEffect, Suspense } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { usePartyStore } from '@/lib/store/partyStore';
import { useInvoiceStore } from '@/lib/store/invoiceStore';
import { shareText, downloadCSV, downloadPDFBlob } from '@/lib/utils/invoiceActions';
import { FiArrowLeft, FiPhone, FiMail, FiShare2, FiMessageCircle, FiEdit2, FiMoreHorizontal, FiFileText, FiFile, FiPlusSquare, FiGitMerge, FiTrash2 } from 'react-icons/fi';
import { motion, AnimatePresence } from 'framer-motion';
import { TransactionCard } from '@/components/TransactionCard';
import { InvoiceBottomSheet } from '@/components/InvoiceBottomSheet';
import jsPDF from 'jspdf';

function CustomerLedgerContent() {
    const router = useRouter();
    const searchParams = useSearchParams();
    const id = searchParams.get('id');
    const { getCustomer } = usePartyStore();
    const { invoices, loadInvoices } = useInvoiceStore();

    const [customer, setCustomer] = useState(null);
    const [transactions, setTransactions] = useState([]);
    const [activeTab, setActiveTab] = useState('ledger');
    const [selectedInvoice, setSelectedInvoice] = useState(null);
    const [isMenuOpen, setIsMenuOpen] = useState(false);
    const { deleteCustomer } = usePartyStore();

    const handleWhatsApp = () => {
        if (customer.phone) {
            // Remove non-numeric characters for the link
            const cleanNumber = customer.phone.replace(/\D/g, '');
            window.open(`https://wa.me/${cleanNumber}`, '_blank');
        } else {
            alert('Phone number not available');
        }
    };

    const handleCall = () => {
        if (customer.phone) {
            window.open(`tel:${customer.phone}`, '_self');
        } else {
            alert('Phone number not available');
        }
    };

    const handleEmail = () => {
        if (customer.email) {
            window.open(`mailto:${customer.email}`, '_self');
        } else {
            alert('Email not available');
        }
    };

    const handleShare = async () => {
        await shareText({
            title: 'Customer Details',
            text: `Customer: ${customer.name}\nPhone: ${customer.phone || 'N/A'}\nBalance: ₹${customer.balance?.toFixed(2) || '0.00'}`,
            dialogTitle: 'Share Customer Details'
        });
    };

    const handleDownloadExcel = async () => {
        const data = transactions.map(tx => ({
            Date: new Date(tx.date).toLocaleDateString(),
            Type: tx.type,
            Number: tx.number,
            Amount: tx.amount,
            Status: tx.status
        }));

        if (!data || !data.length) {
            alert('No transactions to export');
            return;
        }

        // Build CSV content
        const headers = Object.keys(data[0]);
        const csvContent = [
            headers.join(','),
            ...data.map(row => headers.map(fieldName => {
                const value = row[fieldName];
                return typeof value === 'string' && value.includes(',') ? `"${value}"` : value;
            }).join(','))
        ].join('\n');

        await downloadCSV(csvContent, `${customer.name}_ledger.csv`);
        setIsMenuOpen(false);
    };

    const handleDownloadPDF = async () => {
        const doc = new jsPDF();

        // Header
        doc.setFontSize(20);
        doc.text(customer.name, 14, 22);
        doc.setFontSize(12);
        doc.text(`Phone: ${customer.phone || 'N/A'}`, 14, 30);
        doc.text(`Balance: ${customer.balance?.toFixed(2)}`, 14, 38);

        // Table Header
        let y = 50;
        doc.setFontSize(10);
        doc.setTextColor(100);
        doc.text('Date', 14, y);
        doc.text('Type', 60, y);
        doc.text('Number', 100, y);
        doc.text('Amount', 150, y);
        doc.text('Balance', 180, y);

        doc.line(14, y + 2, 200, y + 2);
        y += 10;
        doc.setTextColor(0);

        // Table Rows
        transactions.forEach(tx => {
            if (y > 280) {
                doc.addPage();
                y = 20;
            }

            const date = new Date(tx.date).toLocaleDateString();
            const type = tx.type === 'payment_in' ? 'Payment In' :
                tx.type === 'payment_out' ? 'Payment Out' : 'Invoice';
            const number = tx.number;
            const amount = tx.amount.toFixed(2);
            const balance = tx.balance !== undefined ? tx.balance.toFixed(2) : '-';

            doc.text(date, 14, y);
            doc.text(type, 60, y);
            doc.text(number, 100, y);
            doc.text(amount, 150, y);
            doc.text(balance, 180, y);

            y += 8;
        });

        const pdfBlob = doc.output('blob');
        await downloadPDFBlob(pdfBlob, `${customer.name}_ledger.pdf`);
        setIsMenuOpen(false);
    };

    const handleDeleteCustomer = async () => {
        if (confirm('Are you sure you want to delete this customer? This action cannot be undone.')) {
            await deleteCustomer(customer.id);
            router.push('/parties');
        }
    };

    const menuItemStyle = {
        display: 'flex', alignItems: 'center', gap: '12px', padding: '12px',
        fontSize: '16px', fontWeight: 500, color: '#374151', cursor: 'pointer',
        borderRadius: '8px', transition: 'background 0.2s'
    };

    useEffect(() => {
        if (id) {
            const c = getCustomer(id);
            if (c) setCustomer(c);
            loadInvoices();
        }
    }, [id]);

    useEffect(() => {
        const loadData = async () => {
            if (customer) {
                // Get Invoices and Legacy Payments from 'invoices' table
                const allInvoiceRecords = invoices.filter(inv =>
                    inv.customerId === customer.id || inv.customer?.id === customer.id
                );

                const realInvoices = allInvoiceRecords.filter(inv => !inv.type || inv.type === 'invoice');
                const legacyPayments = allInvoiceRecords.filter(inv => inv.type === 'payment_in' || inv.type === 'payment_out');

                // Get New Payments from 'payments' table
                const newPayments = await db.payments.where('partyId').equals(customer.id).toArray();

                const invoiceTxs = realInvoices.map(inv => ({
                    id: `inv-${inv.id}`,
                    date: inv.date,
                    type: 'invoice',
                    number: inv.invoiceNumber,
                    amount: inv.totals?.total || 0,
                    status: inv.status || 'Unpaid',
                    balance: inv.balanceDue !== undefined ? inv.balanceDue : (inv.totals?.total || 0),
                    data: inv
                }));

                const legacyPaymentTxs = legacyPayments.map(pay => ({
                    id: `inv-${pay.id}`,
                    date: pay.date,
                    type: pay.type, // 'payment_in' or 'payment_out'
                    number: pay.invoiceNumber,
                    amount: pay.totals?.total || 0,
                    status: 'Paid',
                    balance: 0,
                    data: pay
                }));

                const newPaymentTxs = newPayments.map(pay => ({
                    id: `pay-${pay.id}`,
                    date: pay.date,
                    type: pay.type === 'IN' ? 'payment_in' : 'payment_out',
                    number: pay.transactionNumber,
                    amount: pay.amount,
                    status: 'Paid',
                    balance: 0,
                    data: pay
                }));

                const allTxs = [...invoiceTxs, ...legacyPaymentTxs, ...newPaymentTxs];

                // Sort by date descending
                allTxs.sort((a, b) => new Date(b.date) - new Date(a.date));

                setTransactions(allTxs);
            }
        };
        loadData();
    }, [customer, invoices]);

    if (!customer) return <div>Loading...</div>;

    return (
        <div style={{ background: '#f3f4f6', minHeight: '100vh', display: 'flex', flexDirection: 'column' }}>
            {/* Header */}
            <div style={{ background: 'white', padding: '16px', borderBottom: '1px solid #eee' }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '16px' }}>
                    <FiArrowLeft size={24} onClick={() => router.back()} style={{ cursor: 'pointer' }} />
                    <div style={{ display: 'flex', gap: '16px', position: 'relative' }}>
                        <FiMoreHorizontal size={24} onClick={() => setIsMenuOpen(true)} style={{ cursor: 'pointer' }} />
                    </div>
                </div>

                {/* Menu Bottom Sheet */}
                <AnimatePresence>
                    {isMenuOpen && (
                        <>
                            <motion.div
                                initial={{ opacity: 0 }}
                                animate={{ opacity: 1 }}
                                exit={{ opacity: 0 }}
                                onClick={() => setIsMenuOpen(false)}
                                style={{
                                    position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.5)', zIndex: 40
                                }}
                            />
                            <motion.div
                                initial={{ y: '100%' }}
                                animate={{ y: 0 }}
                                exit={{ y: '100%' }}
                                transition={{ type: 'spring', damping: 25, stiffness: 300 }}
                                style={{
                                    position: 'fixed', bottom: 0, left: 0, right: 0,
                                    background: 'white', borderTopLeftRadius: '20px', borderTopRightRadius: '20px',
                                    padding: '20px', zIndex: 50, maxHeight: '80vh', overflowY: 'auto'
                                }}
                            >
                                <div style={{ width: '40px', height: '4px', background: '#e5e7eb', borderRadius: '2px', margin: '0 auto 20px' }} />

                                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                                    <div onClick={() => { setIsMenuOpen(false); router.push(`/parties/customer/edit?id=${customer.id}`); }} style={menuItemStyle}>
                                        <FiEdit2 size={20} /> Edit Customer
                                    </div>
                                    <div style={{ height: '1px', background: '#f3f4f6', margin: '4px 0' }} />

                                    <div onClick={handleDownloadExcel} style={menuItemStyle}>
                                        <FiFileText size={20} /> Download Ledger Excel
                                    </div>
                                    <div onClick={handleDownloadPDF} style={menuItemStyle}>
                                        <FiFile size={20} /> Download Ledger Pdf
                                    </div>
                                    <div style={{ height: '1px', background: '#f3f4f6', margin: '4px 0' }} />

                                    <div onClick={() => { setIsMenuOpen(false); router.push(`/invoice/create?customerId=${customer.id}`); }} style={menuItemStyle}>
                                        <FiPlusSquare size={20} /> Create Invoice
                                    </div>
                                    <div style={{ height: '1px', background: '#f3f4f6', margin: '4px 0' }} />

                                    <div onClick={() => alert('Merge functionality coming soon')} style={menuItemStyle}>
                                        <FiGitMerge size={20} /> Merge
                                    </div>
                                    <div style={{ height: '1px', background: '#f3f4f6', margin: '4px 0' }} />

                                    <div onClick={handleDeleteCustomer} style={{ ...menuItemStyle, color: '#dc2626' }}>
                                        <FiTrash2 size={20} /> Delete Customer
                                    </div>
                                </div>
                            </motion.div>
                        </>
                    )}
                </AnimatePresence>

                <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', marginBottom: '24px' }}>
                    <div style={{
                        width: '64px', height: '64px', borderRadius: '50%', background: '#e0e7ff',
                        color: '#3730a3', display: 'flex', alignItems: 'center', justifyContent: 'center',
                        fontSize: '24px', fontWeight: 'bold', marginBottom: '12px'
                    }}>
                        {customer.name[0]}
                    </div>
                    <div style={{ fontSize: '20px', fontWeight: 'bold', marginBottom: '4px' }}>{customer.name}</div>
                    <div style={{ fontSize: '16px', color: '#dc2626', fontWeight: 600 }}>
                        ₹ {customer.balance?.toFixed(2) || '0.00'}
                    </div>
                </div>

                <div style={{ display: 'flex', justifyContent: 'space-around', paddingBottom: '8px' }}>
                    <div onClick={handleWhatsApp} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px', cursor: 'pointer' }}>
                        <div style={{ padding: '10px', borderRadius: '50%', border: '1px solid #eee' }}><FiMessageCircle size={20} color="#2563eb" /></div>
                        <span style={{ fontSize: '12px', color: '#666' }}>WhatsApp</span>
                    </div>
                    <div onClick={handleCall} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px', cursor: 'pointer' }}>
                        <div style={{ padding: '10px', borderRadius: '50%', border: '1px solid #eee' }}><FiPhone size={20} color="#2563eb" /></div>
                        <span style={{ fontSize: '12px', color: '#666' }}>Call</span>
                    </div>
                    <div onClick={handleEmail} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px', cursor: 'pointer' }}>
                        <div style={{ padding: '10px', borderRadius: '50%', border: '1px solid #eee' }}><FiMail size={20} color="#2563eb" /></div>
                        <span style={{ fontSize: '12px', color: '#666' }}>Mail</span>
                    </div>
                    <div onClick={handleShare} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px', cursor: 'pointer' }}>
                        <div style={{ padding: '10px', borderRadius: '50%', border: '1px solid #eee' }}><FiShare2 size={20} color="#2563eb" /></div>
                        <span style={{ fontSize: '12px', color: '#666' }}>Share</span>
                    </div>
                </div>
            </div>

            {/* Tabs */}
            <div style={{ background: 'white', display: 'flex', borderBottom: '1px solid #eee' }}>
                <div
                    onClick={() => setActiveTab('ledger')}
                    style={{
                        flex: 1, textAlign: 'center', padding: '16px', fontWeight: 600, cursor: 'pointer',
                        color: activeTab === 'ledger' ? '#2563eb' : '#6b7280',
                        borderBottom: activeTab === 'ledger' ? '2px solid #2563eb' : 'none'
                    }}
                >
                    Ledger
                </div>
                <div
                    onClick={() => setActiveTab('transactions')}
                    style={{
                        flex: 1, textAlign: 'center', padding: '16px', fontWeight: 600, cursor: 'pointer',
                        color: activeTab === 'transactions' ? '#2563eb' : '#6b7280',
                        borderBottom: activeTab === 'transactions' ? '2px solid #2563eb' : 'none'
                    }}
                >
                    Transactions
                </div>
            </div>

            {/* List */}
            <div style={{ flex: 1, overflowY: 'auto', paddingBottom: '80px' }}>
                {transactions.length === 0 ? (
                    <div style={{ textAlign: 'center', padding: '40px', color: '#9ca3af' }}>No transactions found</div>
                ) : (
                    transactions.map(tx => (
                        <TransactionCard
                            key={tx.id}
                            transaction={tx}
                            onClick={() => setSelectedInvoice(tx.data)}
                        />
                    ))
                )}
            </div>

            {/* Footer Actions */}
            <div style={{
                position: 'fixed', bottom: 0, left: 0, right: 0, background: 'white', padding: '16px',
                display: 'flex', gap: '16px', boxShadow: '0 -2px 10px rgba(0,0,0,0.05)'
            }}>
                <button
                    onClick={() => router.push(`/parties/payment/create?customerId=${customer.id}&mode=out`)}
                    style={{
                        flex: 1, background: '#dc2626', color: 'white', padding: '16px', borderRadius: '8px',
                        border: 'none', fontWeight: 'bold', fontSize: '16px', cursor: 'pointer'
                    }}>
                    YOU GAVE ₹
                </button>
                <button
                    onClick={() => router.push(`/parties/payment/create?customerId=${customer.id}`)}
                    style={{
                        flex: 1, background: '#16a34a', color: 'white', padding: '16px', borderRadius: '8px',
                        border: 'none', fontWeight: 'bold', fontSize: '16px', cursor: 'pointer'
                    }}>
                    YOU GOT ₹
                </button>
            </div>

            <InvoiceBottomSheet
                isOpen={!!selectedInvoice}
                onClose={() => setSelectedInvoice(null)}
                invoice={selectedInvoice}
                onRecordPayment={() => alert('Record Payment Coming Soon')}
                onShare={() => alert('Share functionality already implemented in Invoice View')}
            />
        </div>
    );
}

export default function CustomerLedgerPage() {
    return (
        <Suspense fallback={<div>Loading...</div>}>
            <CustomerLedgerContent />
        </Suspense>
    );
}
</file>

<file path="src/app/parties/page.js">
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import { useRouter } from 'next/navigation';
import { usePartyStore } from '@/lib/store/partyStore';
import { FiUsers, FiFilter, FiPlus } from 'react-icons/fi';
import { PartyListItem } from '@/components/PartyListItem';
import styles from './page.module.css';

export default function PartiesPage() {
    const router = useRouter();
    const [activeTab, setActiveTab] = useState('customers');
    const { customers, vendors, loadParties } = usePartyStore();

    useEffect(() => {
        loadParties();
    }, []);

    const currentList = activeTab === 'customers' ? customers : vendors;

    // Calculate totals
    const totalCollect = customers.reduce((acc, c) => acc + (c.balance > 0 ? c.balance : 0), 0);
    const totalPay = customers.reduce((acc, c) => acc + (c.balance < 0 ? Math.abs(c.balance) : 0), 0);

    return (
        <div className={styles.container}>
            {/* Sticky Header Container */}
            <div style={{ position: 'sticky', top: 0, zIndex: 10, background: '#f3f4f6' }}>
                {/* Tabs */}
                <div className={styles.tabs}>
                    <div
                        className={`${styles.tab} ${activeTab === 'customers' ? styles.activeTab : ''}`}
                        onClick={() => setActiveTab('customers')}
                    >
                        Customers
                    </div>
                    <div
                        className={`${styles.tab} ${activeTab === 'vendors' ? styles.activeTab : ''}`}
                        onClick={() => setActiveTab('vendors')}
                    >
                        Vendors
                    </div>
                    <div style={{ marginLeft: 'auto', display: 'flex', alignItems: 'center', gap: '16px' }}>
                        <FiUsers size={20} color="#6b7280" />
                        <FiFilter size={20} color="#6b7280" />
                    </div>
                </div>

                {/* Summary Row */}
                <div className={styles.summaryRow}>
                    <div className={`${styles.summaryCard} ${styles.collectCard}`}>
                        <span className={styles.summaryLabel}>You Collect:</span>
                        <span className={styles.summaryAmount} style={{ color: '#16a34a' }}>₹ {totalCollect.toFixed(2)}</span>
                    </div>
                    <div className={`${styles.summaryCard} ${styles.payCard}`}>
                        <span className={styles.summaryLabel}>You Pay:</span>
                        <span className={styles.summaryAmount} style={{ color: '#dc2626' }}>₹ {totalPay.toFixed(2)}</span>
                    </div>
                </div>

                {/* Sort/Filter Row */}
                <div style={{ padding: '0 16px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>
                    <div style={{ fontWeight: 600, color: '#111827', display: 'flex', gap: '16px' }}>
                        <span>Sort</span>
                        <span style={{ fontWeight: 700 }}>Default</span>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '4px', color: '#111827', fontWeight: 600 }}>
                        <FiFilter size={16} /> Filter
                    </div>
                </div>
            </div>

            {currentList.length === 0 ? (
                <div className={styles.emptyState}>
                    <FiUsers className={styles.emptyIcon} />
                    <div className={styles.emptyText}>
                        No {activeTab} to show
                    </div>
                    <Link href={`/parties/${activeTab === 'customers' ? 'customer' : 'vendor'}/add`} style={{ width: '100%' }}>
                        <button className={styles.addButton}>
                            Add {activeTab === 'customers' ? 'Customer' : 'Vendor'}
                        </button>
                    </Link>
                </div>
            ) : (
                <div className={styles.list}>
                    {currentList.map((item) => (
                        <PartyListItem
                            key={item.id}
                            party={item}
                            onClick={() => router.push(`/parties/${activeTab === 'customers' ? 'customer' : 'vendor'}/view?id=${item.id}`)}
                        />
                    ))}
                </div>
            )}

            <Link href={`/parties/${activeTab === 'customers' ? 'customer' : 'vendor'}/add`}>
                <button
                    style={{
                        position: 'fixed',
                        bottom: 90,
                        right: 16,
                        background: 'linear-gradient(90deg, #FBBF24 0%, #F59E0B 100%)',
                        color: 'white',
                        padding: '14px 20px',
                        borderRadius: '50px',
                        border: 'none',
                        boxShadow: '0 10px 25px -5px rgba(245, 194, 66, 0.5)',
                        fontWeight: 700,
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px',
                        zIndex: 40,
                        fontSize: '14px',
                        textTransform: 'uppercase'
                    }}
                >
                    <FiPlus size={20} /> {activeTab === 'customers' ? 'NEW CUSTOMER' : 'NEW VENDOR'}
                </button>
            </Link>
        </div>
    );
}
</file>

<file path="src/app/products/edit/page.js">
'use client';

import { useState, useEffect } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { useProductStore } from '@/lib/store/productStore';
import { useMasterStore } from '@/lib/store/masterStore';
import { db } from '@/lib/db';
import { FiArrowLeft, FiPlusCircle, FiImage, FiMoreHorizontal, FiPlus, FiMinus, FiChevronDown, FiChevronUp, FiLock, FiUnlock } from 'react-icons/fi';
import styles from '../page.module.css'; // Reuse styles

export default function EditProductPage() {
    const router = useRouter();
    const searchParams = useSearchParams();
    const id = searchParams.get('id');
    const { updateProduct } = useProductStore();
    const { categories, loadCategories, subCategories, loadSubCategories } = useMasterStore();
    const [loading, setLoading] = useState(true);
    const [skuLocked, setSkuLocked] = useState(true);

    const [formData, setFormData] = useState({
        type: 'product',
        name: '',
        sellingPrice: '',
        purchasePrice: '',
        taxRate: 3,
        unit: 'gms',
        hsn: '',
        category: '',
        subCategory: '',
        sku: '',
        description: '',

        // Metal Attributes
        metalType: 'Gold',
        metalColor: 'Yellow',
        purity: '22K',
        grossWeight: '',
        netWeight: '',
        wastagePercentage: '',
        wastageWeight: '',
        makingCharges: '',
        makingChargesType: 'per_gram',
        metalRateRef: '',

        // Gemstone Attributes
        hasStones: false,
        stoneType: '',
        stoneCount: '',
        stoneWeight: '',
        stoneShape: '',
        stoneClarity: '',
        stoneColor: '',
        stoneCut: '',
        stoneCertification: '',
        stonePrice: '',
        stoneSetting: '',

        // Design & Dimensions
        size: '',
        pattern: '',
        customizable: false,
        engravingText: '',

        // Pricing & Inventory
        vendorRef: '',
        procurementDate: new Date().toISOString().split('T')[0],

        // Taxation & Compliance
        hallmarkCert: '',
        barcode: '',

        // Optional
        occasion: '',
        collection: '',
        launchDate: '',
        tags: '',

        images: [],
        showOnline: true,
        notForSale: false
    });

    useEffect(() => {
        loadCategories();
        loadSubCategories();
    }, []);

    useEffect(() => {
        const loadProduct = async () => {
            if (!id) return;
            try {
                const product = await db.products.get(Number(id));
                if (product) {
                    setFormData(prev => ({ ...prev, ...product }));
                }
            } catch (error) {
                console.error('Failed to load product', error);
            } finally {
                setLoading(false);
            }
        };
        loadProduct();
    }, [id]);

    const handleSave = async () => {
        if (!formData.name) return alert('Product Name is required');

        if (!skuLocked) {
            try {
                await db.audit_logs.add({
                    entityType: 'product',
                    entityId: Number(id),
                    action: 'MANUAL_SKU_OVERRIDE',
                    details: `SKU updated to ${formData.sku}`,
                    timestamp: new Date()
                });
            } catch (e) {
                console.error("Failed to log audit", e);
            }
        }

        await updateProduct(Number(id), formData);
        router.back();
    };

    const handleImageUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onloadend = () => {
                setFormData(prev => ({
                    ...prev,
                    images: [...prev.images, { name: file.name, data: reader.result }]
                }));
            };
            reader.readAsDataURL(file);
        }
    };

    if (loading) return <div className={styles.container}>Loading...</div>;

    return (
        <div className={styles.container}>
            <div className={styles.header}>
                <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                    <FiArrowLeft size={24} onClick={() => router.back()} style={{ cursor: 'pointer' }} />
                    Edit Product
                </div>
                <FiMoreHorizontal size={24} />
            </div>

            {/* Core Product Metadata */}
            <div className={styles.sectionTitle}>Core Details</div>
            <div className={styles.card}>
                <div className={styles.radioGroup} style={{ marginBottom: 16 }}>
                    <label className={styles.radioLabel}>
                        <input
                            type="radio"
                            checked={formData.type === 'product'}
                            onChange={() => setFormData({ ...formData, type: 'product' })}
                        /> Product
                    </label>
                    <label className={styles.radioLabel}>
                        <input
                            type="radio"
                            checked={formData.type === 'service'}
                            onChange={() => setFormData({ ...formData, type: 'service' })}
                        /> Service
                    </label>
                </div>

                <input
                    className={styles.input}
                    placeholder="Product Name / Title"
                    value={formData.name}
                    onChange={e => setFormData({ ...formData, name: e.target.value })}
                />
                <div style={{ display: 'flex', gap: 12 }}>
                    <select
                        className={styles.select}
                        value={formData.category}
                        onChange={e => setFormData({ ...formData, category: e.target.value, subCategory: '' })}
                        style={{ flex: 1 }}
                    >
                        <option value="">Select Category</option>
                        {categories.map(c => (
                            <option key={c.id} value={c.name}>{c.name}</option>
                        ))}
                    </select>
                    <select
                        className={styles.select}
                        value={formData.subCategory}
                        onChange={e => setFormData({ ...formData, subCategory: e.target.value })}
                        style={{ flex: 1 }}
                        disabled={!formData.category}
                    >
                        <option value="">Select Sub-category</option>
                        {subCategories
                            .filter(sc => {
                                const parent = categories.find(c => c.name === formData.category);
                                return parent && sc.categoryId === parent.id;
                            })
                            .map(sc => (
                                <option key={sc.id} value={sc.name}>{sc.name}</option>
                            ))
                        }
                    </select>
                </div>
            </div>

            <div style={{ position: 'relative' }}>
                <input
                    className={styles.input}
                    placeholder="SKU / Product Code"
                    value={formData.sku}
                    onChange={e => setFormData({ ...formData, sku: e.target.value })}
                    disabled={skuLocked}
                    style={{ paddingRight: 40, backgroundColor: skuLocked ? '#f3f4f6' : 'white' }}
                />
                <div
                    onClick={() => setSkuLocked(!skuLocked)}
                    style={{
                        position: 'absolute', right: 12, top: '50%', transform: 'translateY(-50%)',
                        cursor: 'pointer', color: '#6b7280'
                    }}
                    title={skuLocked ? "Unlock to override" : "Lock to edit"}
                >
                    {skuLocked ? <FiLock /> : <FiUnlock />}
                </div>
            </div>

            <textarea
                className={styles.input}
                placeholder="Description"
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                style={{ resize: 'none', paddingTop: 14, height: 'auto', minHeight: '80px' }}
            />


            {/* Metal-Specific Attributes */}
            <div className={styles.sectionTitle}>Metal Attributes</div>
            <div className={styles.card}>
                <div style={{ display: 'flex', gap: 12 }}>
                    <select
                        className={styles.select}
                        value={formData.metalType}
                        onChange={e => setFormData({ ...formData, metalType: e.target.value })}
                        style={{ flex: 1 }}
                    >
                        <option value="Gold">Gold</option>
                        <option value="Silver">Silver</option>
                        <option value="Platinum">Platinum</option>
                    </select>
                    <select
                        className={styles.select}
                        value={formData.metalColor}
                        onChange={e => setFormData({ ...formData, metalColor: e.target.value })}
                        style={{ flex: 1 }}
                    >
                        <option value="Yellow">Yellow</option>
                        <option value="White">White</option>
                        <option value="Rose">Rose</option>
                        <option value="Two-tone">Two-tone</option>
                    </select>
                </div>
                <div style={{ display: 'flex', gap: 12 }}>
                    <select
                        className={styles.select}
                        value={formData.purity}
                        onChange={e => setFormData({ ...formData, purity: e.target.value })}
                        style={{ flex: 1 }}
                    >
                        <option value="24K">24K (999)</option>
                        <option value="22K">22K (916)</option>
                        <option value="18K">18K (750)</option>
                        <option value="14K">14K (585)</option>
                    </select>
                    <input
                        className={styles.input}
                        type="number"
                        placeholder="Gross Weight (g)"
                        value={formData.grossWeight}
                        onChange={e => setFormData({ ...formData, grossWeight: e.target.value })}
                        style={{ flex: 1 }}
                    />
                </div>
                <div style={{ display: 'flex', gap: 12 }}>
                    <input
                        className={styles.input}
                        type="number"
                        placeholder="Net Metal Weight (g)"
                        value={formData.netWeight}
                        onChange={e => setFormData({ ...formData, netWeight: e.target.value })}
                        style={{ flex: 1 }}
                    />
                    <input
                        className={styles.input}
                        type="number"
                        placeholder="Wastage %"
                        value={formData.wastagePercentage}
                        onChange={e => setFormData({ ...formData, wastagePercentage: e.target.value })}
                        style={{ flex: 1 }}
                    />
                </div>
                <div style={{ display: 'flex', gap: 12 }}>
                    <input
                        className={styles.input}
                        type="number"
                        placeholder="Making Charges"
                        value={formData.makingCharges}
                        onChange={e => setFormData({ ...formData, makingCharges: e.target.value })}
                        style={{ flex: 2 }}
                    />
                    <select
                        className={styles.select}
                        value={formData.makingChargesType}
                        onChange={e => setFormData({ ...formData, makingChargesType: e.target.value })}
                        style={{ flex: 1 }}
                    >
                        <option value="per_gram">Per Gram</option>
                        <option value="fixed">Fixed</option>
                    </select>
                </div>
            </div>

            {/* Gemstone Attributes (Collapsible)*/}
            <div className={styles.card} style={{ padding: 0, overflow: 'hidden' }}>
                <div
                    onClick={() => setFormData({ ...formData, hasStones: !formData.hasStones })}
                    style={{
                        padding: 16, display: 'flex', justifyContent: 'space-between', alignItems: 'center',
                        cursor: 'pointer', background: formData.hasStones ? '#f9fafb' : 'white'
                    }}
                >
                    <div style={{ fontWeight: 600, display: 'flex', alignItems: 'center', gap: 8 }}>
                        Gemstone / Diamond Attributes
                        {formData.hasStones && <span style={{ fontSize: 10, background: '#dcfce7', color: '#166534', padding: '2px 6px', borderRadius: 4 }}>Active</span>}
                    </div>
                    {formData.hasStones ? <FiMinus /> : <FiPlus />}
                </div>

                {formData.hasStones && (
                    <div style={{ padding: 16, borderTop: '1px solid #e5e7eb' }}>
                        <div style={{ display: 'flex', gap: 12 }}>
                            <input
                                className={styles.input}
                                placeholder="Stone Type (e.g. Diamond, Ruby)"
                                value={formData.stoneType}
                                onChange={e => setFormData({ ...formData, stoneType: e.target.value })}
                                style={{ flex: 1 }}
                            />
                            <input
                                className={styles.input}
                                type="number"
                                placeholder="Total Count"
                                value={formData.stoneCount}
                                onChange={e => setFormData({ ...formData, stoneCount: e.target.value })}
                                style={{ flex: 1 }}
                            />
                        </div>
                        <div style={{ display: 'flex', gap: 12 }}>
                            <input
                                className={styles.input}
                                type="number"
                                placeholder="Weight (carats)"
                                value={formData.stoneWeight}
                                onChange={e => setFormData({ ...formData, stoneWeight: e.target.value })}
                                style={{ flex: 1 }}
                            />
                            <input
                                className={styles.input}
                                placeholder="Shape (Round, Oval)"
                                value={formData.stoneShape}
                                onChange={e => setFormData({ ...formData, stoneShape: e.target.value })}
                                style={{ flex: 1 }}
                            />
                        </div>
                        <div style={{ display: 'flex', gap: 12 }}>
                            <input
                                className={styles.input}
                                placeholder="Clarity (SI, VS, VVS)"
                                value={formData.stoneClarity}
                                onChange={e => setFormData({ ...formData, stoneClarity: e.target.value })}
                                style={{ flex: 1 }}
                            />
                            <input
                                className={styles.input}
                                placeholder="Color (D, E, F...)"
                                value={formData.stoneColor}
                                onChange={e => setFormData({ ...formData, stoneColor: e.target.value })}
                                style={{ flex: 1 }}
                            />
                        </div>
                        <input
                            className={styles.input}
                            placeholder="Certification (GIA, IGI...)"
                            value={formData.stoneCertification}
                            onChange={e => setFormData({ ...formData, stoneCertification: e.target.value })}
                        />
                        <input
                            className={styles.input}
                            type="number"
                            placeholder="Stone Price / Charges"
                            value={formData.stonePrice}
                            onChange={e => setFormData({ ...formData, stonePrice: e.target.value })}
                        />
                    </div>
                )}
            </div>

            {/* Design & Dimensions (Collapsible) */}
            <div className={styles.card} style={{ padding: 0, overflow: 'hidden', marginTop: 16 }}>
                <div
                    onClick={() => setFormData(prev => ({ ...prev, showDesign: !prev.showDesign }))}
                    style={{
                        padding: 16, display: 'flex', justifyContent: 'space-between', alignItems: 'center',
                        cursor: 'pointer', background: formData.showDesign ? '#f9fafb' : 'white'
                    }}
                >
                    <div style={{ fontWeight: 600 }}>Design & Dimension Attributes</div>
                    {formData.showDesign ? <FiMinus /> : <FiPlus />}
                </div>

                {formData.showDesign && (
                    <div style={{ padding: 16, borderTop: '1px solid #e5e7eb' }}>
                        <input
                            className={styles.input}
                            placeholder="Size (Ring size, Length)"
                            value={formData.size}
                            onChange={e => setFormData({ ...formData, size: e.target.value })}
                        />
                        <input
                            className={styles.input}
                            placeholder="Pattern / Design Details"
                            value={formData.pattern}
                            onChange={e => setFormData({ ...formData, pattern: e.target.value })}
                        />
                        <input
                            className={styles.input}
                            placeholder="Engraving Text"
                            value={formData.engravingText}
                            onChange={e => setFormData({ ...formData, engravingText: e.target.value })}
                        />
                        <div className={styles.toggleRow} style={{ marginTop: 8 }}>
                            <span className={styles.toggleLabel}>Customizable</span>
                            <input
                                type="checkbox"
                                checked={formData.customizable}
                                onChange={e => setFormData({ ...formData, customizable: e.target.checked })}
                            />
                        </div>
                    </div>
                )}
            </div>

            {/* Pricing & Inventory*/}
            <div className={styles.sectionTitle}>Pricing & Inventory</div>
            <div className={styles.card}>
                <input
                    className={styles.input}
                    type="number"
                    placeholder="Selling Price (Final)"
                    value={formData.sellingPrice}
                    onChange={e => setFormData({ ...formData, sellingPrice: e.target.value })}
                />
                <input
                    className={styles.input}
                    type="number"
                    placeholder="Purchase Price / Cost"
                    value={formData.purchasePrice}
                    onChange={e => setFormData({ ...formData, purchasePrice: e.target.value })}
                />
                <div style={{ display: 'flex', gap: 12 }}>
                    <input
                        className={styles.input}
                        placeholder="Vendor Reference"
                        value={formData.vendorRef}
                        onChange={e => setFormData({ ...formData, vendorRef: e.target.value })}
                        style={{ flex: 1 }}
                    />
                    <input
                        className={styles.input}
                        type="date"
                        placeholder="Procurement Date"
                        value={formData.procurementDate}
                        onChange={e => setFormData({ ...formData, procurementDate: e.target.value })}
                        style={{ flex: 1 }}
                    />
                </div>
            </div>

            {/* Taxation & Compliance*/}
            <div className={styles.sectionTitle}>Taxation & Compliance</div>
            <div className={styles.card}>
                <div style={{ display: 'flex', gap: 12 }}>
                    <input
                        className={styles.input}
                        placeholder="HSN Code"
                        value={formData.hsn}
                        onChange={e => setFormData({ ...formData, hsn: e.target.value })}
                        style={{ flex: 1 }}
                    />
                    <select
                        className={styles.select}
                        value={formData.taxRate}
                        onChange={e => setFormData({ ...formData, taxRate: Number(e.target.value) })}
                        style={{ flex: 1, marginBottom: 12 }}
                    >
                        <option value={0}>Tax Rate 0%</option>
                        <option value={3}>Tax Rate 3%</option>
                        <option value={5}>Tax Rate 5%</option>
                        <option value={12}>Tax Rate 12%</option>
                        <option value={18}>Tax Rate 18%</option>
                    </select>
                </div>
                <input
                    className={styles.input}
                    placeholder="BIS Hallmark Cert Number"
                    value={formData.hallmarkCert}
                    onChange={e => setFormData({ ...formData, hallmarkCert: e.target.value })}
                />
                <input
                    className={styles.input}
                    placeholder="Barcode (Auto-generated if empty)"
                    value={formData.barcode}
                    onChange={e => setFormData({ ...formData, barcode: e.target.value })}
                />
            </div>

            {/* Media & Attachments*/}
            <div className={styles.sectionTitle}>Product Images</div>
            <div className={styles.card}>
                <div style={{ fontSize: 12, color: '#6b7280', marginBottom: 12 }}>
                    Product images must be PNG or JPEG, recommended 1024 px by 1024 px or 1:1 aspect ratio.
                </div>
                <div style={{ display: 'flex', gap: 12, overflowX: 'auto' }}>
                    <label style={{
                        width: 80, height: 80, border: '1px dashed #e5e7eb', borderRadius: 8,
                        display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center',
                        cursor: 'pointer', flexShrink: 0
                    }}>
                        <input type="file" accept="image/*" style={{ display: 'none' }} onChange={handleImageUpload} />
                        <FiImage size={24} color="#3b82f6" />
                        <span style={{ fontSize: 10, fontWeight: 600, marginTop: 4 }}>New<br />Image</span>
                    </label>
                    {formData.images.map((img, idx) => (
                        <img key={idx} src={img.data} alt="" style={{ width: 80, height: 80, borderRadius: 8, objectFit: 'cover', flexShrink: 0 }} />
                    ))}
                </div>
            </div>

            {/* Optional Metadata*/}
            <div className={styles.sectionTitle}>Optional Details</div>
            <div className={styles.card}>
                <input
                    className={styles.input}
                    placeholder="Occasion (Wedding, Daily...)"
                    value={formData.occasion}
                    onChange={e => setFormData({ ...formData, occasion: e.target.value })}
                />
                <input
                    className={styles.input}
                    placeholder="Collection Name"
                    value={formData.collection}
                    onChange={e => setFormData({ ...formData, collection: e.target.value })}
                />
                <input
                    className={styles.input}
                    placeholder="Tags (Comma separated)"
                    value={formData.tags}
                    onChange={e => setFormData({ ...formData, tags: e.target.value })}
                />

                <div className={styles.toggleRow} style={{ marginTop: 12, borderTop: '1px solid #f3f4f6', paddingTop: 12 }}>
                    <span className={styles.toggleLabel}>Show in online store</span>
                    <input
                        type="checkbox"
                        checked={formData.showOnline}
                        onChange={e => setFormData({ ...formData, showOnline: e.target.checked })}
                    />
                </div>
                <div className={styles.toggleRow}>
                    <span className={styles.toggleLabel}>Not For Sale</span>
                    <input
                        type="checkbox"
                        checked={formData.notForSale}
                        onChange={e => setFormData({ ...formData, notForSale: e.target.checked })}
                    />
                </div>
            </div>

            <div className={styles.footer}>
                <button className={styles.saveButton} onClick={handleSave}>Update Product</button>
            </div>
        </div >
    );
}
</file>

<file path="src/app/products/page.module.css">
.container {
    background-color: #f8fafc;
    min-height: 100vh;
    padding-bottom: 80px;
    /* Space for bottom nav */
}

.header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    /* Adjusted for icon on right if needed */
    padding: 16px;
    background: white;
    /* border-bottom: 1px solid #f3f4f6; Removed to blend with search area if needed, but safe to keep */
}

.headerLeft {
    display: flex;
    align-items: center;
    gap: 12px;
}

.headerTitle {
    font-size: 18px;
    font-weight: 600;
    color: #111827;
}

.menuIcon {
    color: #374151;
    cursor: pointer;
}

.headerActions {
    display: flex;
    gap: 16px;
    color: #374151;
}

/* Search Bar */
.searchContainer {
    padding: 0 16px 12px;
    background: white;
    border-bottom: 1px solid #f3f4f6;
}

.searchBar {
    display: flex;
    align-items: center;
    background-color: #f9fafb;
    /* Light grey */
    border: 1px solid #e5e7eb;
    border-radius: 24px;
    /* Pill shape */
    padding: 10px 16px;
    gap: 8px;
}

.searchInput {
    border: none;
    background: transparent;
    outline: none;
    width: 100%;
    font-size: 15px;
    color: #1f2937;
}

.searchInput::placeholder {
    color: #9ca3af;
}

.filterSection {
    background: white;
    z-index: 20;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 12px;
    padding: 16px;
}

@media (min-width: 640px) {
    .grid {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 16px;
    }
}

.emptyState {
    padding: 40px;
    text-align: center;
    color: #6b7280;
    font-size: 14px;
}

/* FAB */
.fab {
    position: fixed;
    bottom: 90px;
    right: 16px;
    background: linear-gradient(90deg, #FBBF24 0%, #F59E0B 100%);
    color: white;
    padding: 14px 20px;
    border-radius: 50px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 700;
    box-shadow: 0 10px 25px -5px rgba(245, 194, 66, 0.5);
    z-index: 100;
    cursor: pointer;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* --- Restored Form Styles for Edit/Add Pages --- */
.sectionTitle {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 8px;
    color: #111827;
    margin-left: 4px;
    margin-top: 24px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.card {
    background: white;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    border: 1px solid #e5e7eb;
}

.input,
.select {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    font-size: 14px;
    outline: none;
    margin-bottom: 12px;
    background: #fff;
    /* White background */
    color: #1f2937;
    transition: all 0.2s;
}

.input:focus,
.select:focus {
    border-color: #2563eb;
    box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
}

.input::placeholder {
    color: #9ca3af;
}

.radioGroup {
    display: flex;
    gap: 24px;
    margin-bottom: 16px;
}

.radioLabel {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 15px;
    font-weight: 500;
    color: #111827;
    cursor: pointer;
}

.radioLabel input {
    width: 18px;
    height: 18px;
    accent-color: #2563eb;
}

.toggleRow {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 0;
}

.toggleLabel {
    font-size: 14px;
    font-weight: 500;
    color: #374151;
}

.footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    padding: 16px;
    border-top: 1px solid #eee;
    z-index: 50;
    padding-bottom: env(safe-area-inset-bottom);
}

.saveButton {
    width: 100%;
    background: #0d6efd;
    color: white;
    padding: 14px;
    border-radius: 12px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    font-size: 16px;
}
</file>

<file path="src/app/page.module.css">
/* Homepage Styles - Golden Theme Redesign */

.container {
  padding: 16px;
  padding-bottom: 100px;
  background-color: var(--background);
  min-height: 100vh;
}

/* Header */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding: 8px 0;
}

.brand {
  font-size: 28px;
  font-weight: 800;
  display: flex;
  align-items: center;
  gap: 8px;
  color: #111827;
  letter-spacing: -0.5px;
}

.headerRight {
  display: flex;
  align-items: center;
  gap: 16px;
}

.notificationBtn {
  color: #6B7280;
  font-size: 24px;
  display: flex;
  align-items: center;
}

.langToggle {
  display: flex;
  align-items: center;
  gap: 4px;
  background: white;
  border-radius: 20px;
  padding: 4px 10px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  border: 1px solid #E5E7EB;
  font-size: 12px;
  font-weight: 500;
  color: #6B7280;
}

/* Business Pulse Card */
.pulseCard {
  background: white;
  border-radius: 24px;
  padding: 20px;
  margin-bottom: 16px;
  box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05);
  position: relative;
  overflow: hidden;
}

.pulseDecoration {
  position: absolute;
  top: 0;
  right: 0;
  width: 120px;
  height: 120px;
  background: linear-gradient(135deg, #DCFCE7 0%, transparent 70%);
  border-radius: 0 0 0 100%;
  opacity: 0.7;
}

.pulseContent {
  position: relative;
  z-index: 1;
}

.pulseLabel {
  font-size: 14px;
  font-weight: 500;
  color: var(--text-secondary);
  margin-bottom: 4px;
}

.pulseAmount {
  font-size: 32px;
  font-weight: 700;
  color: #111827;
  margin-bottom: 4px;
}

.pulseStats {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}

.pulseSubtext {
  font-size: 14px;
  color: var(--text-secondary);
}

.pulseBadge {
  display: inline-flex;
  align-items: center;
  gap: 2px;
  background: #DCFCE7;
  color: var(--success);
  font-size: 12px;
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 4px;
}

.pulseNote {
  font-size: 12px;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: 4px;
}

.pulseChart {
  position: absolute;
  bottom: 16px;
  right: 16px;
  display: flex;
  align-items: flex-end;
  gap: 4px;
  height: 60px;
  opacity: 0.9;
}

.chartBar {
  width: 10px;
  border-radius: 3px 3px 0 0;
}

/* Quick Actions Section */
.actionsSection {
  background: linear-gradient(135deg, #FDE68A 0%, #F5C242 50%, #F59E0B 100%);
  border-radius: 24px;
  padding: 16px;
  margin-bottom: 20px;
  box-shadow: 0 4px 20px -2px rgba(245, 194, 66, 0.3);
}

.primaryActionCard {
  background: white;
  border-radius: 16px;
  padding: 16px;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 16px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  cursor: pointer;
  text-decoration: none;
  color: inherit;
}

.primaryActionCard:active {
  transform: scale(0.98);
}

.primaryIconBox {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  background: #F3F4F6;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  flex-shrink: 0;
}

.primaryIconBox svg {
  color: #4B5563;
}

.starBadge {
  position: absolute;
  bottom: -4px;
  right: -4px;
  width: 16px;
  height: 16px;
  background: #FBBF24;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid white;
}

.primaryActionInfo {
  flex: 1;
}

.primaryActionTitle {
  font-size: 18px;
  font-weight: 700;
  color: #111827;
}

.primaryActionSubtitle {
  font-size: 12px;
  color: var(--text-secondary);
}

.actionChevron {
  color: #D1D5DB;
  font-size: 24px;
}

.quickActionsGrid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
}

.quickActionBtn {
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(8px);
  border-radius: 12px;
  padding: 12px 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
  cursor: pointer;
  text-decoration: none;
  color: inherit;
  border: none;
  font-family: inherit;
}

.quickActionBtn:active {
  background: white;
  transform: scale(0.98);
}

.quickActionBtn svg {
  color: #374151;
  font-size: 18px;
}

.quickActionBtn span {
  font-size: 12px;
  font-weight: 600;
  color: #374151;
}

/* Recent Activity Section */
.activitySection {
  margin-bottom: 20px;
}

.sectionHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  padding: 0 4px;
}

.sectionTitle {
  font-size: 18px;
  font-weight: 700;
  color: #111827;
}

.seeAllLink {
  font-size: 14px;
  font-weight: 500;
  color: var(--primary);
  display: flex;
  align-items: center;
  gap: 2px;
  text-decoration: none;
}

.activityList {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.activityCard {
  background: white;
  border-radius: 16px;
  padding: 16px;
  display: flex;
  align-items: center;
  gap: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
}

.activityAvatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: #F3F4F6;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  flex-shrink: 0;
  overflow: hidden;
}

.activityAvatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.avatarBadge {
  position: absolute;
  bottom: -2px;
  right: -2px;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid white;
}

.avatarBadge.success {
  background: var(--success);
}

.avatarBadge.warning {
  background: var(--primary);
}

.avatarBadge.danger {
  background: #FDBA74;
}

.activityInfo {
  flex: 1;
  min-width: 0;
}

.activityTitle {
  font-size: 14px;
  font-weight: 600;
  color: #111827;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.activitySubtitle {
  font-size: 12px;
  color: var(--text-secondary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.activityRight {
  text-align: right;
  flex-shrink: 0;
}

.activityAmount {
  font-size: 14px;
  font-weight: 700;
  color: #111827;
}

.activityStatus {
  font-size: 11px;
  font-weight: 500;
}

.activityStatus.overdue {
  color: var(--danger);
}

.activityStatus.paid {
  color: var(--success);
}

.activityStatus.risk {
  color: var(--text-secondary);
}

.unpaidCount {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: #FFF7ED;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  font-weight: 700;
  color: #EA580C;
  flex-shrink: 0;
}

/* Streak Card */
.streakCard {
  background: white;
  border-radius: 24px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05);
  position: relative;
  overflow: hidden;
}

.streakContent {
  position: relative;
  z-index: 1;
  width: 65%;
}

.streakTitle {
  font-size: 18px;
  font-weight: 700;
  color: #111827;
  margin-bottom: 8px;
}

.streakSubtitle {
  font-size: 14px;
  font-weight: 600;
  color: #111827;
  margin-bottom: 4px;
}

.streakStats {
  font-size: 12px;
  color: var(--text-secondary);
  margin-bottom: 12px;
}

.streakAmount {
  font-size: 24px;
  font-weight: 700;
  color: #111827;
}

.streakProgress {
  display: flex;
  gap: 6px;
}

.progressBar {
  height: 8px;
  width: 32px;
  border-radius: 4px;
}

.progressBar.filled {
  background: var(--primary);
}

.progressBar.partial {
  background: var(--primary);
  opacity: 0.5;
}

.progressBar.empty {
  background: #E5E7EB;
}

.streakBadge {
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  width: 80px;
  height: 80px;
}

.badgeOuter {
  width: 80px;
  height: 80px;
  background: #FEF3C7;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 3px solid rgba(245, 194, 66, 0.3);
}

.badgeInner {
  width: 56px;
  height: 56px;
  background: var(--primary);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 12px rgba(245, 194, 66, 0.4);
}

.badgeInner svg {
  color: white;
  font-size: 28px;
}

/* Floating Action Button */
.fab {
  position: fixed;
  bottom: 90px;
  right: 16px;
  background: linear-gradient(90deg, #FBBF24 0%, #F59E0B 100%);
  color: white;
  font-weight: 700;
  padding: 14px 20px;
  border-radius: 50px;
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 10px 25px -5px rgba(245, 194, 66, 0.5);
  cursor: pointer;
  text-decoration: none;
  z-index: 40;
  border: none;
  font-family: inherit;
  font-size: 14px;
}

.fab:active {
  transform: scale(0.95);
}

.fab svg {
  font-size: 20px;
}
</file>

<file path="src/components/InvoiceTemplates/Template1.js">
import React from 'react';
import { formatCurrency } from '@/lib/utils/tax';
import { numberToWords } from '@/lib/utils/numberToWords';
import { useSettingsStore } from '@/lib/store/settingsStore';

export const Template1 = ({ data }) => {
    const {
        invoiceNumber, date, dueDate, placeOfSupply, invoiceCopyType,
        items, totals, customer, details, payment
    } = data;
    const companyDetails = data.companyDetails || useSettingsStore.getState().companyDetails;

    // Helper to format address
    const formatAddress = (addr) => {
        if (!addr) return '';
        if (typeof addr === 'string') return addr;
        const parts = [
            addr.addressLine1,
            addr.addressLine2,
            addr.city,
            addr.state ? `${addr.state}${addr.pincode ? ' - ' + addr.pincode : ''}` : addr.pincode
        ].filter(Boolean);
        return parts.join(', ');
    };

    return (
        <div style={{ padding: '40px', background: 'white', width: '800px', fontFamily: 'Inter, sans-serif', color: '#1f2937', fontSize: '12px' }} id="invoice-template">
            {/* Header Section */}
            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '20px' }}>
                <div style={{ flex: 1 }}>
                    {companyDetails.logo && <img src={companyDetails.logo} alt="Logo" style={{ height: '60px', marginBottom: '10px' }} />}
                    <h2 style={{ fontSize: '20px', fontWeight: 800, margin: '0 0 4px 0', color: '#111827' }}>{companyDetails.name}</h2>
                    {data.type !== 'PROFORMA' && <p style={{ margin: 0 }}><strong>GSTIN:</strong> {companyDetails.gstin}</p>}
                    <p style={{ margin: 0, maxWidth: '300px' }}>{formatAddress(companyDetails.billingAddress)}</p>
                    <p style={{ margin: 0 }}><strong>Mobile:</strong> {companyDetails.phone}</p>
                </div>
                <div style={{ textAlign: 'right' }}>
                    <h1 style={{ fontSize: '24px', color: '#2563eb', margin: '0 0 4px 0', fontWeight: 800 }}>
                        {data.type === 'PROFORMA' ? 'PRO FORMA INVOICE' : data.type === 'LENDING' ? 'LENDING BILL' : 'TAX INVOICE'}
                    </h1>
                    <p style={{ fontSize: '10px', textTransform: 'uppercase', color: '#6b7280', margin: 0 }}>{invoiceCopyType}</p>

                    <div style={{ marginTop: '20px', display: 'grid', gridTemplateColumns: 'auto auto', gap: '4px 12px', justifyContent: 'end', textAlign: 'right' }}>
                        <span style={{ fontWeight: 600 }}>{data.type === 'PROFORMA' ? 'Pro Forma #:' : data.type === 'LENDING' ? 'Bill #:' : 'Invoice #:'}</span> <span>{invoiceNumber}</span>
                        <span style={{ fontWeight: 600 }}>Date:</span> <span>{date}</span>
                        {data.type !== 'LENDING' && <><span style={{ fontWeight: 600 }}>Due Date:</span> <span>{dueDate}</span></>}
                        {data.type !== 'PROFORMA' && data.type !== 'LENDING' && <><span style={{ fontWeight: 600 }}>Place of Supply:</span> <span>{placeOfSupply}</span></>}
                    </div>
                </div>
            </div>

            {/* Buyer & Shipping Details */}
            <div style={{ display: 'flex', gap: '40px', marginBottom: '30px', borderTop: '1px solid #e5e7eb', paddingTop: '20px' }}>
                <div style={{ flex: 1 }}>
                    <h3 style={{ fontSize: '14px', fontWeight: 700, margin: '0 0 8px 0', color: '#374151' }}>Bill To:</h3>
                    {customer ? (
                        <>
                            <p style={{ fontWeight: 700, margin: '0 0 2px 0' }}>{customer.name}</p>
                            {data.type !== 'PROFORMA' && <p style={{ margin: '0 0 2px 0' }}><strong>GSTIN:</strong> {customer.gstin}</p>}
                            <p style={{ margin: '0 0 2px 0' }}><strong>Ph:</strong> {customer.phone}</p>
                            <p style={{ margin: 0, maxWidth: '300px' }}>{formatAddress(customer.billingAddress)}</p>
                        </>
                    ) : <p style={{ color: '#9ca3af' }}>No Customer Selected</p>}
                </div>
                <div style={{ flex: 1 }}>
                    <h3 style={{ fontSize: '14px', fontWeight: 700, margin: '0 0 8px 0', color: '#374151' }}>Ship To:</h3>
                    {customer ? (
                        <>
                            <p style={{ fontWeight: 700, margin: '0 0 2px 0' }}>{customer.companyName || customer.name}</p>
                            <p style={{ margin: 0, maxWidth: '300px' }}>{formatAddress(customer.shippingAddress || customer.billingAddress)}</p>
                        </>
                    ) : <p style={{ color: '#9ca3af' }}>Same as Billing</p>}
                </div>
            </div>

            {/* Items Table */}
            <table style={{ width: '100%', borderCollapse: 'collapse', marginBottom: '20px' }}>
                <thead>
                    <tr style={{ background: '#2563eb', color: 'white' }}>
                        <th style={{ padding: '8px', textAlign: 'left', fontSize: '12px' }}>#</th>
                        <th style={{ padding: '8px', textAlign: 'left', fontSize: '12px', width: data.type === 'LENDING' ? '70%' : '40%' }}>Item</th>
                        {data.type !== 'LENDING' && <th style={{ padding: '8px', textAlign: 'center', fontSize: '12px' }}>HSN/SAC</th>}
                        {data.type !== 'LENDING' && <th style={{ padding: '8px', textAlign: 'right', fontSize: '12px' }}>Rate</th>}
                        <th style={{ padding: '8px', textAlign: 'center', fontSize: '12px' }}>Qty</th>
                        {data.type !== 'LENDING' && <th style={{ padding: '8px', textAlign: 'right', fontSize: '12px' }}>Amount</th>}
                    </tr>
                </thead>
                <tbody>
                    {items.map((item, index) => (
                        <React.Fragment key={index}>
                            <tr style={{ borderBottom: (item.netWeight || item.makingChargePerGram) ? 'none' : '1px solid #e5e7eb' }}>
                                <td style={{ padding: '8px' }}>{index + 1}</td>
                                <td style={{ padding: '8px' }}>
                                    <div style={{ fontWeight: 600 }}>{item.name}</div>
                                </td>
                                {data.type !== 'LENDING' && <td style={{ padding: '8px', textAlign: 'center' }}>{item.hsn || '-'}</td>}
                                {data.type !== 'LENDING' && <td style={{ padding: '8px', textAlign: 'right' }}>{formatCurrency(item.rate)}</td>}
                                <td style={{ padding: '8px', textAlign: 'center' }}>{item.quantity}</td>
                                {data.type !== 'LENDING' && <td style={{ padding: '8px', textAlign: 'right', fontWeight: 600 }}>{formatCurrency(item.quantity * item.rate)}</td>}
                            </tr>
                            {/* Jewellery Detail Row */}
                            {(item.netWeight || item.makingChargePerGram) > 0 && (
                                <tr style={{ borderBottom: '1px solid #e5e7eb', fontSize: '10px', color: '#1f2937', background: '#F7F7F7' }}>
                                    <td colSpan={6} style={{ padding: '8px 12px 8px 12px' }}>
                                        <div style={{ display: 'flex', gap: '8px 16px', flexWrap: 'wrap', marginLeft: '32px' }}>
                                            <span><strong>Gross Wt:</strong> {item.grossWeight || 0}g</span>
                                            <span><strong>Net Wt:</strong> {item.netWeight || 0}g</span>
                                            <span><strong>Rate/gm:</strong> {formatCurrency(item.ratePerGram || 0)}</span>
                                            <span><strong>MC/gm:</strong> {formatCurrency(item.makingChargePerGram || 0)}</span>
                                            <span><strong>Mat. Val.:</strong> {formatCurrency(item.materialValue || 0)}</span>
                                            <span><strong>Making Chg:</strong> {formatCurrency(item.makingCharge || 0)}</span>
                                        </div>
                                    </td>
                                </tr>
                            )}
                        </React.Fragment>
                    ))}
                </tbody>
            </table>

            {/* Totals & Tax Summary */}
            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '20px' }}>
                <div style={{ flex: 1 }}>
                    <div style={{ fontSize: '12px', color: '#6b7280', marginBottom: '4px' }}>Total Items / Qty: {items.length} / {items.reduce((acc, item) => acc + (item.quantity || 0), 0)}</div>
                </div>
                {data.type === 'LENDING' ? (
                    <div style={{ width: '350px', background: '#f9fafb', padding: '16px', borderRadius: '8px' }}>
                        <h4 style={{ margin: '0 0 12px 0', borderBottom: '1px solid #e5e7eb', paddingBottom: '8px' }}>Weight Summary</h4>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                            <span>Gross Weight:</span>
                            <strong>{data.weightSummary?.grossWeight || '0'} g</strong>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                            <span>Net Weight:</span>
                            <strong>{data.weightSummary?.netWeight || '0'} g</strong>
                        </div>
                    </div>
                ) : (
                    <div style={{ width: '350px' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', padding: '4px 0', borderBottom: '1px solid #f3f4f6' }}>
                            <span>Taxable Amount</span>
                            <span style={{ fontWeight: 600 }}>{formatCurrency(totals.subtotal)}</span>
                        </div>
                        {/* Conditional Tax Rendering */}
                        {data.type !== 'PROFORMA' && (totals.igst > 0 ? (
                            <div style={{ display: 'flex', justifyContent: 'space-between', padding: '4px 0', borderBottom: '1px solid #f3f4f6' }}>
                                <span>IGST</span>
                                <span>{formatCurrency(totals.igst)}</span>
                            </div>
                        ) : (
                            <>
                                <div style={{ display: 'flex', justifyContent: 'space-between', padding: '4px 0', borderBottom: '1px solid #f3f4f6' }}>
                                    <span>CGST (1.5%)</span>
                                    <span>{formatCurrency(totals.cgst)}</span>
                                </div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', padding: '4px 0', borderBottom: '1px solid #f3f4f6' }}>
                                    <span>SGST (1.5%)</span>
                                    <span>{formatCurrency(totals.sgst)}</span>
                                </div>
                            </>
                        ))}

                        {totals.roundOffAmount !== 0 && (
                            <div style={{ display: 'flex', justifyContent: 'space-between', padding: '4px 0', borderBottom: '1px solid #f3f4f6' }}>
                                <span>Round Off</span>
                                <span>{totals.roundOffAmount.toFixed(2)}</span>
                            </div>
                        )}

                        <div style={{ display: 'flex', justifyContent: 'space-between', padding: '12px 0', borderTop: '2px solid #e5e7eb', marginTop: '8px', fontSize: '16px', fontWeight: 800 }}>
                            <span>Total</span>
                            <span>{formatCurrency(totals.total)}</span>
                        </div>
                    </div>
                )}
            </div>

            {/* Amount in Words - Hide for Lending */}
            {
                data.type !== 'LENDING' && (
                    <div style={{ borderTop: '1px solid #e5e7eb', borderBottom: '1px solid #e5e7eb', padding: '8px 0', marginBottom: '20px', fontStyle: 'italic' }}>
                        <span style={{ fontWeight: 600 }}>Total amount (in words): </span>
                        INR {numberToWords(Math.round(totals.total))} Only.
                    </div>
                )
            }

            {/* Footer: Bank & Signature */}
            <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: '40px' }}>
                <div style={{ width: '50%' }}>
                    {/* Payment / Bank Details */}
                    <h4 style={{ margin: '0 0 8px 0', fontSize: '14px' }}>Bank Details:</h4>
                    <div style={{ fontSize: '12px', lineHeight: '1.6' }}>
                        <div><strong>Bank:</strong> {companyDetails.bankDetails?.bankName || '-'}</div>
                        <div><strong>Account #:</strong> {companyDetails.bankDetails?.accountNumber || '-'}</div>
                        <div><strong>IFSC:</strong> {companyDetails.bankDetails?.ifscCode || '-'}</div>
                        <div><strong>Branch:</strong> {companyDetails.bankDetails?.branchName || '-'}</div>
                    </div>

                    {/* QR Code Placeholder */}
                    {companyDetails.upiId && (
                        <div style={{ marginTop: '12px' }}>
                            <p style={{ margin: '0 0 4px 0', fontWeight: 600 }}>Pay using UPI:</p>
                            <div style={{ width: '80px', height: '80px', background: '#f3f4f6', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '10px' }}>
                                QR CODE
                            </div>
                        </div>
                    )}
                </div>

                <div style={{ textAlign: 'right', display: 'flex', flexDirection: 'column', justifyContent: 'space-between' }}>
                    <div style={{ fontSize: '12px' }}>For {companyDetails.name}</div>
                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'flex-end', marginTop: '40px' }}>
                        {companyDetails.signatureUrl && (
                            <img src={companyDetails.signatureUrl} alt="Signature" style={{ height: '50px', marginBottom: '4px' }} />
                        )}
                        <div style={{ borderTop: '1px solid #374151', width: '150px', paddingTop: '4px', fontSize: '12px', fontWeight: 600 }}>
                            {companyDetails.authorizedSignatoryLabel || 'Authorized Signatory'}
                        </div>
                    </div>
                </div>
            </div>

            {/* Terms & Notes */}
            <div style={{ marginTop: '30px', fontSize: '10px', color: '#4b5563' }}>
                {details.notes && (
                    <div style={{ marginBottom: '10px' }}>
                        <strong>Notes:</strong> {details.notes}
                    </div>
                )}
                {details.terms && (
                    <div>
                        <strong>Terms and Conditions:</strong> {details.terms}
                    </div>
                )}
            </div>

            <div style={{ marginTop: '20px', fontSize: '10px', textAlign: 'center', color: '#9ca3af' }}>
                This is a digitally signed document
            </div>
        </div >
    );
};
</file>

<file path="src/components/InvoiceTemplates/Template2.js">
import React from 'react';
import { formatCurrency } from '@/lib/utils/tax';
import { numberToWords } from '@/lib/utils/numberToWords';
import { useSettingsStore } from '@/lib/store/settingsStore';

export const Template2 = ({ data }) => {
    const {
        invoiceNumber, date, dueDate, placeOfSupply, invoiceCopyType,
        items, totals, customer, details, payment
    } = data;
    const companyDetails = data.companyDetails || useSettingsStore.getState().companyDetails;

    // Helper to format address without trailing commas
    const formatAddress = (addr) => {
        if (!addr) return '';
        if (typeof addr === 'string') return addr;
        const parts = [
            addr.addressLine1,
            addr.addressLine2,
            addr.city,
            addr.state ? `${addr.state}${addr.pincode ? ' - ' + addr.pincode : ''}` : addr.pincode
        ].filter(Boolean);
        return parts.join(', ');
    };

    return (
        <div style={{ padding: '40px', background: 'white', width: '800px', fontFamily: "'Inter', 'Helvetica Neue', Helvetica, Arial, sans-serif", color: '#111827', fontSize: '12px', lineHeight: '1.5' }} id="invoice-template">
            {/* Header Section */}
            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '30px' }}>
                <div style={{ width: '50%' }}>
                    {companyDetails.logo ? (
                        <img src={companyDetails.logo} alt="Logo" style={{ height: '60px', marginBottom: '15px', objectFit: 'contain' }} />
                    ) : (
                        <h2 style={{ fontSize: '24px', fontWeight: 800, color: '#2563eb', margin: '0 0 10px 0' }}>{companyDetails.name}</h2>
                    )}

                    {/* Seller Details - Mimicking Godrej Layout */}
                    {companyDetails.logo && <div style={{ fontWeight: 800, fontSize: '16px', marginBottom: '4px' }}>{companyDetails.name}</div>}
                    <div style={{ fontWeight: 700, marginBottom: '2px' }}>GSTIN {companyDetails.gstin}</div>
                    <div style={{ maxWidth: '300px', color: '#374151' }}>{formatAddress(companyDetails.billingAddress)}</div>
                    {companyDetails.phone && <div>Mobile {companyDetails.phone}</div>}
                </div>

                <div style={{ textAlign: 'right' }}>
                    <h1 style={{ fontSize: '20px', color: '#2563eb', fontWeight: 700, margin: '0 0 2px 0', textTransform: 'uppercase' }}>
                        {data.type === 'PROFORMA' ? 'PRO FORMA INVOICE' : data.type === 'LENDING' ? 'LENDING BILL' : 'TAX INVOICE'}
                    </h1>
                    <div style={{ fontSize: '10px', textTransform: 'uppercase', color: '#6b7280', marginBottom: '20px' }}>{invoiceCopyType || 'ORIGINAL FOR RECIPIENT'}</div>

                    <div style={{ display: 'grid', gridTemplateColumns: 'auto auto', gap: '4px 16px', justifyContent: 'end', textAlign: 'right' }}>
                        <span style={{ color: '#6b7280' }}>{data.type === 'PROFORMA' ? 'Pro Forma #:' : data.type === 'LENDING' ? 'Bill #:' : 'Invoice #:'}</span> <span style={{ fontWeight: 600 }}>{invoiceNumber}</span>
                        <span style={{ color: '#6b7280' }}>Date:</span> <span style={{ fontWeight: 600 }}>{date}</span>
                        {data.type !== 'LENDING' && <><span style={{ color: '#6b7280' }}>Due Date:</span> <span style={{ fontWeight: 600 }}>{dueDate}</span></>}
                        {data.type !== 'PROFORMA' && data.type !== 'LENDING' && <><span style={{ color: '#6b7280' }}>Place of Supply:</span> <span style={{ fontWeight: 600 }}>{placeOfSupply}</span></>}
                    </div>
                </div>
            </div>

            {/* Bill To / Ship To */}
            <div style={{ display: 'flex', gap: '40px', marginBottom: '30px' }}>
                <div style={{ flex: 1 }}>
                    <div style={{ fontSize: '12px', color: '#6b7280', marginBottom: '4px' }}>Bill To:</div>
                    {customer ? (
                        <>
                            <div style={{ fontWeight: 700, fontSize: '14px', marginBottom: '2px' }}>{customer.name}</div>
                            <div style={{ fontWeight: 700, marginBottom: '2px' }}>GSTIN: {customer.gstin}</div>
                            {customer.phone && <div style={{ marginBottom: '2px' }}>Ph: {customer.phone}</div>}
                            <div style={{ maxWidth: '250px', color: '#374151' }}>{formatAddress(customer.billingAddress)}</div>
                        </>
                    ) : <div style={{ color: '#9ca3af' }}>No Customer Selected</div>}
                </div>
                <div style={{ flex: 1 }}>
                    <div style={{ fontSize: '12px', color: '#6b7280', marginBottom: '4px' }}>Ship To:</div>
                    {customer ? (
                        <>
                            <div style={{ maxWidth: '250px', color: '#374151' }}>
                                {formatAddress(customer.shippingAddress || customer.billingAddress)}
                            </div>
                        </>
                    ) : <div style={{ color: '#9ca3af' }}>Same as Billing</div>}
                </div>
            </div>

            {/* Items Table */}
            <table style={{ width: '100%', borderCollapse: 'collapse', marginBottom: '20px' }}>
                <thead>
                    <tr style={{ background: '#2563eb', color: 'white' }}>
                        <th style={{ padding: '10px', textAlign: 'left', fontSize: '12px', fontWeight: 600, width: '40px' }}>#</th>
                        <th style={{ padding: '10px', textAlign: 'left', fontSize: '12px', fontWeight: 600, width: data.type === 'LENDING' ? '70%' : 'auto' }}>Item</th>
                        {data.type !== 'LENDING' && <th style={{ padding: '10px', textAlign: 'center', fontSize: '12px', fontWeight: 600 }}>HSN/SAC</th>}
                        {data.type !== 'LENDING' && <th style={{ padding: '10px', textAlign: 'right', fontSize: '12px', fontWeight: 600 }}>Rate/Item</th>}
                        <th style={{ padding: '10px', textAlign: 'center', fontSize: '12px', fontWeight: 600 }}>Qty</th>
                        {data.type !== 'LENDING' && <th style={{ padding: '10px', textAlign: 'right', fontSize: '12px', fontWeight: 600 }}>Amount</th>}
                    </tr>
                </thead>
                <tbody>
                    {items.map((item, index) => (
                        <React.Fragment key={index}>
                            <tr style={{ borderBottom: (item.netWeight || item.makingChargePerGram) ? 'none' : '1px solid #e5e7eb' }}>
                                <td style={{ padding: '12px 10px', verticalAlign: 'top' }}>{index + 1}</td>
                                <td style={{ padding: '12px 10px', verticalAlign: 'top' }}>
                                    <div style={{ fontWeight: 600, marginBottom: '4px' }}>{item.name}</div>
                                </td>
                                {data.type !== 'LENDING' && <td style={{ padding: '12px 10px', textAlign: 'center', verticalAlign: 'top' }}>{item.hsn || '-'}</td>}
                                {data.type !== 'LENDING' && <td style={{ padding: '12px 10px', textAlign: 'right', verticalAlign: 'top' }}>{formatCurrency(item.rate)}</td>}
                                <td style={{ padding: '12px 10px', textAlign: 'center', verticalAlign: 'top' }}>{item.quantity}</td>
                                {data.type !== 'LENDING' && <td style={{ padding: '12px 10px', textAlign: 'right', verticalAlign: 'top', fontWeight: 600 }}>{formatCurrency(item.quantity * item.rate)}</td>}
                            </tr>
                            {/* Jewellery Detail Row */}
                            {(item.netWeight || item.makingChargePerGram) > 0 && (
                                <tr style={{ borderBottom: '1px solid #e5e7eb', fontSize: '10px', color: '#1f2937', background: '#F7F7F7' }}>
                                    <td colSpan={6} style={{ padding: '8px 12px 8px 12px' }}>
                                        <div style={{ display: 'flex', gap: '8px 16px', flexWrap: 'wrap', marginLeft: '32px' }}>
                                            <span><strong>Gross Wt:</strong> {item.grossWeight || 0}g</span>
                                            <span><strong>Net Wt:</strong> {item.netWeight || 0}g</span>
                                            <span><strong>Rate/gm:</strong> {formatCurrency(item.ratePerGram || 0)}</span>
                                            <span><strong>MC/gm:</strong> {formatCurrency(item.makingChargePerGram || 0)}</span>
                                            <span><strong>Mat. Val.:</strong> {formatCurrency(item.materialValue || 0)}</span>
                                            <span><strong>Making Chg:</strong> {formatCurrency(item.makingCharge || 0)}</span>
                                        </div>
                                    </td>
                                </tr>
                            )}
                        </React.Fragment>
                    ))}
                    {/* Empty rows filler if needed, but keeping it dynamic is better */}
                </tbody>
            </table>

            {/* Footer Section */}
            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '20px' }}>
                <div style={{ flex: 1, paddingRight: '40px' }}>
                    <div style={{ borderTop: '1px solid #e5e7eb', paddingTop: '8px', fontSize: '11px', color: '#6b7280' }}>
                        Total Items / Qty : {items.length} / {items.reduce((acc, item) => acc + (item.quantity || 0), 0)}
                    </div>
                </div>

                {data.type === 'LENDING' ? (
                    <div style={{ width: '350px', background: '#f9fafb', padding: '16px', borderRadius: '8px' }}>
                        <h4 style={{ margin: '0 0 12px 0', borderBottom: '1px solid #e5e7eb', paddingBottom: '8px' }}>Weight Summary</h4>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                            <span>Gross Weight:</span>
                            <strong>{data.weightSummary?.grossWeight || '0'} g</strong>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                            <span>Net Weight:</span>
                            <strong>{data.weightSummary?.netWeight || '0'} g</strong>
                        </div>
                    </div>
                ) : (
                    <div style={{ width: '350px' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', padding: '4px 0', fontSize: '12px' }}>
                            <span style={{ fontWeight: 600 }}>Taxable Amount</span>
                            <span style={{ fontWeight: 600 }}>{formatCurrency(totals.subtotal)}</span>
                        </div>

                        {data.type !== 'PROFORMA' && (totals.igst > 0 ? (
                            <div style={{ display: 'flex', justifyContent: 'space-between', padding: '4px 0', fontSize: '12px' }}>
                                <span>IGST</span>
                                <span>{formatCurrency(totals.igst)}</span>
                            </div>
                        ) : (
                            <>
                                <div style={{ display: 'flex', justifyContent: 'space-between', padding: '4px 0', fontSize: '12px' }}>
                                    <span>CGST (1.5%)</span>
                                    <span>{formatCurrency(totals.cgst)}</span>
                                </div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', padding: '4px 0', fontSize: '12px' }}>
                                    <span>SGST (1.5%)</span>
                                    <span>{formatCurrency(totals.sgst)}</span>
                                </div>
                            </>
                        ))}

                        {totals.roundOffAmount !== 0 && (
                            <div style={{ display: 'flex', justifyContent: 'space-between', padding: '4px 0', fontSize: '12px' }}>
                                <span>Round Off</span>
                                <span>{totals.roundOffAmount.toFixed(2)}</span>
                            </div>
                        )}

                        <div style={{ display: 'flex', justifyContent: 'space-between', padding: '12px 0', borderTop: '1px solid #e5e7eb', borderBottom: '1px solid #e5e7eb', marginTop: '8px', marginBottom: '8px' }}>
                            <span style={{ fontSize: '18px', fontWeight: 800 }}>Total</span>
                            <span style={{ fontSize: '18px', fontWeight: 800 }}>{formatCurrency(totals.total)}</span>
                        </div>

                        <div style={{ fontSize: '11px', color: '#6b7280', textAlign: 'right' }}>
                            Amount Payable: <span style={{ color: '#000', fontWeight: 600 }}>{formatCurrency(totals.total)}</span>
                        </div>
                    </div>
                )}
            </div>

            {/* Amount in Words */}
            {data.type !== 'LENDING' && (
                <div style={{ borderBottom: '1px solid #e5e7eb', paddingBottom: '10px', marginBottom: '20px', fontSize: '12px' }}>
                    <span style={{ color: '#6b7280' }}>Total amount (in words): </span>
                    <span style={{ fontWeight: 600 }}>INR {numberToWords(Math.round(totals.total))} Only.</span>
                </div>
            )}

            {/* Bank & Signature */}
            <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: '20px' }}>
                <div style={{ width: '50%' }}>
                    {/* UPI QR */}
                    <div style={{ display: 'flex', gap: '20px' }}>
                        {companyDetails.upiId && (
                            <div>
                                <div style={{ fontWeight: 600, marginBottom: '4px' }}>Pay using UPI:</div>
                                <div style={{ width: '80px', height: '80px', background: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontSize: '10px' }}>
                                    QR CODE
                                </div>
                            </div>
                        )}

                        <div>
                            <div style={{ fontWeight: 600, marginBottom: '8px' }}>Bank Details:</div>
                            <div style={{ display: 'grid', gridTemplateColumns: 'auto auto', gap: '2px 10px', fontSize: '12px' }}>
                                <span style={{ color: '#6b7280' }}>Bank:</span> <span style={{ fontWeight: 600 }}>{companyDetails.bankDetails?.bankName || '-'}</span>
                                <span style={{ color: '#6b7280' }}>Account #:</span> <span style={{ fontWeight: 600 }}>{companyDetails.bankDetails?.accountNumber || '-'}</span>
                                <span style={{ color: '#6b7280' }}>IFSC:</span> <span style={{ fontWeight: 600 }}>{companyDetails.bankDetails?.ifscCode || '-'}</span>
                                <span style={{ color: '#6b7280' }}>Branch:</span> <span style={{ fontWeight: 600 }}>{companyDetails.bankDetails?.branchName || '-'}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div style={{ textAlign: 'right', display: 'flex', flexDirection: 'column', justifyContent: 'flex-end' }}>
                    <div style={{ fontSize: '11px', color: '#6b7280', marginBottom: '40px' }}>For {companyDetails.name}</div>
                    {companyDetails.signatureUrl && (
                        <img src={companyDetails.signatureUrl} alt="Signature" style={{ height: '50px', alignSelf: 'flex-end', marginBottom: '4px' }} />
                    )}
                    <div style={{ width: '120px', height: '60px', border: '1px dashed #ccc', display: 'flex', alignItems: 'center', justifyContent: 'center', borderRadius: '50%', alignSelf: 'flex-end', color: '#2563eb', fontWeight: 700, fontSize: '10px', transform: 'rotate(-10deg)' }}>
                        {companyDetails.signatureUrl ? '' : 'SIGNATURE'}
                    </div>
                </div>
            </div>

            {/* Terms & Notes */}
            <div style={{ marginTop: '30px', fontSize: '10px', color: '#4b5563' }}>
                {details.notes && (
                    <div style={{ marginBottom: '8px' }}>
                        <div style={{ fontWeight: 700, marginBottom: '2px' }}>Notes:</div>
                        <div>{details.notes}</div>
                    </div>
                )}
                <div style={{ fontWeight: 700, marginBottom: '2px' }}>Terms and Conditions:</div>
                <div style={{ lineHeight: '1.4' }}>
                    {details.terms || '1. Goods once sold cannot be taken back or exchanged.\n2. We are not the manufacturers, company will stand for warranty as per their terms and conditions.\n3. Subject to local Jurisdiction.'}
                </div>
            </div>

            <div style={{ marginTop: '30px', fontSize: '10px', color: '#9ca3af', display: 'flex', justifyContent: 'space-between' }}>
                <span>Page 1/1</span>
                <span>This is a digitally signed document</span>
            </div>
        </div>
    );
};
</file>

<file path="src/components/InvoiceTemplates/Template3.js">
import React from 'react';
import { formatCurrency } from '@/lib/utils/tax';
import { numberToWords } from '@/lib/utils/numberToWords';
import { useSettingsStore } from '@/lib/store/settingsStore';

export const Template3 = ({ data }) => {
    const {
        invoiceNumber, date, dueDate, placeOfSupply, invoiceCopyType,
        items, totals, customer, details, payment
    } = data;
    const companyDetails = data.companyDetails || useSettingsStore.getState().companyDetails;

    const formatAddress = (addr) => {
        if (!addr) return '';
        if (typeof addr === 'string') return addr;
        const parts = [
            addr.addressLine1,
            addr.addressLine2,
            addr.city,
            addr.state ? `${addr.state}${addr.pincode ? ' - ' + addr.pincode : ''}` : addr.pincode
        ].filter(Boolean);
        return parts.join(', ');
    };

    return (
        <div style={{ padding: '40px', background: 'white', width: '800px', fontFamily: 'Georgia, serif', color: '#444', fontSize: '12px' }} id="invoice-template">
            {/* Header */}
            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '40px' }}>
                <div>
                    <h1 style={{ fontSize: '36px', color: '#c2410c', margin: '0 0 10px 0' }}>{data.type === 'PROFORMA' ? 'PRO FORMA' : data.type === 'LENDING' ? 'LENDING BILL' : 'INVOICE'}</h1>
                    <div style={{ fontSize: '14px', color: '#78716c' }}>#{invoiceNumber}</div>
                    <div style={{ fontSize: '12px', color: '#78716c', marginTop: '4px' }}>{invoiceCopyType}</div>
                </div>
                <div style={{ textAlign: 'right' }}>
                    {companyDetails.logo && <img src={companyDetails.logo} alt="Logo" style={{ height: '50px', marginBottom: '10px' }} />}
                    <div style={{ fontWeight: 'bold', fontSize: '16px', color: '#c2410c' }}>{companyDetails.name}</div>
                    <div>{formatAddress(companyDetails.billingAddress)}</div>
                    <div>GSTIN: {companyDetails.gstin}</div>
                </div>
            </div>

            <div style={{ display: 'flex', justifyContent: 'space-between', background: '#fff7ed', padding: '20px', borderRadius: '8px', marginBottom: '30px' }}>
                <div>
                    <h3 style={{ fontSize: '12px', textTransform: 'uppercase', color: '#c2410c', margin: '0 0 8px 0' }}>Billed To</h3>
                    {customer ? (
                        <>
                            <div style={{ fontWeight: 'bold', fontSize: '14px' }}>{customer.name}</div>
                            <div>{formatAddress(customer.billingAddress)}</div>
                            <div>GSTIN: {customer.gstin}</div>
                        </>
                    ) : <div>No Customer</div>}
                </div>
                <div style={{ textAlign: 'right' }}>
                    <h3 style={{ fontSize: '12px', textTransform: 'uppercase', color: '#c2410c', margin: '0 0 8px 0' }}>Invoice Details</h3>
                    <div><strong>Date:</strong> {date}</div>
                    <div><strong>Due Date:</strong> {dueDate}</div>
                    <div><strong>Place of Supply:</strong> {placeOfSupply}</div>
                </div>
            </div>

            {/* Table */}
            <table style={{ width: '100%', borderCollapse: 'collapse', marginBottom: '30px' }}>
                <thead>
                    <tr style={{ borderBottom: '2px solid #c2410c', color: '#c2410c' }}>
                        <th style={{ padding: '10px', textAlign: 'left' }}>Item</th>
                        {data.type !== 'LENDING' && <th style={{ padding: '10px', textAlign: 'center' }}>HSN</th>}
                        {data.type !== 'LENDING' && <th style={{ padding: '10px', textAlign: 'right' }}>Rate</th>}
                        <th style={{ padding: '10px', textAlign: 'center' }}>Qty</th>
                        {data.type !== 'LENDING' && <th style={{ padding: '10px', textAlign: 'right' }}>Amount</th>}
                    </tr>
                </thead>
                <tbody>
                    {items.map((item, index) => (
                        <React.Fragment key={index}>
                            <tr style={{ borderBottom: (item.netWeight || item.makingChargePerGram) ? 'none' : '1px solid #e7e5e4' }}>
                                <td style={{ padding: '10px' }}>
                                    <div style={{ fontWeight: 'bold' }}>{item.name}</div>
                                </td>
                                {data.type !== 'LENDING' && <td style={{ padding: '10px', textAlign: 'center' }}>{item.hsn || '-'}</td>}
                                {data.type !== 'LENDING' && <td style={{ padding: '10px', textAlign: 'right' }}>{formatCurrency(item.rate)}</td>}
                                <td style={{ padding: '10px', textAlign: 'center' }}>{item.quantity}</td>
                                {data.type !== 'LENDING' && <td style={{ padding: '10px', textAlign: 'right' }}>{formatCurrency(item.quantity * item.rate)}</td>}
                            </tr>
                            {/* Jewellery Detail Row */}
                            {(item.netWeight || item.makingChargePerGram) > 0 && (
                                <tr style={{ borderBottom: '1px solid #e7e5e4', fontSize: '10px', color: '#444', background: '#F7F7F7' }}>
                                    <td colSpan={5} style={{ padding: '8px 12px 8px 12px' }}>
                                        <div style={{ display: 'flex', gap: '8px 16px', flexWrap: 'wrap', marginLeft: '24px' }}>
                                            <span><strong>Gross Wt:</strong> {item.grossWeight || 0}g</span>
                                            <span><strong>Net Wt:</strong> {item.netWeight || 0}g</span>
                                            <span><strong>Rate/gm:</strong> {formatCurrency(item.ratePerGram || 0)}</span>
                                            <span><strong>MC/gm:</strong> {formatCurrency(item.makingChargePerGram || 0)}</span>
                                            <span><strong>Mat. Val.:</strong> {formatCurrency(item.materialValue || 0)}</span>
                                            <span><strong>Making Chg:</strong> {formatCurrency(item.makingCharge || 0)}</span>
                                        </div>
                                    </td>
                                </tr>
                            )}
                        </React.Fragment>
                    ))}
                </tbody>
            </table>

            {/* Totals */}
            {data.type === 'LENDING' ? (
                <div style={{ display: 'flex', justifyContent: 'flex-end', marginBottom: '30px' }}>
                    <div style={{ width: '300px', background: '#fff7ed', padding: '10px', borderRadius: '4px' }}>
                        <h4 style={{ margin: '0 0 12px 0', borderBottom: '1px solid #fed7aa', paddingBottom: '8px', color: '#c2410c' }}>Weight Summary</h4>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                            <span>Gross Weight:</span>
                            <strong>{data.weightSummary?.grossWeight || '0'} g</strong>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                            <span>Net Weight:</span>
                            <strong>{data.weightSummary?.netWeight || '0'} g</strong>
                        </div>
                    </div>
                </div>
            ) : (
                <div style={{ display: 'flex', justifyContent: 'flex-end', marginBottom: '30px' }}>
                    <div style={{ width: '300px' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', padding: '5px 0' }}>
                            <span>Subtotal</span>
                            <span>{formatCurrency(totals.subtotal)}</span>
                        </div>
                        {data.type !== 'PROFORMA' && (totals.igst > 0 ? (
                            <div style={{ display: 'flex', justifyContent: 'space-between', padding: '5px 0' }}>
                                <span>IGST</span>
                                <span>{formatCurrency(totals.igst)}</span>
                            </div>
                        ) : (
                            <>
                                <div style={{ display: 'flex', justifyContent: 'space-between', padding: '5px 0' }}>
                                    <span>CGST (1.5%)</span>
                                    <span>{formatCurrency(totals.cgst)}</span>
                                </div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', padding: '5px 0' }}>
                                    <span>SGST (1.5%)</span>
                                    <span>{formatCurrency(totals.sgst)}</span>
                                </div>
                            </>
                        ))}
                        <div style={{ display: 'flex', justifyContent: 'space-between', padding: '10px 0', borderTop: '2px solid #c2410c', marginTop: '10px', color: '#c2410c', fontWeight: 'bold', fontSize: '16px' }}>
                            <span>Total</span>
                            <span>{formatCurrency(totals.total)}</span>
                        </div>
                    </div>
                </div>
            )}

            {data.type !== 'LENDING' && (
                <div style={{ background: '#fff7ed', padding: '10px', borderRadius: '4px', textAlign: 'center', marginBottom: '30px', fontStyle: 'italic' }}>
                    {numberToWords(Math.round(totals.total))} Rupees Only
                </div>
            )}

            {/* Footer */}
            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                <div>
                    <h4 style={{ color: '#c2410c', margin: '0 0 5px 0' }}>Bank Details</h4>
                    <div>{companyDetails.bankDetails?.bankName}</div>
                    <div>{companyDetails.bankDetails?.accountNumber}</div>
                    <div>{companyDetails.bankDetails?.ifscCode}</div>
                </div>
                <div style={{ textAlign: 'right' }}>
                    {companyDetails.signatureUrl && <img src={companyDetails.signatureUrl} alt="Signature" style={{ height: '40px' }} />}
                    <div style={{ borderTop: '1px solid #ccc', paddingTop: '5px', marginTop: '5px' }}>{companyDetails.authorizedSignatoryLabel}</div>
                </div>
            </div>
        </div>
    );
};
</file>

<file path="src/components/BottomNav.js">
'use client';

import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { FiHome, FiBox, FiUsers, FiGrid, FiFileText } from 'react-icons/fi';
import { RiBillLine } from 'react-icons/ri'; // This import will become unused but I'll keep it as per instructions to not make unrelated edits unless explicitly removed.
import clsx from 'clsx';
import styles from './BottomNav.module.css';

const navItems = [
    { label: 'Home', href: '/', icon: FiHome },
    { label: 'Bills', href: '/bills', icon: FiFileText },
    { label: 'Products', href: '/products', icon: FiBox },
    { label: 'Parties', href: '/parties', icon: FiUsers },
    { label: 'More', href: '/more', icon: FiGrid },
];

export default function BottomNav() {
    const pathname = usePathname();

    // Hide BottomNav on specific routes
    if (pathname.includes('/add') || pathname.includes('/create') || pathname.includes('/view') || pathname.includes('/edit')) {
        return null;
    }

    // Hide bottom nav on specific pages if needed (e.g., Create Invoice)
    if (pathname.startsWith('/invoice/create')) return null;

    return (
        <nav className={styles.nav}>
            {navItems.map((item) => {
                const Icon = item.icon;
                const isActive = pathname === item.href;
                return (
                    <Link key={item.label} href={item.href} className={clsx(styles.item, isActive && styles.active)}>
                        <Icon size={24} />
                        <span className={styles.label}>{item.label}</span>
                    </Link>
                );
            })}
        </nav>
    );
}
</file>

<file path="src/lib/store/productStore.js">
import { create } from 'zustand';
import { db } from '@/lib/db';

export const useProductStore = create((set, get) => ({
    products: [],
    isLoading: false,

    loadProducts: async () => {
        set({ isLoading: true });
        try {
            const products = await db.products.toArray();
            set({ products: products.reverse(), isLoading: false });
        } catch (error) {
            console.error('Failed to load products:', error);
            set({ isLoading: false });
        }
    },

    getProductByBarcode: async (barcode) => {
        try {
            const products = await db.products.where('barcode').equals(barcode).toArray();
            return products.length > 0 ? products[0] : null;
        } catch (error) {
            console.error('Failed to lookup product by barcode:', error);
            return null;
        }
    },

    generateSKU: async (category, subCategory) => {
        if (!category || !subCategory) return '';
        try {
            const catPrefix = category.slice(0, 3).toUpperCase();
            const subPrefix = subCategory.slice(0, 3).toUpperCase();

            // Get current sequence
            let seq = await db.sequences.get('product_sku');
            let nextVal = 1;
            if (seq) {
                nextVal = seq.value + 1;
            }

            // Format: CAT-SUB-000001
            const sequenceStr = nextVal.toString().padStart(6, '0');
            return `${catPrefix}-${subPrefix}-${sequenceStr}`;
        } catch (error) {
            console.error("Failed to generate SKU:", error);
            return '';
        }
    },

    incrementSKUSequence: async () => {
        try {
            const seq = await db.sequences.get('product_sku');
            let nextVal = 1;
            if (seq) {
                nextVal = seq.value + 1;
                await db.sequences.update('product_sku', { value: nextVal });
            } else {
                await db.sequences.add({ key: 'product_sku', value: 1 });
            }
        } catch (error) {
            console.error("Failed to increment SKU sequence:", error);
        }
    },

    addProduct: async (product) => {
        try {
            const id = await db.products.add({
                ...product,
                createdAt: new Date()
            });
            await get().incrementSKUSequence(); // Increment sequence after successful add
            set((state) => ({ products: [{ ...product, id }, ...state.products] }));
            return id;
        } catch (error) {
            console.error('Failed to add product:', error);
            throw error;
        }
    },

    deleteProduct: async (id) => {
        try {
            await db.products.delete(id);
            set((state) => ({ products: state.products.filter(p => p.id !== id) }));
        } catch (error) {
            console.error('Failed to delete product:', error);
            throw error;
        }
    },

    updateProduct: async (id, updates) => {
        try {
            await db.products.update(id, updates);
            set((state) => ({
                products: state.products.map(p => p.id === id ? { ...p, ...updates } : p)
            }));
        } catch (error) {
            console.error('Failed to update product:', error);
            throw error;
        }
    }
}));
</file>

<file path="src/lib/store/settingsStore.js">
import { create } from 'zustand';
import { db } from '@/lib/db';

export const useSettingsStore = create((set, get) => ({
    companyDetails: {
        name: '',
        gstin: '',
        phone: '',
        email: '',
        tradeName: '',
        billingAddress: { addressLine1: '', addressLine2: '', pincode: '', city: '', state: '' },
        shippingAddress: { addressLine1: '', addressLine2: '', pincode: '', city: '', state: '' },
        panNumber: '',
        alternatePhone: '',
        website: '',
        customFields: [],
        logo: null,
        bankDetails: {
            bankName: '',
            accountNumber: '',
            ifscCode: '',
            branchName: '',
            accountHolderName: ''
        },
        signatureUrl: null,
        authorizedSignatoryLabel: 'Authorized Signatory',
        upiId: ''
    },
    userProfile: {
        name: '',
        email: '',
        phone: ''
    },
    templateId: 'modern', // Default template
    lendingBillTemplateId: 'modern', // Default Lending Bill template

    loadSettings: async () => {
        const company = await db.settings.get('companyDetails');
        const user = await db.settings.get('userProfile');
        const template = await db.settings.get('templateId');
        const lendingTemplate = await db.settings.get('lendingBillTemplateId');

        if (company) set({ companyDetails: company.value });
        if (user) set({ userProfile: user.value });
        if (template) set({ templateId: template.value });
        if (lendingTemplate) set({ lendingBillTemplateId: lendingTemplate.value });
    },

    updateCompanyDetails: async (details) => {
        const newDetails = { ...get().companyDetails, ...details };
        set({ companyDetails: newDetails });
        await db.settings.put({ key: 'companyDetails', value: newDetails });
    },

    updateUserProfile: async (details) => {
        const newDetails = { ...get().userProfile, ...details };
        set({ userProfile: newDetails });
        await db.settings.put({ key: 'userProfile', value: newDetails });
    },

    setTemplateId: async (id) => {
        set({ templateId: id });
        await db.settings.put({ key: 'templateId', value: id });
    },

    setLendingBillTemplateId: async (id) => {
        set({ lendingBillTemplateId: id });
        await db.settings.put({ key: 'lendingBillTemplateId', value: id });
    },

    resetData: async () => {
        await db.delete();
        await db.open();
        set({
            companyDetails: {
                name: '', gstin: '', phone: '', email: '', address: '', logo: null,
                bankDetails: { bankName: '', accountNumber: '', ifscCode: '', branchName: '', accountHolderName: '' },
                signatureUrl: null, authorizedSignatoryLabel: '', upiId: ''
            },
            userProfile: { name: '', email: '', phone: '' },
            templateId: 'modern',
            lendingBillTemplateId: 'modern'
        });
        window.location.reload();
    }
}));
</file>

<file path="src/app/globals.css">
:root {
  --primary: #F5C242;
  /* Golden Yellow */
  --primary-light: #FFFBEB;
  /* Light Yellow */
  --primary-gradient: linear-gradient(135deg, #FDE68A 0%, #F5C242 50%, #F59E0B 100%);
  /* Yellow Gradient */
  --background: #F7F8FA;
  /* Light Grey Background */
  --foreground: #111827;
  /* Ink Black */
  --card-bg: #FFFFFF;
  /* Surface White */
  --border: #E5E7EB;
  /* Light Grey */
  --text-secondary: #6B7280;
  /* Slate Grey */
  --success: #22C55E;
  /* Green */
  --danger: #EF4444;
  /* Red */
}

body {
  color: var(--foreground);
  background: var(--background);
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  padding-bottom: 60px;
  /* Space for bottom nav */
}

* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

a {
  color: inherit;
  text-decoration: none;
}

button {
  cursor: pointer;
  border: none;
  background: none;
  font-family: inherit;
}

.main-content {
  padding-top: env(safe-area-inset-top);
  min-height: 100vh;
}

.page-transition-container {
  width: 100%;
  overflow-x: hidden;
}
</file>

<file path="src/app/layout.js">
import "./globals.css";
import BottomNav from "@/components/BottomNav";
import BackButtonHandler from "@/components/BackButtonHandler";
import { ToastProvider } from "@/components/Toast";

import AuthWrapper from '@/components/Auth/AuthWrapper';

export const metadata = {
  title: 'Swipe Invoice',
  description: 'Create invoices on the go',
  manifest: '/manifest.json',
};

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body>
        <AuthWrapper>
          <ToastProvider>
            <BackButtonHandler />
            <div className="main-content">
              {children}
            </div>
            <BottomNav />
          </ToastProvider>
        </AuthWrapper>
      </body>
    </html>
  );
}
</file>

<file path="src/lib/store/partyStore.js">
import { create } from 'zustand';
import { db } from '@/lib/db';

export const usePartyStore = create((set, get) => ({
    customers: [],
    vendors: [],

    loadParties: async () => {
        const customers = await db.customers.toArray();
        const vendors = await db.vendors.toArray();
        set({ customers, vendors });
    },

    addCustomer: async (customer) => {
        const id = await db.customers.add(customer);
        set((state) => ({ customers: [...state.customers, { ...customer, id }] }));
        return id;
    },

    addVendor: async (vendor) => {
        const id = await db.vendors.add(vendor);
        set((state) => ({ vendors: [...state.vendors, { ...vendor, id }] }));
        return id;
    },

    updateVendor: async (id, updates) => {
        await db.vendors.update(id, updates);
        set((state) => ({
            vendors: state.vendors.map(v => v.id === id ? { ...v, ...updates } : v)
        }));
    },

    deleteVendor: async (id) => {
        await db.vendors.delete(id);
        set((state) => ({
            vendors: state.vendors.filter(v => v.id !== id)
        }));
    },

    getVendor: (id) => {
        return get().vendors.find(v => v.id === parseInt(id));
    },

    updateCustomer: async (id, updates) => {
        await db.customers.update(id, updates);
        set((state) => ({
            customers: state.customers.map(c => c.id === id ? { ...c, ...updates } : c)
        }));
    },

    deleteCustomer: async (id) => {
        await db.customers.delete(id);
        set((state) => ({
            customers: state.customers.filter(c => c.id !== id)
        }));
    },

    getCustomer: (id) => {
        return get().customers.find(c => c.id === parseInt(id));
    },

    addPayment: async (paymentData) => {
        // paymentData.mode should be 'in' (You Got) or 'out' (You Gave)
        const mode = paymentData.mode || 'in';

        const customer = get().customers.find(c => c.id === paymentData.customerId);
        if (customer) {
            let newBalance = customer.balance || 0;
            if (mode === 'in') {
                newBalance -= paymentData.amount;
            } else {
                newBalance += paymentData.amount;
            }

            // Update customer balance
            await db.customers.update(paymentData.customerId, { balance: newBalance });

            // Create payment record in new table
            await db.payments.add({
                transactionNumber: (mode === 'in' ? 'PAYIN-' : 'PAYOUT-') + Date.now().toString().slice(-4),
                date: paymentData.date,
                type: mode === 'in' ? 'IN' : 'OUT',
                partyType: 'CUSTOMER',
                partyId: paymentData.customerId,
                amount: paymentData.amount,
                mode: paymentData.type || 'CASH', // 'CASH', 'UPI', etc.
                notes: paymentData.notes,
                createdAt: new Date().toISOString()
            });

            // Refresh customers to show new balance
            const customers = await db.customers.toArray();
            set({ customers });
        }
    },

    addVendorPayment: async (paymentData) => {
        // paymentData.mode should be 'in' (You Got from vendor) or 'out' (You Gave to vendor)
        const mode = paymentData.mode || 'out';

        const vendor = get().vendors.find(v => v.id === paymentData.vendorId);
        if (vendor) {
            let newBalance = vendor.balance || 0;
            if (mode === 'out') {
                // You gave money to vendor - reduces what you owe them
                newBalance -= paymentData.amount;
            } else {
                // You got money from vendor (refund, etc.) - increases what you owe them
                newBalance += paymentData.amount;
            }

            // Update vendor balance
            await db.vendors.update(paymentData.vendorId, { balance: newBalance });

            // Create payment record
            await db.payments.add({
                transactionNumber: (mode === 'out' ? 'VPAYOUT-' : 'VPAYIN-') + Date.now().toString().slice(-4),
                date: paymentData.date,
                type: mode === 'out' ? 'OUT' : 'IN',
                partyType: 'VENDOR',
                partyId: paymentData.vendorId,
                amount: paymentData.amount,
                mode: paymentData.type || 'CASH',
                notes: paymentData.notes,
                createdAt: new Date().toISOString()
            });

            // Refresh vendors to show new balance
            const vendors = await db.vendors.toArray();
            set({ vendors });
        }
    }
}));
</file>

<file path="src/app/products/add/page.js">
'use client';

import { useState, useEffect } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { useProductStore } from '@/lib/store/productStore';
import { useMasterStore } from '@/lib/store/masterStore';
import { FiArrowLeft, FiPlusCircle, FiImage, FiMoreHorizontal, FiPlus, FiMinus, FiChevronDown, FiChevronUp, FiLock, FiUnlock, FiRefreshCw } from 'react-icons/fi';
import styles from '../page.module.css';

export default function AddProductPage() {
    const router = useRouter();
    const { addProduct, generateSKU } = useProductStore();
    const { categories, loadCategories, subCategories, loadSubCategories } = useMasterStore();

    const [skuLocked, setSkuLocked] = useState(true);

    useEffect(() => {
        loadCategories();
        loadSubCategories();
    }, []);

    const [formData, setFormData] = useState({
        type: 'product', // product, service
        name: '',
        sellingPrice: '',
        purchasePrice: '',
        taxRate: 3, // Default 3% for jewelry usually
        unit: 'gms', // Default unit
        unit: 'gms', // Default unit
        category: '',
        subCategory: '',
        sku: '',
        description: '',

        // Metal Attributes
        metalType: 'Gold', // Gold, Silver, Platinum
        metalColor: 'Yellow', // Yellow, White, Rose, Two-tone
        purity: '22K', // 24K, 22K, 18K, 14K
        grossWeight: '',
        netWeight: '',
        wastagePercentage: '',
        wastageWeight: '',
        makingCharges: '', // per gram or fixed
        makingChargesType: 'per_gram', // per_gram, fixed
        metalRateRef: '',

        // Gemstone Attributes
        hasStones: false,
        stoneType: '',
        stoneCount: '',
        stoneWeight: '',
        stoneShape: '',
        stoneClarity: '',
        stoneColor: '',
        stoneCut: '',
        stoneCertification: '',
        stonePrice: '',
        stoneSetting: '',

        // Design & Dimensions
        size: '',
        pattern: '',
        customizable: false,
        engravingText: '',

        // Pricing & Inventory
        vendorRef: '',
        procurementDate: new Date().toISOString().split('T')[0],

        // Taxation & Compliance
        hallmarkCert: '',
        barcode: '', // Auto-generated if empty

        // Optional
        launchDate: '',

        images: [],
        showOnline: true,
        notForSale: false
    });

    const searchParams = useSearchParams();
    const returnUrl = searchParams.get('returnUrl');
    const initialBarcode = searchParams.get('barcode');

    // Prefill barcode from URL param (from scanner)
    useEffect(() => {
        if (initialBarcode) {
            setFormData(prev => ({ ...prev, barcode: initialBarcode }));
        }
    }, [initialBarcode]);

    // Auto-generate SKU
    useEffect(() => {
        const gen = async () => {
            if (formData.category && formData.subCategory && skuLocked) {
                const newSku = await generateSKU(formData.category, formData.subCategory);
                setFormData(prev => ({ ...prev, sku: newSku }));
            }
        };
        gen();
    }, [formData.category, formData.subCategory, skuLocked]);

    const handleSave = async () => {
        if (!formData.name) return alert('Product Name is required');

        // Audit Log for Manual SKU
        if (!skuLocked) {
            try {
                await db.audit_logs.add({
                    entityType: 'product',
                    entityId: 0, // ID unknown yet, or we can just log the SKU
                    action: 'MANUAL_SKU_OVERRIDE',
                    details: `SKU set to ${formData.sku}`,
                    timestamp: new Date()
                });
            } catch (e) {
                console.error("Failed to log audit", e);
            }
        }

        await addProduct(formData);
        if (returnUrl) {
            router.push(returnUrl);
        } else {
            router.push('/products');
        }
    };

    const handleImageUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onloadend = () => {
                setFormData(prev => ({
                    ...prev,
                    images: [...prev.images, { name: file.name, data: reader.result }]
                }));
            };
            reader.readAsDataURL(file);
        }
    };

    return (
        <div className={styles.container}>
            <div className={styles.header}>
                <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                    <FiArrowLeft size={24} onClick={() => router.back()} style={{ cursor: 'pointer' }} />
                    Add Product
                </div>
                <FiMoreHorizontal size={24} />
            </div>

            {/* Core Product Metadata */}
            <div className={styles.sectionTitle}>Core Details</div>
            <div className={styles.card}>
                <div className={styles.radioGroup} style={{ marginBottom: 16 }}>
                    <label className={styles.radioLabel}>
                        <input
                            type="radio"
                            checked={formData.type === 'product'}
                            onChange={() => setFormData({ ...formData, type: 'product' })}
                        /> Product
                    </label>
                    <label className={styles.radioLabel}>
                        <input
                            type="radio"
                            checked={formData.type === 'service'}
                            onChange={() => setFormData({ ...formData, type: 'service' })}
                        /> Service
                    </label>
                </div>

                <input
                    className={styles.input}
                    placeholder="Product Name / Title"
                    value={formData.name}
                    onChange={e => setFormData({ ...formData, name: e.target.value })}
                />
                <div style={{ display: 'flex', gap: 12 }}>
                    <select
                        className={styles.select}
                        value={formData.category}
                        onChange={e => setFormData({ ...formData, category: e.target.value, subCategory: '' })}
                        style={{ flex: 1 }}
                    >
                        <option value="">Select Category</option>
                        {categories.map(c => (
                            <option key={c.id} value={c.name}>{c.name}</option>
                        ))}
                    </select>
                    <select
                        className={styles.select}
                        value={formData.subCategory}
                        onChange={e => setFormData({ ...formData, subCategory: e.target.value })}
                        style={{ flex: 1 }}
                        disabled={!formData.category}
                    >
                        <option value="">Select Sub-category</option>
                        {subCategories
                            .filter(sc => {
                                const parent = categories.find(c => c.name === formData.category);
                                return parent && sc.categoryId === parent.id;
                            })
                            .map(sc => (
                                <option key={sc.id} value={sc.name}>{sc.name}</option>
                            ))
                        }
                    </select>
                </div>
                <div style={{ position: 'relative' }}>
                    <input
                        className={styles.input}
                        placeholder="SKU / Product Code"
                        value={formData.sku}
                        onChange={e => setFormData({ ...formData, sku: e.target.value })}
                        disabled={skuLocked}
                        style={{ paddingRight: 40, backgroundColor: skuLocked ? '#f3f4f6' : 'white' }}
                    />
                    <div
                        onClick={() => setSkuLocked(!skuLocked)}
                        style={{
                            position: 'absolute', right: 12, top: '50%', transform: 'translateY(-50%)',
                            cursor: 'pointer', color: '#6b7280'
                        }}
                        title={skuLocked ? "Unlock to override" : "Lock to auto-generate"}
                    >
                        {skuLocked ? <FiLock /> : <FiUnlock />}
                    </div>
                </div>

                <textarea
                    className={styles.input}
                    placeholder="Description"
                    value={formData.description}
                    onChange={e => setFormData({ ...formData, description: e.target.value })}
                    rows={3}
                    style={{ resize: 'none', paddingTop: 14, height: 'auto', minHeight: '80px' }}
                />
            </div>

            {/* Metal-Specific Attributes */}
            <div className={styles.sectionTitle}>Metal Attributes</div>
            <div className={styles.card}>
                <div style={{ display: 'flex', gap: 12 }}>
                    <select
                        className={styles.select}
                        value={formData.metalType}
                        onChange={e => setFormData({ ...formData, metalType: e.target.value })}
                        style={{ flex: 1 }}
                    >
                        <option value="Gold">Gold</option>
                        <option value="Silver">Silver</option>
                        <option value="Platinum">Platinum</option>
                    </select>
                    <select
                        className={styles.select}
                        value={formData.metalColor}
                        onChange={e => setFormData({ ...formData, metalColor: e.target.value })}
                        style={{ flex: 1 }}
                    >
                        <option value="Yellow">Yellow</option>
                        <option value="White">White</option>
                        <option value="Rose">Rose</option>
                        <option value="Two-tone">Two-tone</option>
                    </select>
                </div>
                <div style={{ display: 'flex', gap: 12 }}>
                    <select
                        className={styles.select}
                        value={formData.purity}
                        onChange={e => setFormData({ ...formData, purity: e.target.value })}
                        style={{ flex: 1 }}
                    >
                        <option value="24K">24K (999)</option>
                        <option value="22K">22K (916)</option>
                        <option value="18K">18K (750)</option>
                        <option value="14K">14K (585)</option>
                    </select>
                    <input
                        className={styles.input}
                        type="number"
                        placeholder="Gross Weight (g)"
                        value={formData.grossWeight}
                        onChange={e => setFormData({ ...formData, grossWeight: e.target.value })}
                        style={{ flex: 1 }}
                    />
                </div>
                <div style={{ display: 'flex', gap: 12 }}>
                    <input
                        className={styles.input}
                        type="number"
                        placeholder="Net Metal Weight (g)"
                        value={formData.netWeight}
                        onChange={e => setFormData({ ...formData, netWeight: e.target.value })}
                        style={{ flex: 1 }}
                    />
                    <input
                        className={styles.input}
                        type="number"
                        placeholder="Wastage %"
                        value={formData.wastagePercentage}
                        onChange={e => setFormData({ ...formData, wastagePercentage: e.target.value })}
                        style={{ flex: 1 }}
                    />
                </div>
                <div style={{ display: 'flex', gap: 12 }}>
                    <input
                        className={styles.input}
                        type="number"
                        placeholder="Making Charges"
                        value={formData.makingCharges}
                        onChange={e => setFormData({ ...formData, makingCharges: e.target.value })}
                        style={{ flex: 2 }}
                    />
                    <select
                        className={styles.select}
                        value={formData.makingChargesType}
                        onChange={e => setFormData({ ...formData, makingChargesType: e.target.value })}
                        style={{ flex: 1 }}
                    >
                        <option value="per_gram">Per Gram</option>
                        <option value="fixed">Fixed</option>
                    </select>
                </div>
            </div>

            {/* Gemstone Attributes (Collapsible) */}
            <div className={styles.card} style={{ padding: 0, overflow: 'hidden' }}>
                <div
                    onClick={() => setFormData({ ...formData, hasStones: !formData.hasStones })}
                    style={{
                        padding: 16, display: 'flex', justifyContent: 'space-between', alignItems: 'center',
                        cursor: 'pointer', background: formData.hasStones ? '#f9fafb' : 'white'
                    }}
                >
                    <div style={{ fontWeight: 600, display: 'flex', alignItems: 'center', gap: 8 }}>
                        Gemstone / Diamond Attributes
                        {formData.hasStones && <span style={{ fontSize: 10, background: '#dcfce7', color: '#166534', padding: '2px 6px', borderRadius: 4 }}>Active</span>}
                    </div>
                    {formData.hasStones ? <FiMinus /> : <FiPlus />}
                </div>

                {formData.hasStones && (
                    <div style={{ padding: 16, borderTop: '1px solid #e5e7eb' }}>
                        <div style={{ display: 'flex', gap: 12 }}>
                            <input
                                className={styles.input}
                                placeholder="Stone Type (e.g. Diamond, Ruby)"
                                value={formData.stoneType}
                                onChange={e => setFormData({ ...formData, stoneType: e.target.value })}
                                style={{ flex: 1 }}
                            />
                            <input
                                className={styles.input}
                                type="number"
                                placeholder="Total Count"
                                value={formData.stoneCount}
                                onChange={e => setFormData({ ...formData, stoneCount: e.target.value })}
                                style={{ flex: 1 }}
                            />
                        </div>
                        <div style={{ display: 'flex', gap: 12 }}>
                            <input
                                className={styles.input}
                                type="number"
                                placeholder="Weight (carats)"
                                value={formData.stoneWeight}
                                onChange={e => setFormData({ ...formData, stoneWeight: e.target.value })}
                                style={{ flex: 1 }}
                            />
                            <input
                                className={styles.input}
                                placeholder="Shape (Round, Oval)"
                                value={formData.stoneShape}
                                onChange={e => setFormData({ ...formData, stoneShape: e.target.value })}
                                style={{ flex: 1 }}
                            />
                        </div>
                        <div style={{ display: 'flex', gap: 12 }}>
                            <input
                                className={styles.input}
                                placeholder="Clarity (SI, VS, VVS)"
                                value={formData.stoneClarity}
                                onChange={e => setFormData({ ...formData, stoneClarity: e.target.value })}
                                style={{ flex: 1 }}
                            />
                            <input
                                className={styles.input}
                                placeholder="Color (D, E, F...)"
                                value={formData.stoneColor}
                                onChange={e => setFormData({ ...formData, stoneColor: e.target.value })}
                                style={{ flex: 1 }}
                            />
                        </div>
                        <input
                            className={styles.input}
                            placeholder="Certification (GIA, IGI...)"
                            value={formData.stoneCertification}
                            onChange={e => setFormData({ ...formData, stoneCertification: e.target.value })}
                        />
                        <input
                            className={styles.input}
                            type="number"
                            placeholder="Stone Price / Charges"
                            value={formData.stonePrice}
                            onChange={e => setFormData({ ...formData, stonePrice: e.target.value })}
                        />
                    </div>
                )}
            </div>

            {/* Design & Dimensions (Collapsible) */}
            <div className={styles.card} style={{ padding: 0, overflow: 'hidden', marginTop: 16 }}>
                <div
                    onClick={() => setFormData(prev => ({ ...prev, showDesign: !prev.showDesign }))}
                    style={{
                        padding: 16, display: 'flex', justifyContent: 'space-between', alignItems: 'center',
                        cursor: 'pointer', background: formData.showDesign ? '#f9fafb' : 'white'
                    }}
                >
                    <div style={{ fontWeight: 600 }}>Design & Dimension Attributes</div>
                    {formData.showDesign ? <FiMinus /> : <FiPlus />}
                </div>

                {formData.showDesign && (
                    <div style={{ padding: 16, borderTop: '1px solid #e5e7eb' }}>
                        <input
                            className={styles.input}
                            placeholder="Size (Ring size, Length)"
                            value={formData.size}
                            onChange={e => setFormData({ ...formData, size: e.target.value })}
                        />
                        <input
                            className={styles.input}
                            placeholder="Pattern / Design Details"
                            value={formData.pattern}
                            onChange={e => setFormData({ ...formData, pattern: e.target.value })}
                        />
                        <input
                            className={styles.input}
                            placeholder="Engraving Text"
                            value={formData.engravingText}
                            onChange={e => setFormData({ ...formData, engravingText: e.target.value })}
                        />
                        <div className={styles.toggleRow} style={{ marginTop: 8 }}>
                            <span className={styles.toggleLabel}>Customizable</span>
                            <input
                                type="checkbox"
                                checked={formData.customizable}
                                onChange={e => setFormData({ ...formData, customizable: e.target.checked })}
                            />
                        </div>
                    </div>
                )}
            </div>

            {/* Pricing & Inventory */}
            <div className={styles.sectionTitle}>Pricing & Inventory</div>
            <div className={styles.card}>
                <input
                    className={styles.input}
                    type="number"
                    placeholder="Selling Price (Final)"
                    value={formData.sellingPrice}
                    onChange={e => setFormData({ ...formData, sellingPrice: e.target.value })}
                />
                <input
                    className={styles.input}
                    type="number"
                    placeholder="Purchase Price / Cost"
                    value={formData.purchasePrice}
                    onChange={e => setFormData({ ...formData, purchasePrice: e.target.value })}
                />
                <div style={{ display: 'flex', gap: 12 }}>
                    <input
                        className={styles.input}
                        placeholder="Vendor Reference"
                        value={formData.vendorRef}
                        onChange={e => setFormData({ ...formData, vendorRef: e.target.value })}
                        style={{ flex: 1 }}
                    />
                    <input
                        className={styles.input}
                        type="date"
                        placeholder="Procurement Date"
                        value={formData.procurementDate}
                        onChange={e => setFormData({ ...formData, procurementDate: e.target.value })}
                        style={{ flex: 1 }}
                    />
                </div>
            </div>

            {/* Taxation & Compliance */}
            <div className={styles.sectionTitle}>Taxation & Compliance</div>
            <div className={styles.card}>
                <div style={{ display: 'flex', gap: 12 }}>
                    <select
                        className={styles.select}
                        value={formData.taxRate}
                        onChange={e => setFormData({ ...formData, taxRate: Number(e.target.value) })}
                        style={{ flex: 1, marginBottom: 12 }}
                    >
                        <option value={0}>Tax Rate 0%</option>
                        <option value={3}>Tax Rate 3%</option>
                        <option value={5}>Tax Rate 5%</option>
                        <option value={12}>Tax Rate 12%</option>
                        <option value={18}>Tax Rate 18%</option>
                    </select>
                </div>
                <input
                    className={styles.input}
                    placeholder="BIS Hallmark Cert Number"
                    value={formData.hallmarkCert}
                    onChange={e => setFormData({ ...formData, hallmarkCert: e.target.value })}
                />
                <input
                    className={styles.input}
                    placeholder="Barcode (Auto-generated if empty)"
                    value={formData.barcode}
                    onChange={e => setFormData({ ...formData, barcode: e.target.value })}
                />
            </div>

            {/* Media & Attachments */}
            <div className={styles.sectionTitle}>Product Images</div>
            <div className={styles.card}>
                <div style={{ fontSize: 12, color: '#6b7280', marginBottom: 12 }}>
                    Product images must be PNG or JPEG, recommended 1024 px by 1024 px or 1:1 aspect ratio.
                </div>
                <div style={{ display: 'flex', gap: 12, overflowX: 'auto' }}>
                    <label style={{
                        width: 80, height: 80, border: '1px dashed #e5e7eb', borderRadius: 8,
                        display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center',
                        cursor: 'pointer', flexShrink: 0
                    }}>
                        <input type="file" accept="image/*" style={{ display: 'none' }} onChange={handleImageUpload} />
                        <FiImage size={24} color="#3b82f6" />
                        <span style={{ fontSize: 10, fontWeight: 600, marginTop: 4 }}>New<br />Image</span>
                    </label>
                    {formData.images.map((img, idx) => (
                        <img key={idx} src={img.data} alt="" style={{ width: 80, height: 80, borderRadius: 8, objectFit: 'cover', flexShrink: 0 }} />
                    ))}
                </div>
            </div>

            {/* Optional Metadata */}
            <div className={styles.sectionTitle}>Optional Details</div>
            <div className={styles.card}>

                <div className={styles.toggleRow} style={{ marginTop: 12, borderTop: '1px solid #f3f4f6', paddingTop: 12 }}>
                    <span className={styles.toggleLabel}>Show in online store</span>
                    <input
                        type="checkbox"
                        checked={formData.showOnline}
                        onChange={e => setFormData({ ...formData, showOnline: e.target.checked })}
                    />
                </div>
                <div className={styles.toggleRow}>
                    <span className={styles.toggleLabel}>Not For Sale</span>
                    <input
                        type="checkbox"
                        checked={formData.notForSale}
                        onChange={e => setFormData({ ...formData, notForSale: e.target.checked })}
                    />
                </div>
            </div>

            <div className={styles.footer}>
                <button className={styles.saveButton} onClick={handleSave}>Add Product</button>
            </div>
        </div >
    );
}
</file>

<file path="src/app/more/page.js">
'use client';

import { useEffect } from 'react';
import Link from 'next/link';
import { useSettingsStore } from '@/lib/store/settingsStore';
import { FiUser, FiSettings, FiChevronRight, FiBriefcase, FiUsers, FiFileText, FiCreditCard, FiEdit3, FiBookOpen, FiBox } from 'react-icons/fi';
import styles from './page.module.css';

const menuItems = [
    {
        title: 'Profile',
        items: [
            { label: 'Company Details', icon: FiBriefcase, href: '/more/company' },
            { label: 'User Profile', icon: FiUser, href: '/more/profile' },
            { label: 'Users & Roles', icon: FiUsers, href: '/coming-soon' },
        ]
    },
    {
        title: 'Bills',
        items: [
            { label: 'Expenses', icon: FiCreditCard, href: '/more/bills/expenses' },
        ]
    },
    {
        title: 'Masters',
        items: [
            { label: 'Product Master', icon: FiBox, href: '/more/masters/products' },
        ]
    },
    {
        title: 'Settings',
        items: [
            { label: 'Document Settings', icon: FiFileText, href: '/coming-soon' },
            { label: 'General Settings', icon: FiSettings, href: '/coming-soon' },
            { label: 'Invoice Templates', icon: FiFileText, href: '/more/templates' },
            { label: 'Lending Bill Template', icon: FiFileText, href: '/more/templates/lending' },
            { label: 'Label Templates', icon: FiFileText, href: '/more/label-templates' },
            { label: 'Bank', icon: FiCreditCard, href: '/coming-soon' },
            { label: 'Signature', icon: FiEdit3, href: '/coming-soon' },
            { label: 'Notes & Terms', icon: FiBookOpen, href: '/coming-soon' },
        ]
    }
];

export default function MorePage() {
    const { companyDetails, loadSettings } = useSettingsStore();

    useEffect(() => {
        loadSettings();
    }, []);

    return (
        <div className={styles.container}>
            <div className={styles.profileCard}>
                <div className={styles.avatar}>
                    {companyDetails.name ? companyDetails.name[0].toUpperCase() : 'S'}
                </div>
                <div className={styles.profileInfo}>
                    <div className={styles.profileName}>{companyDetails.name || 'Set Company Name'}</div>
                    <div className={styles.profileSub}>{companyDetails.gstin || 'Add GST Details'}</div>
                </div>
            </div>

            {menuItems.map((section, idx) => (
                <div key={idx}>
                    <div className={styles.sectionTitle}>{section.title}</div>
                    <div className={styles.menuGroup}>
                        {section.items.map((item, itemIdx) => (
                            <Link key={itemIdx} href={item.href} className={styles.menuItem}>
                                <div className={styles.menuIcon}>
                                    <item.icon />
                                </div>
                                <div className={styles.menuLabel}>{item.label}</div>
                                <FiChevronRight className={styles.menuArrow} />
                            </Link>
                        ))}
                    </div>
                </div>
            ))}
        </div>
    );
}
</file>

<file path="src/lib/db/index.js">
import Dexie from 'dexie';

export const db = new Dexie('SwipeInvoiceDB');

db.version(11).stores({
  invoices: '++id, invoiceNumber, date, customerId, status, balanceDue, type',
  purchases: '++id, purchaseNumber, date, vendorId, status, balanceDue',
  customers: '++id, name, gstin, phone, email, isDeleted',
  vendors: '++id, name, gstin, phone, email, isDeleted',
  products: '++id, name, type, sku, hsn, category, sellingPrice, purchasePrice, taxRate, unit, barcode',
  payments: '++id, transactionNumber, date, type, partyType, partyId',
  payment_allocations: '++id, paymentId, invoiceId',
  audit_logs: '++id, entityType, entityId, action, timestamp',
  attendance_log: '++id, userId, loginDate, loginTimestamp, logoutTimestamp, created_at',
  bulk_upload_logs: '++id, userId, fileName, totalRecords, successCount, failureCount, timestamp',
  categories: '++id, name, type',
  subCategories: '++id, name, categoryId',
  sequences: 'key',
  settings: 'key',
  // New tables for Label Templates
  tag_templates: 'template_id, name, version',
  product_tag_config: '++id, product_id, template_id'
});

export const resetDatabase = async () => {
  await db.delete();
  await db.open();
};
</file>

<file path="src/app/products/page.js">
'use client';

import { useEffect, useState, useMemo } from 'react';
import Link from 'next/link';
import { useRouter, useSearchParams } from 'next/navigation';
import { useProductStore } from '@/lib/store/productStore';
import { useMasterStore } from '@/lib/store/masterStore';
import { useInvoiceStore } from '@/lib/store/invoiceStore';
import { shareText } from '@/lib/utils/invoiceActions';
import { FiMenu, FiPlus, FiSearch, FiMoreHorizontal, FiDownload, FiUpload, FiArrowLeft, FiCheck } from 'react-icons/fi';
import { RiBarcodeLine } from 'react-icons/ri';
import ProductCard from './components/ProductCard';
import FilterBar from './components/FilterBar';
import Pagination from './components/Pagination';
import BottomSheet from '@/components/BottomSheet';
import BarcodeScanner from '@/components/BarcodeScanner';
import ScanResultModal from '@/components/ScanResultModal';
import { BulkUploadService } from '@/lib/services/bulkUploadService';
import styles from './page.module.css';

const ITEMS_PER_PAGE = 12;

export default function ProductsPage() {
    const router = useRouter();
    const searchParams = useSearchParams();
    const { products, loadProducts, addProduct, getProductByBarcode } = useProductStore();
    const { categories, loadCategories } = useMasterStore();
    const { items: invoiceItems, addOrUpdateItem } = useInvoiceStore();

    // Detect selection mode from query params
    const isSelectMode = searchParams.get('mode') === 'select';
    const returnUrl = searchParams.get('returnUrl') || '/invoice/create';

    const [search, setSearch] = useState('');
    const [isMenuOpen, setIsMenuOpen] = useState(false);

    // Barcode Scanner State
    const [isScannerOpen, setIsScannerOpen] = useState(false);
    const [scanResult, setScanResult] = useState({ isOpen: false, product: null, barcode: '' });

    // Filter State
    const [filters, setFilters] = useState({
        purity: [],
        weight: [],
        gender: [],
        category: []
    });

    // Pagination State
    const [currentPage, setCurrentPage] = useState(1);

    useEffect(() => {
        loadProducts();
        loadCategories();
    }, []);

    // --- Filtering Logic ---
    const filteredProducts = useMemo(() => {
        return products.filter(product => {
            // 1. Search
            if (search && !product.name.toLowerCase().includes(search.toLowerCase())) return false;

            // 2. Purity
            if (filters.purity.length > 0) {
                const productPurity = product.purity || '';
                if (!filters.purity.some(f => productPurity.includes(f))) return false;
            }

            // 3. Weight
            if (filters.weight.length > 0) {
                const weight = Number(product.grossWeight || 0);
                const matchesWeight = filters.weight.some(range => {
                    if (range === '0-5g') return weight >= 0 && weight <= 5;
                    if (range === '5-10g') return weight > 5 && weight <= 10;
                    return false;
                });
                if (!matchesWeight) return false;
            }

            // 4. Gender
            if (filters.gender.length > 0) {
                const genderText = (product.category + ' ' + product.name + ' ' + (product.tags || '')).toLowerCase();
                const matchesGender = filters.gender.some(g => genderText.includes(g.toLowerCase()));
                if (!matchesGender) return false;
            }

            // 5. Category
            if (filters.category.length > 0) {
                if (!filters.category.includes(product.category)) return false;
            }

            return true;
        });
    }, [products, search, filters]);

    // --- Pagination Logic ---
    const totalPages = Math.ceil(filteredProducts.length / ITEMS_PER_PAGE);
    const paginatedProducts = filteredProducts.slice(
        (currentPage - 1) * ITEMS_PER_PAGE,
        currentPage * ITEMS_PER_PAGE
    );

    // --- Get quantity in invoice for a product ---
    const getItemQuantity = (productId) => {
        const item = invoiceItems.find(i => i.productId === productId);
        return item ? item.quantity : 0;
    };

    // --- Handlers ---
    const handleAddToTray = (product) => {
        if (isSelectMode) {
            // Add to invoice store
            addOrUpdateItem(product, 1);
        } else {
            console.log("Added to tray:", product.name);
            // TODO: Implement standalone Tray Logic if needed
        }
    };

    const handleShare = async (product) => {
        await shareText({
            title: product.name,
            text: `Check out this ${product.name}`,
            url: window.location.href
        });
    };

    // --- Barcode Scan Handlers ---
    const handleBarcodeScan = async (barcode) => {
        setIsScannerOpen(false);
        const product = await getProductByBarcode(barcode);
        setScanResult({ isOpen: true, product, barcode });
    };

    const handleScanAddToTray = (product) => {
        if (isSelectMode) {
            addOrUpdateItem(product, 1);
        }
        setScanResult({ isOpen: false, product: null, barcode: '' });
    };

    const handleScanAgain = () => {
        setScanResult({ isOpen: false, product: null, barcode: '' });
        setIsScannerOpen(true);
    };

    const handleAddManually = (barcode) => {
        setScanResult({ isOpen: false, product: null, barcode: '' });
        router.push(`/products/add?barcode=${encodeURIComponent(barcode)}&returnUrl=${encodeURIComponent(window.location.pathname + window.location.search)}`);
    };

    return (
        <div className={styles.container}>
            {/* Header - Context Aware */}
            <div className={styles.header}>
                <div className={styles.headerLeft}>
                    {isSelectMode ? (
                        <FiArrowLeft size={24} className={styles.menuIcon} onClick={() => router.push(returnUrl)} />
                    ) : (
                        <Link href="/">
                            <FiMenu size={24} className={styles.menuIcon} />
                        </Link>
                    )}
                    <span className={styles.headerTitle}>
                        {isSelectMode ? 'Select Products' : 'Products & Services'}
                    </span>
                </div>
                <div className={styles.headerActions}>
                    <RiBarcodeLine size={24} onClick={() => setIsScannerOpen(true)} style={{ cursor: 'pointer' }} />
                    {isSelectMode ? (
                        <button
                            onClick={() => router.push(returnUrl)}
                            style={{
                                background: '#2563eb',
                                color: 'white',
                                border: 'none',
                                padding: '8px 16px',
                                borderRadius: '8px',
                                fontWeight: 600,
                                fontSize: '14px',
                                display: 'flex',
                                alignItems: 'center',
                                gap: '6px',
                                cursor: 'pointer'
                            }}
                        >
                            <FiCheck size={16} />
                            Done ({invoiceItems.length})
                        </button>
                    ) : (
                        <FiMoreHorizontal size={24} onClick={() => setIsMenuOpen(true)} />
                    )}
                </div>
            </div>

            {/* Search Bar */}
            <div className={styles.searchContainer}>
                <div className={styles.searchBar}>
                    <FiSearch color="#9ca3af" size={20} />
                    <input
                        className={styles.searchInput}
                        placeholder="Search..."
                        value={search}
                        onChange={(e) => setSearch(e.target.value)}
                    />
                </div>
            </div>

            {/* Filter Bar */}
            <div className={styles.filterSection}>
                <FilterBar
                    filters={filters}
                    onFilterChange={(newFilters) => {
                        setFilters(newFilters);
                        setCurrentPage(1);
                    }}
                    categories={categories}
                />
            </div>

            {/* Product Grid */}
            <div className={styles.grid}>
                {paginatedProducts.map(product => (
                    <ProductCard
                        key={product.id}
                        product={product}
                        onAddToTray={handleAddToTray}
                        onShare={handleShare}
                        quantity={isSelectMode ? getItemQuantity(product.id) : 0}
                        isSelectMode={isSelectMode}
                    />
                ))}
            </div>

            {/* Empty State */}
            {filteredProducts.length === 0 && (
                <div className={styles.emptyState}>
                    No products found.
                </div>
            )}

            {/* Pagination */}
            {filteredProducts.length > 0 && (
                <Pagination
                    currentPage={currentPage}
                    totalPages={totalPages}
                    onPageChange={setCurrentPage}
                    onRecentlyViewed={() => console.log('Recently Viewed')}
                />
            )}

            {/* Floating Create Button - Hidden in Select Mode */}
            {!isSelectMode && (
                <Link href="/products/add">
                    <div className={styles.fab}>
                        <FiPlus size={18} />
                        NEW PRODUCT
                    </div>
                </Link>
            )}


            {/* Bulk Actions Menu - Hidden in Select Mode */}
            {!isSelectMode && (
                <BottomSheet isOpen={isMenuOpen} onClose={() => setIsMenuOpen(false)}>
                    <div style={{ display: 'flex', flexDirection: 'column', padding: '0 16px 20px' }}>
                        <div className={styles.menuItem} onClick={() => { BulkUploadService.downloadAllProducts(); setIsMenuOpen(false); }}>
                            <FiDownload size={20} />
                            <span>Bulk Download</span>
                        </div>
                        <Link href="/products/bulk-upload" onClick={() => setIsMenuOpen(false)}>
                            <div className={styles.menuItem}>
                                <FiUpload size={20} />
                                <span>Bulk Upload</span>
                            </div>
                        </Link>
                    </div>
                </BottomSheet>
            )}

            {/* Barcode Scanner */}
            <BarcodeScanner
                isOpen={isScannerOpen}
                onScan={handleBarcodeScan}
                onClose={() => setIsScannerOpen(false)}
            />

            {/* Scan Result Modal */}
            <ScanResultModal
                isOpen={scanResult.isOpen}
                product={scanResult.product}
                barcode={scanResult.barcode}
                onAddToTray={handleScanAddToTray}
                onScanAgain={handleScanAgain}
                onAddManually={handleAddManually}
                onClose={() => setScanResult({ isOpen: false, product: null, barcode: '' })}
            />
        </div>
    );
}
</file>

<file path="src/lib/store/invoiceStore.js">
import { create } from 'zustand';
import { db } from '@/lib/db';
import { calculateGST } from '../utils/tax';

export const useInvoiceStore = create((set, get) => ({
    invoiceNumber: 'INV-1',
    date: new Date().toISOString().split('T')[0],
    dueDate: new Date().toISOString().split('T')[0],
    placeOfSupply: '',
    invoiceCopyType: 'Original for Recipient',
    customer: null,
    items: [],
    invoices: [], // List of all invoices
    type: 'INVOICE', // 'INVOICE' | 'PROFORMA'

    loadInvoices: async () => {
        const invoices = await db.invoices.toArray();
        set({ invoices: invoices.reverse() });
    },

    // New Fields
    details: {
        reference: '',
        notes: '',
        terms: '',
        extraDiscount: 0,
        shippingCharges: 0,
        packagingCharges: 0,
    },
    weightSummary: {
        grossWeight: '',
        netWeight: '',
    },
    toggles: {
        tds: false,
        tcs: false,
        rcm: false,
    },
    payment: {
        isFullyPaid: false,
        amountReceived: 0,
        mode: 'Cash',
        notes: '',
    },
    roundOff: false,
    id: null, // For editing

    setInvoiceNumber: (num) => set({ invoiceNumber: num }),
    setDate: (date) => set({ date }),
    setDueDate: (date) => set({ dueDate: date }),
    setPlaceOfSupply: (pos) => set({ placeOfSupply: pos }),
    setInvoiceCopyType: (type) => set({ invoiceCopyType: type }),
    setCustomer: (customer) => set({ customer }),
    setInvoiceType: (type) => set({ type }),

    setWeightSummary: (field, value) => set((state) => ({
        weightSummary: { ...state.weightSummary, [field]: value }
    })),

    setInvoice: (invoice) => set({
        id: invoice.id,
        invoiceNumber: invoice.invoiceNumber,
        date: invoice.date,
        dueDate: invoice.dueDate || invoice.date,
        placeOfSupply: invoice.placeOfSupply || '',
        invoiceCopyType: invoice.invoiceCopyType || 'Original for Recipient',
        customer: invoice.customer,
        items: invoice.items,
        details: invoice.details || { reference: '', notes: '', terms: '', extraDiscount: 0, shippingCharges: 0, packagingCharges: 0 },
        weightSummary: invoice.weightSummary || { grossWeight: '', netWeight: '' },
        toggles: invoice.toggles || { tds: false, tcs: false, rcm: false },
        payment: invoice.payment || { isFullyPaid: false, amountReceived: 0, mode: 'Cash', notes: '' },
        roundOff: invoice.totals?.roundOffAmount !== 0,
        type: invoice.type || 'INVOICE'
    }),

    updateDetails: (field, value) => set((state) => ({
        details: { ...state.details, [field]: value }
    })),
    toggleSwitch: (field) => set((state) => ({
        toggles: { ...state.toggles, [field]: !state.toggles[field] }
    })),
    updatePayment: (field, value) => set((state) => ({
        payment: { ...state.payment, [field]: value }
    })),
    toggleRoundOff: () => set((state) => ({ roundOff: !state.roundOff })),

    resetInvoice: () => set({
        id: null,
        invoiceNumber: 'INV-' + Date.now().toString().slice(-4), // Should be overwritten by useEffect in Create page ideally
        date: new Date().toISOString().split('T')[0],
        dueDate: new Date().toISOString().split('T')[0],
        placeOfSupply: '',
        invoiceCopyType: 'Original for Recipient',
        customer: null,
        items: [],
        details: { reference: '', notes: '', terms: '', extraDiscount: 0, shippingCharges: 0, packagingCharges: 0 },
        weightSummary: { grossWeight: '', netWeight: '' },
        toggles: { tds: false, tcs: false, rcm: false },
        payment: { isFullyPaid: false, amountReceived: 0, mode: 'Cash', notes: '' },
        roundOff: false,
        type: 'INVOICE'
    }),

    addItem: () => set((state) => ({
        items: [...state.items, {
            id: Date.now(),
            name: '',
            rate: 0,
            quantity: 1,
            gstRate: 0,
            hsn: '',

            // Manual Item Defaults
            netWeight: 0,
            grossWeight: 0,
            ratePerGram: 0,
            makingChargePerGram: 0,
            purity: ''
        }]
    })),

    updateItem: (id, field, value) => set((state) => ({
        items: state.items.map(item =>
            item.id === id ? { ...item, [field]: value } : item
        )
    })),

    removeItem: (id) => set((state) => ({
        items: state.items.filter(item => item.id !== id)
    })),

    addOrUpdateItem: (product, change) => set((state) => {
        const existingItem = state.items.find(item => item.productId === product.id);

        if (existingItem) {
            const newQuantity = existingItem.quantity + change;
            if (newQuantity <= 0) {
                return { items: state.items.filter(item => item.productId !== product.id) };
            }
            return {
                items: state.items.map(item =>
                    item.productId === product.id
                        ? { ...item, quantity: newQuantity }
                        : item
                )
            };
        } else if (change > 0) {
            // Auto-fill logic for Jewellery
            // Name fallback: SubCategory -> Name
            const itemName = product.subCategory || product.name;

            // Default rate: Use sellingPrice as fallback for ratePerGram if not explicitly defined in product
            const ratePerGram = Number(product.sellingPrice) || 0;

            // Making Charge
            const makingChargePerGram = Number(product.makingCharges) || 0;

            // Weights
            const grossWeight = Number(product.grossWeight) || 0;
            const netWeight = Number(product.netWeight) || 0;

            return {
                items: [...state.items, {
                    id: Date.now(),
                    productId: product.id,
                    name: itemName,
                    rate: 0, // Legacy field
                    quantity: change,
                    gstRate: 0, // New logic doesn't use per-item GST rate
                    hsn: product.hsn || '',

                    // Jewellery Fields
                    grossWeight,
                    netWeight,
                    ratePerGram,
                    makingChargePerGram,
                    purity: product.purity || '',

                    // Computed initial values
                    materialValue: netWeight * ratePerGram,
                    makingCharge: netWeight * makingChargePerGram,
                    itemTotal: (netWeight * ratePerGram) + (netWeight * makingChargePerGram)
                }]
            };
        }
        return state;
    }),

    saveInvoice: async () => {
        const state = get();
        const { invoiceNumber, date, dueDate, placeOfSupply, invoiceCopyType, customer, items, details, weightSummary, toggles, payment, id, type } = state;

        if (!customer) throw new Error('Customer is required');

        // Calculate totals dynamically to ensure accuracy and avoid undefined state
        const totals = state.calculateTotals();

        const balanceDue = totals.total - (payment.amountReceived || 0);
        const status = balanceDue <= 0 ? 'Paid' : (payment.amountReceived > 0 ? 'Partial' : 'Unpaid');

        // Prepare items with computed values for persistence
        const persistedItems = items.map(item => {
            // Re-calculate line item totals to be sure
            const matVal = (Number(item.netWeight) || 0) * (Number(item.ratePerGram) || 0);
            const mc = (Number(item.netWeight) || 0) * (Number(item.makingChargePerGram) || 0);
            const itemTotal = matVal + mc;

            return {
                ...item,
                materialValue: matVal,
                makingCharge: mc,
                itemTotal: itemTotal
            };
        });

        const invoiceData = {
            invoiceNumber,
            date,
            dueDate,
            placeOfSupply,
            invoiceCopyType,
            customerId: customer.id,
            customer: { name: customer.name, id: customer.id, phone: customer.phone }, // Snapshot
            items: persistedItems,
            details,
            weightSummary,
            toggles,
            totals,
            status: type === 'LENDING' ? 'Pending' : status, // Lending bills are always Pending/Open initially?
            balanceDue,
            type: type || 'INVOICE',

            // specific top-level tax columns for easy querying
            cgstAmount: totals.cgst,
            sgstAmount: totals.sgst,
            totalBeforeTax: totals.subtotal,
            totalAfterTax: totals.total,

            updatedAt: new Date().toISOString()
        };

        return await db.transaction('rw', db.invoices, db.payments, db.payment_allocations, db.customers, async () => {
            let invoiceId = id;

            if (id) {
                await db.invoices.update(id, invoiceData);
            } else {
                invoiceId = await db.invoices.add({ ...invoiceData, createdAt: new Date().toISOString() });
            }

            // Only update payments/balance for regular Invoices.
            // Pro Forma: No balance update.
            // Lending Bill: No balance update (It's a goods loan, not a financial transaction yet).

            if (type !== 'PROFORMA' && type !== 'LENDING') {
                if (!id && payment.amountReceived > 0) {
                    const paymentId = await db.payments.add({
                        transactionNumber: 'PAYIN-' + Date.now().toString().slice(-4),
                        date: date,
                        type: 'IN',
                        partyType: 'CUSTOMER',
                        partyId: customer.id,
                        amount: Number(payment.amountReceived),
                        mode: payment.mode,
                        notes: payment.notes,
                        createdAt: new Date().toISOString()
                    });

                    await db.payment_allocations.add({
                        paymentId,
                        invoiceId,
                        amount: Number(payment.amountReceived)
                    });

                    // Update Customer Balance
                    // We need to fetch current balance first to be safe, or just use atomic update if Dexie supports it (it doesn't for complex math).
                    const currentCustomer = await db.customers.get(customer.id);
                    if (currentCustomer) {
                        // Invoice increases balance (debit), Payment decreases it (credit)
                        // Net change = Invoice Total - Payment Amount
                        // Wait, usually:
                        // Balance = Receivable.
                        // Invoice created -> Balance increases by Total.
                        // Payment received -> Balance decreases by Amount.
                        // So net change = Total - Amount.
                        const newBalance = (currentCustomer.balance || 0) + totals.total - Number(payment.amountReceived);
                        await db.customers.update(customer.id, { balance: newBalance });
                    }
                } else if (!id) {
                    // Only Invoice created, no payment
                    const currentCustomer = await db.customers.get(customer.id);
                    if (currentCustomer) {
                        const newBalance = (currentCustomer.balance || 0) + totals.total;
                        await db.customers.update(customer.id, { balance: newBalance });
                    }
                }
            }

            // Reload invoices
            const invoices = await db.invoices.toArray();
            set({ invoices: invoices.reverse() });

            return invoiceId;
        });
    },

    deleteInvoice: async (id) => {
        // TODO: Handle reversing balance changes and deleting linked payments?
        // For now, simple delete to match previous behavior, but we should warn user.
        await db.invoices.delete(id);
        const invoices = await db.invoices.toArray();
        set({ invoices: invoices.reverse() });
    },

    calculateTotals: () => {
        const { items, details, roundOff, type } = get();
        let subtotal = 0; // Total Before Tax

        // Calculate line item totals
        items.forEach(item => {
            // Logic: 
            // Material Value = Net Weight * Rate Per Gram
            // Making Charge = Net Weight * Making Charge Per Gram
            // Item Total = Material Value + Making Charge

            // For manual items that might not have weights:
            // Fallback to legacy calc: rate * quantity?
            // Prompt says: "For manual items... allow user to enter: item name, rate, weight, making charge manually."
            // So we assume all items follow the new structure or we support legacy for manual.

            let itemTotal = 0;

            if (item.productId || (item.netWeight !== undefined)) {
                // Jewellery Logic
                const netWeight = Number(item.netWeight) || 0;
                const ratePerGram = Number(item.ratePerGram) || 0;
                const mcPerGram = Number(item.makingChargePerGram) || 0;

                const materialValue = netWeight * ratePerGram;
                const makingCharge = netWeight * mcPerGram;
                itemTotal = materialValue + makingCharge;

                // Consider quantity? Usually jewellery items are unique pieces (qty 1).
                // But if user sets Qty > 1, we should multiply?
                // Prompt "3. Support for Multiple Products... Each line item should independently calculate its own totals".
                // Assuming Qty is effectively 1 per row for specific items, or if Qty > 1, it multiplies totals.
                // Let's multiply by quantity to be safe standard behavior.
                itemTotal = itemTotal * (item.quantity || 1);
            } else {
                // Legacy / Simple Manual Item fallback
                itemTotal = (item.rate || 0) * (item.quantity || 1);
            }

            subtotal += itemTotal;
        });

        // LENDING BILL Logic: No Price, No Tax
        if (type === 'LENDING') {
            return {
                subtotal: 0,
                totalTax: 0,
                total: 0,
                roundOffAmount: 0,
                rawTotal: 0,
                cgst: 0,
                sgst: 0,
                igst: 0
            };
        }

        // Tax Calculation (Invoice Level)
        // If PROFORMA, Tax is 0.
        let cgstAmount = 0;
        let sgstAmount = 0;
        let totalTax = 0;

        if (type !== 'PROFORMA') {
            const cgstRate = 1.5;
            const sgstRate = 1.5;

            cgstAmount = (subtotal * cgstRate) / 100;
            sgstAmount = (subtotal * sgstRate) / 100;
            totalTax = cgstAmount + sgstAmount;
        }

        let total = subtotal + totalTax;

        // Add/Subtract extra charges
        total += Number(details.shippingCharges || 0);
        total += Number(details.packagingCharges || 0);
        total -= Number(details.extraDiscount || 0);

        let finalTotal = total;
        let roundOffAmount = 0;

        if (roundOff) {
            finalTotal = Math.round(total);
            roundOffAmount = finalTotal - total;
        }

        return {
            subtotal, // This is Total Before Tax
            totalTax,
            total: finalTotal,
            roundOffAmount,
            rawTotal: total,
            cgst: cgstAmount,
            sgst: sgstAmount,
            igst: 0
        };
    }
}));
</file>

<file path="src/app/invoice/view/page.js">
'use client';

import { useState, useEffect, Suspense } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { db } from '@/lib/db';
import { formatCurrency } from '@/lib/utils/tax';
import { shareInvoicePDF, downloadInvoicePDF } from '@/lib/utils/invoiceActions';
import BottomSheet from '@/components/BottomSheet';
import {
    FiArrowLeft, FiEdit, FiMoreHorizontal, FiShare2, FiPrinter, FiDownload, FiPlus,
    FiCopy, FiClock, FiRefreshCw, FiSettings, FiMail, FiMessageSquare,
    FiTruck, FiFileText, FiXCircle
} from 'react-icons/fi';
import CancelInvoiceModal from '@/components/CancelInvoiceModal';
import { useInvoiceStore } from '@/lib/store/invoiceStore';

function InvoiceViewContent() {
    const router = useRouter();
    const searchParams = useSearchParams();
    const id = searchParams.get('id');
    const [invoice, setInvoice] = useState(null);
    const [isMenuOpen, setIsMenuOpen] = useState(false);

    useEffect(() => {
        const loadInvoice = async () => {
            if (id) {
                const inv = await db.invoices.get(Number(id));
                setInvoice(inv);
            }
        };
        loadInvoice();
    }, [id]);

    const handleShare = async () => {
        if (!invoice) return;
        await shareInvoicePDF(invoice);
    };

    const handleDownload = async () => {
        if (!invoice) return;
        await downloadInvoicePDF(invoice);
    };

    const [isCancelModalOpen, setIsCancelModalOpen] = useState(false);
    const { deleteInvoice } = useInvoiceStore();

    const handleCancelInvoice = async (reason) => {
        if (invoice) {
            await deleteInvoice(invoice.id);
            setIsCancelModalOpen(false);
            router.push('/'); // Redirect to home/dashboard after deletion
        }
    };

    if (!invoice) return <div style={{ padding: 20 }}>Loading...</div>;

    const menuGridItems = [
        { label: 'Edit', icon: FiEdit, onClick: () => router.push(`/invoice/edit?id=${invoice.id}`) },
        {
            label: 'View PDF', icon: FiDownload, onClick: async () => {
                await handleDownload();
                setIsMenuOpen(false);
            }
        },

        {
            label: 'Send Bill', icon: FiShare2, onClick: () => {
                handleShare();
                setIsMenuOpen(false);
            }
        },
    ];

    const menuListItems = [
        { label: 'Duplicate', icon: FiCopy },
        { label: 'Thermal Print', icon: FiPrinter },
        { label: 'Activity', icon: FiClock },
        { label: 'Convert', icon: FiRefreshCw, sub: '(3 free trials left)' },
        { label: 'Document Settings', icon: FiSettings },
        { label: 'Send Email', icon: FiMail },
        { label: 'Send SMS', icon: FiMessageSquare },

        {
            label: 'Cancel Invoice',
            icon: FiXCircle,
            danger: true,
            action: true,
            onClick: () => {
                setIsMenuOpen(false);
                setIsCancelModalOpen(true);
            }
        },
    ];

    return (
        <div style={{ background: '#f3f4f6', minHeight: '100vh', paddingBottom: 100 }}>
            {/* Header */}
            <div style={{
                background: 'white',
                padding: '16px',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'space-between',
                borderBottom: '1px solid #e5e7eb'
            }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                    <FiArrowLeft size={24} onClick={() => router.push('/')} style={{ cursor: 'pointer' }} />
                    <div>
                        <div style={{ fontWeight: 700, fontSize: 16 }}>{invoice.invoiceNumber}</div>
                        <div style={{ fontSize: 12, color: '#6b7280' }}>Invoice</div>
                    </div>
                </div>
                <div style={{ display: 'flex', gap: 12 }}>
                    <button
                        onClick={() => router.push(`/invoice/edit?id=${invoice.id}`)}
                        style={{
                            display: 'flex', alignItems: 'center', gap: 6,
                            background: '#fef3c7', color: '#d97706',
                            border: 'none', padding: '6px 12px', borderRadius: 6, fontWeight: 600
                        }}>
                        <FiEdit size={14} /> Edit
                    </button>
                    <FiMoreHorizontal size={24} onClick={() => setIsMenuOpen(true)} style={{ cursor: 'pointer' }} />
                </div>
            </div>

            <div style={{ padding: 16 }}>
                {/* Customer Details */}
                <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 8, color: '#374151' }}>Customer Details</div>
                <div style={{ background: 'white', padding: 16, borderRadius: 12, marginBottom: 16 }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 12 }}>
                        <div style={{ fontSize: 12, color: '#6b7280' }}>Customer Details</div>
                        <div style={{
                            background: invoice.status === 'Paid' ? '#dcfce7' : '#fee2e2',
                            color: invoice.status === 'Paid' ? '#166534' : '#991b1b',
                            fontSize: 10, fontWeight: 600, padding: '2px 8px', borderRadius: 4
                        }}>
                            {invoice.status.toUpperCase()}
                        </div>
                    </div>
                    <div style={{ fontWeight: 600, fontSize: 16, marginBottom: 12 }}>{invoice.customer.name}</div>

                    <div style={{ marginBottom: 12 }}>
                        <div style={{ fontSize: 12, color: '#6b7280', display: 'flex', alignItems: 'center', gap: 4 }}>
                            Invoice date <FiEdit size={10} />
                        </div>
                        <div style={{ fontWeight: 600, fontSize: 14 }}>{invoice.date}</div>
                    </div>

                    <div>
                        <div style={{ fontSize: 12, color: '#6b7280' }}>Billing Address</div>
                        <div style={{ fontWeight: 600, fontSize: 14 }}>{invoice.customer.address || 'NA'}</div>
                    </div>
                </div>

                {/* Items */}
                <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 8, color: '#374151' }}>
                    Items <span style={{ color: '#6b7280', fontWeight: 400 }}>({invoice.items.length} Product)</span>
                </div>
                <div style={{ background: 'white', borderRadius: 12, overflow: 'hidden', marginBottom: 16 }}>
                    {invoice.items.map((item, idx) => (
                        <div key={idx} style={{ padding: 16, borderBottom: '1px solid #f3f4f6' }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>
                                <div style={{ fontWeight: 600 }}>{item.name}</div>
                                <div style={{ fontWeight: 600 }}>{formatCurrency(item.rate)}</div>
                            </div>
                            <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: 12, color: '#6b7280' }}>
                                <div>x {item.quantity}</div>
                                <div>&gt;</div>
                            </div>
                        </div>
                    ))}
                    <div style={{ padding: 16, background: '#f9fafb' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4, fontSize: 14, color: '#6b7280' }}>
                            <div>Subtotal</div>
                            <div>{formatCurrency(invoice.totals.subtotal)}</div>
                        </div>
                        {/* Add other charges here if present */}
                        <div style={{ display: 'flex', justifyContent: 'space-between', fontWeight: 700, fontSize: 14 }}>
                            <div>Total Amount</div>
                            <div>{formatCurrency(invoice.totals.total)}</div>
                        </div>
                    </div>
                </div>

                {/* Payments */}
                <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 8, color: '#374151' }}>Payments</div>
                <div style={{ background: 'white', padding: 16, borderRadius: 12, marginBottom: 16 }}>
                    {invoice.payment?.amountReceived > 0 ? (
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                                    <span style={{ fontWeight: 600 }}>{invoice.date}</span>
                                    <span style={{ background: '#dcfce7', color: '#166534', fontSize: 10, padding: '2px 6px', borderRadius: 4 }}>
                                        {invoice.payment?.mode}
                                    </span>
                                </div>
                                <div style={{ fontSize: 12, color: '#6b7280' }}>PAYIN-1</div>
                            </div>
                            <div style={{ textAlign: 'right' }}>
                                <div style={{ fontWeight: 600 }}>{formatCurrency(invoice.payment?.amountReceived || 0)}</div>
                                <button style={{
                                    background: '#2563eb', color: 'white', border: 'none',
                                    padding: '4px 8px', borderRadius: 4, fontSize: 10, marginTop: 4
                                }}>
                                    📄 View Receipt
                                </button>
                            </div>
                        </div>
                    ) : (
                        <div style={{ color: '#6b7280', fontSize: 14 }}>No payments recorded</div>
                    )}
                </div>

                {/* Internal Notes */}
                <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 8, color: '#374151' }}>Internal Notes</div>
                <div style={{ background: 'white', padding: 16, borderRadius: 12, marginBottom: 16 }}>
                    <button style={{
                        border: 'none', background: 'none', color: '#2563eb', fontWeight: 600,
                        display: 'flex', alignItems: 'center', gap: 6
                    }}>
                        <FiPlus size={16} /> Add Internal Notes
                    </button>
                </div>

                {/* Attachments */}
                <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 8, color: '#374151' }}>Attachments</div>
                <div style={{ display: 'flex', gap: 12 }}>
                    <button style={{
                        flex: 1, background: 'white', border: '1px solid #e5e7eb', borderRadius: 8,
                        padding: 12, display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8,
                        color: '#2563eb', fontWeight: 600
                    }}>
                        📷 Camera
                    </button>
                    <button style={{
                        flex: 1, background: 'white', border: '1px solid #e5e7eb', borderRadius: 8,
                        padding: 12, display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8,
                        color: '#2563eb', fontWeight: 600
                    }}>
                        ⬆️ Upload File
                    </button>
                </div>
            </div>

            {/* Bottom Actions */}
            <div style={{
                position: 'fixed', bottom: 0, left: 0, right: 0,
                background: 'white', padding: 16, borderTop: '1px solid #e5e7eb',
                display: 'flex', gap: 12, overflowX: 'auto'
            }}>
                <button
                    onClick={handleDownload}
                    style={{
                        flex: 1, padding: '12px', borderRadius: 24, border: '1px solid #e5e7eb',
                        background: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8,
                        minWidth: 120
                    }}>
                    <FiDownload /> View PDF
                </button>
                <button style={{
                    flex: 1, padding: '12px', borderRadius: 24, border: '1px solid #e5e7eb',
                    background: '#f3f4f6', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8,
                    minWidth: 140
                }}>
                    <FiPrinter /> Thermal Print
                </button>
                <button
                    onClick={handleShare}
                    style={{
                        flex: 1, padding: '12px', borderRadius: 24, border: 'none',
                        background: '#2563eb', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8,
                        minWidth: 120
                    }}>
                    <FiShare2 /> Send Bill
                </button>
            </div>

            <BottomSheet isOpen={isMenuOpen} onClose={() => setIsMenuOpen(false)}>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: 12, marginBottom: 24 }}>
                    {menuGridItems.map((item, idx) => (
                        <div key={idx} onClick={item.onClick} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 8 }}>
                            <div style={{
                                width: 48, height: 48, borderRadius: 12, background: 'white',
                                border: '1px solid #e5e7eb', display: 'flex', alignItems: 'center', justifyContent: 'center',
                                boxShadow: '0 1px 2px rgba(0,0,0,0.05)'
                            }}>
                                <item.icon size={20} />
                            </div>
                            <div style={{ fontSize: 11, fontWeight: 600, textAlign: 'center', lineHeight: 1.2 }}>{item.label}</div>
                        </div>
                    ))}
                </div>

                <div style={{ display: 'flex', flexDirection: 'column' }}>
                    {menuListItems.map((item, idx) => (
                        <div key={idx}
                            onClick={item.onClick || (() => alert(`${item.label} coming soon`))}
                            style={{
                                display: 'flex', alignItems: 'center', gap: 16, padding: '16px 0',
                                borderBottom: idx < menuListItems.length - 1 ? '1px solid #f3f4f6' : 'none',
                                color: item.danger ? '#ef4444' : 'inherit'
                            }}
                        >
                            <item.icon size={20} />
                            <div style={{ flex: 1 }}>
                                <div style={{ fontSize: 14, fontWeight: 500 }}>{item.label}</div>
                                {item.sub && <div style={{ fontSize: 11, color: '#9ca3af' }}>{item.sub}</div>}
                            </div>
                            {item.action && (
                                <div style={{
                                    width: 24, height: 24, borderRadius: 12, background: item.danger ? '#fee2e2' : '#f3f4f6',
                                    display: 'flex', alignItems: 'center', justifyContent: 'center'
                                }}>
                                    <div style={{
                                        width: 0, height: 0,
                                        borderTop: '4px solid transparent', borderBottom: '4px solid transparent',
                                        borderLeft: `6px solid ${item.danger ? '#ef4444' : '#6b7280'}`
                                    }} />
                                </div>
                            )}
                        </div>
                    ))}
                </div>
            </BottomSheet>

            <CancelInvoiceModal
                isOpen={isCancelModalOpen}
                onClose={() => setIsCancelModalOpen(false)}
                onConfirm={handleCancelInvoice}
            />
        </div>
    );
}

export default function InvoiceViewPage() {
    return (
        <Suspense fallback={<div>Loading...</div>}>
            <InvoiceViewContent />
        </Suspense>
    );
}
</file>

<file path="src/app/page.js">
'use client';

import Link from 'next/link';
import { FiBell, FiChevronRight, FiCheck, FiArrowUp, FiArrowDown } from 'react-icons/fi';
import { FaReceipt, FaShoppingBag, FaWallet, FaFileAlt, FaStar } from 'react-icons/fa';
import styles from './page.module.css';

export default function Home() {
  return (
    <div className={styles.container}>
      {/* Header */}
      <header className={styles.header}>
        <div className={styles.brand}>
          swipe <span>🇮🇳</span>
        </div>
        <div className={styles.headerRight}>
          <button className={styles.notificationBtn}>
            <FiBell />
          </button>
          <div className={styles.langToggle}>
            <span>HI</span>
            <span>🇮🇳</span>
          </div>
        </div>
      </header>

      {/* Business Pulse Card */}
      <section className={styles.pulseCard}>
        <div className={styles.pulseDecoration}></div>
        <div className={styles.pulseContent}>
          <div className={styles.pulseLabel}>Business Pulse</div>
          <div className={styles.pulseAmount}>₹42,300</div>
          <div className={styles.pulseStats}>
            <span className={styles.pulseSubtext}>received this week</span>
            <span className={styles.pulseBadge}>
              <FiArrowUp size={10} /> 12%
            </span>
          </div>
          <div className={styles.pulseNote}>
            5 payments completed - Great job! 🎉
          </div>
        </div>
        <div className={styles.pulseChart}>
          <div className={styles.chartBar} style={{ height: '30%', background: '#E5E7EB' }}></div>
          <div className={styles.chartBar} style={{ height: '45%', background: '#BBF7D0' }}></div>
          <div className={styles.chartBar} style={{ height: '35%', background: '#86EFAC' }}></div>
          <div className={styles.chartBar} style={{ height: '60%', background: '#4ADE80' }}></div>
          <div className={styles.chartBar} style={{ height: '50%', background: '#22C55E' }}></div>
          <div className={styles.chartBar} style={{ height: '85%', background: '#F5C242' }}></div>
        </div>
      </section>

      {/* Quick Actions Section */}
      <section className={styles.actionsSection}>
        {/* Primary Action - Create Invoice */}
        <Link href="/invoice/create" className={styles.primaryActionCard}>
          <div className={styles.primaryIconBox}>
            <FaReceipt size={22} />
            <div className={styles.starBadge}>
              <FaStar size={8} color="white" />
            </div>
          </div>
          <div className={styles.primaryActionInfo}>
            <div className={styles.primaryActionTitle}>Create Invoice</div>
            <div className={styles.primaryActionSubtitle}>Most used</div>
          </div>
          <FiChevronRight className={styles.actionChevron} size={24} />
        </Link>

        {/* Quick Action Buttons */}
        <div className={styles.quickActionsGrid}>
          <Link href="/bills/purchase/create" className={styles.quickActionBtn}>
            <FaShoppingBag size={16} />
            <span>Purchase</span>
          </Link>
          <Link href="/more/bills/expenses/create" className={styles.quickActionBtn}>
            <FaWallet size={16} />
            <span>Expense</span>
          </Link>
          <Link href="/invoice/create?type=proforma" className={styles.quickActionBtn}>
            <FaFileAlt size={16} />
            <span>Pro Forma</span>
          </Link>
        </div>
      </section>

      {/* Recent Activity Section */}
      <section className={styles.activitySection}>
        <div className={styles.sectionHeader}>
          <h3 className={styles.sectionTitle}>Recent Activity</h3>
          <Link href="/invoice" className={styles.seeAllLink}>
            See All <FiChevronRight size={16} />
          </Link>
        </div>

        <div className={styles.activityList}>
          {/* Activity Item 1 - Follow up payment */}
          <div className={styles.activityCard}>
            <div className={styles.activityAvatar}>
              <img src="https://images.unsplash.com/photo-1560343090-f0409e92791a?w=100&h=100&fit=crop" alt="Shop" />
              <div className={`${styles.avatarBadge} ${styles.success}`}>
                <FiArrowDown size={10} color="white" />
              </div>
            </div>
            <div className={styles.activityInfo}>
              <div className={styles.activityTitle}>Follow up payment</div>
              <div className={styles.activitySubtitle}>Ramesh Jewellers · ₹7,200</div>
            </div>
            <div className={styles.activityRight}>
              <div className={styles.activityAmount}>₹7,200</div>
              <div className={`${styles.activityStatus} ${styles.overdue}`}>5 days overdue</div>
            </div>
          </div>

          {/* Activity Item 2 - Last Invoice */}
          <div className={styles.activityCard}>
            <div className={styles.activityAvatar}>
              <FaReceipt size={20} color="#6B7280" />
              <div className={`${styles.avatarBadge} ${styles.warning}`}>
                <FiCheck size={10} color="white" />
              </div>
            </div>
            <div className={styles.activityInfo}>
              <div className={styles.activityTitle}>Last Invoice: INV-042</div>
              <div className={styles.activitySubtitle}>₹15,600 · Paid! 😊 · 15 mins ago</div>
            </div>
            <div className={styles.activityRight}>
              <div className={styles.activityAmount}>₹15,600 <span style={{ fontWeight: 400, fontSize: 11, color: '#22C55E' }}>Paid!</span></div>
              <div className={`${styles.activityStatus} ${styles.paid}`}>15 mins ago</div>
            </div>
          </div>

          {/* Activity Item 3 - Unpaid invoices */}
          <div className={styles.activityCard}>
            <div className={styles.unpaidCount}>3</div>
            <div className={styles.activityInfo}>
              <div className={styles.activityTitle}>3 invoices unpaid</div>
              <div className={styles.activitySubtitle}>₹18,900 at risk</div>
            </div>
            <div className={styles.activityRight}>
              <div className={styles.activityAmount}>₹18,900</div>
              <div className={`${styles.activityStatus} ${styles.risk}`}>A risk</div>
            </div>
          </div>
        </div>
      </section>

      {/* Floating Action Button */}
      <Link href="/invoice/create" className={styles.fab}>
        <FiCheck size={20} />
        Create Invoice
        <FiChevronRight size={16} />
      </Link>
    </div>
  );
}
</file>

<file path="src/components/InvoiceForm.js">
'use client';

import { useRouter, useSearchParams } from 'next/navigation';
import { useInvoiceStore } from '@/lib/store/invoiceStore';
import { usePartyStore } from '@/lib/store/partyStore';
import { useSettingsStore } from '@/lib/store/settingsStore';
import { useEffect } from 'react';
import { formatCurrency } from '@/lib/utils/tax';
import { db } from '@/lib/db';
import { generatePDF } from '@/lib/utils/pdf';
import { FiPlus, FiTrash2, FiCalendar, FiUser, FiBox, FiArrowLeft } from 'react-icons/fi';
import styles from './InvoiceForm.module.css';

export default function InvoiceForm() {
    const router = useRouter();
    const searchParams = useSearchParams(); // Need to import this
    const prefillCustomerId = searchParams?.get('customerId');
    const { getCustomer } = usePartyStore(); // Need to import this

    const {
        id, invoiceNumber, date, dueDate, placeOfSupply, invoiceCopyType, items, customer,
        details, toggles, payment, roundOff, type, // Add type
        addItem, updateItem, removeItem, calculateTotals,
        updateDetails, toggleSwitch, updatePayment, toggleRoundOff, resetInvoice, saveInvoice,
        setDueDate, setPlaceOfSupply, setInvoiceCopyType, setCustomer
    } = useInvoiceStore();

    useEffect(() => {
        if (prefillCustomerId && !customer) {
            const c = getCustomer(prefillCustomerId);
            if (c) setCustomer(c);
        }
    }, [prefillCustomerId, customer, getCustomer, setCustomer]);

    const totals = calculateTotals();

    const handleSave = async () => {
        if (!customer) return alert('Please select a customer');
        if (items.length === 0) return alert('Please add at least one item');

        try {
            const savedId = await saveInvoice();
            resetInvoice(); // Clear form
            router.push(`/invoice/view?id=${savedId}`);
        } catch (error) {
            console.error('Failed to save invoice:', error);
            alert('Failed to save invoice: ' + error.message);
        }
    };

    const handleDownloadPDF = async () => {
        const { templateId, lendingBillTemplateId } = useSettingsStore.getState();

        await generatePDF({
            invoiceNumber,
            date,
            items,
            totals,
            type,
            templateId: type === 'LENDING' ? (lendingBillTemplateId || 'modern') : (templateId || 'modern')
        });
    };

    return (
        <div className={styles.container}>
            <div className={styles.card}>
                <div className={styles.row}>
                    <div>
                        <div className={styles.label}>{type === 'PROFORMA' ? 'Pro Forma #' : type === 'LENDING' ? 'Lending Bill #' : 'Invoice #'}</div>
                        <div className={styles.value}>{invoiceNumber}</div>
                        {type === 'PROFORMA' && <span style={{ fontSize: 10, background: '#e0e7ff', color: '#4338ca', padding: '2px 6px', borderRadius: 4 }}>PRO FORMA</span>}
                        {type === 'LENDING' && <span style={{ fontSize: 10, background: '#f3f4f6', color: '#374151', padding: '2px 6px', borderRadius: 4 }}>LENDING BILL</span>}
                    </div>
                    <div className={styles.value} style={{ color: 'var(--primary)' }}>Edit</div>
                </div>
                <div className={styles.row}>
                    <div className={styles.label}>Date</div>
                    <input type="date" className={styles.input} value={date} onChange={(e) => useInvoiceStore.getState().setDate(e.target.value)} />
                </div>
                <div className={styles.row}>
                    <div className={styles.label}>Due Date</div>
                    <input type="date" className={styles.input} value={dueDate} onChange={(e) => setDueDate(e.target.value)} />
                </div>

            </div>

            <div className={styles.sectionTitle}>
                Customer <FiUser size={14} />
            </div>
            <div className={styles.card}>
                {customer ? (
                    <div className={styles.selectedCustomer}>
                        <div className={styles.customerInfo}>
                            <div className={styles.customerName}>{customer.name}</div>
                            {customer.phone && <div className={styles.customerPhone}>{customer.phone}</div>}
                        </div>
                        <div className={styles.customerActions}>
                            <button
                                className={styles.actionButton}
                                onClick={() => router.push('/invoice/create/select-customer')}
                            >
                                View
                            </button>
                            <button
                                className={styles.actionButton}
                                onClick={() => router.push('/invoice/create/select-customer')}
                            >
                                Change
                            </button>
                        </div>
                    </div>
                ) : (
                    <button
                        className={styles.addButton}
                        onClick={() => router.push('/invoice/create/select-customer')}
                    >
                        <FiPlus /> Select Customer
                    </button>
                )}
            </div>

            <div className={styles.sectionTitle}>
                Products <FiBox size={14} />
            </div>
            {/* Products List with Jewellery Fields */}
            <div className={styles.card}>
                {type !== 'LENDING' && (
                    <button
                        className={styles.addButton}
                        onClick={() => router.push('/invoice/create/select-product')}
                        style={{ marginBottom: '12px' }}
                    >
                        <FiPlus /> Select Products
                    </button>
                )}

                {items.map((item) => (
                    <div key={item.id} className={styles.itemRow} style={{ borderBottom: '1px solid #f3f4f6', paddingBottom: 16 }}>
                        <div className={styles.itemHeader} style={{ marginBottom: 8, justifyContent: 'space-between', alignItems: 'flex-start' }}>
                            <div style={{ flex: 1 }}>
                                {type === 'LENDING' ? (
                                    <div style={{ marginBottom: 8 }}>
                                        <label style={{ fontSize: 10, color: '#6b7280', display: 'block', marginBottom: 4 }}>Item Description / Subcategory</label>
                                        <input
                                            className={styles.input}
                                            value={item.name}
                                            onChange={(e) => updateItem(item.id, 'name', e.target.value)}
                                            placeholder="Enter Item Description (e.g. Gold Ring)"
                                        />
                                    </div>
                                ) : (
                                    <div style={{ fontWeight: 600 }}>{item.name}</div>
                                )}
                            </div>
                            <button onClick={() => removeItem(item.id)} style={{ color: 'red', border: 'none', background: 'none', marginLeft: 8, padding: 4 }}>
                                <FiTrash2 />
                            </button>
                        </div>

                        {type === 'LENDING' ? (
                            <div style={{ display: 'flex', gap: 16 }}>
                                <div style={{ width: 100 }}>
                                    <label style={{ fontSize: 10, color: '#6b7280' }}>Quantity</label>
                                    <input
                                        className={styles.input}
                                        type="number"
                                        value={item.quantity}
                                        onChange={(e) => updateItem(item.id, 'quantity', Number(e.target.value))}
                                        placeholder="1"
                                    />
                                </div>
                            </div>
                        ) : (
                            <>
                                {/* Row 1: Weights (Read Only) */}
                                <div style={{ display: 'flex', gap: 8, marginBottom: 8 }}>
                                    <div style={{ flex: 1 }}>
                                        <label style={{ fontSize: 10, color: '#6b7280' }}>Gross Wt</label>
                                        <input
                                            className={styles.input}
                                            value={item.grossWeight || ''}
                                            readOnly
                                            placeholder="0"
                                            style={{ background: '#f9fafb' }}
                                        />
                                    </div>
                                    <div style={{ flex: 1 }}>
                                        <label style={{ fontSize: 10, color: '#6b7280' }}>Net Wt (g)</label>
                                        <input
                                            className={styles.input}
                                            type="number"
                                            value={item.netWeight || ''}
                                            onChange={(e) => updateItem(item.id, 'netWeight', e.target.value)}
                                            placeholder="0"
                                            // Manual items might need editable weight
                                            readOnly={!!item.productId}
                                            style={{ background: item.productId ? '#f9fafb' : 'white' }}
                                        />
                                    </div>
                                    <div style={{ flex: 1 }}>
                                        <label style={{ fontSize: 10, color: '#6b7280' }}>Purity</label>
                                        <input
                                            className={styles.input}
                                            value={item.purity || ''}
                                            readOnly
                                            placeholder="-"
                                            style={{ background: '#f9fafb' }}
                                        />
                                    </div>
                                </div>

                                {/* Row 2: Pricing Inputs */}
                                <div style={{ display: 'flex', gap: 8, marginBottom: 8 }}>
                                    <div style={{ flex: 1 }}>
                                        <label style={{ fontSize: 10, color: '#6b7280' }}>Rate/gm</label>
                                        <input
                                            className={styles.input}
                                            type="number"
                                            value={item.ratePerGram || ''}
                                            onChange={(e) => updateItem(item.id, 'ratePerGram', e.target.value)}
                                            placeholder="Rate"
                                        />
                                    </div>
                                    <div style={{ flex: 1 }}>
                                        <label style={{ fontSize: 10, color: '#6b7280' }}>MC/gm</label>
                                        <input
                                            className={styles.input}
                                            type="number"
                                            value={item.makingChargePerGram || ''}
                                            onChange={(e) => updateItem(item.id, 'makingChargePerGram', e.target.value)}
                                            placeholder="MC"
                                        />
                                    </div>
                                </div>

                                {/* Row 3: Totals (Computed) */}
                                <div style={{ display: 'flex', gap: 8, background: '#f8fafc', padding: 8, borderRadius: 6 }}>
                                    <div style={{ flex: 1 }}>
                                        <div style={{ fontSize: 10, color: '#6b7280' }}>Mat. Value</div>
                                        <div style={{ fontSize: 12, fontWeight: 500 }}>
                                            {formatCurrency((Number(item.netWeight) || 0) * (Number(item.ratePerGram) || 0))}
                                        </div>
                                    </div>
                                    <div style={{ flex: 1 }}>
                                        <div style={{ fontSize: 10, color: '#6b7280' }}>Making Chg</div>
                                        <div style={{ fontSize: 12, fontWeight: 500 }}>
                                            {formatCurrency((Number(item.netWeight) || 0) * (Number(item.makingChargePerGram) || 0))}
                                        </div>
                                    </div>
                                    <div style={{ flex: 1, textAlign: 'right' }}>
                                        <div style={{ fontSize: 10, color: '#6b7280' }}>Total</div>
                                        <div style={{ fontSize: 14, fontWeight: 600, color: '#2563eb' }}>
                                            {formatCurrency(
                                                ((Number(item.netWeight) || 0) * (Number(item.ratePerGram) || 0)) +
                                                ((Number(item.netWeight) || 0) * (Number(item.makingChargePerGram) || 0))
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </>
                        )}
                    </div>
                ))}

                <button
                    className={styles.addButton}
                    onClick={() => {
                        useInvoiceStore.getState().addItem();
                    }}
                    style={{ background: 'white', border: '1px solid #e5e7eb', color: '#4b5563' }}
                >
                    <FiPlus /> {type === 'LENDING' ? 'Add Item' : 'Add Manual Item'}
                </button>
            </div>

            {/* Weight Summary for Lending Bill */}
            {type === 'LENDING' && (
                <>
                    <div className={styles.sectionTitle}>
                        Weight Summary <FiBox size={14} />
                    </div>
                    <div className={styles.card}>
                        <div style={{ display: 'flex', gap: 16 }}>
                            <div style={{ flex: 1 }}>
                                <label className={styles.label}>Gross Weight (g)</label>
                                <input
                                    type="number"
                                    className={styles.input}
                                    value={useInvoiceStore.getState().weightSummary?.grossWeight || ''}
                                    onChange={(e) => useInvoiceStore.getState().setWeightSummary('grossWeight', e.target.value)}
                                    placeholder="0.000"
                                />
                            </div>
                            <div style={{ flex: 1 }}>
                                <label className={styles.label}>Net Weight (g)</label>
                                <input
                                    type="number"
                                    className={styles.input}
                                    value={useInvoiceStore.getState().weightSummary?.netWeight || ''}
                                    onChange={(e) => useInvoiceStore.getState().setWeightSummary('netWeight', e.target.value)}
                                    placeholder="0.000"
                                />
                            </div>
                        </div>
                    </div>
                </>
            )}

            {/* Optional Fields */}
            <div className={styles.sectionTitle}>Optional</div>
            <div className={styles.card} style={{ padding: 0 }}>
                {[
                    { icon: '📄', label: 'Add Reference', field: 'reference', type: 'text' },
                    { icon: '📋', label: 'Add Terms', field: 'terms', type: 'text' },
                ].map((opt, idx) => (
                    <div key={idx} className={styles.optionalRow}>
                        <div className={styles.optionalLabel}>
                            <span style={{ width: 24, textAlign: 'center' }}>{opt.icon}</span>
                            {opt.label}
                        </div>
                        <input
                            type={opt.type}
                            className={styles.optionalInput}
                            placeholder={opt.label}
                            value={details[opt.field]}
                            onChange={(e) => updateDetails(opt.field, e.target.value)}
                        />
                    </div>
                ))}
                <div className={styles.optionalRow} style={{ borderBottom: 'none' }}>
                    <div className={styles.optionalLabel}>
                        <span style={{ width: 24, textAlign: 'center' }}>📎</span>
                        Attachments
                    </div>
                </div>
            </div>


            {/* Payments - Hide for Lending Bill */}
            {type !== 'LENDING' && (
                <>
                    <div className={styles.sectionTitle}>Payments</div>
                    <div className={styles.card}>
                        <div className={styles.checkboxRow}>
                            <input
                                type="checkbox"
                                checked={payment.isFullyPaid}
                                onChange={(e) => {
                                    updatePayment('isFullyPaid', e.target.checked);
                                    if (e.target.checked) updatePayment('amountReceived', totals.total);
                                }}
                                style={{ width: 18, height: 18 }}
                            />
                            <span style={{ fontWeight: 500 }}>Mark as fully paid</span>
                        </div>

                        <div className={styles.paymentGrid}>
                            <div>
                                <div className={styles.label}>Amount Received</div>
                                <div className={styles.inputWrapper}>
                                    <span style={{ color: '#6b7280' }}>₹</span>
                                    <input
                                        type="number"
                                        className={styles.paymentInput}
                                        value={payment.amountReceived}
                                        onChange={(e) => updatePayment('amountReceived', e.target.value)}
                                    />
                                </div>
                            </div>
                            <div>
                                <div className={styles.label}>Payment Mode</div>
                                <select
                                    className={styles.select}
                                    value={payment.mode}
                                    onChange={(e) => updatePayment('mode', e.target.value)}
                                >
                                    <option>Cash</option>
                                    <option>UPI</option>
                                    <option>Bank Transfer</option>
                                    <option>Cheque</option>
                                </select>
                            </div>
                        </div>

                        <div style={{ marginTop: 12 }}>
                            <div className={styles.label}>Notes</div>
                            <input
                                className={styles.input}
                                placeholder="Advance Received, UTR Number etc.,"
                                value={payment.notes}
                                onChange={(e) => updatePayment('notes', e.target.value)}
                            />
                        </div>
                    </div>
                </>
            )}

            {/* Footer */}
            <div className={styles.footer}>
                <div className={styles.footerLeft}>
                    {type === 'LENDING' ? (
                        <div style={{ fontSize: 12, color: '#6b7280' }}>
                            Total Items: {items.length} | Total Qty: {items.reduce((acc, i) => acc + (i.quantity || 0), 0)}
                        </div>
                    ) : (
                        <>
                            <div className={styles.footerRow}>
                                <span>Sub Total</span>
                                <span>{formatCurrency(totals.subtotal)}</span>
                            </div>

                            {/* Tax Breakdown (Only for Regular Invoices) */}
                            {type !== 'PROFORMA' && (
                                <>
                                    <div className={styles.footerRow} style={{ color: '#6b7280', fontSize: 12 }}>
                                        <span>CGST (1.5%)</span>
                                        <span>{formatCurrency(totals.cgst)}</span>
                                    </div>
                                    <div className={styles.footerRow} style={{ color: '#6b7280', fontSize: 12 }}>
                                        <span>SGST (1.5%)</span>
                                        <span>{formatCurrency(totals.sgst)}</span>
                                    </div>
                                </>
                            )}

                            <div className={styles.footerRow}>
                                <span>Round Off</span>
                                <div
                                    className={`${styles.toggleSwitch} ${roundOff ? styles.active : ''}`}
                                    onClick={toggleRoundOff}
                                    style={{ width: 36, height: 20 }}
                                >
                                    <div className={styles.toggleKnob} style={{ width: 16, height: 16 }} />
                                </div>
                                <span>{totals.roundOffAmount.toFixed(2)}</span>
                            </div>
                            <div className={styles.totalAmount}>
                                <span>Total Amount</span>
                                <span>{formatCurrency(totals.total)}</span>
                            </div>
                        </>
                    )}
                </div>
                <button className={styles.createButton} onClick={handleSave}>
                    {id ? 'Update' : 'Create'} <FiArrowLeft style={{ transform: 'rotate(180deg)' }} />
                </button>
            </div>
        </div>
    );
}
</file>

<file path="package.json">
{
  "name": "swipe-app",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "mobile:build": "next build && npx cap sync",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "cypress:open": "cypress open",
    "cypress:run": "cypress run"
  },
  "dependencies": {
    "@capacitor/android": "^7.4.4",
    "@capacitor/app": "^7.1.0",
    "@capacitor/assets": "^3.0.5",
    "@capacitor/cli": "^7.4.4",
    "@capacitor/core": "^7.4.4",
    "@capacitor/filesystem": "^7.1.5",
    "@capacitor/share": "^7.0.2",
    "clsx": "^2.1.1",
    "dexie": "^4.2.1",
    "framer-motion": "^12.23.24",
    "html2canvas": "^1.4.1",
    "html5-qrcode": "^2.3.8",
    "jspdf": "^3.0.4",
    "minisearch": "^7.2.0",
    "next": "^16.0.7",
    "papaparse": "^5.5.3",
    "react": "^19.2.1",
    "react-dom": "^19.2.1",
    "react-icons": "^5.5.0",
    "zustand": "^5.0.8"
  },
  "packageManager": "pnpm@10.10.0+sha512.d615db246fe70f25dcfea6d8d73dee782ce23e2245e3c4f6f888249fb568149318637dca73c2c5c8ef2a4ca0d5657fb9567188bfab47f566d1ee6ce987815c39",
  "devDependencies": {
    "@testing-library/dom": "^10.4.1",
    "@testing-library/jest-dom": "^6.9.1",
    "@testing-library/react": "^16.3.0",
    "@testing-library/user-event": "^14.6.1",
    "cypress": "^14.5.4",
    "jest": "^29.7.0",
    "jest-environment-jsdom": "^29.7.0",
    "msw": "^2.12.4"
  }
}
</file>

</files>
